(function(){function e(e,t){var i;e||(e={});for(i in t)e[i]=t[i];return e}function t(){var e,t=arguments,i,s={},n=function(e,t){var i,s;typeof e!=="object"&&(e={});for(s in t)t.hasOwnProperty(s)&&(i=t[s],e[s]=i&&typeof i==="object"&&Object.prototype.toString.call(i)!=="[object Array]"&&s!=="renderTo"&&typeof i.nodeType!=="number"?n(e[s]||{},i):t[s]);return e};t[0]===!0&&(s=t[1],t=Array.prototype.slice.call(t,2));i=t.length;for(e=0;e<i;e++)s=n(s,t[e]);return s}function i(e,t){return parseInt(e,t||10)}function s(e){return typeof e==="string"}function n(e){return typeof e==="object"}function a(e){return Object.prototype.toString.call(e)==="[object Array]"}function o(e){return typeof e==="number"}function r(e){return z.log(e)/z.LN10}function l(e){return z.pow(10,e)}function h(e,t){for(var i=e.length;i--;)if(e[i]===t){e.splice(i,1);break}}function u(e){return e!==N&&e!==null}function c(e,t,i){var a,o;if(s(t))u(i)?e.setAttribute(t,i):e&&e.getAttribute&&(o=e.getAttribute(t));else if(u(t)&&n(t))for(a in t)e.setAttribute(a,t[a]);return o}function d(e){return a(e)?e:[e]}function p(){var e=arguments,t,i,s=e.length;for(t=0;t<s;t++)if(i=e[t],typeof i!=="undefined"&&i!==null)return i}function m(t,i){if(ee&&!oe&&i&&i.opacity!==N)i.filter="alpha(opacity="+i.opacity*100+")";e(t.style,i)}function f(t,i,s,n,a){t=H.createElement(t);i&&e(t,i);a&&m(t,{padding:0,border:we,margin:0});s&&m(t,s);n&&n.appendChild(t);return t}function g(t,i){var s=function(){};s.prototype=new t;e(s.prototype,i);return s}function _(e,t,s,n){var a=me.lang,e=+e||0,o=t===-1?(e.toString().split(".")[1]||"").length:isNaN(t=W(t))?2:t,t=s===void 0?a.decimalPoint:s,n=n===void 0?a.thousandsSep:n,a=e<0?"-":"",s=String(i(e=W(e).toFixed(o))),r=s.length>3?s.length%3:0;return a+(r?s.substr(0,r)+n:"")+s.substr(r).replace(/(\d{3})(?=\d)/g,"$1"+n)+(o?t+W(e-s).toFixed(o).slice(2):"")}function y(e,t){return Array((t||2)+1-String(e).length).join(0)+e}function b(e,t,i){var s=e[t];e[t]=function(){var e=Array.prototype.slice.call(arguments);e.unshift(s);return i.apply(this,e)}}function S(e,t){for(var i="{",s=!1,n,a,o,r,l,h=[];(i=e.indexOf(i))!==-1;){n=e.slice(0,i);if(s){a=n.split(":");o=a.shift().split(".");l=o.length;n=t;for(r=0;r<l;r++)n=n[o[r]];if(a.length)a=a.join(":"),o=/\.([0-9])/,r=me.lang,l=void 0,/f$/.test(a)?(l=(l=a.match(o))?l[1]:-1,n=_(n,l,r.decimalPoint,a.indexOf(",")>-1?r.thousandsSep:"")):n=fe(a,n)}h.push(n);e=e.slice(i+1);i=(s=!s)?"}":"{"}h.push(e);return h.join("")}function v(e){return z.pow(10,$(z.log(e)/z.LN10))}function w(e,t,i,s){var n,i=p(i,1);n=e/i;t||(t=[1,2,2.5,5,10],s&&s.allowDecimals===!1&&(i===1?t=[1,2,5,10]:i<=.1&&(t=[1/i])));for(s=0;s<t.length;s++)if(e=t[s],n<=(t[s]+(t[s+1]||t[s]))/2)break;e*=i;return e}function C(){this.symbol=this.color=0}function M(e,t){var i=e.length,s,n;for(n=0;n<i;n++)e[n].ss_i=n;e.sort(function(e,i){s=t(e,i);return s===0?e.ss_i-i.ss_i:s});for(n=0;n<i;n++)delete e[n].ss_i}function T(e){for(var t=e.length,i=e[0];t--;)e[t]<i&&(i=e[t]);return i}function x(e){for(var t=e.length,i=e[0];t--;)e[t]>i&&(i=e[t]);return i}function D(e,t){for(var i in e)e[i]&&e[i]!==t&&e[i].destroy&&e[i].destroy(),delete e[i]}function A(e){pe||(pe=f(ve));e&&pe.appendChild(e);pe.innerHTML=""}function L(e,t){var i="Highcharts error #"+e+": www.highcharts.com/errors/"+e;if(t)throw i;else q.console&&console.log(i)}function I(e){return parseFloat(e.toPrecision(14))}function k(e,t){ge=p(e,t.animation)}function P(){var e=me.global.useUTC,t=e?"getUTC":"get",i=e?"setUTC":"set";xe=(e&&me.global.timezoneOffset||0)*6e4;Te=e?Date.UTC:function(e,t,i,s,n,a){return new Date(e,t,p(i,1),p(s,0),p(n,0),p(a,0)).getTime()};De=t+"Minutes";Ae=t+"Hours";Le=t+"Day";Ie=t+"Date";ke=t+"Month";Pe=t+"FullYear";Ee=i+"Minutes";Ve=i+"Hours";Oe=i+"Date";Re=i+"Month";Be=i+"FullYear"}function E(){}function V(e,t,i,s){this.axis=e;this.pos=t;this.type=i||"";this.isNew=!0;!i&&!s&&this.addLabel()}function O(){this.init.apply(this,arguments)}function R(){this.init.apply(this,arguments)}function B(e,t,i,s,n,a){var o=e.chart.inverted;this.axis=e;this.isNegative=i;this.options=t;this.x=s;this.total=null;this.points={};this.stack=n;this.percent=a==="percent";this.alignOptions={align:t.align||(o?i?"left":"right":"center"),verticalAlign:t.verticalAlign||(o?"middle":i?"bottom":"top"),y:p(t.y,o?4:i?14:-6),x:p(t.x,o?i?-6:6:0)};this.textAlign=t.textAlign||(o?i?"right":"left":"center")}var N,H=document,q=window,z=Math,F=z.round,$=z.floor,Y=z.ceil,U=z.max,G=z.min,W=z.abs,Q=z.cos,X=z.sin,j=z.PI,K=j*2/360,Z=navigator.userAgent,J=q.opera,ee=/msie/i.test(Z)&&!J,te=H.documentMode===8,ie=/AppleWebKit/.test(Z),se=/Firefox/.test(Z),ne=/(Mobile|Android|Windows Phone)/.test(Z),ae="http://www.w3.org/2000/svg",oe=!!H.createElementNS&&!!H.createElementNS(ae,"svg").createSVGRect,re=se&&parseInt(Z.split("Firefox/")[1],10)<4,le=!oe&&!ee&&!!H.createElement("canvas").getContext,he,ue,ce={},de=0,pe,me,fe,ge,_e,ye,be=function(){},Se=[],ve="div",we="none",Ce=/^[0-9]+$/,Me="stroke-width",Te,xe,De,Ae,Le,Ie,ke,Pe,Ee,Ve,Oe,Re,Be,Ne={},He=q.Highcharts=q.Highcharts?L(16,!0):{};fe=function(t,i,s){if(!u(i)||isNaN(i))return"Invalid date";var t=p(t,"%Y-%m-%d %H:%M:%S"),n=new Date(i-xe),a,o=n[Ae](),r=n[Le](),l=n[Ie](),h=n[ke](),c=n[Pe](),d=me.lang,m=d.weekdays,n=e({a:m[r].substr(0,3),A:m[r],d:y(l),e:l,b:d.shortMonths[h],B:d.months[h],m:y(h+1),y:c.toString().substr(2,2),Y:c,H:y(o),I:y(o%12||12),l:o%12||12,M:y(n[De]()),p:o<12?"AM":"PM",P:o<12?"am":"pm",S:y(n.getSeconds()),L:y(F(i%1e3),3)},He.dateFormats);for(a in n)for(;t.indexOf("%"+a)!==-1;)t=t.replace("%"+a,typeof n[a]==="function"?n[a](i):n[a]);return s?t.substr(0,1).toUpperCase()+t.substr(1):t};C.prototype={wrapColor:function(e){if(this.color>=e)this.color=0},wrapSymbol:function(e){if(this.symbol>=e)this.symbol=0}};ye=function(){for(var e=0,t=arguments,i=t.length,s={};e<i;e++)s[t[e++]]=t[e];return s}("millisecond",1,"second",1e3,"minute",6e4,"hour",36e5,"day",864e5,"week",6048e5,"month",26784e5,"year",31556952e3);_e={init:function(e,t,i){var t=t||"",s=e.shift,n=t.indexOf("C")>-1,a=n?7:3,o,t=t.split(" "),i=[].concat(i),r,l,h=function(e){for(o=e.length;o--;)e[o]==="M"&&e.splice(o+1,0,e[o+1],e[o+2],e[o+1],e[o+2])};n&&(h(t),h(i));e.isArea&&(r=t.splice(t.length-6,6),l=i.splice(i.length-6,6));if(s<=i.length/a&&t.length===i.length)for(;s--;)i=[].concat(i).splice(0,a).concat(i);e.shift=0;if(t.length)for(e=i.length;t.length<e;)s=[].concat(t).splice(t.length-a,a),n&&(s[a-6]=s[a-2],s[a-5]=s[a-1]),t=t.concat(s);r&&(t=t.concat(r),i=i.concat(l));return[t,i]},step:function(e,t,i,s){var n=[],a=e.length;if(i===1)n=s;else if(a===t.length&&i<1)for(;a--;)s=parseFloat(e[a]),n[a]=isNaN(s)?e[a]:i*parseFloat(t[a]-s)+s;else n=t;return n}};(function(t){q.HighchartsAdapter=q.HighchartsAdapter||t&&{init:function(e){var i=t.fx,n=i.step,a,o=t.Tween,r=o&&o.propHooks;a=t.cssHooks.opacity;t.extend(t.easing,{easeOutQuad:function(e,t,i,s,n){return-s*(t/=n)*(t-2)+i}});t.each(["cur","_default","width","height","opacity"],function(e,t){var s=n,a;t==="cur"?s=i.prototype:t==="_default"&&o&&(s=r[t],t="set");(a=s[t])&&(s[t]=function(i){var s,i=e?i:this;if(i.prop!=="align")return s=i.elem,s.attr?s.attr(i.prop,t==="cur"?N:i.now):a.apply(this,arguments)})});b(a,"get",function(e,t,i){return t.attr?t.opacity||0:e.call(this,t,i)});a=function(t){var i=t.elem,s;if(!t.started)s=e.init(i,i.d,i.toD),t.start=s[0],t.end=s[1],t.started=!0;i.attr("d",e.step(t.start,t.end,t.pos,i.toD))};o?r.d={set:a}:n.d=a;this.each=Array.prototype.forEach?function(e,t){return Array.prototype.forEach.call(e,t)}:function(e,t){for(var i=0,s=e.length;i<s;i++)if(t.call(e[i],e[i],i,e)===!1)return i};t.fn.highcharts=function(){var e="Chart",t=arguments,i,n;s(t[0])&&(e=t[0],t=Array.prototype.slice.call(t,1));i=t[0];if(i!==N)i.chart=i.chart||{},i.chart.renderTo=this[0],new He[e](i,t[1]),n=this;i===N&&(n=Se[c(this[0],"data-highcharts-chart")]);return n}},getScript:t.getScript,inArray:t.inArray,adapterRun:function(e,i){return t(e)[i]()},grep:t.grep,map:function(e,t){for(var i=[],s=0,n=e.length;s<n;s++)i[s]=t.call(e[s],e[s],s,e);return i},offset:function(e){return t(e).offset()},addEvent:function(e,i,s){t(e).bind(i,s)},removeEvent:function(e,i,s){var n=H.removeEventListener?"removeEventListener":"detachEvent";H[n]&&e&&!e[n]&&(e[n]=function(){});t(e).unbind(i,s)},fireEvent:function(i,s,n,a){var o=t.Event(s),r="detached"+s,l;!ee&&n&&(delete n.layerX,delete n.layerY);e(o,n);i[s]&&(i[r]=i[s],i[s]=null);t.each(["preventDefault","stopPropagation"],function(e,t){var i=o[t];o[t]=function(){try{i.call(o)}catch(e){t==="preventDefault"&&(l=!0)}}});t(i).trigger(o);i[r]&&(i[s]=i[r],i[r]=null);a&&!o.isDefaultPrevented()&&!l&&a(o)},washMouseEvent:function(e){var t=e.originalEvent||e;if(t.pageX===N)t.pageX=e.pageX,t.pageY=e.pageY;return t},animate:function(e,i,s){var n=t(e);if(!e.style)e.style={};if(i.d)e.toD=i.d,i.d=1;n.stop();i.opacity!==N&&e.attr&&(i.opacity+="px");n.animate(i,s)},stop:function(e){t(e).stop()}}})(q.jQuery);var qe=q.HighchartsAdapter,ze=qe||{};qe&&qe.init.call(qe,_e);var Fe=ze.adapterRun,$e=ze.getScript,Ye=ze.inArray,Ue=ze.each,Ge=ze.grep,We=ze.offset,Qe=ze.map,Xe=ze.addEvent,je=ze.removeEvent,Ke=ze.fireEvent,Ze=ze.washMouseEvent,Je=ze.animate,et=ze.stop,ze={enabled:!0,x:0,y:15,style:{color:"#666",cursor:"default",fontSize:"11px"}};me={colors:"#2f7ed8,#0d233a,#8bbc21,#910000,#1aadce,#492970,#f28f43,#77a1e5,#c42525,#a6c96a".split(","),symbols:["circle","diamond","square","triangle","triangle-down"],lang:{loading:"Loading...",months:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),shortMonths:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),weekdays:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),decimalPoint:".",numericSymbols:"k,M,G,T,P,E".split(","),resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",thousandsSep:","},global:{useUTC:!0,canvasToolsURL:"http://code.highcharts.com/3.0.10/modules/canvas-tools.js",VMLRadialGradientURL:"http://code.highcharts.com/3.0.10/gfx/vml-radial-gradient.png"},chart:{borderColor:"#4572A7",borderRadius:5,defaultSeriesType:"line",ignoreHiddenSeries:!0,spacing:[10,10,15,10],backgroundColor:"#FFFFFF",plotBorderColor:"#C0C0C0",resetZoomButton:{theme:{zIndex:20},position:{align:"right",x:-10,y:10}}},title:{text:"Chart title",align:"center",margin:15,style:{color:"#274b6d",fontSize:"16px"}},subtitle:{text:"",align:"center",style:{color:"#4d759e"}},plotOptions:{line:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:2,marker:{enabled:!0,lineWidth:0,radius:4,lineColor:"#FFFFFF",states:{hover:{enabled:!0},select:{fillColor:"#FFFFFF",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:t(ze,{align:"center",enabled:!1,formatter:function(){return this.y===null?"":_(this.y,-1)},verticalAlign:"bottom",y:0}),cropThreshold:300,pointRange:0,states:{hover:{marker:{}},select:{marker:{}}},stickyTracking:!0,turboThreshold:1e3}},labels:{style:{position:"absolute",color:"#3E576F"}},legend:{enabled:!0,align:"center",layout:"horizontal",labelFormatter:function(){return this.name},borderWidth:1,borderColor:"#909090",borderRadius:5,navigation:{activeColor:"#274b6d",inactiveColor:"#CCC"},shadow:!1,itemStyle:{color:"#274b6d",fontSize:"12px"},itemHoverStyle:{color:"#000"},itemHiddenStyle:{color:"#CCC"},itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"1em"},style:{position:"absolute",backgroundColor:"white",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:oe,backgroundColor:"rgba(255, 255, 255, .85)",borderWidth:1,borderRadius:3,dateTimeLabelFormats:{millisecond:"%A, %b %e, %H:%M:%S.%L",second:"%A, %b %e, %H:%M:%S",minute:"%A, %b %e, %H:%M",hour:"%A, %b %e, %H:%M",day:"%A, %b %e, %Y",week:"Week from %A, %b %e, %Y",month:"%B %Y",year:"%Y"},headerFormat:'<span style="font-size: 10px">{point.key}</span><br/>',pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b><br/>',shadow:!0,snap:ne?25:10,style:{color:"#333333",cursor:"default",fontSize:"12px",padding:"8px",whiteSpace:"nowrap"}},credits:{enabled:!0,text:"Highcharts.com",href:"http://www.highcharts.com",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#909090",fontSize:"9px"}}};var tt=me.plotOptions,qe=tt.line;P();var it=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/,st=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,nt=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,at=function(e){var s=[],n,a;(function(e){e&&e.stops?a=Qe(e.stops,function(e){return at(e[1])}):(n=it.exec(e))?s=[i(n[1]),i(n[2]),i(n[3]),parseFloat(n[4],10)]:(n=st.exec(e))?s=[i(n[1],16),i(n[2],16),i(n[3],16),1]:(n=nt.exec(e))&&(s=[i(n[1]),i(n[2]),i(n[3]),1])})(e);return{get:function(i){var n;a?(n=t(e),n.stops=[].concat(n.stops),Ue(a,function(e,t){n.stops[t]=[n.stops[t][0],e.get(i)]})):n=s&&!isNaN(s[0])?i==="rgb"?"rgb("+s[0]+","+s[1]+","+s[2]+")":i==="a"?s[3]:"rgba("+s.join(",")+")":e;return n},brighten:function(e){if(a)Ue(a,function(t){t.brighten(e)});else if(o(e)&&e!==0){var t;for(t=0;t<3;t++)s[t]+=i(e*255),s[t]<0&&(s[t]=0),s[t]>255&&(s[t]=255)}return this},rgba:s,setOpacity:function(e){s[3]=e;return this}}};E.prototype={init:function(e,t){this.element=t==="span"?f(t):H.createElementNS(ae,t);this.renderer=e;this.attrSetters={}},opacity:1,animate:function(e,i,s){i=p(i,ge,!0);et(this);if(i){i=t(i,{});if(s)i.complete=s;Je(this,e,i)}else this.attr(e),s&&s()},attr:function(e,t){var n,a,o,r,l=this.element,h=l.nodeName.toLowerCase(),d=this.renderer,m,f=this.attrSetters,g=this.shadows,_,y,b=this;s(e)&&u(t)&&(n=e,e={},e[n]=t);if(s(e))n=e,h==="circle"?n={x:"cx",y:"cy"}[n]||n:n==="strokeWidth"&&(n="stroke-width"),b=c(l,n)||this[n]||0,n!=="d"&&n!=="visibility"&&n!=="fill"&&(b=parseFloat(b));else{for(n in e)if(m=!1,a=e[n],o=f[n]&&f[n].call(this,a,n),o!==!1){o!==N&&(a=o);if(n==="d")a&&a.join&&(a=a.join(" ")),/(NaN| {2}|^$)/.test(a)&&(a="M 0 0");else if(n==="x"&&h==="text")for(o=0;o<l.childNodes.length;o++)r=l.childNodes[o],c(r,"x")===c(l,"x")&&c(r,"x",a);else if(this.rotation&&(n==="x"||n==="y"))y=!0;else if(n==="fill")a=d.color(a,l,n);else if(h==="circle"&&(n==="x"||n==="y"))n={x:"cx",y:"cy"}[n]||n;else if(h==="rect"&&n==="r")c(l,{rx:a,ry:a}),m=!0;else if(n==="translateX"||n==="translateY"||n==="rotation"||n==="verticalAlign"||n==="scaleX"||n==="scaleY")m=y=!0;else if(n==="stroke")a=d.color(a,l,n);else if(n==="dashstyle")if(n="stroke-dasharray",a=a&&a.toLowerCase(),a==="solid")a=we;else{if(a){a=a.replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(o=a.length;o--;)a[o]=i(a[o])*p(e["stroke-width"],this["stroke-width"]);a=a.join(",")}}else if(n==="width")a=i(a);else if(n==="align")n="text-anchor",a={left:"start",center:"middle",right:"end"}[a];else if(n==="title")o=l.getElementsByTagName("title")[0],o||(o=H.createElementNS(ae,"title"),l.appendChild(o)),o.textContent=a;n==="strokeWidth"&&(n="stroke-width");if(n==="stroke-width"||n==="stroke"){this[n]=a;if(this.stroke&&this["stroke-width"])c(l,"stroke",this.stroke),c(l,"stroke-width",this["stroke-width"]),this.hasStroke=!0;else if(n==="stroke-width"&&a===0&&this.hasStroke)l.removeAttribute("stroke"),this.hasStroke=!1;m=!0}this.symbolName&&/^(x|y|width|height|r|start|end|innerR|anchorX|anchorY)/.test(n)&&(_||(this.symbolAttr(e),_=!0),m=!0);if(g&&/^(width|height|visibility|x|y|d|transform|cx|cy|r)$/.test(n))for(o=g.length;o--;)c(g[o],n,n==="height"?U(a-(g[o].cutHeight||0),0):a);if((n==="width"||n==="height")&&h==="rect"&&a<0)a=0;this[n]=a;if(n==="text"){if(a!==this.textStr)delete this.bBox,this.textStr=a,this.added&&d.buildText(this)}else m||a!==void 0&&l.setAttribute(n,a)}y&&this.updateTransform()}return b},addClass:function(e){var t=this.element,i=c(t,"class")||"";i.indexOf(e)===-1&&c(t,"class",i+" "+e);return this},symbolAttr:function(e){var t=this;Ue("x,y,r,start,end,width,height,innerR,anchorX,anchorY".split(","),function(i){t[i]=p(e[i],t[i])});t.attr({d:t.renderer.symbols[t.symbolName](t.x,t.y,t.width,t.height,t)})},clip:function(e){return this.attr("clip-path",e?"url("+this.renderer.url+"#"+e.id+")":we)},crisp:function(e){var t,i={},s,n=e.strokeWidth||this.strokeWidth||this.attr&&this.attr("stroke-width")||0;s=F(n)%2/2;e.x=$(e.x||this.x||0)+s;e.y=$(e.y||this.y||0)+s;e.width=$((e.width||this.width||0)-2*s);e.height=$((e.height||this.height||0)-2*s);e.strokeWidth=n;for(t in e)this[t]!==e[t]&&(this[t]=i[t]=e[t]);return i},css:function(t){var s=this.styles,n={},a=this.element,o,r,l="";o=!s;if(t&&t.color)t.fill=t.color;if(s)for(r in t)t[r]!==s[r]&&(n[r]=t[r],o=!0);if(o){o=this.textWidth=t&&t.width&&a.nodeName.toLowerCase()==="text"&&i(t.width);s&&(t=e(s,n));this.styles=t;o&&(le||!oe&&this.renderer.forExport)&&delete t.width;if(ee&&!oe)m(this.element,t);else{s=function(e,t){return"-"+t.toLowerCase()};for(r in t)l+=r.replace(/([A-Z])/g,s)+":"+t[r]+";";c(a,"style",l)}o&&this.added&&this.renderer.buildText(this)}return this},on:function(e,t){var i=this,s=i.element;ue&&e==="click"?(s.ontouchstart=function(e){i.touchEventFired=Date.now();e.preventDefault();t.call(s,e)},s.onclick=function(e){(Z.indexOf("Android")===-1||Date.now()-(i.touchEventFired||0)>1100)&&t.call(s,e)}):s["on"+e]=t;return this},setRadialReference:function(e){this.element.radialReference=e;return this},translate:function(e,t){return this.attr({translateX:e,translateY:t})},invert:function(){this.inverted=!0;this.updateTransform();return this},updateTransform:function(){var e=this.translateX||0,t=this.translateY||0,i=this.scaleX,s=this.scaleY,n=this.inverted,a=this.rotation;n&&(e+=this.attr("width"),t+=this.attr("height"));e=["translate("+e+","+t+")"];n?e.push("rotate(90) scale(-1,1)"):a&&e.push("rotate("+a+" "+(this.x||0)+" "+(this.y||0)+")");(u(i)||u(s))&&e.push("scale("+p(i,1)+" "+p(s,1)+")");e.length&&c(this.element,"transform",e.join(" "))},toFront:function(){var e=this.element;e.parentNode.appendChild(e);return this},align:function(e,t,i){var n,a,o,r,l={};a=this.renderer;o=a.alignedObjects;if(e){if(this.alignOptions=e,this.alignByTranslate=t,!i||s(i))this.alignTo=n=i||"renderer",h(o,this),o.push(this),i=null}else e=this.alignOptions,t=this.alignByTranslate,n=this.alignTo;i=p(i,a[n],a);n=e.align;a=e.verticalAlign;o=(i.x||0)+(e.x||0);r=(i.y||0)+(e.y||0);if(n==="right"||n==="center")o+=(i.width-(e.width||0))/{right:1,center:2}[n];l[t?"translateX":"x"]=F(o);if(a==="bottom"||a==="middle")r+=(i.height-(e.height||0))/({bottom:1,middle:2}[a]||1);l[t?"translateY":"y"]=F(r);this[this.placed?"animate":"attr"](l);this.placed=!0;this.alignAttr=l;return this},getBBox:function(){var t=this.bBox,i=this.renderer,s,n,a=this.rotation;s=this.element;var o=this.styles,r=a*K;n=this.textStr;var l;if(n===""||Ce.test(n))l=n.toString().length+(o?"|"+o.fontSize+"|"+o.fontFamily:""),t=i.cache[l];if(!t){if(s.namespaceURI===ae||i.forExport){try{t=s.getBBox?e({},s.getBBox()):{width:s.offsetWidth,height:s.offsetHeight}}catch(h){}if(!t||t.width<0)t={width:0,height:0}}else t=this.htmlGetBBox();if(i.isSVG){s=t.width;n=t.height;if(ee&&o&&o.fontSize==="11px"&&n.toPrecision(3)==="16.9")t.height=n=14;if(a)t.width=W(n*X(r))+W(s*Q(r)),t.height=W(n*Q(r))+W(s*X(r))}this.bBox=t;l&&(i.cache[l]=t)}return t},show:function(e){return this.attr({visibility:e?"inherit":"visible"})},hide:function(){return this.attr({visibility:"hidden"})},fadeOut:function(e){var t=this;t.animate({opacity:0},{duration:e||150,complete:function(){t.hide()}})},add:function(e){var t=this.renderer,s=e||t,n=s.element||t.box,a=this.element,o=this.zIndex,r,l;if(e)this.parentGroup=e;this.parentInverted=e&&e.inverted;this.textStr!==void 0&&t.buildText(this);if(o)s.handleZ=!0,o=i(o);if(s.handleZ){e=n.childNodes;for(r=0;r<e.length;r++)if(t=e[r],s=c(t,"zIndex"),t!==a&&(i(s)>o||!u(o)&&u(s))){n.insertBefore(a,t);l=!0;break}}l||n.appendChild(a);this.added=!0;if(this.onAdd)this.onAdd();return this},safeRemoveChild:function(e){var t=e.parentNode;t&&t.removeChild(e)},destroy:function(){var e=this,t=e.element||{},i=e.shadows,s=e.renderer.isSVG&&t.nodeName==="SPAN"&&e.parentGroup,n,a;t.onclick=t.onmouseout=t.onmouseover=t.onmousemove=t.point=null;et(e);if(e.clipPath)e.clipPath=e.clipPath.destroy();if(e.stops){for(a=0;a<e.stops.length;a++)e.stops[a]=e.stops[a].destroy();e.stops=null}e.safeRemoveChild(t);for(i&&Ue(i,function(t){e.safeRemoveChild(t)});s&&s.div.childNodes.length===0;)t=s.parentGroup,e.safeRemoveChild(s.div),delete s.div,s=t;e.alignTo&&h(e.renderer.alignedObjects,e);for(n in e)delete e[n];return null},shadow:function(e,t,i){var s=[],n,a,o=this.element,r,l,h,u;if(e){l=p(e.width,3);h=(e.opacity||.15)/l;u=this.parentInverted?"(-1,-1)":"("+p(e.offsetX,1)+", "+p(e.offsetY,1)+")";for(n=1;n<=l;n++){a=o.cloneNode(0);r=l*2+1-2*n;c(a,{isShadow:"true",stroke:e.color||"black","stroke-opacity":h*n,"stroke-width":r,transform:"translate"+u,fill:we});if(i)c(a,"height",U(c(a,"height")-r,0)),a.cutHeight=r;t?t.element.appendChild(a):o.parentNode.insertBefore(a,o);s.push(a)}this.shadows=s}return this}};var ot=function(){this.init.apply(this,arguments)};ot.prototype={Element:E,init:function(e,t,i,s,n){var a=location,o,s=this.createElement("svg").attr({version:"1.1"}).css(this.getStyle(s));o=s.element;e.appendChild(o);e.innerHTML.indexOf("xmlns")===-1&&c(o,"xmlns",ae);this.isSVG=!0;this.box=o;this.boxWrapper=s;this.alignedObjects=[];this.url=(se||ie)&&H.getElementsByTagName("base").length?a.href.replace(/#.*?$/,"").replace(/([\('\)])/g,"\\$1").replace(/ /g,"%20"):"";this.createElement("desc").add().element.appendChild(H.createTextNode("Created with Highcharts 3.0.10"));this.defs=this.createElement("defs").add();this.forExport=n;this.gradients={};this.cache={};this.setSize(t,i,!1);var r;if(se&&e.getBoundingClientRect)this.subPixelFix=t=function(){m(e,{left:0,top:0});r=e.getBoundingClientRect();m(e,{left:Y(r.left)-r.left+"px",top:Y(r.top)-r.top+"px"})},t(),Xe(q,"resize",t)},getStyle:function(t){return this.style=e({fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Verdana, Arial, Helvetica, sans-serif',fontSize:"12px"},t)},isHidden:function(){return!this.boxWrapper.getBBox().width},destroy:function(){var e=this.defs;this.box=null;this.boxWrapper=this.boxWrapper.destroy();D(this.gradients||{});this.gradients=null;if(e)this.defs=e.destroy();this.subPixelFix&&je(q,"resize",this.subPixelFix);return this.alignedObjects=null},createElement:function(e){var t=new this.Element;t.init(this,e);return t},draw:function(){},buildText:function(e){for(var t=e.element,s=this,n=s.forExport,a=p(e.textStr,"").toString().replace(/<(b|strong)>/g,'<span style="font-weight:bold">').replace(/<(i|em)>/g,'<span style="font-style:italic">').replace(/<a/g,"<span").replace(/<\/(b|strong|i|em|a)>/g,"</span>").split(/<br.*?>/g),o=t.childNodes,r=/<.*style="([^"]+)".*>/,l=/<.*href="(http[^"]+)".*>/,h=c(t,"x"),u=e.styles,d=e.textWidth,f=u&&u.lineHeight,g=o.length,_=function(e){return f?i(f):s.fontMetrics(/(px|em)$/.test(e&&e.style.fontSize)?e.style.fontSize:u.fontSize||11).h};g--;)t.removeChild(o[g]);d&&!e.added&&this.box.appendChild(t);a[a.length-1]===""&&a.pop();Ue(a,function(i,a){var o,p=0,i=i.replace(/<span/g,"|||<span").replace(/<\/span>/g,"</span>|||");o=i.split("|||");Ue(o,function(i){if(i!==""||o.length===1){var f={},g=H.createElementNS(ae,"tspan"),y;r.test(i)&&(y=i.match(r)[1].replace(/(;| |^)color([ :])/,"$1fill$2"),c(g,"style",y));l.test(i)&&!n&&(c(g,"onclick",'location.href="'+i.match(l)[1]+'"'),m(g,{cursor:"pointer"}));i=(i.replace(/<(.|\n)*?>/g,"")||" ").replace(/&lt;/g,"<").replace(/&gt;/g,">");if(i!==" "&&(g.appendChild(H.createTextNode(i)),p?f.dx=0:f.x=h,c(g,f),!p&&a&&(!oe&&n&&m(g,{display:"block"}),c(g,"dy",_(g),ie&&g.offsetHeight)),t.appendChild(g),p++,d))for(var i=i.replace(/([^\^])-/g,"$1- ").split(" "),f=i.length>1&&u.whiteSpace!=="nowrap",b,S,v=e._clipHeight,w=[],C=_(),M=1;f&&(i.length||w.length);)delete e.bBox,b=e.getBBox(),S=b.width,!oe&&s.forExport&&(S=s.measureSpanWidth(g.firstChild.data,e.styles)),b=S>d,!b||i.length===1?(i=w,w=[],i.length&&(M++,v&&M*C>v?(i=["..."],e.attr("title",e.textStr)):(g=H.createElementNS(ae,"tspan"),c(g,{dy:C,x:h}),y&&c(g,"style",y),t.appendChild(g),S>d&&(d=S)))):(g.removeChild(g.firstChild),w.unshift(i.pop())),i.length&&g.appendChild(H.createTextNode(i.join(" ").replace(/- /g,"-")))}})})},button:function(i,s,n,a,o,r,l,h,u){var c=this.label(i,s,n,u,null,null,null,null,"button"),d=0,p,m,f,g,_,y,i={x1:0,y1:0,x2:0,y2:1},o=t({"stroke-width":1,stroke:"#CCCCCC",fill:{linearGradient:i,stops:[[0,"#FEFEFE"],[1,"#F6F6F6"]]},r:2,padding:5,style:{color:"black"}},o);f=o.style;delete o.style;r=t(o,{stroke:"#68A",fill:{linearGradient:i,stops:[[0,"#FFF"],[1,"#ACF"]]}},r);g=r.style;delete r.style;l=t(o,{stroke:"#68A",fill:{linearGradient:i,stops:[[0,"#9BD"],[1,"#CDF"]]}},l);_=l.style;delete l.style;h=t(o,{style:{color:"#CCC"}},h);y=h.style;delete h.style;Xe(c.element,ee?"mouseover":"mouseenter",function(){d!==3&&c.attr(r).css(g)});Xe(c.element,ee?"mouseout":"mouseleave",function(){d!==3&&(p=[o,r,l][d],m=[f,g,_][d],c.attr(p).css(m))});c.setState=function(e){(c.state=d=e)?e===2?c.attr(l).css(_):e===3&&c.attr(h).css(y):c.attr(o).css(f)};return c.on("click",function(){d!==3&&a.call(c)}).attr(o).css(e({cursor:"default"},f))},crispLine:function(e,t){e[1]===e[4]&&(e[1]=e[4]=F(e[1])-t%2/2);e[2]===e[5]&&(e[2]=e[5]=F(e[2])+t%2/2);return e},path:function(t){var i={fill:we};a(t)?i.d=t:n(t)&&e(i,t);return this.createElement("path").attr(i)},circle:function(e,t,i){e=n(e)?e:{x:e,y:t,r:i};return this.createElement("circle").attr(e)},arc:function(e,t,i,s,a,o){if(n(e))t=e.y,i=e.r,s=e.innerR,a=e.start,o=e.end,e=e.x;e=this.symbol("arc",e||0,t||0,i||0,i||0,{innerR:s||0,start:a||0,end:o||0});e.r=i;return e},rect:function(e,t,i,s,a,o){var a=n(e)?e.r:a,r=this.createElement("rect"),e=n(e)?e:e===N?{}:{x:e,y:t,width:U(i,0),height:U(s,0)};if(o!==N)e.strokeWidth=o,e=r.crisp(e);if(a)e.r=a;return r.attr(e)},setSize:function(e,t,i){var s=this.alignedObjects,n=s.length;this.width=e;this.height=t;for(this.boxWrapper[p(i,!0)?"animate":"attr"]({width:e,height:t});n--;)s[n].align()},g:function(e){var t=this.createElement("g");return u(e)?t.attr({"class":"highcharts-"+e}):t},image:function(t,i,s,n,a){var o={preserveAspectRatio:we};arguments.length>1&&e(o,{x:i,y:s,width:n,height:a});o=this.createElement("image").attr(o);o.element.setAttributeNS?o.element.setAttributeNS("http://www.w3.org/1999/xlink","href",t):o.element.setAttribute("hc-svg-href",t);return o},symbol:function(t,i,s,n,a,o){var r,l=this.symbols[t],l=l&&l(F(i),F(s),n,a,o),h=/^url\((.*?)\)$/,u,c;if(l)r=this.path(l),e(r,{symbolName:t,x:i,y:s,width:n,height:a}),o&&e(r,o);else if(h.test(t))c=function(e,t){e.element&&(e.attr({width:t[0],height:t[1]}),e.alignByTranslate||e.translate(F((n-t[0])/2),F((a-t[1])/2)))},u=t.match(h)[1],t=ce[u],r=this.image(u).attr({x:i,y:s}),r.isImg=!0,t?c(r,t):(r.attr({width:0,height:0}),f("img",{onload:function(){c(r,ce[u]=[this.width,this.height])},src:u}));return r},symbols:{circle:function(e,t,i,s){var n=.166*i;return["M",e+i/2,t,"C",e+i+n,t,e+i+n,t+s,e+i/2,t+s,"C",e-n,t+s,e-n,t,e+i/2,t,"Z"]},square:function(e,t,i,s){return["M",e,t,"L",e+i,t,e+i,t+s,e,t+s,"Z"]},triangle:function(e,t,i,s){return["M",e+i/2,t,"L",e+i,t+s,e,t+s,"Z"]},"triangle-down":function(e,t,i,s){return["M",e,t,"L",e+i,t,e+i/2,t+s,"Z"]},diamond:function(e,t,i,s){return["M",e+i/2,t,"L",e+i,t+s/2,e+i/2,t+s,e,t+s/2,"Z"]},arc:function(e,t,i,s,n){var a=n.start,i=n.r||i||s,o=n.end-.001,s=n.innerR,r=n.open,l=Q(a),h=X(a),u=Q(o),o=X(o),n=n.end-a<j?0:1;return["M",e+i*l,t+i*h,"A",i,i,0,n,1,e+i*u,t+i*o,r?"M":"L",e+s*u,t+s*o,"A",s,s,0,n,0,e+s*l,t+s*h,r?"":"Z"]}},clipRect:function(e,t,i,s){var n="highcharts-"+de++,a=this.createElement("clipPath").attr({id:n}).add(this.defs),e=this.rect(e,t,i,s,0).add(a);e.id=n;e.clipPath=a;return e},color:function(e,i,s){var n=this,o,r=/^rgba/,l,h,d,p,m,f,g,_=[];e&&e.linearGradient?l="linearGradient":e&&e.radialGradient&&(l="radialGradient");if(l){s=e[l];h=n.gradients;p=e.stops;i=i.radialReference;a(s)&&(e[l]=s={x1:s[0],y1:s[1],x2:s[2],y2:s[3],gradientUnits:"userSpaceOnUse"});l==="radialGradient"&&i&&!u(s.gradientUnits)&&(s=t(s,{cx:i[0]-i[2]/2+s.cx*i[2],cy:i[1]-i[2]/2+s.cy*i[2],r:s.r*i[2],gradientUnits:"userSpaceOnUse"}));for(g in s)g!=="id"&&_.push(g,s[g]);for(g in p)_.push(p[g]);_=_.join(",");h[_]?e=h[_].id:(s.id=e="highcharts-"+de++,h[_]=d=n.createElement(l).attr(s).add(n.defs),d.stops=[],Ue(p,function(e){r.test(e[1])?(o=at(e[1]),m=o.get("rgb"),f=o.get("a")):(m=e[1],f=1);e=n.createElement("stop").attr({offset:e[0],"stop-color":m,"stop-opacity":f}).add(d);d.stops.push(e)}));return"url("+n.url+"#"+e+")"}else return r.test(e)?(o=at(e),c(i,s+"-opacity",o.get("a")),o.get("rgb")):(i.removeAttribute(s+"-opacity"),e)},text:function(e,t,i,s){var n=le||!oe&&this.forExport;if(s&&!this.forExport)return this.html(e,t,i);t=F(p(t,0));i=F(p(i,0));e=this.createElement("text").attr({x:t,y:i,text:e});n&&e.css({position:"absolute"});e.x=t;e.y=i;return e},fontMetrics:function(e){var e=e||this.style.fontSize,e=/px/.test(e)?i(e):/em/.test(e)?parseFloat(e)*12:12,e=e<24?e+4:F(e*1.2),t=F(e*.8);return{h:e,b:t}},label:function(i,s,n,a,o,r,l,h,c){function d(){var e,i;e=_.element.style;b=(C===void 0||M===void 0||g.styles.textAlign)&&_.textStr&&_.getBBox();g.width=(C||b.width||0)+2*v+w;g.height=(M||b.height||0)+2*v;L=v+f.fontMetrics(e&&e.fontSize).b;if(I){if(!y)e=F(-S*v),i=h?-L:0,g.box=y=a?f.symbol(a,e,i,g.width,g.height,A):f.rect(e,i,g.width,g.height,0,A[Me]),y.attr("fill",we).add(g);y.isImg||y.attr(t({width:g.width,height:g.height},A));A=null}}function p(){var e=g.styles,e=e&&e.textAlign,t=w+v*(1-S),i;i=h?0:L;if(u(C)&&b&&(e==="center"||e==="right"))t+={center:.5,right:1}[e]*(C-b.width);(t!==_.x||i!==_.y)&&_.attr({x:t,y:i});_.x=t;_.y=i}function m(e,t){y?y.attr(e,t):A[e]=t}var f=this,g=f.g(c),_=f.text("",0,0,l).attr({zIndex:1}),y,b,S=0,v=3,w=0,C,M,T,x,D=0,A={},L,l=g.attrSetters,I;g.onAdd=function(){_.add(g);g.attr({text:i,x:s,y:n});y&&u(o)&&g.attr({anchorX:o,anchorY:r})};l.width=function(e){C=e;return!1};l.height=function(e){M=e;return!1};l.padding=function(e){u(e)&&e!==v&&(v=e,p());return!1};l.paddingLeft=function(e){u(e)&&e!==w&&(w=e,p());return!1};l.align=function(e){S={left:0,center:.5,right:1}[e];return!1};l.text=function(e,t){_.attr(t,e);d();p();return!1};l[Me]=function(e,t){e&&(I=!0);D=e%2/2;m(t,e);return!1};l.stroke=l.fill=l.r=function(e,t){t==="fill"&&e&&(I=!0);m(t,e);return!1};l.anchorX=function(e,t){o=e;m(t,e+D-T);return!1};l.anchorY=function(e,t){r=e;m(t,e-x);return!1};l.x=function(e){g.x=e;e-=S*((C||b.width)+v);T=F(e);g.attr("translateX",T);return!1};l.y=function(e){x=g.y=F(e);g.attr("translateY",x);return!1};var k=g.css;return e(g,{css:function(e){if(e){var i={},e=t(e);Ue("fontSize,fontWeight,fontFamily,color,lineHeight,width,textDecoration,textShadow".split(","),function(t){e[t]!==N&&(i[t]=e[t],delete e[t])});_.css(i)}return k.call(g,e)},getBBox:function(){return{width:b.width+2*v,height:b.height+2*v,x:b.x-v,y:b.y-v}},shadow:function(e){y&&y.shadow(e);return g},destroy:function(){je(g.element,"mouseenter");je(g.element,"mouseleave");_&&(_=_.destroy());y&&(y=y.destroy());E.prototype.destroy.call(g);g=f=d=p=m=null}})}};he=ot;e(E.prototype,{htmlCss:function(t){var i=this.element;if(i=t&&i.tagName==="SPAN"&&t.width)delete t.width,this.textWidth=i,this.updateTransform();this.styles=e(this.styles,t);m(this.element,t);return this},htmlGetBBox:function(){var e=this.element,t=this.bBox;if(!t){if(e.nodeName==="text")e.style.position="absolute";t=this.bBox={x:e.offsetLeft,y:e.offsetTop,width:e.offsetWidth,height:e.offsetHeight}}return t},htmlUpdateTransform:function(){if(this.added){var e=this.renderer,t=this.element,s=this.translateX||0,n=this.translateY||0,a=this.x||0,o=this.y||0,r=this.textAlign||"left",l={
left:0,center:.5,right:1}[r],h=this.shadows;m(t,{marginLeft:s,marginTop:n});h&&Ue(h,function(e){m(e,{marginLeft:s+1,marginTop:n+1})});this.inverted&&Ue(t.childNodes,function(i){e.invertChild(i,t)});if(t.tagName==="SPAN"){var c=this.rotation,d,f=i(this.textWidth),g=[c,r,t.innerHTML,this.textWidth].join(",");if(g!==this.cTT){d=e.fontMetrics(t.style.fontSize).b;u(c)&&this.setSpanRotation(c,l,d);h=p(this.elemWidth,t.offsetWidth);if(h>f&&/[ \-]/.test(t.textContent||t.innerText))m(t,{width:f+"px",display:"block",whiteSpace:"normal"}),h=f;this.getSpanCorrection(h,d,l,c,r)}m(t,{left:a+(this.xCorr||0)+"px",top:o+(this.yCorr||0)+"px"});if(ie)d=t.offsetHeight;this.cTT=g}}else this.alignOnAdd=!0},setSpanRotation:function(e,t,i){var s={},n=ee?"-ms-transform":ie?"-webkit-transform":se?"MozTransform":J?"-o-transform":"";s[n]=s.transform="rotate("+e+"deg)";s[n+(se?"Origin":"-origin")]=s.transformOrigin=t*100+"% "+i+"px";m(this.element,s)},getSpanCorrection:function(e,t,i){this.xCorr=-e*i;this.yCorr=-t}});e(ot.prototype,{html:function(t,i,s){var n=this.createElement("span"),a=n.attrSetters,o=n.element,r=n.renderer;a.text=function(e){e!==o.innerHTML&&delete this.bBox;o.innerHTML=this.textStr=e;return!1};a.x=a.y=a.align=a.rotation=function(e,t){t==="align"&&(t="textAlign");n[t]=e;n.htmlUpdateTransform();return!1};n.attr({text:t,x:F(i),y:F(s)}).css({position:"absolute",whiteSpace:"nowrap",fontFamily:this.style.fontFamily,fontSize:this.style.fontSize});n.css=n.htmlCss;if(r.isSVG)n.add=function(t){var i,s=r.box.parentNode,a=[];if(this.parentGroup=t){if(i=t.div,!i){for(;t;)a.push(t),t=t.parentGroup;Ue(a.reverse(),function(t){var n;i=t.div=t.div||f(ve,{className:c(t.element,"class")},{position:"absolute",left:(t.translateX||0)+"px",top:(t.translateY||0)+"px"},i||s);n=i.style;e(t.attrSetters,{translateX:function(e){n.left=e+"px"},translateY:function(e){n.top=e+"px"},visibility:function(e,t){n[t]=e}})})}}else i=s;i.appendChild(o);n.added=!0;n.alignOnAdd&&n.htmlUpdateTransform();return n};return n}});var rt;if(!oe&&!le){He.VMLElement=rt={init:function(e,t){var i=["<",t,' filled="f" stroked="f"'],s=["position: ","absolute",";"],n=t===ve;(t==="shape"||n)&&s.push("left:0;top:0;width:1px;height:1px;");s.push("visibility: ",n?"hidden":"visible");i.push(' style="',s.join(""),'"/>');if(t)i=n||t==="span"||t==="img"?i.join(""):e.prepVML(i),this.element=f(i);this.renderer=e;this.attrSetters={}},add:function(e){var t=this.renderer,i=this.element,s=t.box,s=e?e.element||e:s;e&&e.inverted&&t.invertChild(i,s);s.appendChild(i);this.added=!0;this.alignOnAdd&&!this.deferUpdateTransform&&this.updateTransform();if(this.onAdd)this.onAdd();return this},updateTransform:E.prototype.htmlUpdateTransform,setSpanRotation:function(){var e=this.rotation,t=Q(e*K),i=X(e*K);m(this.element,{filter:e?["progid:DXImageTransform.Microsoft.Matrix(M11=",t,", M12=",-i,", M21=",i,", M22=",t,", sizingMethod='auto expand')"].join(""):we})},getSpanCorrection:function(e,t,i,s,n){var a=s?Q(s*K):1,o=s?X(s*K):0,r=p(this.elemHeight,this.element.offsetHeight),l;this.xCorr=a<0&&-e;this.yCorr=o<0&&-r;l=a*o<0;this.xCorr+=o*t*(l?1-i:i);this.yCorr-=a*t*(s?l?i:1-i:1);n&&n!=="left"&&(this.xCorr-=e*i*(a<0?-1:1),s&&(this.yCorr-=r*i*(o<0?-1:1)),m(this.element,{textAlign:n}))},pathToVML:function(e){for(var t=e.length,i=[];t--;)if(o(e[t]))i[t]=F(e[t]*10)-5;else if(e[t]==="Z")i[t]="x";else if(i[t]=e[t],e.isArc&&(e[t]==="wa"||e[t]==="at"))i[t+5]===i[t+7]&&(i[t+7]+=e[t+7]>e[t+5]?1:-1),i[t+6]===i[t+8]&&(i[t+8]+=e[t+8]>e[t+6]?1:-1);return i.join(" ")||"x"},attr:function(e,t){var i,n,a,r=this.element||{},l=r.style,h=r.nodeName,d=this.renderer,p=this.symbolName,m,g=this.shadows,_,y=this.attrSetters,b=this;s(e)&&u(t)&&(i=e,e={},e[i]=t);if(s(e))i=e,b=i==="strokeWidth"||i==="stroke-width"?this.strokeweight:this[i];else for(i in e)if(n=e[i],_=!1,a=y[i]&&y[i].call(this,n,i),a!==!1&&n!==null){a!==N&&(n=a);if(p&&/^(x|y|r|start|end|width|height|innerR|anchorX|anchorY)/.test(i))m||(this.symbolAttr(e),m=!0),_=!0;else if(i==="d"){n=n||[];this.d=n.join(" ");r.path=n=this.pathToVML(n);if(g)for(a=g.length;a--;)g[a].path=g[a].cutOff?this.cutOffPath(n,g[a].cutOff):n;_=!0}else if(i==="visibility"){n==="inherit"&&(n="visible");if(g)for(a=g.length;a--;)g[a].style[i]=n;h==="DIV"&&(n=n==="hidden"?"-999em":0,te||(l[i]=n?"visible":"hidden"),i="top");l[i]=n;_=!0}else if(i==="zIndex")n&&(l[i]=n),_=!0;else if(Ye(i,["x","y","width","height"])!==-1)this[i]=n,i==="x"||i==="y"?i={x:"left",y:"top"}[i]:n=U(0,n),this.updateClipping?(this[i]=n,this.updateClipping()):l[i]=n,_=!0;else if(i==="class"&&h==="DIV")r.className=n;else if(i==="stroke")n=d.color(n,r,i),i="strokecolor";else if(i==="stroke-width"||i==="strokeWidth")r.stroked=n?!0:!1,i="strokeweight",this[i]=n,o(n)&&(n+="px");else if(i==="dashstyle")(r.getElementsByTagName("stroke")[0]||f(d.prepVML(["<stroke/>"]),null,null,r))[i]=n||"solid",this.dashstyle=n,_=!0;else if(i==="fill")if(h==="SPAN")l.color=n;else{if(h!=="IMG")r.filled=n!==we?!0:!1,n=d.color(n,r,i,this),i="fillcolor"}else if(i==="opacity")_=!0;else if(h==="shape"&&i==="rotation")this[i]=r.style[i]=n,r.style.left=-F(X(n*K)+1)+"px",r.style.top=F(Q(n*K))+"px";else if(i==="translateX"||i==="translateY"||i==="rotation")this[i]=n,this.updateTransform(),_=!0;_||(te?r[i]=n:c(r,i,n))}return b},clip:function(e){var t=this,i;e?(i=e.members,h(i,t),i.push(t),t.destroyClip=function(){h(i,t)},e=e.getCSS(t)):(t.destroyClip&&t.destroyClip(),e={clip:te?"inherit":"rect(auto)"});return t.css(e)},css:E.prototype.htmlCss,safeRemoveChild:function(e){e.parentNode&&A(e)},destroy:function(){this.destroyClip&&this.destroyClip();return E.prototype.destroy.apply(this)},on:function(e,t){this.element["on"+e]=function(){var e=q.event;e.target=e.srcElement;t(e)};return this},cutOffPath:function(e,t){var s,e=e.split(/[ ,]/);s=e.length;if(s===9||s===11)e[s-4]=e[s-2]=i(e[s-2])-10*t;return e.join(" ")},shadow:function(e,t,s){var n=[],a,o=this.element,r=this.renderer,l,h=o.style,u,c=o.path,d,m,g,_;c&&typeof c.value!=="string"&&(c="x");m=c;if(e){g=p(e.width,3);_=(e.opacity||.15)/g;for(a=1;a<=3;a++){d=g*2+1-2*a;s&&(m=this.cutOffPath(c.value,d+.5));u=['<shape isShadow="true" strokeweight="',d,'" filled="false" path="',m,'" coordsize="10 10" style="',o.style.cssText,'" />'];l=f(r.prepVML(u),null,{left:i(h.left)+p(e.offsetX,1),top:i(h.top)+p(e.offsetY,1)});if(s)l.cutOff=d+1;u=['<stroke color="',e.color||"black",'" opacity="',_*a,'"/>'];f(r.prepVML(u),null,null,l);t?t.element.appendChild(l):o.parentNode.insertBefore(l,o);n.push(l)}this.shadows=n}return this}};rt=g(E,rt);var lt={Element:rt,isIE8:Z.indexOf("MSIE 8.0")>-1,init:function(t,i,s,n){var a;this.alignedObjects=[];n=this.createElement(ve).css(e(this.getStyle(n),{position:"relative"}));a=n.element;t.appendChild(n.element);this.isVML=!0;this.box=a;this.boxWrapper=n;this.cache={};this.setSize(i,s,!1);if(!H.namespaces.hcv){H.namespaces.add("hcv","urn:schemas-microsoft-com:vml");try{H.createStyleSheet().cssText="hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke{ behavior:url(#default#VML); display: inline-block; } "}catch(o){H.styleSheets[0].cssText+="hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke{ behavior:url(#default#VML); display: inline-block; } "}}},isHidden:function(){return!this.box.offsetWidth},clipRect:function(t,i,s,a){var o=this.createElement(),r=n(t);return e(o,{members:[],left:(r?t.x:t)+1,top:(r?t.y:i)+1,width:(r?t.width:s)-1,height:(r?t.height:a)-1,getCSS:function(t){var i=t.element,s=i.nodeName,t=t.inverted,n=this.top-(s==="shape"?i.offsetTop:0),a=this.left,i=a+this.width,o=n+this.height,n={clip:"rect("+F(t?a:n)+"px,"+F(t?o:i)+"px,"+F(t?i:o)+"px,"+F(t?n:a)+"px)"};!t&&te&&s==="DIV"&&e(n,{width:i+"px",height:o+"px"});return n},updateClipping:function(){Ue(o.members,function(e){e.css(o.getCSS(e))})}})},color:function(e,t,i,s){var n=this,a,o=/^rgba/,r,l,h=we;e&&e.linearGradient?l="gradient":e&&e.radialGradient&&(l="pattern");if(l){var u,c,d=e.linearGradient||e.radialGradient,p,m,g,_,y,b="",e=e.stops,S,v=[],w=function(){r=['<fill colors="'+v.join(",")+'" opacity="',g,'" o:opacity2="',m,'" type="',l,'" ',b,'focus="100%" method="any" />'];f(n.prepVML(r),null,null,t)};p=e[0];S=e[e.length-1];p[0]>0&&e.unshift([0,p[1]]);S[0]<1&&e.push([1,S[1]]);Ue(e,function(e,t){o.test(e[1])?(a=at(e[1]),u=a.get("rgb"),c=a.get("a")):(u=e[1],c=1);v.push(e[0]*100+"% "+u);t?(g=c,_=u):(m=c,y=u)});if(i==="fill")if(l==="gradient")i=d.x1||d[0]||0,e=d.y1||d[1]||0,p=d.x2||d[2]||0,d=d.y2||d[3]||0,b='angle="'+(90-z.atan((d-e)/(p-i))*180/j)+'"',w();else{var h=d.r,C=h*2,M=h*2,T=d.cx,x=d.cy,D=t.radialReference,A,h=function(){D&&(A=s.getBBox(),T+=(D[0]-A.x)/A.width-.5,x+=(D[1]-A.y)/A.height-.5,C*=D[2]/A.width,M*=D[2]/A.height);b='src="'+me.global.VMLRadialGradientURL+'" size="'+C+","+M+'" origin="0.5,0.5" position="'+T+","+x+'" color2="'+y+'" ';w()};s.added?h():s.onAdd=h;h=_}else h=u}else if(o.test(e)&&t.tagName!=="IMG")a=at(e),r=["<",i,' opacity="',a.get("a"),'"/>'],f(this.prepVML(r),null,null,t),h=a.get("rgb");else{h=t.getElementsByTagName(i);if(h.length)h[0].opacity=1,h[0].type="solid";h=e}return h},prepVML:function(e){var t=this.isIE8,e=e.join("");t?(e=e.replace("/>",' xmlns="urn:schemas-microsoft-com:vml" />'),e=e.indexOf('style="')===-1?e.replace("/>",' style="display:inline-block;behavior:url(#default#VML);" />'):e.replace('style="','style="display:inline-block;behavior:url(#default#VML);')):e=e.replace("<","<hcv:");return e},text:ot.prototype.html,path:function(t){var i={coordsize:"10 10"};a(t)?i.d=t:n(t)&&e(i,t);return this.createElement("shape").attr(i)},circle:function(e,t,i){var s=this.symbol("circle");if(n(e))i=e.r,t=e.y,e=e.x;s.isCircle=!0;s.r=i;return s.attr({x:e,y:t})},g:function(e){var t;e&&(t={className:"highcharts-"+e,"class":"highcharts-"+e});return this.createElement(ve).attr(t)},image:function(e,t,i,s,n){var a=this.createElement("img").attr({src:e});arguments.length>1&&a.attr({x:t,y:i,width:s,height:n});return a},createElement:function(e){return e==="rect"?this.symbol(e):ot.prototype.createElement.call(this,e)},invertChild:function(e,t){var s=this,n=t.style,a=e.tagName==="IMG"&&e.style;m(e,{flip:"x",left:i(n.width)-(a?i(a.top):1),top:i(n.height)-(a?i(a.left):1),rotation:-90});Ue(e.childNodes,function(t){s.invertChild(t,e)})},symbols:{arc:function(e,t,i,s,n){var a=n.start,o=n.end,r=n.r||i||s,i=n.innerR,s=Q(a),l=X(a),h=Q(o),u=X(o);if(o-a===0)return["x"];a=["wa",e-r,t-r,e+r,t+r,e+r*s,t+r*l,e+r*h,t+r*u];n.open&&!i&&a.push("e","M",e,t);a.push("at",e-i,t-i,e+i,t+i,e+i*h,t+i*u,e+i*s,t+i*l,"x","e");a.isArc=!0;return a},circle:function(e,t,i,s,n){n&&(i=s=2*n.r);n&&n.isCircle&&(e-=i/2,t-=s/2);return["wa",e,t,e+i,t+s,e+i,t+s/2,e+i,t+s/2,"e"]},rect:function(e,t,i,s,n){var a=e+i,o=t+s,r;!u(n)||!n.r?a=ot.prototype.symbols.square.apply(0,arguments):(r=G(n.r,i,s),a=["M",e+r,t,"L",a-r,t,"wa",a-2*r,t,a,t+2*r,a-r,t,a,t+r,"L",a,o-r,"wa",a-2*r,o-2*r,a,o,a,o-r,a-r,o,"L",e+r,o,"wa",e,o-2*r,e+2*r,o,e+r,o,e,o-r,"L",e,t+r,"wa",e,t,e+2*r,t+2*r,e,t+r,e+r,t,"x","e"]);return a}}};He.VMLRenderer=rt=function(){this.init.apply(this,arguments)};rt.prototype=t(ot.prototype,lt);he=rt}ot.prototype.measureSpanWidth=function(e,t){var i=H.createElement("span"),s;s=H.createTextNode(e);i.appendChild(s);m(i,t);this.box.appendChild(i);s=i.offsetWidth;A(i);return s};var ht;if(le)He.CanVGRenderer=rt=function(){ae="http://www.w3.org/1999/xhtml"},rt.prototype.symbols={},ht=function(){function e(){var e=t.length,i;for(i=0;i<e;i++)t[i]();t=[]}var t=[];return{push:function(i,s){t.length===0&&$e(s,e);t.push(i)}}}(),he=rt;V.prototype={addLabel:function(){var t=this.axis,i=t.options,s=t.chart,n=t.horiz,a=t.categories,r=t.names,h=this.pos,c=i.labels,d=t.tickPositions,n=n&&a&&!c.step&&!c.staggerLines&&!c.rotation&&s.plotWidth/d.length||!n&&(s.margin[3]||s.chartWidth*.33),m=h===d[0],f=h===d[d.length-1],g,r=a?p(a[h],r[h],h):h,a=this.label,_=d.info;t.isDatetimeAxis&&_&&(g=i.dateTimeLabelFormats[_.higherRanks[h]||_.unitName]);this.isFirst=m;this.isLast=f;i=t.labelFormatter.call({axis:t,chart:s,isFirst:m,isLast:f,dateTimeLabelFormat:g,value:t.isLog?I(l(r)):r});h=n&&{width:U(1,F(n-2*(c.padding||10)))+"px"};h=e(h,c.style);if(u(a))a&&a.attr({text:i}).css(h);else{g={align:t.labelAlign};if(o(c.rotation))g.rotation=c.rotation;if(n&&c.ellipsis)g._clipHeight=t.len/d.length;this.label=u(i)&&c.enabled?s.renderer.text(i,0,0,c.useHTML).attr(g).css(h).add(t.labelGroup):null}},getLabelSize:function(){var e=this.label,t=this.axis;return e?e.getBBox()[t.horiz?"height":"width"]:0},getLabelSides:function(){var e=this.label.getBBox(),t=this.axis,i=t.horiz,s=t.options.labels,e=i?e.width:e.height,t=i?s.x-e*{left:0,center:.5,right:1}[t.labelAlign]:0;return[t,i?e+t:e]},handleOverflow:function(e,t){var i=!0,s=this.axis,n=this.isFirst,a=this.isLast,o=s.horiz?t.x:t.y,r=s.reversed,l=s.tickPositions,h=this.getLabelSides(),u=h[0],h=h[1],c,d,p,m=this.label.line||0;c=s.labelEdge;d=s.justifyLabels&&(n||a);c[m]===N||o+u>c[m]?c[m]=o+h:d||(i=!1);if(d){c=(d=s.justifyToPlot)?s.pos:0;d=d?c+s.len:s.chart.chartWidth;do e+=n?1:-1,p=s.ticks[l[e]];while(l[e]&&(!p||p.label.line!==m));s=p&&p.label.xy&&p.label.xy.x+p.getLabelSides()[n?0:1];n&&!r||a&&r?o+u<c&&(o=c-u,p&&o+h>s&&(i=!1)):o+h>d&&(o=d-h,p&&o+u<s&&(i=!1));t.x=o}return i},getPosition:function(e,t,i,s){var n=this.axis,a=n.chart,o=s&&a.oldChartHeight||a.chartHeight;return{x:e?n.translate(t+i,null,null,s)+n.transB:n.left+n.offset+(n.opposite?(s&&a.oldChartWidth||a.chartWidth)-n.right-n.left:0),y:e?o-n.bottom+n.offset-(n.opposite?n.height:0):o-n.translate(t+i,null,null,s)-n.transB}},getLabelPosition:function(e,t,i,s,n,a,o,r){var l=this.axis,h=l.transA,c=l.reversed,d=l.staggerLines,p=l.chart.renderer.fontMetrics(n.style.fontSize).b,m=n.rotation,e=e+n.x-(a&&s?a*h*(c?-1:1):0),t=t+n.y-(a&&!s?a*h*(c?1:-1):0);m&&l.side===2&&(t-=p-p*Q(m*K));!u(n.y)&&!m&&(t+=p-i.getBBox().height/2);if(d)i.line=o/(r||1)%d,t+=i.line*(l.labelOffset/d);return{x:e,y:t}},getMarkPath:function(e,t,i,s,n,a){return a.crispLine(["M",e,t,"L",e+(n?0:-i),t+(n?i:0)],s)},render:function(e,t,i){var s=this.axis,n=s.options,a=s.chart.renderer,o=s.horiz,r=this.type,l=this.label,h=this.pos,u=n.labels,c=this.gridLine,d=r?r+"Grid":"grid",m=r?r+"Tick":"tick",f=n[d+"LineWidth"],g=n[d+"LineColor"],_=n[d+"LineDashStyle"],y=n[m+"Length"],d=n[m+"Width"]||0,b=n[m+"Color"],S=n[m+"Position"],m=this.mark,v=u.step,w=!0,C=s.tickmarkOffset,M=this.getPosition(o,h,C,t),T=M.x,M=M.y,x=o&&T===s.pos+s.len||!o&&M===s.pos?-1:1;this.isActive=!0;if(f){h=s.getPlotLinePath(h+C,f*x,t,!0);if(c===N){c={stroke:g,"stroke-width":f};if(_)c.dashstyle=_;if(!r)c.zIndex=1;if(t)c.opacity=0;this.gridLine=c=f?a.path(h).attr(c).add(s.gridGroup):null}if(!t&&c&&h)c[this.isNew?"attr":"animate"]({d:h,opacity:i})}if(d&&y)S==="inside"&&(y=-y),s.opposite&&(y=-y),r=this.getMarkPath(T,M,y,d*x,o,a),m?m.animate({d:r,opacity:i}):this.mark=a.path(r).attr({stroke:b,"stroke-width":d,opacity:i}).add(s.axisGroup);if(l&&!isNaN(T))l.xy=M=this.getLabelPosition(T,M,l,o,u,C,e,v),this.isFirst&&!this.isLast&&!p(n.showFirstLabel,1)||this.isLast&&!this.isFirst&&!p(n.showLastLabel,1)?w=!1:!s.isRadial&&!u.step&&!u.rotation&&!t&&i!==0&&(w=this.handleOverflow(e,M)),v&&e%v&&(w=!1),w&&!isNaN(M.y)?(M.opacity=i,l[this.isNew?"attr":"animate"](M),this.isNew=!1):l.attr("y",-9999)},destroy:function(){D(this,this.axis)}};He.PlotLineOrBand=function(e,t){this.axis=e;if(t)this.options=t,this.id=t.id};He.PlotLineOrBand.prototype={render:function(){var e=this,i=e.axis,s=i.horiz,n=(i.pointRange||0)/2,a=e.options,o=a.label,l=e.label,h=a.width,c=a.to,d=a.from,m=u(d)&&u(c),f=a.value,g=a.dashStyle,_=e.svgElem,y=[],b,S=a.color,v=a.zIndex,w=a.events,C=i.chart.renderer;i.isLog&&(d=r(d),c=r(c),f=r(f));if(h){if(y=i.getPlotLinePath(f,h),n={stroke:S,"stroke-width":h},g)n.dashstyle=g}else if(m){if(d=U(d,i.min-n),c=G(c,i.max+n),y=i.getPlotBandPath(d,c,a),n={fill:S},a.borderWidth)n.stroke=a.borderColor,n["stroke-width"]=a.borderWidth}else return;if(u(v))n.zIndex=v;if(_)if(y)_.animate({d:y},null,_.onGetPath);else{if(_.hide(),_.onGetPath=function(){_.show()},l)e.label=l=l.destroy()}else if(y&&y.length&&(e.svgElem=_=C.path(y).attr(n).add(),w))for(b in a=function(t){_.on(t,function(i){w[t].apply(e,[i])})},w)a(b);if(o&&u(o.text)&&y&&y.length&&i.width>0&&i.height>0){o=t({align:s&&m&&"center",x:s?!m&&4:10,verticalAlign:!s&&m&&"middle",y:s?m?16:10:m?6:-4,rotation:s&&!m&&90},o);if(!l)e.label=l=C.text(o.text,0,0,o.useHTML).attr({align:o.textAlign||o.align,rotation:o.rotation,zIndex:v}).css(o.style).add();i=[y[1],y[4],p(y[6],y[1])];y=[y[2],y[5],p(y[7],y[2])];s=T(i);m=T(y);l.align(o,!1,{x:s,y:m,width:x(i)-s,height:x(y)-m});l.show()}else l&&l.hide();return e},destroy:function(){h(this.axis.plotLinesAndBands,this);delete this.axis;D(this)}};O.prototype={defaultOptions:{dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%e. %b",week:"%e. %b",month:"%b '%y",year:"%Y"},endOnTick:!1,gridLineColor:"#C0C0C0",labels:ze,lineColor:"#C0D0E0",lineWidth:1,minPadding:.01,maxPadding:.01,minorGridLineColor:"#E0E0E0",minorGridLineWidth:1,minorTickColor:"#A0A0A0",minorTickLength:2,minorTickPosition:"outside",startOfWeek:1,startOnTick:!1,tickColor:"#C0D0E0",tickLength:5,tickmarkPlacement:"between",tickPixelInterval:100,tickPosition:"outside",tickWidth:1,title:{align:"middle",style:{color:"#4d759e",fontWeight:"bold"}},type:"linear"},defaultYAxisOptions:{endOnTick:!0,gridLineWidth:1,tickPixelInterval:72,showLastLabel:!0,labels:{x:-8,y:3},lineWidth:0,maxPadding:.05,minPadding:.05,startOnTick:!0,tickWidth:0,title:{rotation:270,text:"Values"},stackLabels:{enabled:!1,formatter:function(){return _(this.total,-1)},style:ze.style}},defaultLeftAxisOptions:{labels:{x:-8,y:null},title:{rotation:270}},defaultRightAxisOptions:{labels:{x:8,y:null},title:{rotation:90}},defaultBottomAxisOptions:{labels:{x:0,y:14},title:{rotation:0}},defaultTopAxisOptions:{labels:{x:0,y:-5},title:{rotation:0}},init:function(e,t){var i=t.isX;this.horiz=e.inverted?!i:i;this.coll=(this.isXAxis=i)?"xAxis":"yAxis";this.opposite=t.opposite;this.side=t.side||(this.horiz?this.opposite?0:2:this.opposite?1:3);this.setOptions(t);var s=this.options,n=s.type;this.labelFormatter=s.labels.formatter||this.defaultLabelFormatter;this.userOptions=t;this.minPixelPadding=0;this.chart=e;this.reversed=s.reversed;this.zoomEnabled=s.zoomEnabled!==!1;this.categories=s.categories||n==="category";this.names=[];this.isLog=n==="logarithmic";this.isDatetimeAxis=n==="datetime";this.isLinked=u(s.linkedTo);this.tickmarkOffset=this.categories&&s.tickmarkPlacement==="between"?.5:0;this.ticks={};this.labelEdge=[];this.minorTicks={};this.plotLinesAndBands=[];this.alternateBands={};this.len=0;this.minRange=this.userMinRange=s.minRange||s.maxZoom;this.range=s.range;this.offset=s.offset||0;this.stacks={};this.oldStacks={};this.min=this.max=null;this.crosshair=p(s.crosshair,d(e.options.tooltip.crosshairs)[i?0:1],!1);var a,s=this.options.events;Ye(this,e.axes)===-1&&(i&&!this.isColorAxis?e.axes.splice(e.xAxis.length,0,this):e.axes.push(this),e[this.coll].push(this));this.series=this.series||[];if(e.inverted&&i&&this.reversed===N)this.reversed=!0;this.removePlotLine=this.removePlotBand=this.removePlotBandOrLine;for(a in s)Xe(this,a,s[a]);if(this.isLog)this.val2lin=r,this.lin2val=l},setOptions:function(e){this.options=t(this.defaultOptions,this.isXAxis?{}:this.defaultYAxisOptions,[this.defaultTopAxisOptions,this.defaultRightAxisOptions,this.defaultBottomAxisOptions,this.defaultLeftAxisOptions][this.side],t(me[this.coll],e))},defaultLabelFormatter:function(){var e=this.axis,t=this.value,i=e.categories,s=this.dateTimeLabelFormat,n=me.lang.numericSymbols,a=n&&n.length,o,r=e.options.labels.format,e=e.isLog?t:e.tickInterval;if(r)o=S(r,this);else if(i)o=t;else if(s)o=fe(s,t);else if(a&&e>=1e3)for(;a--&&o===N;)i=Math.pow(1e3,a+1),e>=i&&n[a]!==null&&(o=_(t/i,-1)+n[a]);o===N&&(o=t>=1e4?_(t,0):_(t,-1,N,""));return o},getSeriesExtremes:function(){var e=this,t=e.chart;e.hasVisibleSeries=!1;e.dataMin=e.dataMax=null;e.buildStacks&&e.buildStacks();Ue(e.series,function(i){if(i.visible||!t.options.chart.ignoreHiddenSeries){var s;s=i.options.threshold;var n;e.hasVisibleSeries=!0;e.isLog&&s<=0&&(s=null);if(e.isXAxis){if(s=i.xData,s.length)e.dataMin=G(p(e.dataMin,s[0]),T(s)),e.dataMax=U(p(e.dataMax,s[0]),x(s))}else{i.getExtremes();n=i.dataMax;i=i.dataMin;if(u(i)&&u(n))e.dataMin=G(p(e.dataMin,i),i),e.dataMax=U(p(e.dataMax,n),n);if(u(s))if(e.dataMin>=s)e.dataMin=s,e.ignoreMinPadding=!0;else if(e.dataMax<s)e.dataMax=s,e.ignoreMaxPadding=!0}}})},translate:function(e,t,i,s,n,a){var r=1,l=0,h=s?this.oldTransA:this.transA,s=s?this.oldMin:this.min,u=this.minPixelPadding,n=(this.options.ordinal||this.isLog&&n)&&this.lin2val;if(!h)h=this.transA;if(i)r*=-1,l=this.len;this.reversed&&(r*=-1,l-=r*(this.sector||this.len));t?(e=e*r+l,e-=u,e=e/h+s,n&&(e=this.lin2val(e))):(n&&(e=this.val2lin(e)),a==="between"&&(a=.5),e=r*(e-s)*h+l+r*u+(o(a)?h*a*this.pointRange:0));return e},toPixels:function(e,t){return this.translate(e,!1,!this.horiz,null,!0)+(t?0:this.pos)},toValue:function(e,t){return this.translate(e-(t?0:this.pos),!0,!this.horiz,null,!0)},getPlotLinePath:function(e,t,i,s,n){var a=this.chart,o=this.left,r=this.top,l,h,u=i&&a.oldChartHeight||a.chartHeight,c=i&&a.oldChartWidth||a.chartWidth,d;l=this.transB;n=p(n,this.translate(e,null,null,i));e=i=F(n+l);l=h=F(u-n-l);if(isNaN(n))d=!0;else if(this.horiz){if(l=r,h=u-this.bottom,e<o||e>o+this.width)d=!0}else if(e=o,i=c-this.right,l<r||l>r+this.height)d=!0;return d&&!s?null:a.renderer.crispLine(["M",e,l,"L",i,h],t||1)},getLinearTickPositions:function(e,t,i){for(var s,t=I($(t/e)*e),i=I(Y(i/e)*e),n=[];t<=i;){n.push(t);t=I(t+e);if(t===s)break;s=t}return n},getMinorTickPositions:function(){var e=this.options,t=this.tickPositions,i=this.minorTickInterval,s=[],n;if(this.isLog){n=t.length;for(e=1;e<n;e++)s=s.concat(this.getLogTickPositions(i,t[e-1],t[e],!0))}else if(this.isDatetimeAxis&&e.minorTickInterval==="auto")s=s.concat(this.getTimeTicks(this.normalizeTimeTickInterval(i),this.min,this.max,e.startOfWeek)),s[0]<this.min&&s.shift();else for(t=this.min+(t[0]-this.min)%i;t<=this.max;t+=i)s.push(t);return s},adjustForMinRange:function(){var e=this.options,t=this.min,i=this.max,s,n=this.dataMax-this.dataMin>=this.minRange,a,o,r,l,h;if(this.isXAxis&&this.minRange===N&&!this.isLog)u(e.min)||u(e.max)?this.minRange=null:(Ue(this.series,function(e){l=e.xData;for(o=h=e.xIncrement?1:l.length-1;o>0;o--)if(r=l[o]-l[o-1],a===N||r<a)a=r}),this.minRange=G(a*5,this.dataMax-this.dataMin));if(i-t<this.minRange){var c=this.minRange;s=(c-i+t)/2;s=[t-s,p(e.min,t-s)];if(n)s[2]=this.dataMin;t=x(s);i=[t+c,p(e.max,t+c)];if(n)i[2]=this.dataMax;i=T(i);i-t<c&&(s[0]=i-c,s[1]=p(e.min,i-c),t=x(s))}this.min=t;this.max=i},setAxisTranslation:function(e){var t=this,i=t.max-t.min,n=t.axisPointRange||0,a,o=0,r=0,l=t.linkedParent,h=!!t.categories,c=t.transA;if(t.isXAxis||h||n)l?(o=l.minPointOffset,r=l.pointRangePadding):Ue(t.series,function(e){var l=U(t.isXAxis?e.pointRange:t.axisPointRange||0,+h),c=e.options.pointPlacement,d=e.closestPointRange;l>i&&(l=0);n=U(n,l);o=U(o,s(c)?0:l/2);r=U(r,c==="on"?0:l);!e.noSharedTooltip&&u(d)&&(a=u(a)?G(a,d):d)}),l=t.ordinalSlope&&a?t.ordinalSlope/a:1,t.minPointOffset=o*=l,t.pointRangePadding=r*=l,t.pointRange=G(n,i),t.closestPointRange=a;if(e)t.oldTransA=c;t.translationSlope=t.transA=c=t.len/(i+r||1);t.transB=t.horiz?t.left:t.bottom;t.minPixelPadding=c*o},setTickPositions:function(e){var t=this,i=t.chart,s=t.options,n=t.isLog,a=t.isDatetimeAxis,o=t.isXAxis,l=t.isLinked,h=t.options.tickPositioner,c=s.maxPadding,d=s.minPadding,m=s.tickInterval,f=s.minTickInterval,g=s.tickPixelInterval,_,y=t.categories;l?(t.linkedParent=i[t.coll][s.linkedTo],i=t.linkedParent.getExtremes(),t.min=p(i.min,i.dataMin),t.max=p(i.max,i.dataMax),s.type!==t.linkedParent.options.type&&L(11,1)):(t.min=p(t.userMin,s.min,t.dataMin),t.max=p(t.userMax,s.max,t.dataMax));if(n)!e&&G(t.min,p(t.dataMin,t.min))<=0&&L(10,1),t.min=I(r(t.min)),t.max=I(r(t.max));if(t.range&&u(t.max))t.userMin=t.min=U(t.min,t.max-t.range),t.userMax=t.max,t.range=null;t.beforePadding&&t.beforePadding();t.adjustForMinRange();if(!y&&!t.axisPointRange&&!t.usePercentage&&!l&&u(t.min)&&u(t.max)&&(i=t.max-t.min)){if(!u(s.min)&&!u(t.userMin)&&d&&(t.dataMin<0||!t.ignoreMinPadding))t.min-=i*d;if(!u(s.max)&&!u(t.userMax)&&c&&(t.dataMax>0||!t.ignoreMaxPadding))t.max+=i*c}t.min===t.max||t.min===void 0||t.max===void 0?t.tickInterval=1:l&&!m&&g===t.linkedParent.options.tickPixelInterval?t.tickInterval=t.linkedParent.tickInterval:(t.tickInterval=p(m,y?1:(t.max-t.min)*g/U(t.len,g)),!u(m)&&t.len<g&&!this.isRadial&&!this.isLog&&!y&&s.startOnTick&&s.endOnTick&&(_=!0,t.tickInterval/=4));o&&!e&&Ue(t.series,function(e){e.processData(t.min!==t.oldMin||t.max!==t.oldMax)});t.setAxisTranslation(!0);t.beforeSetTickPositions&&t.beforeSetTickPositions();if(t.postProcessTickInterval)t.tickInterval=t.postProcessTickInterval(t.tickInterval);if(t.pointRange)t.tickInterval=U(t.pointRange,t.tickInterval);if(!m&&t.tickInterval<f)t.tickInterval=f;if(!a&&!n&&!m)t.tickInterval=w(t.tickInterval,null,v(t.tickInterval),s);t.minorTickInterval=s.minorTickInterval==="auto"&&t.tickInterval?t.tickInterval/5:s.minorTickInterval;t.tickPositions=e=s.tickPositions?[].concat(s.tickPositions):h&&h.apply(t,[t.min,t.max]);if(!e)!t.ordinalPositions&&(t.max-t.min)/t.tickInterval>U(2*t.len,200)&&L(19,!0),e=a?t.getTimeTicks(t.normalizeTimeTickInterval(t.tickInterval,s.units),t.min,t.max,s.startOfWeek,t.ordinalPositions,t.closestPointRange,!0):n?t.getLogTickPositions(t.tickInterval,t.min,t.max):t.getLinearTickPositions(t.tickInterval,t.min,t.max),_&&e.splice(1,e.length-2),t.tickPositions=e;if(!l)n=e[0],a=e[e.length-1],l=t.minPointOffset||0,s.startOnTick?t.min=n:t.min-l>n&&e.shift(),s.endOnTick?t.max=a:t.max+l<a&&e.pop(),e.length===1&&(s=W(t.max||1)*.001,t.min-=s,t.max+=s)},setMaxTicks:function(){var e=this.chart,t=e.maxTicks||{},i=this.tickPositions,s=this._maxTicksKey=[this.coll,this.pos,this.len].join("-");if(!this.isLinked&&!this.isDatetimeAxis&&i&&i.length>(t[s]||0)&&this.options.alignTicks!==!1)t[s]=i.length;e.maxTicks=t},adjustTickAmount:function(){var e=this._maxTicksKey,t=this.tickPositions,i=this.chart.maxTicks;if(i&&i[e]&&!this.isDatetimeAxis&&!this.categories&&!this.isLinked&&this.options.alignTicks!==!1&&this.min!==N){var s=this.tickAmount,n=t.length;this.tickAmount=e=i[e];if(n<e){for(;t.length<e;)t.push(I(t[t.length-1]+this.tickInterval));this.transA*=(n-1)/(e-1);this.max=t[t.length-1]}if(u(s)&&e!==s)this.isDirty=!0}},setScale:function(){var e=this.stacks,t,i,s,n;this.oldMin=this.min;this.oldMax=this.max;this.oldAxisLength=this.len;this.setAxisSize();n=this.len!==this.oldAxisLength;Ue(this.series,function(e){if(e.isDirtyData||e.isDirty||e.xAxis.isDirty)s=!0});if(n||s||this.isLinked||this.forceRedraw||this.userMin!==this.oldUserMin||this.userMax!==this.oldUserMax){if(!this.isXAxis)for(t in e)for(i in e[t])e[t][i].total=null,e[t][i].cum=0;this.forceRedraw=!1;this.getSeriesExtremes();this.setTickPositions();this.oldUserMin=this.userMin;this.oldUserMax=this.userMax;if(!this.isDirty)this.isDirty=n||this.min!==this.oldMin||this.max!==this.oldMax}else if(!this.isXAxis){if(this.oldStacks)e=this.stacks=this.oldStacks;for(t in e)for(i in e[t])e[t][i].cum=e[t][i].total}this.setMaxTicks()},setExtremes:function(t,i,s,n,a){var o=this,r=o.chart,s=p(s,!0),a=e(a,{min:t,max:i});Ke(o,"setExtremes",a,function(){o.userMin=t;o.userMax=i;o.eventArgs=a;o.isDirtyExtremes=!0;s&&r.redraw(n)})},zoom:function(e,t){var i=this.dataMin,s=this.dataMax,n=this.options;this.allowZoomOutside||(u(i)&&e<=G(i,p(n.min,i))&&(e=N),u(s)&&t>=U(s,p(n.max,s))&&(t=N));this.displayBtn=e!==N||t!==N;this.setExtremes(e,t,!1,N,{trigger:"zoom"});return!0},setAxisSize:function(){var e=this.chart,t=this.options,i=t.offsetLeft||0,s=t.offsetRight||0,n=this.horiz,a,o;this.left=o=p(t.left,e.plotLeft+i);this.top=a=p(t.top,e.plotTop);this.width=i=p(t.width,e.plotWidth-i+s);this.height=t=p(t.height,e.plotHeight);this.bottom=e.chartHeight-t-a;this.right=e.chartWidth-i-o;this.len=U(n?i:t,0);this.pos=n?o:a},getExtremes:function(){var e=this.isLog;return{min:e?I(l(this.min)):this.min,max:e?I(l(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}},getThreshold:function(e){var t=this.isLog,i=t?l(this.min):this.min,t=t?l(this.max):this.max;i>e||e===null?e=i:t<e&&(e=t);return this.translate(e,0,1,0,1)},autoLabelAlign:function(e){e=(p(e,0)-this.side*90+720)%360;return e>15&&e<165?"right":e>195&&e<345?"left":"center"},getOffset:function(){var e=this,t=e.chart,i=t.renderer,s=e.options,n=e.tickPositions,a=e.ticks,o=e.horiz,r=e.side,l=t.inverted?[1,0,3,2][r]:r,h,c=0,d,m=0,f=s.title,g=s.labels,_=0,y=t.axisOffset,b=t.clipOffset,S=[-1,1,1,-1][r],v,w=1,C=p(g.maxStaggerLines,5),M,T,x,D;e.hasData=h=e.hasVisibleSeries||u(e.min)&&u(e.max)&&!!n;e.showAxis=t=h||p(s.showEmpty,!0);e.staggerLines=e.horiz&&g.staggerLines;if(!e.axisGroup)e.gridGroup=i.g("grid").attr({zIndex:s.gridZIndex||1}).add(),e.axisGroup=i.g("axis").attr({zIndex:s.zIndex||2}).add(),e.labelGroup=i.g("axis-labels").attr({zIndex:g.zIndex||7}).addClass("highcharts-"+e.coll.toLowerCase()+"-labels").add();if(h||e.isLinked){e.labelAlign=p(g.align||e.autoLabelAlign(g.rotation));Ue(n,function(t){a[t]?a[t].addLabel():a[t]=new V(e,t)});if(e.horiz&&!e.staggerLines&&C&&!g.rotation){for(v=e.reversed?[].concat(n).reverse():n;w<C;){h=[];M=!1;for(g=0;g<v.length;g++)T=v[g],x=(x=a[T].label&&a[T].label.getBBox())?x.width:0,D=g%w,x&&(T=e.translate(T),h[D]!==N&&T<h[D]&&(M=!0),h[D]=T+x);if(M)w++;else break}if(w>1)e.staggerLines=w}Ue(n,function(t){if(r===0||r===2||{1:"left",3:"right"}[r]===e.labelAlign)_=U(a[t].getLabelSize(),_)});if(e.staggerLines)_*=e.staggerLines,e.labelOffset=_}else for(v in a)a[v].destroy(),delete a[v];if(f&&f.text&&f.enabled!==!1){if(!e.axisTitle)e.axisTitle=i.text(f.text,0,0,f.useHTML).attr({zIndex:7,rotation:f.rotation||0,align:f.textAlign||{low:"left",middle:"center",high:"right"}[f.align]}).addClass("highcharts-"+this.coll.toLowerCase()+"-title").css(f.style).add(e.axisGroup),e.axisTitle.isNew=!0;if(t)c=e.axisTitle.getBBox()[o?"height":"width"],m=p(f.margin,o?5:10),d=f.offset;e.axisTitle[t?"show":"hide"]()}e.offset=S*p(s.offset,y[r]);e.axisTitleMargin=p(d,_+m+(r!==2&&_&&S*s.labels[o?"y":"x"]));y[r]=U(y[r],e.axisTitleMargin+c+S*e.offset);b[l]=U(b[l],$(s.lineWidth/2)*2)},getLinePath:function(e){var t=this.chart,i=this.opposite,s=this.offset,n=this.horiz,a=this.left+(i?this.width:0)+s,s=t.chartHeight-this.bottom-(i?this.height:0)+s;i&&(e*=-1);return t.renderer.crispLine(["M",n?this.left:a,n?s:this.top,"L",n?t.chartWidth-this.right:a,n?s:t.chartHeight-this.bottom],e)},getTitlePosition:function(){var e=this.horiz,t=this.left,s=this.top,n=this.len,a=this.options.title,o=e?t:s,r=this.opposite,l=this.offset,h=i(a.style.fontSize||12),n={low:o+(e?0:n),middle:o+n/2,high:o+(e?n:0)}[a.align],t=(e?s+this.height:t)+(e?1:-1)*(r?-1:1)*this.axisTitleMargin+(this.side===2?h:0);return{x:e?n:t+(r?this.width:0)+l+(a.x||0),y:e?t-(r?this.height:0)+l:n+(a.y||0)}},render:function(){var e=this,t=e.horiz,i=e.reversed,s=e.chart,n=s.renderer,a=e.options,o=e.isLog,r=e.isLinked,h=e.tickPositions,c,d=e.axisTitle,p=e.ticks,m=e.minorTicks,f=e.alternateBands,g=a.stackLabels,_=a.alternateGridColor,y=e.tickmarkOffset,b=a.lineWidth,S=s.hasRendered&&u(e.oldMin)&&!isNaN(e.oldMin),v=e.hasData,w=e.showAxis,C,M=a.labels.overflow,T=e.justifyLabels=t&&M!==!1,x;e.labelEdge.length=0;e.justifyToPlot=M==="justify";Ue([p,m,f],function(e){for(var t in e)e[t].isActive=!1});if(v||r)if(e.minorTickInterval&&!e.categories&&Ue(e.getMinorTickPositions(),function(t){m[t]||(m[t]=new V(e,t,"minor"));S&&m[t].isNew&&m[t].render(null,!0);m[t].render(null,!1,1)}),h.length&&(c=h.slice(),(t&&i||!t&&!i)&&c.reverse(),T&&(c=c.slice(1).concat([c[0]])),Ue(c,function(t,i){T&&(i=i===c.length-1?0:i+1);if(!r||t>=e.min&&t<=e.max)p[t]||(p[t]=new V(e,t)),S&&p[t].isNew&&p[t].render(i,!0,.1),p[t].render(i,!1,1)}),y&&e.min===0&&(p[-1]||(p[-1]=new V(e,-1,null,!0)),p[-1].render(-1))),_&&Ue(h,function(t,i){
if(i%2===0&&t<e.max)f[t]||(f[t]=new He.PlotLineOrBand(e)),C=t+y,x=h[i+1]!==N?h[i+1]+y:e.max,f[t].options={from:o?l(C):C,to:o?l(x):x,color:_},f[t].render(),f[t].isActive=!0}),!e._addedPlotLB)Ue((a.plotLines||[]).concat(a.plotBands||[]),function(t){e.addPlotBandOrLine(t)}),e._addedPlotLB=!0;Ue([p,m,f],function(e){var t,i,n=[],a=ge?ge.duration||500:0,o=function(){for(i=n.length;i--;)e[n[i]]&&!e[n[i]].isActive&&(e[n[i]].destroy(),delete e[n[i]])};for(t in e)if(!e[t].isActive)e[t].render(t,!1,0),e[t].isActive=!1,n.push(t);e===f||!s.hasRendered||!a?o():a&&setTimeout(o,a)});if(b)t=e.getLinePath(b),e.axisLine?e.axisLine.animate({d:t}):e.axisLine=n.path(t).attr({stroke:a.lineColor,"stroke-width":b,zIndex:7}).add(e.axisGroup),e.axisLine[w?"show":"hide"]();if(d&&w)d[d.isNew?"attr":"animate"](e.getTitlePosition()),d.isNew=!1;g&&g.enabled&&e.renderStackTotals();e.isDirty=!1},redraw:function(){var e=this.chart.pointer;e&&e.reset(!0);this.render();Ue(this.plotLinesAndBands,function(e){e.render()});Ue(this.series,function(e){e.isDirty=!0})},destroy:function(e){var t=this,i=t.stacks,s,n=t.plotLinesAndBands;e||je(t);for(s in i)D(i[s]),i[s]=null;Ue([t.ticks,t.minorTicks,t.alternateBands],function(e){D(e)});for(e=n.length;e--;)n[e].destroy();Ue("stackTotalGroup,axisLine,axisTitle,axisGroup,cross,gridGroup,labelGroup".split(","),function(e){t[e]&&(t[e]=t[e].destroy())});this.cross&&this.cross.destroy()},drawCrosshair:function(e,t){if(this.crosshair)if((u(t)||!p(this.crosshair.snap,!0))===!1)this.hideCrosshair();else{var i,s=this.crosshair,n=s.animation;p(s.snap,!0)?u(t)&&(i=this.chart.inverted!=this.horiz?t.plotX:this.len-t.plotY):i=this.horiz?e.chartX-this.pos:this.len-e.chartY+this.pos;i=this.isRadial?this.getPlotLinePath(this.isXAxis?t.x:p(t.stackY,t.y)):this.getPlotLinePath(null,null,null,null,i);if(i===null)this.hideCrosshair();else if(this.cross)this.cross.attr({visibility:"visible"})[n?"animate":"attr"]({d:i},n);else{n={"stroke-width":s.width||1,stroke:s.color||"#C0C0C0",zIndex:s.zIndex||2};if(s.dashStyle)n.dashstyle=s.dashStyle;this.cross=this.chart.renderer.path(i).attr(n).add()}}},hideCrosshair:function(){this.cross&&this.cross.hide()}};e(O.prototype,{getPlotBandPath:function(e,t){var i=this.getPlotLinePath(t),s=this.getPlotLinePath(e);s&&i?s.push(i[4],i[5],i[1],i[2]):s=null;return s},addPlotBand:function(e){this.addPlotBandOrLine(e,"plotBands")},addPlotLine:function(e){this.addPlotBandOrLine(e,"plotLines")},addPlotBandOrLine:function(e,t){var i=new He.PlotLineOrBand(this,e).render(),s=this.userOptions;i&&(t&&(s[t]=s[t]||[],s[t].push(e)),this.plotLinesAndBands.push(i));return i},removePlotBandOrLine:function(e){for(var t=this.plotLinesAndBands,i=this.options,s=this.userOptions,n=t.length;n--;)t[n].id===e&&t[n].destroy();Ue([i.plotLines||[],s.plotLines||[],i.plotBands||[],s.plotBands||[]],function(t){for(n=t.length;n--;)t[n].id===e&&h(t,t[n])})}});O.prototype.getTimeTicks=function(t,i,s,n){var a=[],o={},r=me.global.useUTC,l,h=new Date(i-xe),c=t.unitRange,d=t.count;if(u(i)){c>=ye.second&&(h.setMilliseconds(0),h.setSeconds(c>=ye.minute?0:d*$(h.getSeconds()/d)));if(c>=ye.minute)h[Ee](c>=ye.hour?0:d*$(h[De]()/d));if(c>=ye.hour)h[Ve](c>=ye.day?0:d*$(h[Ae]()/d));if(c>=ye.day)h[Oe](c>=ye.month?1:d*$(h[Ie]()/d));c>=ye.month&&(h[Re](c>=ye.year?0:d*$(h[ke]()/d)),l=h[Pe]());c>=ye.year&&(l-=l%d,h[Be](l));if(c===ye.week)h[Oe](h[Ie]()-h[Le]()+p(n,1));i=1;xe&&(h=new Date(h.getTime()+xe));l=h[Pe]();for(var n=h.getTime(),m=h[ke](),f=h[Ie](),g=r?xe:(864e5+h.getTimezoneOffset()*6e4)%864e5;n<s;)a.push(n),c===ye.year?n=Te(l+i*d,0):c===ye.month?n=Te(l,m+i*d):!r&&(c===ye.day||c===ye.week)?n=Te(l,m,f+i*d*(c===ye.day?1:7)):n+=c*d,i++;a.push(n);Ue(Ge(a,function(e){return c<=ye.hour&&e%ye.day===g}),function(e){o[e]="day"})}a.info=e(t,{higherRanks:o,totalRange:c*d});return a};O.prototype.normalizeTimeTickInterval=function(e,t){var i=t||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],s=i[i.length-1],n=ye[s[0]],a=s[1],o;for(o=0;o<i.length;o++)if(s=i[o],n=ye[s[0]],a=s[1],i[o+1]&&e<=(n*a[a.length-1]+ye[i[o+1][0]])/2)break;n===ye.year&&e<5*n&&(a=[1,2,5]);i=w(e/n,a,s[0]==="year"?U(v(e/n),1):1);return{unitRange:n,count:i,unitName:s[0]}};O.prototype.getLogTickPositions=function(e,t,i,s){var n=this.options,a=this.len,o=[];if(!s)this._minorAutoInterval=null;if(e>=.5)e=F(e),o=this.getLinearTickPositions(e,t,i);else if(e>=.08)for(var a=$(t),h,u,c,d,m,n=e>.3?[1,2,4]:e>.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9];a<i+1&&!m;a++){u=n.length;for(h=0;h<u&&!m;h++)c=r(l(a)*n[h]),c>t&&(!s||d<=i)&&o.push(d),d>i&&(m=!0),d=c}else if(t=l(t),i=l(i),e=n[s?"minorTickInterval":"tickInterval"],e=p(e==="auto"?null:e,this._minorAutoInterval,(i-t)*(n.tickPixelInterval/(s?5:1))/((s?a/this.tickPositions.length:a)||1)),e=w(e,null,v(e)),o=Qe(this.getLinearTickPositions(e,t,i),r),!s)this._minorAutoInterval=e/5;if(!s)this.tickInterval=e;return o};var ut=He.Tooltip=function(){this.init.apply(this,arguments)};ut.prototype={init:function(e,t){var s=t.borderWidth,n=t.style,a=i(n.padding);this.chart=e;this.options=t;this.crosshairs=[];this.now={x:0,y:0};this.isHidden=!0;this.label=e.renderer.label("",0,0,t.shape,null,null,t.useHTML,null,"tooltip").attr({padding:a,fill:t.backgroundColor,"stroke-width":s,r:t.borderRadius,zIndex:8}).css(n).css({padding:0}).add().attr({y:-9999});le||this.label.shadow(t.shadow);this.shared=t.shared},destroy:function(){if(this.label)this.label=this.label.destroy();clearTimeout(this.hideTimer);clearTimeout(this.tooltipTimeout)},move:function(t,i,s,n){var a=this,o=a.now,r=a.options.animation!==!1&&!a.isHidden;e(o,{x:r?(2*o.x+t)/3:t,y:r?(o.y+i)/2:i,anchorX:r?(2*o.anchorX+s)/3:s,anchorY:r?(o.anchorY+n)/2:n});a.label.attr(o);if(r&&(W(t-o.x)>1||W(i-o.y)>1))clearTimeout(this.tooltipTimeout),this.tooltipTimeout=setTimeout(function(){a&&a.move(t,i,s,n)},32)},hide:function(){var e=this,t;clearTimeout(this.hideTimer);if(!this.isHidden)t=this.chart.hoverPoints,this.hideTimer=setTimeout(function(){e.label.fadeOut();e.isHidden=!0},p(this.options.hideDelay,500)),t&&Ue(t,function(e){e.setState()}),this.chart.hoverPoints=null},getAnchor:function(e,t){var i,s=this.chart,n=s.inverted,a=s.plotTop,o=0,r=0,l,e=d(e);i=e[0].tooltipPos;this.followPointer&&t&&(t.chartX===N&&(t=s.pointer.normalize(t)),i=[t.chartX-s.plotLeft,t.chartY-a]);i||(Ue(e,function(e){l=e.series.yAxis;o+=e.plotX;r+=(e.plotLow?(e.plotLow+e.plotHigh)/2:e.plotY)+(!n&&l?l.top-a:0)}),o/=e.length,r/=e.length,i=[n?s.plotWidth-r:o,this.shared&&!n&&e.length>1&&t?t.chartY-a:n?s.plotHeight-o:r]);return Qe(i,F)},getPosition:function(e,t,i){var s=this.chart,n=s.plotLeft,a=s.plotTop,o=s.plotWidth,r=s.plotHeight,l=p(this.options.distance,12),h=isNaN(i.plotX)?0:i.plotX,i=i.plotY,s=h+n+(s.inverted?l:-e-l),u=i-t+a+15,c;s<7&&(s=n+U(h,0)+l);s+e>n+o&&(s-=s+e-(n+o),u=i-t+a-l,c=!0);u<a+5&&(u=a+5,c&&i>=u&&i<=u+t&&(u=i+a+l));u+t>a+r&&(u=U(a,a+r-t-l));return{x:s,y:u}},defaultFormatter:function(e){var t=this.points||d(this),i=t[0].series,s;s=[e.tooltipHeaderFormatter(t[0])];Ue(t,function(e){i=e.series;s.push(i.tooltipFormatter&&i.tooltipFormatter(e)||e.point.tooltipFormatter(i.tooltipOptions.pointFormat))});s.push(e.options.footerFormat||"");return s.join("")},refresh:function(e,t){var i=this.chart,s=this.label,n=this.options,a,o,r={},l,h=[];l=n.formatter||this.defaultFormatter;var r=i.hoverPoints,u,c=this.shared;clearTimeout(this.hideTimer);this.followPointer=d(e)[0].series.tooltipOptions.followPointer;o=this.getAnchor(e,t);a=o[0];o=o[1];c&&(!e.series||!e.series.noSharedTooltip)?(i.hoverPoints=e,r&&Ue(r,function(e){e.setState()}),Ue(e,function(e){e.setState("hover");h.push(e.getLabelConfig())}),r={x:e[0].category,y:e[0].y},r.points=h,e=e[0]):r=e.getLabelConfig();l=l.call(r,this);r=e.series;l===!1?this.hide():(this.isHidden&&(et(s),s.attr("opacity",1).show()),s.attr({text:l}),u=n.borderColor||e.color||r.color||"#606060",s.attr({stroke:u}),this.updatePosition({plotX:a,plotY:o}),this.isHidden=!1);Ke(i,"tooltipRefresh",{text:l,x:a+i.plotLeft,y:o+i.plotTop,borderColor:u})},updatePosition:function(e){var t=this.chart,i=this.label,i=(this.options.positioner||this.getPosition).call(this,i.width,i.height,e);this.move(F(i.x),F(i.y),e.plotX+t.plotLeft,e.plotY+t.plotTop)},tooltipHeaderFormatter:function(e){var t=e.series,i=t.tooltipOptions,s=i.dateTimeLabelFormats,n=i.xDateFormat,a=t.xAxis,r=a&&a.options.type==="datetime"&&o(e.key),i=i.headerFormat,a=a&&a.closestPointRange,l;if(r&&!n){if(a)for(l in ye){if(ye[l]>=a||ye[l]<=ye.day&&e.key%ye[l]>0){n=s[l];break}}else n=s.day;n=n||s.year}r&&n&&(i=i.replace("{point.key}","{point.key:"+n+"}"));return S(i,{point:e,series:t})}};var ct;ue=H.documentElement.ontouchstart!==N;var dt=He.Pointer=function(e,t){this.init(e,t)};dt.prototype={init:function(e,t){var i=t.chart,s=i.events,n=le?"":i.zoomType,i=e.inverted,a;this.options=t;this.chart=e;this.zoomX=a=/x/.test(n);this.zoomY=n=/y/.test(n);this.zoomHor=a&&!i||n&&i;this.zoomVert=n&&!i||a&&i;this.runChartClick=s&&!!s.click;this.pinchDown=[];this.lastValidTouch={};if(He.Tooltip&&t.tooltip.enabled)e.tooltip=new ut(e,t.tooltip);this.setDOMEvents()},normalize:function(t,i){var s,n,t=t||q.event,t=Ze(t);if(!t.target)t.target=t.srcElement;n=t.touches?t.touches.item(0):t;if(!i)this.chartPosition=i=We(this.chart.container);n.pageX===N?(s=U(t.x,t.clientX-i.left),n=t.y):(s=n.pageX-i.left,n=n.pageY-i.top);return e(t,{chartX:F(s),chartY:F(n)})},getCoordinates:function(e){var t={xAxis:[],yAxis:[]};Ue(this.chart.axes,function(i){t[i.isXAxis?"xAxis":"yAxis"].push({axis:i,value:i.toValue(e[i.horiz?"chartX":"chartY"])})});return t},getIndex:function(e){var t=this.chart;return t.inverted?t.plotHeight+t.plotTop-e.chartY:e.chartX-t.plotLeft},runPointActions:function(e){var t=this.chart,i=t.series,s=t.tooltip,n,a,o=t.hoverPoint,r=t.hoverSeries,l,h,c=t.chartWidth,d=this.getIndex(e);if(s&&this.options.tooltip.shared&&(!r||!r.noSharedTooltip)){a=[];l=i.length;for(h=0;h<l;h++)if(i[h].visible&&i[h].options.enableMouseTracking!==!1&&!i[h].noSharedTooltip&&i[h].singularTooltips!==!0&&i[h].tooltipPoints.length&&(n=i[h].tooltipPoints[d])&&n.series)n._dist=W(d-n.clientX),c=G(c,n._dist),a.push(n);for(l=a.length;l--;)a[l]._dist>c&&a.splice(l,1);if(a.length&&a[0].clientX!==this.hoverX)s.refresh(a,e),this.hoverX=a[0].clientX}if(r&&r.tracker&&(!s||!s.followPointer)){if((n=r.tooltipPoints[d])&&n!==o)n.onMouseOver(e)}else s&&s.followPointer&&!s.isHidden&&(i=s.getAnchor([{}],e),s.updatePosition({plotX:i[0],plotY:i[1]}));if(s&&!this._onDocumentMouseMove)this._onDocumentMouseMove=function(e){if(u(ct))Se[ct].pointer.onDocumentMouseMove(e)},Xe(H,"mousemove",this._onDocumentMouseMove);Ue(t.axes,function(t){t.drawCrosshair(e,p(n,o))})},reset:function(e){var t=this.chart,i=t.hoverSeries,s=t.hoverPoint,n=t.tooltip,a=n&&n.shared?t.hoverPoints:s;(e=e&&n&&a)&&d(a)[0].plotX===N&&(e=!1);if(e)n.refresh(a),s&&s.setState(s.state,!0);else{if(s)s.onMouseOut();if(i)i.onMouseOut();n&&n.hide();if(this._onDocumentMouseMove)je(H,"mousemove",this._onDocumentMouseMove),this._onDocumentMouseMove=null;Ue(t.axes,function(e){e.hideCrosshair()});this.hoverX=null}},scaleGroups:function(e,t){var i=this.chart,s;Ue(i.series,function(n){s=e||n.getPlotBox();n.xAxis&&n.xAxis.zoomEnabled&&(n.group.attr(s),n.markerGroup&&(n.markerGroup.attr(s),n.markerGroup.clip(t?i.clipRect:null)),n.dataLabelsGroup&&n.dataLabelsGroup.attr(s))});i.clipRect.attr(t||i.clipBox)},dragStart:function(e){var t=this.chart;t.mouseIsDown=e.type;t.cancelClick=!1;t.mouseDownX=this.mouseDownX=e.chartX;t.mouseDownY=this.mouseDownY=e.chartY},drag:function(e){var t=this.chart,i=t.options.chart,s=e.chartX,n=e.chartY,a=this.zoomHor,o=this.zoomVert,r=t.plotLeft,l=t.plotTop,h=t.plotWidth,u=t.plotHeight,c,d=this.mouseDownX,p=this.mouseDownY;s<r?s=r:s>r+h&&(s=r+h);n<l?n=l:n>l+u&&(n=l+u);this.hasDragged=Math.sqrt(Math.pow(d-s,2)+Math.pow(p-n,2));if(this.hasDragged>10){c=t.isInsidePlot(d-r,p-l);if(t.hasCartesianSeries&&(this.zoomX||this.zoomY)&&c&&!this.selectionMarker)this.selectionMarker=t.renderer.rect(r,l,a?1:h,o?1:u,0).attr({fill:i.selectionMarkerFill||"rgba(69,114,167,0.25)",zIndex:7}).add();this.selectionMarker&&a&&(s-=d,this.selectionMarker.attr({width:W(s),x:(s>0?0:s)+d}));this.selectionMarker&&o&&(s=n-p,this.selectionMarker.attr({height:W(s),y:(s>0?0:s)+p}));c&&!this.selectionMarker&&i.panning&&t.pan(e,i.panning)}},drop:function(t){var i=this.chart,s=this.hasPinched;if(this.selectionMarker){var n={xAxis:[],yAxis:[],originalEvent:t.originalEvent||t},a=this.selectionMarker,o=a.x,r=a.y,l;if(this.hasDragged||s)Ue(i.axes,function(e){if(e.zoomEnabled){var t=e.horiz,i=e.toValue(t?o:r),t=e.toValue(t?o+a.width:r+a.height);!isNaN(i)&&!isNaN(t)&&(n[e.coll].push({axis:e,min:G(i,t),max:U(i,t)}),l=!0)}}),l&&Ke(i,"selection",n,function(t){i.zoom(e(t,s?{animation:!1}:null))});this.selectionMarker=this.selectionMarker.destroy();s&&this.scaleGroups()}if(i)m(i.container,{cursor:i._cursor}),i.cancelClick=this.hasDragged>10,i.mouseIsDown=this.hasDragged=this.hasPinched=!1,this.pinchDown=[]},onContainerMouseDown:function(e){e=this.normalize(e);e.preventDefault&&e.preventDefault();this.dragStart(e)},onDocumentMouseUp:function(e){u(ct)&&Se[ct].pointer.drop(e)},onDocumentMouseMove:function(e){var t=this.chart,i=this.chartPosition,s=t.hoverSeries,e=this.normalize(e,i);i&&s&&!this.inClass(e.target,"highcharts-tracker")&&!t.isInsidePlot(e.chartX-t.plotLeft,e.chartY-t.plotTop)&&this.reset()},onContainerMouseLeave:function(){var e=Se[ct];if(e)e.pointer.reset(),e.pointer.chartPosition=null;ct=null},onContainerMouseMove:function(e){var t=this.chart;ct=t.index;e=this.normalize(e);t.mouseIsDown==="mousedown"&&this.drag(e);(this.inClass(e.target,"highcharts-tracker")||t.isInsidePlot(e.chartX-t.plotLeft,e.chartY-t.plotTop))&&!t.openMenu&&this.runPointActions(e)},inClass:function(e,t){for(var i;e;){if(i=c(e,"class"))if(i.indexOf(t)!==-1)return!0;else if(i.indexOf("highcharts-container")!==-1)return!1;e=e.parentNode}},onTrackerMouseOut:function(e){var t=this.chart.hoverSeries,i=(e=e.relatedTarget||e.toElement)&&e.point&&e.point.series;if(t&&!t.options.stickyTracking&&!this.inClass(e,"highcharts-tooltip")&&i!==t)t.onMouseOut()},onContainerClick:function(t){var i=this.chart,s=i.hoverPoint,n=i.plotLeft,a=i.plotTop,o=i.inverted,r,l,h,t=this.normalize(t);t.cancelBubble=!0;if(!i.cancelClick)s&&this.inClass(t.target,"highcharts-tracker")?(r=this.chartPosition,l=s.plotX,h=s.plotY,e(s,{pageX:r.left+n+(o?i.plotWidth-h:l),pageY:r.top+a+(o?i.plotHeight-l:h)}),Ke(s.series,"click",e(t,{point:s})),i.hoverPoint&&s.firePointEvent("click",t)):(e(t,this.getCoordinates(t)),i.isInsidePlot(t.chartX-n,t.chartY-a)&&Ke(i,"click",t))},setDOMEvents:function(){var e=this,t=e.chart.container;t.onmousedown=function(t){e.onContainerMouseDown(t)};t.onmousemove=function(t){e.onContainerMouseMove(t)};t.onclick=function(t){e.onContainerClick(t)};Xe(t,"mouseleave",e.onContainerMouseLeave);Xe(H,"mouseup",e.onDocumentMouseUp);if(ue)t.ontouchstart=function(t){e.onContainerTouchStart(t)},t.ontouchmove=function(t){e.onContainerTouchMove(t)},Xe(H,"touchend",e.onDocumentTouchEnd)},destroy:function(){var e;je(this.chart.container,"mouseleave",this.onContainerMouseLeave);je(H,"mouseup",this.onDocumentMouseUp);je(H,"touchend",this.onDocumentTouchEnd);clearInterval(this.tooltipTimeout);for(e in this)this[e]=null}};e(He.Pointer.prototype,{pinchTranslate:function(e,t,i,s,n,a,o,r){e&&this.pinchTranslateDirection(!0,i,s,n,a,o,r);t&&this.pinchTranslateDirection(!1,i,s,n,a,o,r)},pinchTranslateDirection:function(e,t,i,s,n,a,o,r){var l=this.chart,h=e?"x":"y",u=e?"X":"Y",c="chart"+u,d=e?"width":"height",p=l["plot"+(e?"Left":"Top")],m,f,g=r||1,_=l.inverted,y=l.bounds[e?"h":"v"],b=t.length===1,S=t[0][c],v=i[0][c],w=!b&&t[1][c],C=!b&&i[1][c],M,i=function(){!b&&W(S-w)>20&&(g=r||W(v-C)/W(S-w));f=(p-v)/g+S;m=l["plot"+(e?"Width":"Height")]/g};i();t=f;t<y.min?(t=y.min,M=!0):t+m>y.max&&(t=y.max-m,M=!0);M?(v-=.8*(v-o[h][0]),b||(C-=.8*(C-o[h][1])),i()):o[h]=[v,C];_||(a[h]=f-p,a[d]=m);a=_?1/g:g;n[d]=m;n[h]=t;s[_?e?"scaleY":"scaleX":"scale"+u]=g;s["translate"+u]=a*p+(v-a*S)},pinch:function(t){var i=this,s=i.chart,n=i.pinchDown,a=s.tooltip&&s.tooltip.options.followTouchMove,o=t.touches,r=o.length,l=i.lastValidTouch,h=i.zoomHor||i.pinchHor,u=i.zoomVert||i.pinchVert,c=h||u,d=i.selectionMarker,p={},m=r===1&&(i.inClass(t.target,"highcharts-tracker")&&s.runTrackerClick||s.runChartClick),f={};(c||a)&&!m&&t.preventDefault();Qe(o,function(e){return i.normalize(e)});if(t.type==="touchstart")Ue(o,function(e,t){n[t]={chartX:e.chartX,chartY:e.chartY}}),l.x=[n[0].chartX,n[1]&&n[1].chartX],l.y=[n[0].chartY,n[1]&&n[1].chartY],Ue(s.axes,function(e){if(e.zoomEnabled){var t=s.bounds[e.horiz?"h":"v"],i=e.minPixelPadding,n=e.toPixels(e.dataMin),a=e.toPixels(e.dataMax),o=G(n,a),n=U(n,a);t.min=G(e.pos,o-i);t.max=U(e.pos+e.len,n+i)}});else if(n.length){if(!d)i.selectionMarker=d=e({destroy:be},s.plotBox);i.pinchTranslate(h,u,n,o,p,d,f,l);i.hasPinched=c;i.scaleGroups(p,f);!c&&a&&r===1&&this.runPointActions(i.normalize(t))}},onContainerTouchStart:function(e){var t=this.chart;ct=t.index;e.touches.length===1?(e=this.normalize(e),t.isInsidePlot(e.chartX-t.plotLeft,e.chartY-t.plotTop)?(this.runPointActions(e),this.pinch(e)):this.reset()):e.touches.length===2&&this.pinch(e)},onContainerTouchMove:function(e){(e.touches.length===1||e.touches.length===2)&&this.pinch(e)},onDocumentTouchEnd:function(e){u(ct)&&Se[ct].pointer.drop(e)}});if(q.PointerEvent||q.MSPointerEvent){var pt={},mt=!!q.PointerEvent,ft=function(){var e,t=[];t.item=function(e){return this[e]};for(e in pt)pt.hasOwnProperty(e)&&t.push({pageX:pt[e].pageX,pageY:pt[e].pageY,target:pt[e].target});return t},gt=function(e,t,i,s){e=e.originalEvent||e;if((e.pointerType==="touch"||e.pointerType===e.MSPOINTER_TYPE_TOUCH)&&Se[ct])s(e),s=Se[ct].pointer,s[t]({type:i,target:e.currentTarget,preventDefault:be,touches:ft()})};e(dt.prototype,{onContainerPointerDown:function(e){gt(e,"onContainerTouchStart","touchstart",function(e){pt[e.pointerId]={pageX:e.pageX,pageY:e.pageY,target:e.currentTarget}})},onContainerPointerMove:function(e){gt(e,"onContainerTouchMove","touchmove",function(e){pt[e.pointerId]={pageX:e.pageX,pageY:e.pageY};if(!pt[e.pointerId].target)pt[e.pointerId].target=e.currentTarget})},onDocumentPointerUp:function(e){gt(e,"onContainerTouchEnd","touchend",function(e){delete pt[e.pointerId]})},batchMSEvents:function(e){e(this.chart.container,mt?"pointerdown":"MSPointerDown",this.onContainerPointerDown);e(this.chart.container,mt?"pointermove":"MSPointerMove",this.onContainerPointerMove);e(H,mt?"pointerup":"MSPointerUp",this.onDocumentPointerUp)}});b(dt.prototype,"init",function(e,t,i){m(t.container,{"-ms-touch-action":we,"touch-action":we});e.call(this,t,i)});b(dt.prototype,"setDOMEvents",function(e){e.apply(this);this.batchMSEvents(Xe)});b(dt.prototype,"destroy",function(e){this.batchMSEvents(je);e.call(this)})}var _t=He.Legend=function(e,t){this.init(e,t)};_t.prototype={init:function(e,s){var n=this,a=s.itemStyle,o=p(s.padding,8),r=s.itemMarginTop||0;this.options=s;if(s.enabled)n.baseline=i(a.fontSize)+3+r,n.itemStyle=a,n.itemHiddenStyle=t(a,s.itemHiddenStyle),n.itemMarginTop=r,n.padding=o,n.initialItemX=o,n.initialItemY=o-5,n.maxItemWidth=0,n.chart=e,n.itemHeight=0,n.lastLineHeight=0,n.symbolWidth=p(s.symbolWidth,16),n.pages=[],n.render(),Xe(n.chart,"endResize",function(){n.positionCheckboxes()})},colorizeItem:function(e,t){var i=this.options,s=e.legendItem,n=e.legendLine,a=e.legendSymbol,o=this.itemHiddenStyle.color,i=t?i.itemStyle.color:o,r=t?e.legendColor||e.color||"#CCC":o,o=e.options&&e.options.marker,l={stroke:r,fill:r},h;s&&s.css({fill:i,color:i});n&&n.attr({stroke:r});if(a){if(o&&a.isMarker)for(h in o=e.convertAttribs(o),o)s=o[h],s!==N&&(l[h]=s);a.attr(l)}},positionItem:function(e){var t=this.options,i=t.symbolPadding,t=!t.rtl,s=e._legendItemPos,n=s[0],s=s[1],a=e.checkbox;e.legendGroup&&e.legendGroup.translate(t?n:this.legendWidth-n-2*i-4,s);if(a)a.x=n,a.y=s},destroyItem:function(e){var t=e.checkbox;Ue(["legendItem","legendLine","legendSymbol","legendGroup"],function(t){e[t]&&(e[t]=e[t].destroy())});t&&A(e.checkbox)},destroy:function(){var e=this.group,t=this.box;if(t)this.box=t.destroy();if(e)this.group=e.destroy()},positionCheckboxes:function(e){var t=this.group.alignAttr,i,s=this.clipHeight||this.legendHeight;if(t)i=t.translateY,Ue(this.allItems,function(n){var a=n.checkbox,o;a&&(o=i+a.y+(e||0)+3,m(a,{left:t.translateX+n.legendItemWidth+a.x-20+"px",top:o+"px",display:o>i-6&&o<i+s-6?"":we}))})},renderTitle:function(){var e=this.padding,t=this.options.title,i=0;if(t.text){if(!this.title)this.title=this.chart.renderer.label(t.text,e-3,e-4,null,null,null,null,null,"legend-title").attr({zIndex:1}).css(t.style).add(this.group);e=this.title.getBBox();i=e.height;this.offsetWidth=e.width;this.contentGroup.attr({translateY:i})}this.titleHeight=i},renderItem:function(e){var i=this.chart,s=i.renderer,n=this.options,a=n.layout==="horizontal",o=this.symbolWidth,r=n.symbolPadding,l=this.itemStyle,h=this.itemHiddenStyle,u=this.padding,c=a?p(n.itemDistance,8):0,d=!n.rtl,m=n.width,f=n.itemMarginBottom||0,g=this.itemMarginTop,_=this.initialItemX,y=e.legendItem,b=e.series&&e.series.drawLegendSymbol?e.series:e,v=b.options,v=this.createCheckboxForItem&&v&&v.showCheckbox,w=n.useHTML;if(!y)e.legendGroup=s.g("legend-item").attr({zIndex:1}).add(this.scrollGroup),b.drawLegendSymbol(this,e),e.legendItem=y=s.text(n.labelFormat?S(n.labelFormat,e):n.labelFormatter.call(e),d?o+r:-r,this.baseline,w).css(t(e.visible?l:h)).attr({align:d?"left":"right",zIndex:2}).add(e.legendGroup),this.setItemEvents&&this.setItemEvents(e,y,w,l,h),this.colorizeItem(e,e.visible),v&&this.createCheckboxForItem(e);s=y.getBBox();o=e.legendItemWidth=n.itemWidth||e.legendItemWidth||o+r+s.width+c+(v?20:0);this.itemHeight=r=F(e.legendItemHeight||s.height);if(a&&this.itemX-_+o>(m||i.chartWidth-2*u-_-n.x))this.itemX=_,this.itemY+=g+this.lastLineHeight+f,this.lastLineHeight=0;this.maxItemWidth=U(this.maxItemWidth,o);this.lastItemY=g+this.itemY+f;this.lastLineHeight=U(r,this.lastLineHeight);e._legendItemPos=[this.itemX,this.itemY];a?this.itemX+=o:(this.itemY+=g+r+f,this.lastLineHeight=r);this.offsetWidth=m||U((a?this.itemX-_-c:o)+u,this.offsetWidth)},getAllItems:function(){var e=[];Ue(this.chart.series,function(t){var i=t.options;if(p(i.showInLegend,!u(i.linkedTo)?N:!1,!0))e=e.concat(t.legendItems||(i.legendType==="point"?t.data:t))});return e},render:function(){var t=this,i=t.chart,s=i.renderer,n=t.group,a,o,r,l,h=t.box,u=t.options,c=t.padding,d=u.borderWidth,p=u.backgroundColor;t.itemX=t.initialItemX;t.itemY=t.initialItemY;t.offsetWidth=0;t.lastItemY=0;if(!n)t.group=n=s.g("legend").attr({zIndex:7}).add(),t.contentGroup=s.g().attr({zIndex:1}).add(n),t.scrollGroup=s.g().add(t.contentGroup);t.renderTitle();a=t.getAllItems();M(a,function(e,t){return(e.options&&e.options.legendIndex||0)-(t.options&&t.options.legendIndex||0)});u.reversed&&a.reverse();t.allItems=a;t.display=o=!!a.length;Ue(a,function(e){t.renderItem(e)});r=u.width||t.offsetWidth;l=t.lastItemY+t.lastLineHeight+t.titleHeight;l=t.handleOverflow(l);if(d||p){r+=c;l+=c;if(h){if(r>0&&l>0)h[h.isNew?"attr":"animate"](h.crisp({width:r,height:l})),h.isNew=!1}else t.box=h=s.rect(0,0,r,l,u.borderRadius,d||0).attr({stroke:u.borderColor,"stroke-width":d||0,fill:p||we}).add(n).shadow(u.shadow),h.isNew=!0;h[o?"show":"hide"]()}t.legendWidth=r;t.legendHeight=l;Ue(a,function(e){t.positionItem(e)});o&&n.align(e({width:r,height:l},u),!0,"spacingBox");i.isResizing||this.positionCheckboxes()},handleOverflow:function(e){var t=this,i=this.chart,s=i.renderer,n=this.options,a=n.y,a=i.spacingBox.height+(n.verticalAlign==="top"?-a:a)-this.padding,o=n.maxHeight,r,l=this.clipRect,h=n.navigation,u=p(h.animation,!0),c=h.arrowSize||12,d=this.nav,m=this.pages,f,g=this.allItems;n.layout==="horizontal"&&(a/=2);o&&(a=G(a,o));m.length=0;if(e>a&&!n.useHTML){this.clipHeight=r=a-20-this.titleHeight-this.padding;this.currentPage=p(this.currentPage,1);this.fullHeight=e;Ue(g,function(e,t){var i=e._legendItemPos[1],s=F(e.legendItem.getBBox().height),n=m.length;if(!n||i-m[n-1]>r&&(f||i)!==m[n-1])m.push(f||i),n++;t===g.length-1&&i+s-m[n-1]>r&&m.push(i);i!==f&&(f=i)});if(!l)l=t.clipRect=s.clipRect(0,this.padding,9999,0),t.contentGroup.clip(l);l.attr({height:r});if(!d)this.nav=d=s.g().attr({zIndex:1}).add(this.group),this.up=s.symbol("triangle",0,0,c,c).on("click",function(){t.scroll(-1,u)}).add(d),this.pager=s.text("",15,10).css(h.style).add(d),this.down=s.symbol("triangle-down",0,0,c,c).on("click",function(){t.scroll(1,u)}).add(d);t.scroll(0);e=a}else if(d)l.attr({height:i.chartHeight}),d.hide(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0;return e},scroll:function(e,t){var i=this.pages,s=i.length,n=this.currentPage+e,a=this.clipHeight,o=this.options.navigation,r=o.activeColor,o=o.inactiveColor,l=this.pager,h=this.padding;n>s&&(n=s);if(n>0)t!==N&&k(t,this.chart),this.nav.attr({translateX:h,translateY:a+this.padding+7+this.titleHeight,visibility:"visible"}),this.up.attr({fill:n===1?o:r}).css({cursor:n===1?"default":"pointer"}),l.attr({text:n+"/"+s}),this.down.attr({x:18+this.pager.getBBox().width,fill:n===s?o:r}).css({cursor:n===s?"default":"pointer"}),i=-i[n-1]+this.initialItemY,this.scrollGroup.animate({translateY:i}),this.currentPage=n,this.positionCheckboxes(i)}};ze=He.LegendSymbolMixin={drawRectangle:function(e,t){var i=e.options.symbolHeight||12;t.legendSymbol=this.chart.renderer.rect(0,e.baseline-5-i/2,e.symbolWidth,i,p(e.options.symbolRadius,2)).attr({zIndex:3}).add(t.legendGroup)},drawLineMarker:function(e){var t=this.options,i=t.marker,s;s=e.symbolWidth;var n=this.chart.renderer,a=this.legendGroup,e=e.baseline-F(n.fontMetrics(e.options.itemStyle.fontSize).b*.3),o;if(t.lineWidth){o={"stroke-width":t.lineWidth};if(t.dashStyle)o.dashstyle=t.dashStyle;this.legendLine=n.path(["M",0,e,"L",s,e]).attr(o).add(a)}if(i&&i.enabled)t=i.radius,this.legendSymbol=s=n.symbol(this.symbol,s/2-t,e-t,2*t,2*t).add(a),s.isMarker=!0}};(/Trident\/7\.0/.test(Z)||se)&&b(_t.prototype,"positionItem",function(e,t){var i=this,s=function(){t._legendItemPos&&e.call(i,t)};i.chart.renderer.forExport?s():setTimeout(s)});R.prototype={init:function(e,i){var s,n=e.series;e.series=null;s=t(me,e);s.series=e.series=n;this.userOptions=e;n=s.chart;this.margin=this.splashArray("margin",n);this.spacing=this.splashArray("spacing",n);var a=n.events;this.bounds={h:{},v:{}};this.callback=i;this.isResizing=0;this.options=s;this.axes=[];this.series=[];this.hasCartesianSeries=n.showAxes;var o=this,r;o.index=Se.length;Se.push(o);n.reflow!==!1&&Xe(o,"load",function(){o.initReflow()});if(a)for(r in a)Xe(o,r,a[r]);o.xAxis=[];o.yAxis=[];o.animation=le?!1:p(n.animation,!0);o.pointCount=0;o.counters=new C;o.firstRender()},initSeries:function(e){var t=this.options.chart;(t=Ne[e.type||t.type||t.defaultSeriesType])||L(17,!0);t=new t;t.init(this,e);return t},isInsidePlot:function(e,t,i){var s=i?t:e,e=i?e:t;return s>=0&&s<=this.plotWidth&&e>=0&&e<=this.plotHeight},adjustTickAmounts:function(){this.options.chart.alignTicks!==!1&&Ue(this.axes,function(e){e.adjustTickAmount()});this.maxTicks=null},redraw:function(t){var i=this.axes,s=this.series,n=this.pointer,a=this.legend,o=this.isDirtyLegend,r,l,h=this.isDirtyBox,u=s.length,c=u,d=this.renderer,p=d.isHidden(),m=[];k(t,this);p&&this.cloneRenderTo();for(this.layOutTitles();c--;)if(t=s[c],t.options.stacking&&(r=!0,t.isDirty)){l=!0;break}if(l)for(c=u;c--;)if(t=s[c],t.options.stacking)t.isDirty=!0;Ue(s,function(e){e.isDirty&&e.options.legendType==="point"&&(o=!0)});if(o&&a.options.enabled)a.render(),this.isDirtyLegend=!1;r&&this.getStacks();if(this.hasCartesianSeries){if(!this.isResizing)this.maxTicks=null,Ue(i,function(e){e.setScale()});this.adjustTickAmounts();this.getMargins();Ue(i,function(e){e.isDirty&&(h=!0)});Ue(i,function(t){if(t.isDirtyExtremes)t.isDirtyExtremes=!1,m.push(function(){Ke(t,"afterSetExtremes",e(t.eventArgs,t.getExtremes()));delete t.eventArgs});(h||r)&&t.redraw()})}h&&this.drawChartBox();Ue(s,function(e){e.isDirty&&e.visible&&(!e.isCartesian||e.xAxis)&&e.redraw()});n&&n.reset(!0);d.draw();Ke(this,"redraw");p&&this.cloneRenderTo(!0);Ue(m,function(e){e.call()})},get:function(e){var t=this.axes,i=this.series,s,n;for(s=0;s<t.length;s++)if(t[s].options.id===e)return t[s];for(s=0;s<i.length;s++)if(i[s].options.id===e)return i[s];for(s=0;s<i.length;s++){n=i[s].points||[];for(t=0;t<n.length;t++)if(n[t].id===e)return n[t]}return null},getAxes:function(){var e=this,t=this.options,i=t.xAxis=d(t.xAxis||{}),t=t.yAxis=d(t.yAxis||{});Ue(i,function(e,t){e.index=t;e.isX=!0});Ue(t,function(e,t){e.index=t});i=i.concat(t);Ue(i,function(t){new O(e,t)});e.adjustTickAmounts()},getSelectedPoints:function(){var e=[];Ue(this.series,function(t){e=e.concat(Ge(t.points||[],function(e){return e.selected}))});return e},getSelectedSeries:function(){return Ge(this.series,function(e){return e.selected})},getStacks:function(){var e=this;Ue(e.yAxis,function(e){if(e.stacks&&e.hasVisibleSeries)e.oldStacks=e.stacks});Ue(e.series,function(t){if(t.options.stacking&&(t.visible===!0||e.options.chart.ignoreHiddenSeries===!1))t.stackKey=t.type+p(t.options.stack,"")})},setTitle:function(e,i,s){var n;var a=this,o=a.options,r;r=o.title=t(o.title,e);n=o.subtitle=t(o.subtitle,i),o=n;Ue([["title",e,r],["subtitle",i,o]],function(e){var t=e[0],i=a[t],s=e[1],e=e[2];i&&s&&(a[t]=i=i.destroy());e&&e.text&&!i&&(a[t]=a.renderer.text(e.text,0,0,e.useHTML).attr({align:e.align,"class":"highcharts-"+t,zIndex:e.zIndex||4}).css(e.style).add())});a.layOutTitles(s)},layOutTitles:function(t){var i=0,s=this.title,n=this.subtitle,a=this.options,o=a.title,a=a.subtitle,r=this.spacingBox.width-44;if(s&&(s.css({width:(o.width||r)+"px"}).align(e({y:15},o),!1,"spacingBox"),!o.floating&&!o.verticalAlign))i=s.getBBox().height,i>=18&&i<=25&&(i=15);n&&(n.css({width:(a.width||r)+"px"}).align(e({y:i+o.margin},a),!1,"spacingBox"),!a.floating&&!a.verticalAlign&&(i=Y(i+n.getBBox().height)));s=this.titleOffset!==i;this.titleOffset=i;if(!this.isDirtyBox&&s)this.isDirtyBox=s,this.hasRendered&&p(t,!0)&&this.isDirtyBox&&this.redraw()},getChartSize:function(){var e=this.options.chart,t=e.width,e=e.height,i=this.renderToClone||this.renderTo;if(!u(t))this.containerWidth=Fe(i,"width");if(!u(e))this.containerHeight=Fe(i,"height");this.chartWidth=U(0,t||this.containerWidth||600);this.chartHeight=U(0,p(e,this.containerHeight>19?this.containerHeight:400))},cloneRenderTo:function(e){var t=this.renderToClone,i=this.container;e?t&&(this.renderTo.appendChild(i),A(t),delete this.renderToClone):(i&&i.parentNode===this.renderTo&&this.renderTo.removeChild(i),this.renderToClone=t=this.renderTo.cloneNode(0),m(t,{position:"absolute",top:"-9999px",display:"block"}),t.style.setProperty&&t.style.setProperty("display","block","important"),H.body.appendChild(t),i&&t.appendChild(i))},getContainer:function(){var t,n=this.options.chart,a,o,r;this.renderTo=t=n.renderTo;r="highcharts-"+de++;if(s(t))this.renderTo=t=H.getElementById(t);t||L(13,!0);a=i(c(t,"data-highcharts-chart"));!isNaN(a)&&Se[a]&&Se[a].hasRendered&&Se[a].destroy();c(t,"data-highcharts-chart",this.index);t.innerHTML="";!n.skipClone&&!t.offsetWidth&&this.cloneRenderTo();this.getChartSize();a=this.chartWidth;o=this.chartHeight;this.container=t=f(ve,{className:"highcharts-container"+(n.className?" "+n.className:""),id:r},e({position:"relative",overflow:"hidden",width:a+"px",height:o+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)"},n.style),this.renderToClone||t);this._cursor=t.style.cursor;this.renderer=n.forExport?new ot(t,a,o,n.style,!0):new he(t,a,o,n.style);le&&this.renderer.create(this,t,a,o)},getMargins:function(){var e=this.spacing,t,i=this.legend,s=this.margin,n=this.options.legend,a=p(n.margin,10),o=n.x,r=n.y,l=n.align,h=n.verticalAlign,c=this.titleOffset;this.resetMargins();t=this.axisOffset;if(c&&!u(s[0]))this.plotTop=U(this.plotTop,c+this.options.title.margin+e[0]);
if(i.display&&!n.floating)if(l==="right"){if(!u(s[1]))this.marginRight=U(this.marginRight,i.legendWidth-o+a+e[1])}else if(l==="left"){if(!u(s[3]))this.plotLeft=U(this.plotLeft,i.legendWidth+o+a+e[3])}else if(h==="top"){if(!u(s[0]))this.plotTop=U(this.plotTop,i.legendHeight+r+a+e[0])}else if(h==="bottom"&&!u(s[2]))this.marginBottom=U(this.marginBottom,i.legendHeight-r+a+e[2]);this.extraBottomMargin&&(this.marginBottom+=this.extraBottomMargin);this.extraTopMargin&&(this.plotTop+=this.extraTopMargin);this.hasCartesianSeries&&Ue(this.axes,function(e){e.getOffset()});u(s[3])||(this.plotLeft+=t[3]);u(s[0])||(this.plotTop+=t[0]);u(s[2])||(this.marginBottom+=t[2]);u(s[1])||(this.marginRight+=t[1]);this.setChartSize()},reflow:function(e){var t=this,i=t.options.chart,s=t.renderTo,n=i.width||Fe(s,"width"),a=i.height||Fe(s,"height"),i=e?e.target:q,s=function(){if(t.container)t.setSize(n,a,!1),t.hasUserSize=null};if(!t.hasUserSize&&n&&a&&(i===q||i===H)){if(n!==t.containerWidth||a!==t.containerHeight)clearTimeout(t.reflowTimeout),e?t.reflowTimeout=setTimeout(s,100):s();t.containerWidth=n;t.containerHeight=a}},initReflow:function(){var e=this,t=function(t){e.reflow(t)};Xe(q,"resize",t);Xe(e,"destroy",function(){je(q,"resize",t)})},setSize:function(e,t,i){var s=this,n,a,o;s.isResizing+=1;o=function(){s&&Ke(s,"endResize",null,function(){s.isResizing-=1})};k(i,s);s.oldChartHeight=s.chartHeight;s.oldChartWidth=s.chartWidth;if(u(e))s.chartWidth=n=U(0,F(e)),s.hasUserSize=!!n;if(u(t))s.chartHeight=a=U(0,F(t));(ge?Je:m)(s.container,{width:n+"px",height:a+"px"},ge);s.setChartSize(!0);s.renderer.setSize(n,a,i);s.maxTicks=null;Ue(s.axes,function(e){e.isDirty=!0;e.setScale()});Ue(s.series,function(e){e.isDirty=!0});s.isDirtyLegend=!0;s.isDirtyBox=!0;s.getMargins();s.redraw(i);s.oldChartHeight=null;Ke(s,"resize");ge===!1?o():setTimeout(o,ge&&ge.duration||500)},setChartSize:function(e){var t=this.inverted,i=this.renderer,s=this.chartWidth,n=this.chartHeight,a=this.options.chart,o=this.spacing,r=this.clipOffset,l,h,u,c;this.plotLeft=l=F(this.plotLeft);this.plotTop=h=F(this.plotTop);this.plotWidth=u=U(0,F(s-l-this.marginRight));this.plotHeight=c=U(0,F(n-h-this.marginBottom));this.plotSizeX=t?c:u;this.plotSizeY=t?u:c;this.plotBorderWidth=a.plotBorderWidth||0;this.spacingBox=i.spacingBox={x:o[3],y:o[0],width:s-o[3]-o[1],height:n-o[0]-o[2]};this.plotBox=i.plotBox={x:l,y:h,width:u,height:c};s=2*$(this.plotBorderWidth/2);t=Y(U(s,r[3])/2);i=Y(U(s,r[0])/2);this.clipBox={x:t,y:i,width:$(this.plotSizeX-U(s,r[1])/2-t),height:$(this.plotSizeY-U(s,r[2])/2-i)};e||Ue(this.axes,function(e){e.setAxisSize();e.setAxisTranslation()})},resetMargins:function(){var e=this.spacing,t=this.margin;this.plotTop=p(t[0],e[0]);this.marginRight=p(t[1],e[1]);this.marginBottom=p(t[2],e[2]);this.plotLeft=p(t[3],e[3]);this.axisOffset=[0,0,0,0];this.clipOffset=[0,0,0,0]},drawChartBox:function(){var e=this.options.chart,t=this.renderer,i=this.chartWidth,s=this.chartHeight,n=this.chartBackground,a=this.plotBackground,o=this.plotBorder,r=this.plotBGImage,l=e.borderWidth||0,h=e.backgroundColor,u=e.plotBackgroundColor,c=e.plotBackgroundImage,d=e.plotBorderWidth||0,p,m=this.plotLeft,f=this.plotTop,g=this.plotWidth,_=this.plotHeight,y=this.plotBox,b=this.clipRect,S=this.clipBox;p=l+(e.shadow?8:0);if(l||h)if(n)n.animate(n.crisp({width:i-p,height:s-p}));else{n={fill:h||we};if(l)n.stroke=e.borderColor,n["stroke-width"]=l;this.chartBackground=t.rect(p/2,p/2,i-p,s-p,e.borderRadius,l).attr(n).addClass("highcharts-background").add().shadow(e.shadow)}if(u)a?a.animate(y):this.plotBackground=t.rect(m,f,g,_,0).attr({fill:u}).add().shadow(e.plotShadow);if(c)r?r.animate(y):this.plotBGImage=t.image(c,m,f,g,_).add();b?b.animate({width:S.width,height:S.height}):this.clipRect=t.clipRect(S);if(d)o?o.animate(o.crisp({x:m,y:f,width:g,height:_})):this.plotBorder=t.rect(m,f,g,_,0,-d).attr({stroke:e.plotBorderColor,"stroke-width":d,fill:we,zIndex:1}).add();this.isDirtyBox=!1},propFromSeries:function(){var e=this,t=e.options.chart,i,s=e.options.series,n,a;Ue(["inverted","angular","polar"],function(o){i=Ne[t.type||t.defaultSeriesType];a=e[o]||t[o]||i&&i.prototype[o];for(n=s&&s.length;!a&&n--;)(i=Ne[s[n].type])&&i.prototype[o]&&(a=!0);e[o]=a})},linkSeries:function(){var e=this,t=e.series;Ue(t,function(e){e.linkedSeries.length=0});Ue(t,function(t){var i=t.options.linkedTo;if(s(i)&&(i=i===":previous"?e.series[t.index-1]:e.get(i)))i.linkedSeries.push(t),t.linkedParent=i})},renderSeries:function(){Ue(this.series,function(e){e.translate();e.setTooltipPoints&&e.setTooltipPoints();e.render()})},render:function(){var t=this,s=t.axes,n=t.renderer,a=t.options,o=a.labels,r=a.credits,l;t.setTitle();t.legend=new _t(t,a.legend);t.getStacks();Ue(s,function(e){e.setScale()});t.getMargins();t.maxTicks=null;Ue(s,function(e){e.setTickPositions(!0);e.setMaxTicks()});t.adjustTickAmounts();t.getMargins();t.drawChartBox();t.hasCartesianSeries&&Ue(s,function(e){e.render()});if(!t.seriesGroup)t.seriesGroup=n.g("series-group").attr({zIndex:3}).add();t.renderSeries();o.items&&Ue(o.items,function(s){var a=e(o.style,s.style),r=i(a.left)+t.plotLeft,l=i(a.top)+t.plotTop+12;delete a.left;delete a.top;n.text(s.html,r,l).attr({zIndex:2}).css(a).add()});if(r.enabled&&!t.credits)l=r.href,t.credits=n.text(r.text,0,0).on("click",function(){if(l)location.href=l}).attr({align:r.position.align,zIndex:8}).css(r.style).add().align(r.position);t.hasRendered=!0},destroy:function(){var e=this,t=e.axes,i=e.series,s=e.container,n,a=s&&s.parentNode;Ke(e,"destroy");Se[e.index]=N;e.renderTo.removeAttribute("data-highcharts-chart");je(e);for(n=t.length;n--;)t[n]=t[n].destroy();for(n=i.length;n--;)i[n]=i[n].destroy();Ue("title,subtitle,chartBackground,plotBackground,plotBGImage,plotBorder,seriesGroup,clipRect,credits,pointer,scroller,rangeSelector,legend,resetZoomButton,tooltip,renderer".split(","),function(t){var i=e[t];i&&i.destroy&&(e[t]=i.destroy())});if(s)s.innerHTML="",je(s),a&&A(s);for(n in e)delete e[n]},isReadyToRender:function(){var e=this;return!oe&&q==q.top&&H.readyState!=="complete"||le&&!q.canvg?(le?ht.push(function(){e.firstRender()},e.options.global.canvasToolsURL):H.attachEvent("onreadystatechange",function(){H.detachEvent("onreadystatechange",e.firstRender);H.readyState==="complete"&&e.firstRender()}),!1):!0},firstRender:function(){var e=this,t=e.options,i=e.callback;if(e.isReadyToRender()){e.getContainer();Ke(e,"init");e.resetMargins();e.setChartSize();e.propFromSeries();e.getAxes();Ue(t.series||[],function(t){e.initSeries(t)});e.linkSeries();Ke(e,"beforeRender");if(He.Pointer)e.pointer=new dt(e,t);e.render();e.renderer.draw();i&&i.apply(e,[e]);Ue(e.callbacks,function(t){t.apply(e,[e])});e.cloneRenderTo(!0);Ke(e,"load")}},splashArray:function(e,t){var i=t[e],i=n(i)?i:[i,i,i,i];return[p(t[e+"Top"],i[0]),p(t[e+"Right"],i[1]),p(t[e+"Bottom"],i[2]),p(t[e+"Left"],i[3])]}};R.prototype.callbacks=[];rt=He.CenteredSeriesMixin={getCenter:function(){var e=this.options,t=this.chart,s=2*(e.slicedOffset||0),n,a=t.plotWidth-2*s,o=t.plotHeight-2*s,t=e.center,e=[p(t[0],"50%"),p(t[1],"50%"),e.size||"100%",e.innerSize||0],r=G(a,o),l;return Qe(e,function(e,t){l=/%$/.test(e);n=t<2||t===2&&l;return(l?[a,o,r,r][t]*i(e)/100:e)+(n?s:0)})}};var yt=function(){};yt.prototype={init:function(e,t,i){this.series=e;this.applyOptions(t,i);this.pointAttr={};if(e.options.colorByPoint&&(t=e.options.colors||e.chart.options.colors,this.color=this.color||t[e.colorCounter++],e.colorCounter===t.length))e.colorCounter=0;e.chart.pointCount++;return this},applyOptions:function(t,i){var s=this.series,n=s.pointValKey,t=yt.prototype.optionsToObject.call(this,t);e(this,t);this.options=this.options?e(this.options,t):t;if(n)this.y=this[n];if(this.x===N&&s)this.x=i===N?s.autoIncrement():i;return this},optionsToObject:function(e){var t={},i=this.series,s=i.pointArrayMap||["y"],n=s.length,o=0,r=0;if(typeof e==="number"||e===null)t[s[0]]=e;else if(a(e)){if(e.length>n){i=typeof e[0];if(i==="string")t.name=e[0];else if(i==="number")t.x=e[0];o++}for(;r<n;)t[s[r++]]=e[o++]}else if(typeof e==="object"){t=e;if(e.dataLabels)i._hasPointLabels=!0;if(e.marker)i._hasPointMarkers=!0}return t},destroy:function(){var e=this.series.chart,t=e.hoverPoints,i;e.pointCount--;if(t&&(this.setState(),h(t,this),!t.length))e.hoverPoints=null;if(this===e.hoverPoint)this.onMouseOut();if(this.graphic||this.dataLabel)je(this),this.destroyElements();this.legendItem&&e.legend.destroyItem(this);for(i in this)this[i]=null},destroyElements:function(){for(var e="graphic,dataLabel,dataLabelUpper,group,connector,shadowGroup".split(","),t,i=6;i--;)t=e[i],this[t]&&(this[t]=this[t].destroy())},getLabelConfig:function(){return{x:this.category,y:this.y,key:this.name||this.category,series:this.series,point:this,percentage:this.percentage,total:this.total||this.stackTotal}},tooltipFormatter:function(e){var t=this.series,i=t.tooltipOptions,s=p(i.valueDecimals,""),n=i.valuePrefix||"",a=i.valueSuffix||"";Ue(t.pointArrayMap||["y"],function(t){t="{point."+t;if(n||a)e=e.replace(t+"}",n+t+"}"+a);e=e.replace(t+"}",t+":,."+s+"f}")});return S(e,{point:this,series:this.series})}};var bt=function(){};bt.prototype={isCartesian:!0,type:"line",pointClass:yt,sorted:!0,requireSorting:!0,pointAttrToOptions:{stroke:"lineColor","stroke-width":"lineWidth",fill:"fillColor",r:"radius"},axisTypes:["xAxis","yAxis"],colorCounter:0,parallelArrays:["x","y"],init:function(t,i){var s=this,n,a,o=t.series,r=function(e,t){return p(e.options.index,e._i)-p(t.options.index,t._i)};s.chart=t;s.options=i=s.setOptions(i);s.linkedSeries=[];s.bindAxes();e(s,{name:i.name,state:"",pointAttr:{},visible:i.visible!==!1,selected:i.selected===!0});if(le)i.animation=!1;a=i.events;for(n in a)Xe(s,n,a[n]);if(a&&a.click||i.point&&i.point.events&&i.point.events.click||i.allowPointSelect)t.runTrackerClick=!0;s.getColor();s.getSymbol();Ue(s.parallelArrays,function(e){s[e+"Data"]=[]});s.setData(i.data,!1);if(s.isCartesian)t.hasCartesianSeries=!0;o.push(s);s._i=o.length-1;M(o,r);this.yAxis&&M(this.yAxis.series,r);Ue(o,function(e,t){e.index=t;e.name=e.name||"Series "+(t+1)})},bindAxes:function(){var e=this,t=e.options,i=e.chart,s;Ue(e.axisTypes||[],function(n){Ue(i[n],function(i){s=i.options;if(t[n]===s.index||t[n]!==N&&t[n]===s.id||t[n]===N&&s.index===0)i.series.push(e),e[n]=i,i.isDirty=!0});!e[n]&&e.optionalAxis!==n&&L(18,!0)})},updateParallelArrays:function(e,t){var i=e.series,s=arguments;Ue(i.parallelArrays,typeof t==="number"?function(s){var n=s==="y"&&i.toYData?i.toYData(e):e[s];i[s+"Data"][t]=n}:function(e){Array.prototype[t].apply(i[e+"Data"],Array.prototype.slice.call(s,2))})},autoIncrement:function(){var e=this.options,t=this.xIncrement,t=p(t,e.pointStart,0);this.pointInterval=p(this.pointInterval,e.pointInterval,1);this.xIncrement=t+this.pointInterval;return t},getSegments:function(){var e=-1,t=[],i,s=this.points,n=s.length;if(n)if(this.options.connectNulls){for(i=n;i--;)s[i].y===null&&s.splice(i,1);s.length&&(t=[s])}else Ue(s,function(i,a){i.y===null?(a>e+1&&t.push(s.slice(e+1,a)),e=a):a===n-1&&t.push(s.slice(e+1,a+1))});this.segments=t},setOptions:function(e){var i=this.chart,s=i.options.plotOptions,i=i.userOptions||{},n=i.plotOptions||{},a=s[this.type];this.userOptions=e;s=t(a,s.series,e);this.tooltipOptions=t(me.tooltip,me.plotOptions[this.type].tooltip,i.tooltip,n.series&&n.series.tooltip,n[this.type]&&n[this.type].tooltip,e.tooltip);a.marker===null&&delete s.marker;return s},getColor:function(){var e=this.options,t=this.userOptions,i=this.chart.options.colors,s=this.chart.counters,n;n=e.color||tt[this.type].color;if(!n&&!e.colorByPoint)u(t._colorIndex)?e=t._colorIndex:(t._colorIndex=s.color,e=s.color++),n=i[e];this.color=n;s.wrapColor(i.length)},getSymbol:function(){var e=this.userOptions,t=this.options.marker,i=this.chart,s=i.options.symbols,i=i.counters;this.symbol=t.symbol;if(!this.symbol)u(e._symbolIndex)?e=e._symbolIndex:(e._symbolIndex=i.symbol,e=i.symbol++),this.symbol=s[e];if(/^url/.test(this.symbol))t.radius=0;i.wrapSymbol(s.length)},drawLegendSymbol:ze.drawLineMarker,setData:function(e,t,i,n){var r=this,l=r.points,h=l&&l.length||0,u,c=r.options,d=r.chart,m=null,f=r.xAxis,g=f&&!!f.categories,_=r.tooltipPoints,y=c.turboThreshold,b=this.xData,S=this.yData,v=(u=r.pointArrayMap)&&u.length,e=e||[];u=e.length;t=p(t,!0);if(n!==!1&&u&&h===u&&!r.cropped&&!r.hasGroupedData)Ue(e,function(e,t){l[t].update(e,!1)});else{r.xIncrement=null;r.pointRange=g?1:c.pointRange;r.colorCounter=0;Ue(this.parallelArrays,function(e){r[e+"Data"].length=0});if(y&&u>y){for(i=0;m===null&&i<u;)m=e[i],i++;if(o(m)){g=p(c.pointStart,0);c=p(c.pointInterval,1);for(i=0;i<u;i++)b[i]=g,S[i]=e[i],g+=c;r.xIncrement=g}else if(a(m))if(v)for(i=0;i<u;i++)c=e[i],b[i]=c[0],S[i]=c.slice(1,v+1);else for(i=0;i<u;i++)c=e[i],b[i]=c[0],S[i]=c[1];else L(12)}else for(i=0;i<u;i++)if(e[i]!==N&&(c={series:r},r.pointClass.prototype.applyOptions.apply(c,[e[i]]),r.updateParallelArrays(c,i),g&&c.name))f.names[c.x]=c.name;s(S[0])&&L(14,!0);r.data=[];r.options.data=e;for(i=h;i--;)l[i]&&l[i].destroy&&l[i].destroy();if(_)_.length=0;if(f)f.minRange=f.userMinRange;r.isDirty=r.isDirtyData=d.isDirtyBox=!0;i=!1}t&&d.redraw(i)},processData:function(e){var t=this.xData,i=this.yData,s=t.length,n;n=0;var a,o,r=this.xAxis,l=this.options,h=l.cropThreshold,u=this.isCartesian;if(u&&!this.isDirty&&!r.isDirty&&!this.yAxis.isDirty&&!e)return!1;if(u&&this.sorted&&(!h||s>h||this.forceCrop))if(e=r.min,r=r.max,t[s-1]<e||t[0]>r)t=[],i=[];else if(t[0]<e||t[s-1]>r)n=this.cropData(this.xData,this.yData,e,r),t=n.xData,i=n.yData,n=n.start,a=!0;for(r=t.length-1;r>=0;r--)s=t[r]-t[r-1],s>0&&(o===N||s<o)?o=s:s<0&&this.requireSorting&&L(15);this.cropped=a;this.cropStart=n;this.processedXData=t;this.processedYData=i;if(l.pointRange===null)this.pointRange=o||1;this.closestPointRange=o},cropData:function(e,t,i,s){var n=e.length,a=0,o=n,r=p(this.cropShoulder,1),l;for(l=0;l<n;l++)if(e[l]>=i){a=U(0,l-r);break}for(;l<n;l++)if(e[l]>s){o=l+r;break}return{xData:e.slice(a,o),yData:t.slice(a,o),start:a,end:o}},generatePoints:function(){var e=this.options.data,t=this.data,i,s=this.processedXData,n=this.processedYData,a=this.pointClass,o=s.length,r=this.cropStart||0,l,h=this.hasGroupedData,u,c=[],p;if(!t&&!h)t=[],t.length=e.length,t=this.data=t;for(p=0;p<o;p++)l=r+p,h?c[p]=(new a).init(this,[s[p]].concat(d(n[p]))):(t[l]?u=t[l]:e[l]!==N&&(t[l]=u=(new a).init(this,e[l],s[p])),c[p]=u);if(t&&(o!==(i=t.length)||h))for(p=0;p<i;p++)if(p===r&&!h&&(p+=o),t[p])t[p].destroyElements(),t[p].plotX=N;this.data=t;this.points=c},getExtremes:function(e){var t=this.yAxis,i=this.processedXData,s,n=[],a=0;s=this.xAxis.getExtremes();var o=s.min,r=s.max,l,h,u,c,e=e||this.stackedYData||this.processedYData;s=e.length;for(c=0;c<s;c++)if(h=i[c],u=e[c],l=u!==null&&u!==N&&(!t.isLog||u.length||u>0),h=this.getExtremesFromAll||this.cropped||(i[c+1]||h)>=o&&(i[c-1]||h)<=r,l&&h)if(l=u.length)for(;l--;)u[l]!==null&&(n[a++]=u[l]);else n[a++]=u;this.dataMin=p(void 0,T(n));this.dataMax=p(void 0,x(n))},translate:function(){this.processedXData||this.processData();this.generatePoints();for(var e=this.options,t=e.stacking,i=this.xAxis,s=i.categories,n=this.yAxis,a=this.points,r=a.length,l=!!this.modifyValue,h=e.pointPlacement,c=h==="between"||o(h),d=e.threshold,e=0;e<r;e++){var m=a[e],f=m.x,g=m.y,_=m.low,y=t&&n.stacks[(this.negStacks&&g<d?"-":"")+this.stackKey];if(n.isLog&&g<=0)m.y=g=null;m.plotX=i.translate(f,0,0,0,1,h,this.type==="flags");if(t&&this.visible&&y&&y[f])y=y[f],g=y.points[this.index],_=g[0],g=g[1],_===0&&(_=p(d,n.min)),n.isLog&&_<=0&&(_=null),m.total=m.stackTotal=y.total,m.percentage=y.total&&m.y/y.total*100,m.stackY=g,y.setOffset(this.pointXOffset||0,this.barW||0);m.yBottom=u(_)?n.translate(_,0,1,0,1):null;l&&(g=this.modifyValue(g,m));m.plotY=typeof g==="number"&&g!==Infinity?n.translate(g,0,1,0,1):N;m.clientX=c?i.translate(f,0,0,0,1):m.plotX;m.negative=m.y<(d||0);m.category=s&&s[m.x]!==N?s[m.x]:m.x}this.getSegments()},animate:function(t){var i=this,s=i.chart,a=s.renderer,o;o=i.options.animation;var r=s.clipBox,l=s.inverted,h;if(o&&!n(o))o=tt[i.type].animation;h="_sharedClip"+o.duration+o.easing;if(t)t=s[h],o=s[h+"m"],t||(s[h]=t=a.clipRect(e(r,{width:0})),s[h+"m"]=o=a.clipRect(-99,l?-s.plotLeft:-s.plotTop,99,l?s.chartWidth:s.chartHeight)),i.group.clip(t),i.markerGroup.clip(o),i.sharedClipKey=h;else{if(t=s[h])t.animate({width:s.plotSizeX},o),s[h+"m"].animate({width:s.plotSizeX+99},o);i.animate=null;i.animationTimeout=setTimeout(function(){i.afterAnimate()},o.duration)}},afterAnimate:function(){var e=this.chart,t=this.sharedClipKey,i=this.group;i&&this.options.clip!==!1&&(i.clip(e.clipRect),this.markerGroup.clip());setTimeout(function(){t&&e[t]&&(e[t]=e[t].destroy(),e[t+"m"]=e[t+"m"].destroy())},100)},drawPoints:function(){var t,i=this.points,s=this.chart,n,a,o,r,l,h,u,c,d=this.options.marker,m=this.pointAttr[""],f,g=this.markerGroup;if(d.enabled||this._hasPointMarkers)for(o=i.length;o--;)if(r=i[o],n=$(r.plotX),a=r.plotY,c=r.graphic,h=r.marker||{},t=d.enabled&&h.enabled===N||h.enabled,f=s.isInsidePlot(F(n),a,s.inverted),t&&a!==N&&!isNaN(a)&&r.y!==null)if(t=r.pointAttr[r.selected?"select":""]||m,l=t.r,h=p(h.symbol,this.symbol),u=h.indexOf("url")===0,c)c.attr({visibility:f?"inherit":"hidden"}).animate(e({x:n-l,y:a-l},c.symbolName?{width:2*l,height:2*l}:{}));else{if(f&&(l>0||u))r.graphic=s.renderer.symbol(h,n-l,a-l,2*l,2*l).attr(t).add(g)}else if(c)r.graphic=c.destroy()},convertAttribs:function(e,t,i,s){var n=this.pointAttrToOptions,a,o,r={},e=e||{},t=t||{},i=i||{},s=s||{};for(a in n)o=n[a],r[a]=p(e[o],t[a],i[a],s[a]);return r},getAttribs:function(){var t=this,i=t.options,s=tt[t.type].marker?i.marker:i,n=s.states,a=n.hover,o,r=t.color;o={stroke:r,fill:r};var l=t.points||[],h,c=[],d,p=t.pointAttrToOptions;d=t.hasPointSpecificOptions;var m=i.negativeColor,f=s.lineColor,g=s.fillColor;h=i.turboThreshold;var _;i.marker?(a.radius=a.radius||s.radius+2,a.lineWidth=a.lineWidth||s.lineWidth+1):a.color=a.color||at(a.color||r).brighten(a.brightness).get();c[""]=t.convertAttribs(s,o);Ue(["hover","select"],function(e){c[e]=t.convertAttribs(n[e],c[""])});t.pointAttr=c;r=l.length;if(!h||r<h||d)for(;r--;){h=l[r];if((s=h.options&&h.options.marker||h.options)&&s.enabled===!1)s.radius=0;if(h.negative&&m)h.color=h.fillColor=m;d=i.colorByPoint||h.color;if(h.options)for(_ in p)u(s[p[_]])&&(d=!0);if(d){s=s||{};d=[];n=s.states||{};o=n.hover=n.hover||{};if(!i.marker)o.color=o.color||!h.options.color&&a.color||at(h.color).brighten(o.brightness||a.brightness).get();o={color:h.color};if(!g)o.fillColor=h.color;if(!f)o.lineColor=h.color;d[""]=t.convertAttribs(e(o,s),c[""]);d.hover=t.convertAttribs(n.hover,c.hover,d[""]);d.select=t.convertAttribs(n.select,c.select,d[""])}else d=c;h.pointAttr=d}},destroy:function(){var e=this,t=e.chart,i=/AppleWebKit\/533/.test(Z),s,n,a=e.data||[],o,r,l;Ke(e,"destroy");je(e);Ue(e.axisTypes||[],function(t){if(l=e[t])h(l.series,e),l.isDirty=l.forceRedraw=!0});e.legendItem&&e.chart.legend.destroyItem(e);for(n=a.length;n--;)(o=a[n])&&o.destroy&&o.destroy();e.points=null;clearTimeout(e.animationTimeout);Ue("area,graph,dataLabelsGroup,group,markerGroup,tracker,graphNeg,areaNeg,posClip,negClip".split(","),function(t){e[t]&&(s=i&&t==="group"?"hide":"destroy",e[t][s]())});if(t.hoverSeries===e)t.hoverSeries=null;h(t.series,e);for(r in e)delete e[r]},getSegmentPath:function(e){var t=this,i=[],s=t.options.step;Ue(e,function(n,a){var o=n.plotX,r=n.plotY,l;t.getPointSpline?i.push.apply(i,t.getPointSpline(e,n,a)):(i.push(a?"L":"M"),s&&a&&(l=e[a-1],s==="right"?i.push(l.plotX,r):s==="center"?i.push((l.plotX+o)/2,l.plotY,(l.plotX+o)/2,r):i.push(o,l.plotY)),i.push(n.plotX,n.plotY))});return i},getGraphPath:function(){var e=this,t=[],i,s=[];Ue(e.segments,function(n){i=e.getSegmentPath(n);n.length>1?t=t.concat(i):s.push(n[0])});e.singlePoints=s;return e.graphPath=t},drawGraph:function(){var e=this,t=this.options,i=[["graph",t.lineColor||this.color]],s=t.lineWidth,n=t.dashStyle,a=t.linecap!=="square",o=this.getGraphPath(),r=t.negativeColor;r&&i.push(["graphNeg",r]);Ue(i,function(i,r){var l=i[0],h=e[l];if(h)et(h),h.animate({d:o});else if(s&&o.length)h={stroke:i[1],"stroke-width":s,fill:we,zIndex:1},n?h.dashstyle=n:a&&(h["stroke-linecap"]=h["stroke-linejoin"]="round"),e[l]=e.chart.renderer.path(o).attr(h).add(e.group).shadow(!r&&t.shadow)})},clipNeg:function(){var e=this.options,t=this.chart,i=t.renderer,s=e.negativeColor||e.negativeFillColor,n,a=this.graph,o=this.area,r=this.posClip,l=this.negClip;n=t.chartWidth;var h=t.chartHeight,u=U(n,h),c=this.yAxis;if(s&&(a||o)){s=F(c.toPixels(e.threshold||0,!0));s<0&&(u-=s);e={x:0,y:0,width:u,height:s};u={x:0,y:s,width:u,height:u};if(t.inverted)e.height=u.y=t.plotWidth-s,i.isVML&&(e={x:t.plotWidth-s-t.plotLeft,y:0,width:n,height:h},u={x:s+t.plotLeft-n,y:0,width:t.plotLeft+s,height:n});c.reversed?(t=u,n=e):(t=e,n=u);r?(r.animate(t),l.animate(n)):(this.posClip=r=i.clipRect(t),this.negClip=l=i.clipRect(n),a&&this.graphNeg&&(a.clip(r),this.graphNeg.clip(l)),o&&(o.clip(r),this.areaNeg.clip(l)))}},invertGroups:function(){function e(){var e={width:t.yAxis.len,height:t.xAxis.len};Ue(["group","markerGroup"],function(i){t[i]&&t[i].attr(e).invert()})}var t=this,i=t.chart;if(t.xAxis)Xe(i,"resize",e),Xe(t,"destroy",function(){je(i,"resize",e)}),e(),t.invertGroups=e},plotGroup:function(e,t,i,s,n){var a=this[e],o=!a;o&&(this[e]=a=this.chart.renderer.g(t).attr({visibility:i,zIndex:s||.1}).add(n));a[o?"attr":"animate"](this.getPlotBox());return a},getPlotBox:function(){return{translateX:this.xAxis?this.xAxis.left:this.chart.plotLeft,translateY:this.yAxis?this.yAxis.top:this.chart.plotTop,scaleX:1,scaleY:1}},render:function(){var e=this.chart,t,i=this.options,s=i.animation&&!!this.animate&&e.renderer.isSVG,n=this.visible?"visible":"hidden",a=i.zIndex,o=this.hasRendered,r=e.seriesGroup;t=this.plotGroup("group","series",n,a,r);this.markerGroup=this.plotGroup("markerGroup","markers",n,a,r);s&&this.animate(!0);this.getAttribs();t.inverted=this.isCartesian?e.inverted:!1;this.drawGraph&&(this.drawGraph(),this.clipNeg());this.drawDataLabels&&this.drawDataLabels();this.visible&&this.drawPoints();this.drawTracker&&this.options.enableMouseTracking!==!1&&this.drawTracker();e.inverted&&this.invertGroups();i.clip!==!1&&!this.sharedClipKey&&!o&&t.clip(e.clipRect);s?this.animate():o||this.afterAnimate();this.isDirty=this.isDirtyData=!1;this.hasRendered=!0},redraw:function(){var e=this.chart,t=this.isDirtyData,i=this.group,s=this.xAxis,n=this.yAxis;i&&(e.inverted&&i.attr({width:e.plotWidth,height:e.plotHeight}),i.animate({translateX:p(s&&s.left,e.plotLeft),translateY:p(n&&n.top,e.plotTop)}));this.translate();this.setTooltipPoints(!0);this.render();t&&Ke(this,"updatedData")}};B.prototype={destroy:function(){D(this,this.axis)},render:function(e){var t=this.options,i=t.format,i=i?S(i,this):t.formatter.call(this);this.label?this.label.attr({text:i,visibility:"hidden"}):this.label=this.axis.chart.renderer.text(i,0,0,t.useHTML).css(t.style).attr({align:this.textAlign,rotation:t.rotation,visibility:"hidden"}).add(e)},setOffset:function(e,t){var i=this.axis,s=i.chart,n=s.inverted,a=this.isNegative,o=i.translate(this.percent?100:this.total,0,0,0,1),i=i.translate(0),i=W(o-i),r=s.xAxis[0].translate(this.x)+e,l=s.plotHeight,a={x:n?a?o:o-i:r,y:n?l-r-t:a?l-o-i:l-o,width:n?i:t,height:n?t:i};if(n=this.label)n.align(this.alignOptions,null,a),a=n.alignAttr,n[this.options.crop===!1||s.isInsidePlot(a.x,a.y)?"show":"hide"](!0)}};O.prototype.buildStacks=function(){var e=this.series,t=p(this.options.reversedStacks,!0),i=e.length;if(!this.isXAxis){for(this.usePercentage=!1;i--;)e[t?i:e.length-i-1].setStackedPoints();if(this.usePercentage)for(i=0;i<e.length;i++)e[i].setPercentStacks()}};O.prototype.renderStackTotals=function(){var e=this.chart,t=e.renderer,i=this.stacks,s,n,a=this.stackTotalGroup;if(!a)this.stackTotalGroup=a=t.g("stack-labels").attr({visibility:"visible",zIndex:6}).add();a.translate(e.plotLeft,e.plotTop);for(s in i)for(n in e=i[s],e)e[n].render(a)};bt.prototype.setStackedPoints=function(){if(this.options.stacking&&!(this.visible!==!0&&this.chart.options.chart.ignoreHiddenSeries!==!1)){var e=this.processedXData,t=this.processedYData,i=[],s=t.length,n=this.options,a=n.threshold,o=n.stack,n=n.stacking,r=this.stackKey,l="-"+r,h=this.negStacks,u=this.yAxis,c=u.stacks,d=u.oldStacks,p,m,f,g,_;for(f=0;f<s;f++){g=e[f];_=t[f];m=(p=h&&_<a)?l:r;c[m]||(c[m]={});if(!c[m][g])d[m]&&d[m][g]?(c[m][g]=d[m][g],c[m][g].total=null):c[m][g]=new B(u,u.options.stackLabels,p,g,o,n);m=c[m][g];m.points[this.index]=[m.cum||0];n==="percent"?(p=p?r:l,h&&c[p]&&c[p][g]?(p=c[p][g],m.total=p.total=U(p.total,m.total)+W(_)||0):m.total=I(m.total+(W(_)||0))):m.total=I(m.total+(_||0));m.cum=(m.cum||0)+(_||0);m.points[this.index].push(m.cum);i[f]=m.cum}if(n==="percent")u.usePercentage=!0;this.stackedYData=i;u.oldStacks={}}};bt.prototype.setPercentStacks=function(){var e=this,t=e.stackKey,i=e.yAxis.stacks,s=e.processedXData;Ue([t,"-"+t],function(t){var n;for(var a=s.length,o,r;a--;)if(o=s[a],n=(r=i[t]&&i[t][o])&&r.points[e.index],o=n)r=r.total?100/r.total:0,o[0]=I(o[0]*r),o[1]=I(o[1]*r),e.stackedYData[a]=o[1]})};e(R.prototype,{addSeries:function(e,t,i){var s,n=this;e&&(t=p(t,!0),Ke(n,"addSeries",{options:e},function(){s=n.initSeries(e);n.isDirtyLegend=!0;n.linkSeries();t&&n.redraw(i)}));return s},addAxis:function(e,i,s,n){var a=i?"xAxis":"yAxis",o=this.options;new O(this,t(e,{index:this[a].length,isX:i}));o[a]=d(o[a]||{});o[a].push(e);p(s,!0)&&this.redraw(n)},showLoading:function(t){var i=this.options,s=this.loadingDiv,n=i.loading;if(!s)this.loadingDiv=s=f(ve,{className:"highcharts-loading"},e(n.style,{zIndex:10,display:we}),this.container),this.loadingSpan=f("span",null,n.labelStyle,s);this.loadingSpan.innerHTML=t||i.lang.loading;if(!this.loadingShown)m(s,{opacity:0,display:"",left:this.plotLeft+"px",top:this.plotTop+"px",width:this.plotWidth+"px",height:this.plotHeight+"px"}),Je(s,{opacity:n.style.opacity},{duration:n.showDuration||0}),this.loadingShown=!0},hideLoading:function(){var e=this.options,t=this.loadingDiv;t&&Je(t,{opacity:0},{duration:e.loading.hideDuration||100,complete:function(){m(t,{display:we})}});this.loadingShown=!1}});e(yt.prototype,{update:function(e,t,i){var s=this,a=s.series,o=s.graphic,r,l=a.data,h=a.chart,u=a.options,t=p(t,!0);s.firePointEvent("update",{options:e},function(){s.applyOptions(e);if(n(e)){a.getAttribs();if(o)e&&e.marker&&e.marker.symbol?s.graphic=o.destroy():o.attr(s.pointAttr[s.state||""]);if(e&&e.dataLabels&&s.dataLabel)s.dataLabel=s.dataLabel.destroy()}r=Ye(s,l);a.updateParallelArrays(s,r);u.data[r]=s.options;a.isDirty=a.isDirtyData=!0;if(!a.fixedBox&&a.hasCartesianSeries)h.isDirtyBox=!0;u.legendType==="point"&&h.legend.destroyItem(s);t&&h.redraw(i)})},remove:function(e,t){var i=this,s=i.series,n=s.points,a=s.chart,o,r=s.data;k(t,a);e=p(e,!0);i.firePointEvent("remove",null,function(){o=Ye(i,r);r.length===n.length&&n.splice(o,1);r.splice(o,1);s.options.data.splice(o,1);s.updateParallelArrays(i,"splice",o,1);i.destroy();s.isDirty=!0;s.isDirtyData=!0;e&&a.redraw()})}});e(bt.prototype,{addPoint:function(e,t,i,s){var n=this.options,a=this.data,o=this.graph,r=this.area,l=this.chart,h=this.xAxis&&this.xAxis.names,u=o&&o.shift||0,c=n.data,d,m=this.xData;k(s,l);i&&Ue([o,r,this.graphNeg,this.areaNeg],function(e){if(e)e.shift=u+1});if(r)r.isArea=!0;t=p(t,!0);s={series:this};this.pointClass.prototype.applyOptions.apply(s,[e]);o=s.x;r=m.length;if(this.requireSorting&&o<m[r-1])for(d=!0;r&&m[r-1]>o;)r--;this.updateParallelArrays(s,"splice",r,0,0);this.updateParallelArrays(s,r);if(h)h[o]=s.name;c.splice(r,0,e);d&&(this.data.splice(r,0,null),this.processData());n.legendType==="point"&&this.generatePoints();i&&(a[0]&&a[0].remove?a[0].remove(!1):(a.shift(),this.updateParallelArrays(s,"shift"),c.shift()));this.isDirtyData=this.isDirty=!0;t&&(this.getAttribs(),l.redraw())},remove:function(e,t){var i=this,s=i.chart,e=p(e,!0);if(!i.isRemoving)i.isRemoving=!0,Ke(i,"remove",null,function(){i.destroy();s.isDirtyLegend=s.isDirtyBox=!0;s.linkSeries();e&&s.redraw(t)});i.isRemoving=!1},update:function(i,s){var n=this.chart,a=this.type,o=Ne[a].prototype,r,i=t(this.userOptions,{animation:!1,index:this.index,pointStart:this.xData[0]},{data:this.options.data},i);this.remove(!1);for(r in o)o.hasOwnProperty(r)&&(this[r]=N);e(this,Ne[i.type||a].prototype);this.init(n,i);p(s,!0)&&n.redraw(!1)}});e(O.prototype,{update:function(i,s){var n=this.chart,i=n.options[this.coll][this.options.index]=t(this.userOptions,i);this.destroy(!0);this._addedPlotLB=this.userMin=this.userMax=N;this.init(n,e(i,{events:N}));n.isDirtyBox=!0;p(s,!0)&&n.redraw()},remove:function(e){for(var t=this.chart,i=this.coll,s=this.series,n=s.length;n--;)s[n]&&s[n].remove(!1);h(t.axes,this);h(t[i],this);t.options[i].splice(this.options.index,1);Ue(t[i],function(e,t){e.options.index=t});this.destroy();t.isDirtyBox=!0;p(e,!0)&&t.redraw()},setTitle:function(e,t){this.update({title:e},t)},setCategories:function(e,t){this.update({categories:e},t)}});lt=g(bt);Ne.line=lt;tt.area=t(qe,{threshold:0});var St=g(bt,{type:"area",getSegments:function(){var e=[],t=[],i=[],s=this.xAxis,n=this.yAxis,a=n.stacks[this.stackKey],o={},r,l,h=this.points,u=this.options.connectNulls,c,d,p;if(this.options.stacking&&!this.cropped){for(d=0;d<h.length;d++)o[h[d].x]=h[d];for(p in a)a[p].total!==null&&i.push(+p);i.sort(function(e,t){return e-t});Ue(i,function(e){if(!u||o[e]&&o[e].y!==null)o[e]?t.push(o[e]):(r=s.translate(e),c=a[e].percent?a[e].total?a[e].cum*100/a[e].total:0:a[e].cum,l=n.toPixels(c,!0),t.push({y:null,plotX:r,clientX:r,plotY:l,yBottom:l,onMouseOver:be}))});t.length&&e.push(t)}else bt.prototype.getSegments.call(this),e=this.segments;this.segments=e},getSegmentPath:function(e){var t=bt.prototype.getSegmentPath.call(this,e),i=[].concat(t),s,n=this.options;s=t.length;var a=this.yAxis.getThreshold(n.threshold),o;s===3&&i.push("L",t[1],t[2]);if(n.stacking&&!this.closedStacks)for(s=e.length-1;s>=0;s--)o=p(e[s].yBottom,a),s<e.length-1&&n.step&&i.push(e[s+1].plotX,o),i.push(e[s].plotX,o);else this.closeSegment(i,e,a);this.areaPath=this.areaPath.concat(i);return t},closeSegment:function(e,t,i){e.push("L",t[t.length-1].plotX,i,"L",t[0].plotX,i)},drawGraph:function(){this.areaPath=[];bt.prototype.drawGraph.apply(this);var e=this,t=this.areaPath,i=this.options,s=i.negativeColor,n=i.negativeFillColor,a=[["area",this.color,i.fillColor]];(s||n)&&a.push(["areaNeg",s,n]);Ue(a,function(s){var n=s[0],a=e[n];a?a.animate({d:t}):e[n]=e.chart.renderer.path(t).attr({fill:p(s[2],at(s[1]).setOpacity(p(i.fillOpacity,.75)).get()),zIndex:0}).add(e.group)})},drawLegendSymbol:ze.drawRectangle});Ne.area=St;tt.spline=t(qe);lt=g(bt,{type:"spline",getPointSpline:function(e,t,i){var s=t.plotX,n=t.plotY,a=e[i-1],o=e[i+1],r,l,h,u;if(a&&o){e=a.plotY;h=o.plotX;var o=o.plotY,c;r=(1.5*s+a.plotX)/2.5;l=(1.5*n+e)/2.5;h=(1.5*s+h)/2.5;u=(1.5*n+o)/2.5;c=(u-l)*(h-s)/(h-r)+n-u;l+=c;u+=c;l>e&&l>n?(l=U(e,n),u=2*n-l):l<e&&l<n&&(l=G(e,n),u=2*n-l);u>o&&u>n?(u=U(o,n),l=2*n-u):u<o&&u<n&&(u=G(o,n),l=2*n-u);t.rightContX=h;t.rightContY=u}i?(t=["C",a.rightContX||a.plotX,a.rightContY||a.plotY,r||s,l||n,s,n],a.rightContX=a.rightContY=null):t=["M",s,n];return t}});Ne.spline=lt;tt.areaspline=t(tt.area);St=St.prototype;lt=g(lt,{type:"areaspline",closedStacks:!0,getSegmentPath:St.getSegmentPath,closeSegment:St.closeSegment,drawGraph:St.drawGraph,drawLegendSymbol:ze.drawRectangle});Ne.areaspline=lt;tt.column=t(qe,{borderColor:"#FFFFFF",borderWidth:1,borderRadius:0,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{brightness:.1,shadow:!1},select:{color:"#C0C0C0",borderColor:"#000000",shadow:!1}},dataLabels:{align:null,verticalAlign:null,y:null},stickyTracking:!1,threshold:0});lt=g(bt,{type:"column",pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color",r:"borderRadius"},cropShoulder:0,trackerGroups:["group","dataLabelsGroup"],negStacks:!0,init:function(){bt.prototype.init.apply(this,arguments);
var e=this,t=e.chart;t.hasRendered&&Ue(t.series,function(t){if(t.type===e.type)t.isDirty=!0})},getColumnMetrics:function(){var e=this,t=e.options,i=e.xAxis,s=e.yAxis,n=i.reversed,a,o={},r,l=0;t.grouping===!1?l=1:Ue(e.chart.series,function(t){var i=t.options,n=t.yAxis;if(t.type===e.type&&t.visible&&s.len===n.len&&s.pos===n.pos)i.stacking?(a=t.stackKey,o[a]===N&&(o[a]=l++),r=o[a]):i.grouping!==!1&&(r=l++),t.columnIndex=r});var i=G(W(i.transA)*(i.ordinalSlope||t.pointRange||i.closestPointRange||i.tickInterval||1),i.len),h=i*t.groupPadding,c=(i-2*h)/l,d=t.pointWidth,t=u(d)?(c-d)/2:c*t.pointPadding,d=p(d,c-2*t);return e.columnMetrics={width:d,offset:t+(h+((n?l-(e.columnIndex||0):e.columnIndex)||0)*c-i/2)*(n?-1:1)}},translate:function(){var e=this.chart,t=this.options,i=t.borderWidth,s=this.yAxis,n=this.translatedThreshold=s.getThreshold(t.threshold),a=p(t.minPointLength,5),t=this.getColumnMetrics(),o=t.width,r=this.barW=Y(U(o,1+2*i)),l=this.pointXOffset=t.offset,h=-(i%2?.5:0),u=i%2?.5:1;e.renderer.isVML&&e.inverted&&(u+=1);bt.prototype.translate.apply(this);Ue(this.points,function(e){var t=p(e.yBottom,n),i=G(U(-999-t,e.plotY),s.len+999+t),c=e.plotX+l,d=r,m=G(i,t),f,i=U(i,t)-m;W(i)<a&&a&&(i=a,m=F(W(m-n)>a?t-a:n-(s.translate(e.y,0,1,0,1)<=n?a:0)));e.barX=c;e.pointWidth=o;t=W(c)<.5;d=F(c+d)+h;c=F(c)+h;d-=c;f=W(m)<.5;i=F(m+i)+u;m=F(m)+u;i-=m;t&&(c+=1,d-=1);f&&(m-=1,i+=1);e.shapeType="rect";e.shapeArgs={x:c,y:m,width:d,height:i}})},getSymbol:be,drawLegendSymbol:ze.drawRectangle,drawGraph:be,drawPoints:function(){var e=this,i=e.options,s=this.chart.renderer,n=i.animationLimit||250,a;Ue(e.points,function(o){var r=o.plotY,l=o.graphic;if(r!==N&&!isNaN(r)&&o.y!==null)a=o.shapeArgs,l?(et(l),l[e.points.length<n?"animate":"attr"](t(a))):o.graphic=s[o.shapeType](a).attr(o.pointAttr[o.selected?"select":""]).add(e.group).shadow(i.shadow,null,i.stacking&&!i.borderRadius);else if(l)o.graphic=l.destroy()})},animate:function(e){var t=this.yAxis,i=this.options,s=this.chart.inverted,n={};if(oe)e?(n.scaleY=.001,e=G(t.pos+t.len,U(t.pos,t.toPixels(i.threshold))),s?n.translateX=e-t.len:n.translateY=e,this.group.attr(n)):(n.scaleY=1,n[s?"translateX":"translateY"]=t.pos,this.group.animate(n,this.options.animation),this.animate=null)},remove:function(){var e=this,t=e.chart;t.hasRendered&&Ue(t.series,function(t){if(t.type===e.type)t.isDirty=!0});bt.prototype.remove.apply(e,arguments)}});Ne.column=lt;tt.bar=t(tt.column);St=g(lt,{type:"bar",inverted:!0});Ne.bar=St;tt.scatter=t(qe,{lineWidth:0,tooltip:{headerFormat:'<span style="font-size: 10px; color:{series.color}">{series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>",followPointer:!0},stickyTracking:!1});St=g(bt,{type:"scatter",sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["markerGroup"],takeOrdinalPosition:!1,singularTooltips:!0,drawGraph:function(){this.options.lineWidth&&bt.prototype.drawGraph.call(this)}});Ne.scatter=St;tt.pie=t(qe,{borderColor:"#FFFFFF",borderWidth:1,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{distance:30,enabled:!0,formatter:function(){return this.point.name}},ignoreHiddenPoint:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,states:{hover:{brightness:.1,shadow:!1}},stickyTracking:!1,tooltip:{followPointer:!0}});qe={type:"pie",isCartesian:!1,pointClass:g(yt,{init:function(){yt.prototype.init.apply(this,arguments);var t=this,i;if(t.y<0)t.y=null;e(t,{visible:t.visible!==!1,name:p(t.name,"Slice")});i=function(e){t.slice(e.type==="select")};Xe(t,"select",i);Xe(t,"unselect",i);return t},setVisible:function(e){var t=this,i=t.series,s=i.chart;t.visible=t.options.visible=e=e===N?!t.visible:e;i.options.data[Ye(t,i.data)]=t.options;Ue(["graphic","dataLabel","connector","shadowGroup"],function(i){if(t[i])t[i][e?"show":"hide"](!0)});t.legendItem&&s.legend.colorizeItem(t,e);if(!i.isDirty&&i.options.ignoreHiddenPoint)i.isDirty=!0,s.redraw()},slice:function(e,t,i){var s=this.series;k(i,s.chart);p(t,!0);this.sliced=this.options.sliced=e=u(e)?e:!this.sliced;s.options.data[Ye(this,s.data)]=this.options;e=e?this.slicedTranslation:{translateX:0,translateY:0};this.graphic.animate(e);this.shadowGroup&&this.shadowGroup.animate(e)}}),requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","dataLabelsGroup"],axisTypes:[],pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color"},singularTooltips:!0,getColor:be,animate:function(e){var t=this,i=t.points,s=t.startAngleRad;if(!e)Ue(i,function(e){var i=e.graphic,e=e.shapeArgs;i&&(i.attr({r:t.center[3]/2,start:s,end:s}),i.animate({r:e.r,start:e.start,end:e.end},t.options.animation))}),t.animate=null},setData:function(e,t,i,s){bt.prototype.setData.call(this,e,!1,i,s);this.processData();this.generatePoints();p(t,!0)&&this.chart.redraw(i)},generatePoints:function(){var e,t=0,i,s,n,a=this.options.ignoreHiddenPoint;bt.prototype.generatePoints.call(this);i=this.points;s=i.length;for(e=0;e<s;e++)n=i[e],t+=a&&!n.visible?0:n.y;this.total=t;for(e=0;e<s;e++)n=i[e],n.percentage=t>0?n.y/t*100:0,n.total=t},translate:function(e){this.generatePoints();var t=0,i=this.options,s=i.slicedOffset,n=s+i.borderWidth,a,o,r,l=i.startAngle||0,h=this.startAngleRad=j/180*(l-90),l=(this.endAngleRad=j/180*(p(i.endAngle,l+360)-90))-h,u=this.points,c=i.dataLabels.distance,i=i.ignoreHiddenPoint,d,m=u.length,f;if(!e)this.center=e=this.getCenter();this.getX=function(t,i){r=z.asin(G((t-e[1])/(e[2]/2+c),1));return e[0]+(i?-1:1)*Q(r)*(e[2]/2+c)};for(d=0;d<m;d++){f=u[d];a=h+t*l;if(!i||f.visible)t+=f.percentage/100;o=h+t*l;f.shapeType="arc";f.shapeArgs={x:e[0],y:e[1],r:e[2]/2,innerR:e[3]/2,start:F(a*1e3)/1e3,end:F(o*1e3)/1e3};r=(o+a)/2;r>1.5*j?r-=2*j:r<-j/2&&(r+=2*j);f.slicedTranslation={translateX:F(Q(r)*s),translateY:F(X(r)*s)};a=Q(r)*e[2]/2;o=X(r)*e[2]/2;f.tooltipPos=[e[0]+a*.7,e[1]+o*.7];f.half=r<-j/2||r>j/2?1:0;f.angle=r;n=G(n,c/2);f.labelPos=[e[0]+a+Q(r)*c,e[1]+o+X(r)*c,e[0]+a+Q(r)*n,e[1]+o+X(r)*n,e[0]+a,e[1]+o,c<0?"center":f.half?"right":"left",r]}},drawGraph:null,drawPoints:function(){var t=this,i=t.chart.renderer,s,n,a=t.options.shadow,o,r;if(a&&!t.shadowGroup)t.shadowGroup=i.g("shadow").add(t.group);Ue(t.points,function(l){n=l.graphic;r=l.shapeArgs;o=l.shadowGroup;if(a&&!o)o=l.shadowGroup=i.g("shadow").add(t.shadowGroup);s=l.sliced?l.slicedTranslation:{translateX:0,translateY:0};o&&o.attr(s);n?n.animate(e(r,s)):l.graphic=n=i[l.shapeType](r).setRadialReference(t.center).attr(l.pointAttr[l.selected?"select":""]).attr({"stroke-linejoin":"round"}).attr(s).add(t.group).shadow(a,o);l.visible!==void 0&&l.setVisible(l.visible)})},sortByAngle:function(e,t){e.sort(function(e,i){return e.angle!==void 0&&(i.angle-e.angle)*t})},drawLegendSymbol:ze.drawRectangle,getCenter:rt.getCenter,getSymbol:be};qe=g(bt,qe);Ne.pie=qe;bt.prototype.drawDataLabels=function(){var i=this,s=i.options,n=s.cursor,a=s.dataLabels,s=i.points,o,r,l,h;if(a.enabled||i._hasPointLabels)i.dlProcessOptions&&i.dlProcessOptions(a),h=i.plotGroup("dataLabelsGroup","data-labels",i.visible?"visible":"hidden",a.zIndex||6),r=a,Ue(s,function(s){var c,d=s.dataLabel,m,f,g=s.connector,_=!0;o=s.options&&s.options.dataLabels;c=p(o&&o.enabled,r.enabled);if(d&&!c)s.dataLabel=d.destroy();else if(c){a=t(r,o);c=a.rotation;m=s.getLabelConfig();l=a.format?S(a.format,m):a.formatter.call(m,a);a.style.color=p(a.color,a.style.color,i.color,"black");if(d)if(u(l))d.attr({text:l}),_=!1;else{if(s.dataLabel=d=d.destroy(),g)s.connector=g.destroy()}else if(u(l)){d={fill:a.backgroundColor,stroke:a.borderColor,"stroke-width":a.borderWidth,r:a.borderRadius||0,rotation:c,padding:a.padding,zIndex:1};for(f in d)d[f]===N&&delete d[f];d=s.dataLabel=i.chart.renderer[c?"text":"label"](l,0,-999,null,null,null,a.useHTML).attr(d).css(e(a.style,n&&{cursor:n})).add(h).shadow(a.shadow)}d&&i.alignDataLabel(s,d,a,null,_)}})};bt.prototype.alignDataLabel=function(t,i,s,n,a){var o=this.chart,r=o.inverted,l=p(t.plotX,-999),h=p(t.plotY,-999),u=i.getBBox();if(t=this.visible&&(t.series.forceDL||o.isInsidePlot(l,F(h),r)||n&&o.isInsidePlot(l,r?n.x+1:n.y+n.height-1,r)))n=e({x:r?o.plotWidth-h:l,y:F(r?o.plotHeight-l:h),width:0,height:0},n),e(s,{width:u.width,height:u.height}),s.rotation?(r={align:s.align,x:n.x+s.x+n.width/2,y:n.y+s.y+n.height/2},i[a?"attr":"animate"](r)):(i.align(s,null,n),r=i.alignAttr,p(s.overflow,"justify")==="justify"?this.justifyDataLabel(i,s,r,u,n,a):p(s.crop,!0)&&(t=o.isInsidePlot(r.x,r.y)&&o.isInsidePlot(r.x+u.width,r.y+u.height)));if(!t)i.attr({y:-999}),i.placed=!1};bt.prototype.justifyDataLabel=function(e,t,i,s,n,a){var o=this.chart,r=t.align,l=t.verticalAlign,h,u;h=i.x;if(h<0)r==="right"?t.align="left":t.x=-h,u=!0;h=i.x+s.width;if(h>o.plotWidth)r==="left"?t.align="right":t.x=o.plotWidth-h,u=!0;h=i.y;if(h<0)l==="bottom"?t.verticalAlign="top":t.y=-h,u=!0;h=i.y+s.height;if(h>o.plotHeight)l==="top"?t.verticalAlign="bottom":t.y=o.plotHeight-h,u=!0;if(u)e.placed=!a,e.align(t,null,n)};if(Ne.pie)Ne.pie.prototype.drawDataLabels=function(){var e=this,t=e.data,i,s=e.chart,n=e.options.dataLabels,a=p(n.connectorPadding,10),o=p(n.connectorWidth,1),r=s.plotWidth,s=s.plotHeight,l,h,u=p(n.softConnector,!0),c=n.distance,d=e.center,m=d[2]/2,f=d[1],g=c>0,_,y,b,S,v=[[],[]],w,C,M,T,D,A=[0,0,0,0],L=function(e,t){return t.y-e.y};if(e.visible&&(n.enabled||e._hasPointLabels)){bt.prototype.drawDataLabels.apply(e);Ue(t,function(e){e.dataLabel&&e.visible&&v[e.half].push(e)});for(T=0;!S&&t[T];)S=t[T]&&t[T].dataLabel&&(t[T].dataLabel.getBBox().height||21),T++;for(T=2;T--;){var t=[],I=[],k=v[T],P=k.length,E;e.sortByAngle(k,T-.5);if(c>0){for(D=f-m-c;D<=f+m+c;D+=S)t.push(D);y=t.length;if(P>y){i=[].concat(k);i.sort(L);for(D=P;D--;)i[D].rank=D;for(D=P;D--;)k[D].rank>=y&&k.splice(D,1);P=k.length}for(D=0;D<P;D++){i=k[D];b=i.labelPos;i=9999;var V,O;for(O=0;O<y;O++)V=W(t[O]-b[1]),V<i&&(i=V,E=O);if(E<D&&t[D]!==null)E=D;else for(y<P-D+E&&t[D]!==null&&(E=y-P+D);t[E]===null;)E++;I.push({i:E,y:t[E]});t[E]=null}I.sort(L)}for(D=0;D<P;D++){i=k[D];b=i.labelPos;_=i.dataLabel;M=i.visible===!1?"hidden":"visible";i=b[1];if(c>0){if(y=I.pop(),E=y.i,C=y.y,i>C&&t[E+1]!==null||i<C&&t[E-1]!==null)C=i}else C=i;w=n.justify?d[0]+(T?-1:1)*(m+c):e.getX(E===0||E===t.length-1?i:C,T);_._attr={visibility:M,align:b[6]};_._pos={x:w+n.x+({left:a,right:-a}[b[6]]||0),y:C+n.y-10};_.connX=w;_.connY=C;if(this.options.size===null)y=_.width,w-y<a?A[3]=U(F(y-w+a),A[3]):w+y>r-a&&(A[1]=U(F(w+y-r+a),A[1])),C-S/2<0?A[0]=U(F(-C+S/2),A[0]):C+S/2>s&&(A[2]=U(F(C+S/2-s),A[2]))}}if(x(A)===0||this.verifyDataLabelOverflow(A))this.placeDataLabels(),g&&o&&Ue(this.points,function(t){l=t.connector;b=t.labelPos;if((_=t.dataLabel)&&_._pos)M=_._attr.visibility,w=_.connX,C=_.connY,h=u?["M",w+(b[6]==="left"?5:-5),C,"C",w,C,2*b[2]-b[4],2*b[3]-b[5],b[2],b[3],"L",b[4],b[5]]:["M",w+(b[6]==="left"?5:-5),C,"L",b[2],b[3],"L",b[4],b[5]],l?(l.animate({d:h}),l.attr("visibility",M)):t.connector=l=e.chart.renderer.path(h).attr({"stroke-width":o,stroke:n.connectorColor||t.color||"#606060",visibility:M}).add(e.group);else if(l)t.connector=l.destroy()})}},Ne.pie.prototype.placeDataLabels=function(){Ue(this.points,function(e){var e=e.dataLabel,t;if(e)(t=e._pos)?(e.attr(e._attr),e[e.moved?"animate":"attr"](t),e.moved=!0):e&&e.attr({y:-999})})},Ne.pie.prototype.alignDataLabel=be,Ne.pie.prototype.verifyDataLabelOverflow=function(e){var t=this.center,i=this.options,s=i.center,n=i=i.minSize||80,a;s[0]!==null?n=U(t[2]-U(e[1],e[3]),i):(n=U(t[2]-e[1]-e[3],i),t[0]+=(e[3]-e[1])/2);s[1]!==null?n=U(G(n,t[2]-U(e[0],e[2])),i):(n=U(G(n,t[2]-e[0]-e[2]),i),t[1]+=(e[0]-e[2])/2);n<t[2]?(t[2]=n,this.translate(t),Ue(this.points,function(e){if(e.dataLabel)e.dataLabel._pos=null}),this.drawDataLabels&&this.drawDataLabels()):a=!0;return a};if(Ne.column)Ne.column.prototype.alignDataLabel=function(e,i,s,n,a){var o=this.chart,r=o.inverted,l=e.dlBox||e.shapeArgs,h=e.below||e.plotY>p(this.translatedThreshold,o.plotSizeY),u=p(s.inside,!!this.options.stacking);if(l&&(n=t(l),r&&(n={x:o.plotWidth-n.y-n.height,y:o.plotHeight-n.x-n.width,width:n.height,height:n.width}),!u))r?(n.x+=h?0:n.width,n.width=0):(n.y+=h?n.height:0,n.height=0);s.align=p(s.align,!r||u?"center":h?"right":"left");s.verticalAlign=p(s.verticalAlign,r||u?"middle":h?"top":"bottom");bt.prototype.alignDataLabel.call(this,e,i,s,n,a)};qe=He.TrackerMixin={drawTrackerPoint:function(){var e=this,t=e.chart,i=t.pointer,s=e.options.cursor,n=s&&{cursor:s},a=function(i){var s=i.target,n;if(t.hoverSeries!==e)e.onMouseOver();for(;s&&!n;)n=s.point,s=s.parentNode;if(n!==N&&n!==t.hoverPoint)n.onMouseOver(i)};Ue(e.points,function(e){if(e.graphic)e.graphic.element.point=e;if(e.dataLabel)e.dataLabel.element.point=e});if(!e._hasTracking)Ue(e.trackerGroups,function(t){if(e[t]&&(e[t].addClass("highcharts-tracker").on("mouseover",a).on("mouseout",function(e){i.onTrackerMouseOut(e)}).css(n),ue))e[t].on("touchstart",a)}),e._hasTracking=!0},drawTrackerGraph:function(){var e=this,t=e.options,i=t.trackByArea,s=[].concat(i?e.areaPath:e.graphPath),n=s.length,a=e.chart,o=a.pointer,r=a.renderer,l=a.options.tooltip.snap,h=e.tracker,u=t.cursor,c=u&&{cursor:u},u=e.singlePoints,d,p=function(){if(a.hoverSeries!==e)e.onMouseOver()},m="rgba(192,192,192,"+(oe?1e-4:.002)+")";if(n&&!i)for(d=n+1;d--;)s[d]==="M"&&s.splice(d+1,0,s[d+1]-l,s[d+2],"L"),(d&&s[d]==="M"||d===n)&&s.splice(d,0,"L",s[d-2]+l,s[d-1]);for(d=0;d<u.length;d++)n=u[d],s.push("M",n.plotX-l,n.plotY,"L",n.plotX+l,n.plotY);h?h.attr({d:s}):(e.tracker=r.path(s).attr({"stroke-linejoin":"round",visibility:e.visible?"visible":"hidden",stroke:m,fill:i?m:we,"stroke-width":t.lineWidth+(i?0:2*l),zIndex:2}).add(e.group),Ue([e.tracker,e.markerGroup],function(e){e.addClass("highcharts-tracker").on("mouseover",p).on("mouseout",function(e){o.onTrackerMouseOut(e)}).css(c);if(ue)e.on("touchstart",p)}))}};if(Ne.column)lt.prototype.drawTracker=qe.drawTrackerPoint;if(Ne.pie)Ne.pie.prototype.drawTracker=qe.drawTrackerPoint;if(Ne.scatter)St.prototype.drawTracker=qe.drawTrackerPoint;e(_t.prototype,{setItemEvents:function(e,t,i,s,n){var a=this;(i?t:e.legendGroup).on("mouseover",function(){e.setState("hover");t.css(a.options.itemHoverStyle)}).on("mouseout",function(){t.css(e.visible?s:n);e.setState()}).on("click",function(t){var i=function(){e.setVisible()},t={browserEvent:t};e.firePointEvent?e.firePointEvent("legendItemClick",t,i):Ke(e,"legendItemClick",t,i)})},createCheckboxForItem:function(e){e.checkbox=f("input",{type:"checkbox",checked:e.selected,defaultChecked:e.selected},this.options.itemCheckboxStyle,this.chart.container);Xe(e.checkbox,"click",function(t){Ke(e,"checkboxClick",{checked:t.target.checked},function(){e.select()})})}});me.legend.itemStyle.cursor="pointer";e(R.prototype,{showResetZoom:function(){var e=this,t=me.lang,i=e.options.chart.resetZoomButton,s=i.theme,n=s.states,a=i.relativeTo==="chart"?null:"plotBox";this.resetZoomButton=e.renderer.button(t.resetZoom,null,null,function(){e.zoomOut()},s,n&&n.hover).attr({align:i.position.align,title:t.resetZoomTitle}).add().align(i.position,!1,a)},zoomOut:function(){var e=this;Ke(e,"selection",{resetSelection:!0},function(){e.zoom()})},zoom:function(e){var t,i=this.pointer,s=!1,a;!e||e.resetSelection?Ue(this.axes,function(e){t=e.zoom()}):Ue(e.xAxis.concat(e.yAxis),function(e){var n=e.axis,a=n.isXAxis;if(i[a?"zoomX":"zoomY"]||i[a?"pinchX":"pinchY"])t=n.zoom(e.min,e.max),n.displayBtn&&(s=!0)});a=this.resetZoomButton;if(s&&!a)this.showResetZoom();else if(!s&&n(a))this.resetZoomButton=a.destroy();t&&this.redraw(p(this.options.chart.animation,e&&e.animation,this.pointCount<100))},pan:function(e,t){var i=this,s=i.hoverPoints,n;s&&Ue(s,function(e){e.setState()});Ue(t==="xy"?[1,0]:[1],function(t){var s=e[t?"chartX":"chartY"],a=i[t?"xAxis":"yAxis"][0],o=i[t?"mouseDownX":"mouseDownY"],r=(a.pointRange||0)/2,l=a.getExtremes(),h=a.toValue(o-s,!0)+r,o=a.toValue(o+i[t?"plotWidth":"plotHeight"]-s,!0)-r;a.series.length&&h>G(l.dataMin,l.min)&&o<U(l.dataMax,l.max)&&(a.setExtremes(h,o,!1,!1,{trigger:"pan"}),n=!0);i[t?"mouseDownX":"mouseDownY"]=s});n&&i.redraw(!1);m(i.container,{cursor:"move"})}});e(yt.prototype,{select:function(e,t){var i=this,s=i.series,n=s.chart,e=p(e,!i.selected);i.firePointEvent(e?"select":"unselect",{accumulate:t},function(){i.selected=i.options.selected=e;s.options.data[Ye(i,s.data)]=i.options;i.setState(e&&"select");t||Ue(n.getSelectedPoints(),function(e){if(e.selected&&e!==i)e.selected=e.options.selected=!1,s.options.data[Ye(e,s.data)]=e.options,e.setState(""),e.firePointEvent("unselect")})})},onMouseOver:function(e){var t=this.series,i=t.chart,s=i.tooltip,n=i.hoverPoint;if(n&&n!==this)n.onMouseOut();this.firePointEvent("mouseOver");s&&(!s.shared||t.noSharedTooltip)&&s.refresh(this,e);this.setState("hover");i.hoverPoint=this},onMouseOut:function(){var e=this.series.chart,t=e.hoverPoints;if(!t||Ye(this,t)===-1)this.firePointEvent("mouseOut"),this.setState(),e.hoverPoint=null},firePointEvent:function(e,t,i){var s=this,n=this.series.options;(n.point.events[e]||s.options&&s.options.events&&s.options.events[e])&&this.importEvents();e==="click"&&n.allowPointSelect&&(i=function(e){s.select(null,e.ctrlKey||e.metaKey||e.shiftKey)});Ke(this,e,t,i)},importEvents:function(){if(!this.hasImportedEvents){var e=t(this.series.options.point,this.options).events,i;this.events=e;for(i in e)Xe(this,i,e[i]);this.hasImportedEvents=!0}},setState:function(e,i){var s=this.plotX,n=this.plotY,a=this.series,o=a.options.states,r=tt[a.type].marker&&a.options.marker,l=r&&!r.enabled,h=r&&r.states[e],u=h&&h.enabled===!1,c=a.stateMarkerGraphic,d=this.marker||{},p=a.chart,m=this.pointAttr,e=e||"",i=i&&c;if(!(e===this.state&&!i||this.selected&&e!=="select"||o[e]&&o[e].enabled===!1||e&&(u||l&&!h.enabled)||e&&d.states&&d.states[e]&&d.states[e].enabled===!1)){if(this.graphic)o=r&&this.graphic.symbolName&&m[e].r,this.graphic.attr(t(m[e],o?{x:s-o,y:n-o,width:2*o,height:2*o}:{}));else{if(e&&h)if(o=h.radius,d=d.symbol||a.symbol,c&&c.currentSymbol!==d&&(c=c.destroy()),c)c[i?"animate":"attr"]({x:s-o,y:n-o});else a.stateMarkerGraphic=c=p.renderer.symbol(d,s-o,n-o,2*o,2*o).attr(m[e]).add(a.markerGroup),c.currentSymbol=d;if(c)c[e&&p.isInsidePlot(s,n,p.inverted)?"show":"hide"]()}this.state=e}}});e(bt.prototype,{onMouseOver:function(){var e=this.chart,t=e.hoverSeries;if(t&&t!==this)t.onMouseOut();this.options.events.mouseOver&&Ke(this,"mouseOver");this.setState("hover");e.hoverSeries=this},onMouseOut:function(){var e=this.options,t=this.chart,i=t.tooltip,s=t.hoverPoint;if(s)s.onMouseOut();this&&e.events.mouseOut&&Ke(this,"mouseOut");i&&!e.stickyTracking&&(!i.shared||this.noSharedTooltip)&&i.hide();this.setState();t.hoverSeries=null},setState:function(e){var t=this.options,i=this.graph,s=this.graphNeg,n=t.states,t=t.lineWidth,e=e||"";if(this.state!==e)this.state=e,n[e]&&n[e].enabled===!1||(e&&(t=n[e].lineWidth||t+1),i&&!i.dashstyle&&(e={"stroke-width":t},i.attr(e),s&&s.attr(e)))},setVisible:function(e,t){var i=this,s=i.chart,n=i.legendItem,a,o=s.options.chart.ignoreHiddenSeries,r=i.visible;a=(i.visible=e=i.userOptions.visible=e===N?!r:e)?"show":"hide";Ue(["group","dataLabelsGroup","markerGroup","tracker"],function(e){if(i[e])i[e][a]()});if(s.hoverSeries===i)i.onMouseOut();n&&s.legend.colorizeItem(i,e);i.isDirty=!0;i.options.stacking&&Ue(s.series,function(e){if(e.options.stacking&&e.visible)e.isDirty=!0});Ue(i.linkedSeries,function(t){t.setVisible(e,!1)});if(o)s.isDirtyBox=!0;t!==!1&&s.redraw();Ke(i,a)},setTooltipPoints:function(e){var t=[],i,s,n=this.xAxis,a=n&&n.getExtremes(),o=n?n.tooltipLen||n.len:this.chart.plotSizeX,r,l,h=[];if(!(this.options.enableMouseTracking===!1||this.singularTooltips)){if(e)this.tooltipPoints=null;Ue(this.segments||this.points,function(e){t=t.concat(e)});n&&n.reversed&&(t=t.reverse());this.orderTooltipPoints&&this.orderTooltipPoints(t);e=t.length;for(l=0;l<e;l++)if(n=t[l],i=n.x,i>=a.min&&i<=a.max){r=t[l+1];i=s===N?0:s+1;for(s=t[l+1]?G(U(0,$((n.clientX+(r?r.wrappedClientX||r.clientX:o))/2)),o):o;i>=0&&i<=s;)h[i++]=n}this.tooltipPoints=h}},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},select:function(e){this.selected=e=e===N?!this.selected:e;if(this.checkbox)this.checkbox.checked=e;Ke(this,e?"select":"unselect")},drawTracker:qe.drawTrackerGraph});e(He,{Axis:O,Chart:R,Color:at,Point:yt,Tick:V,Renderer:he,Series:bt,SVGElement:E,SVGRenderer:ot,arrayMin:T,arrayMax:x,charts:Se,dateFormat:fe,format:S,pathAnim:_e,getOptions:function(){return me},hasBidiBug:re,isTouchDevice:ne,numberFormat:_,seriesTypes:Ne,setOptions:function(e){me=t(!0,me,e);P();return me},addEvent:Xe,removeEvent:je,createElement:f,discardElement:A,css:m,each:Ue,extend:e,map:Qe,merge:t,pick:p,splat:d,extendClass:g,pInt:i,wrap:b,svg:oe,canvas:le,vml:!oe&&!le,product:"Highcharts",version:"3.0.10"})})();(function(e,t){function i(e,t,i){this.init.call(this,e,t,i)}var s=e.arrayMin,n=e.arrayMax,a=e.each,o=e.extend,r=e.merge,l=e.map,h=e.pick,u=e.pInt,c=e.getOptions().plotOptions,d=e.seriesTypes,p=e.extendClass,m=e.splat,f=e.wrap,g=e.Axis,_=e.Tick,y=e.Point,b=e.Pointer,S=e.TrackerMixin,v=e.CenteredSeriesMixin,w=e.Series,C=Math,M=C.round,T=C.floor,x=C.max,D=e.Color,A=function(){};o(i.prototype,{init:function(e,t,i){var s=this,n=s.defaultOptions;s.chart=t;if(t.angular)n.background={};s.options=e=r(n,e);(e=e.background)&&a([].concat(m(e)).reverse(),function(e){var t=e.backgroundColor,e=r(s.defaultBackgroundOptions,e);if(t)e.backgroundColor=t;e.color=e.backgroundColor;i.options.plotBands.unshift(e)})},defaultOptions:{center:["50%","50%"],size:"85%",startAngle:0},defaultBackgroundOptions:{shape:"circle",borderWidth:1,borderColor:"silver",backgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#FFF"],[1,"#DDD"]]},from:Number.MIN_VALUE,innerRadius:0,to:Number.MAX_VALUE,outerRadius:"105%"}});var L=g.prototype,_=_.prototype,I={getOffset:A,redraw:function(){this.isDirty=!1},render:function(){this.isDirty=!1},setScale:A,setCategories:A,setTitle:A},k={isRadial:!0,defaultRadialGaugeOptions:{labels:{align:"center",x:0,y:null},minorGridLineWidth:0,minorTickInterval:"auto",minorTickLength:10,minorTickPosition:"inside",minorTickWidth:1,tickLength:10,tickPosition:"inside",tickWidth:2,title:{rotation:0},zIndex:2},defaultRadialXOptions:{gridLineWidth:1,labels:{align:null,distance:15,x:0,y:null},maxPadding:0,minPadding:0,showLastLabel:!1,tickLength:0},defaultRadialYOptions:{gridLineInterpolation:"circle",labels:{align:"right",x:-3,y:-2},showLastLabel:!1,title:{x:4,text:null,rotation:90}},setOptions:function(e){e=this.options=r(this.defaultOptions,this.defaultRadialOptions,e);if(!e.plotBands)e.plotBands=[]},getOffset:function(){L.getOffset.call(this);this.chart.axisOffset[this.side]=0;this.center=this.pane.center=v.getCenter.call(this.pane)},getLinePath:function(e,t){var i=this.center,t=h(t,i[2]/2-this.offset);return this.chart.renderer.symbols.arc(this.left+i[0],this.top+i[1],t,t,{start:this.startAngleRad,end:this.endAngleRad,open:!0,innerR:0})},setAxisTranslation:function(){L.setAxisTranslation.call(this);if(this.center)this.transA=this.isCircular?(this.endAngleRad-this.startAngleRad)/(this.max-this.min||1):this.center[2]/2/(this.max-this.min||1),this.minPixelPadding=this.isXAxis?this.transA*this.minPointOffset:0},beforeSetTickPositions:function(){this.autoConnect&&(this.max+=this.categories&&1||this.pointRange||this.closestPointRange||0)},setAxisSize:function(){L.setAxisSize.call(this);if(this.isRadial){this.center=this.pane.center=e.CenteredSeriesMixin.getCenter.call(this.pane);if(this.isCircular)this.sector=this.endAngleRad-this.startAngleRad;this.len=this.width=this.height=this.center[2]*h(this.sector,1)/2}},getPosition:function(e,t){if(!this.isCircular)t=this.translate(e),e=this.min;return this.postTranslate(this.translate(e),h(t,this.center[2]/2)-this.offset)},postTranslate:function(e,t){var i=this.chart,s=this.center,e=this.startAngleRad+e;return{x:i.plotLeft+s[0]+Math.cos(e)*t,y:i.plotTop+s[1]+Math.sin(e)*t}},getPlotBandPath:function(e,t,i){var s=this.center,n=this.startAngleRad,a=s[2]/2,o=[h(i.outerRadius,"100%"),i.innerRadius,h(i.thickness,10)],r=/%$/,c,d=this.isCircular;this.options.gridLineInterpolation==="polygon"?s=this.getPlotLinePath(e).concat(this.getPlotLinePath(t,!0)):(d||(o[0]=this.translate(e),o[1]=this.translate(t)),o=l(o,function(e){r.test(e)&&(e=u(e,10)*a/100);return e}),i.shape==="circle"||!d?(e=-Math.PI/2,t=Math.PI*1.5,c=!0):(e=n+this.translate(e),t=n+this.translate(t)),s=this.chart.renderer.symbols.arc(this.left+s[0],this.top+s[1],o[0],o[0],{start:e,end:t,innerR:h(o[1],o[0]-o[2]),open:c}));return s},getPlotLinePath:function(e,t){var i=this.center,s=this.chart,n=this.getPosition(e),o,r,l;this.isCircular?l=["M",i[0]+s.plotLeft,i[1]+s.plotTop,"L",n.x,n.y]:this.options.gridLineInterpolation==="circle"?(e=this.translate(e))&&(l=this.getLinePath(0,e)):(o=s.xAxis[0],l=[],e=this.translate(e),i=o.tickPositions,o.autoConnect&&(i=i.concat([i[0]])),t&&(i=[].concat(i).reverse()),a(i,function(t,i){r=o.getPosition(t,e);l.push(i?"L":"M",r.x,r.y)}));return l},getTitlePosition:function(){var e=this.center,t=this.chart,i=this.options.title;return{x:t.plotLeft+e[0]+(i.x||0),y:t.plotTop+e[1]-{high:.5,middle:.25,low:0}[i.align]*e[2]+(i.y||0)}}};f(L,"init",function(e,s,n){var a;var l=s.angular,u=s.polar,c=n.isX,d=l&&c,p,f;f=s.options;var g=n.pane||0;if(l){if(o(this,d?I:k),p=!c)this.defaultRadialOptions=this.defaultRadialGaugeOptions}else if(u)o(this,k),this.defaultRadialOptions=(p=c)?this.defaultRadialXOptions:r(this.defaultYAxisOptions,this.defaultRadialYOptions);e.call(this,s,n);if(!d&&(l||u)){e=this.options;if(!s.panes)s.panes=[];this.pane=(a=s.panes[g]=s.panes[g]||new i(m(f.pane)[g],s,this),g=a);g=g.options;s.inverted=!1;f.chart.zoomType=null;this.startAngleRad=s=(g.startAngle-90)*Math.PI/180;this.endAngleRad=f=(h(g.endAngle,g.startAngle+360)-90)*Math.PI/180;this.offset=e.offset||0;if((this.isCircular=p)&&n.max===t&&f-s===2*Math.PI)this.autoConnect=!0}});f(_,"getPosition",function(e,t,i,s,n){var a=this.axis;return a.getPosition?a.getPosition(i):e.call(this,t,i,s,n)});f(_,"getLabelPosition",function(e,t,i,s,n,a,o,r,l){var u=this.axis,c=a.y,d=a.align,p=(u.translate(this.pos)+u.startAngleRad+Math.PI/2)/Math.PI*180%360;u.isRadial?(e=u.getPosition(this.pos,u.center[2]/2+h(a.distance,-25)),a.rotation==="auto"?s.attr({rotation:p}):c===null&&(c=u.chart.renderer.fontMetrics(s.styles.fontSize).b-s.getBBox().height/2),d===null&&(d=u.isCircular?p>20&&p<160?"left":p>200&&p<340?"right":"center":"center",s.attr({align:d})),e.x+=a.x,e.y+=c):e=e.call(this,t,i,s,n,a,o,r,l);return e});f(_,"getMarkPath",function(e,t,i,s,n,a,o){var r=this.axis;r.isRadial?(e=r.getPosition(this.pos,r.center[2]/2+s),t=["M",t,i,"L",e.x,e.y]):t=e.call(this,t,i,s,n,a,o);return t});c.arearange=r(c.area,{lineWidth:1,marker:null,threshold:null,tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.low}</b> - <b>{point.high}</b><br/>'},trackByArea:!0,dataLabels:{verticalAlign:null,xLow:0,xHigh:0,yLow:0,yHigh:0}});d.arearange=p(d.area,{type:"arearange",pointArrayMap:["low","high"],toYData:function(e){return[e.low,e.high]},pointValKey:"low",getSegments:function(){var e=this;a(e.points,function(t){if(!e.options.connectNulls&&(t.low===null||t.high===null))t.y=null;else if(t.low===null&&t.high!==null)t.y=t.high});w.prototype.getSegments.call(this)},translate:function(){var e=this.yAxis;d.area.prototype.translate.apply(this);a(this.points,function(t){var i=t.low,s=t.high,n=t.plotY;s===null&&i===null?t.y=null:i===null?(t.plotLow=t.plotY=null,t.plotHigh=e.translate(s,0,1,0,1)):s===null?(t.plotLow=n,t.plotHigh=null):(t.plotLow=n,t.plotHigh=e.translate(s,0,1,0,1))})},getSegmentPath:function(e){var t,i=[],s=e.length,n=w.prototype.getSegmentPath,a,o;o=this.options;var r=o.step;for(t=HighchartsAdapter.grep(e,function(e){return e.plotLow!==null});s--;)a=e[s],a.plotHigh!==null&&i.push({plotX:a.plotX,plotY:a.plotHigh});e=n.call(this,t);if(r)r===!0&&(r="left"),o.step={left:"right",center:"center",right:"left"}[r];i=n.call(this,i);o.step=r;o=[].concat(e,i);i[0]="L";this.areaPath=this.areaPath.concat(e,i);return o},drawDataLabels:function(){var e=this.data,t=e.length,i,s=[],n=w.prototype,a=this.options.dataLabels,o,r=this.chart.inverted;if(a.enabled||this._hasPointLabels){for(i=t;i--;)o=e[i],o.y=o.high,o._plotY=o.plotY,o.plotY=o.plotHigh,s[i]=o.dataLabel,o.dataLabel=o.dataLabelUpper,o.below=!1,r?(a.align="left",a.x=a.xHigh):a.y=a.yHigh;n.drawDataLabels&&n.drawDataLabels.apply(this,arguments);for(i=t;i--;)o=e[i],o.dataLabelUpper=o.dataLabel,o.dataLabel=s[i],o.y=o.low,o.plotY=o._plotY,o.below=!0,r?(a.align="right",a.x=a.xLow):a.y=a.yLow;n.drawDataLabels&&n.drawDataLabels.apply(this,arguments)}},alignDataLabel:function(){d.column.prototype.alignDataLabel.apply(this,arguments)},getSymbol:d.column.prototype.getSymbol,drawPoints:A});c.areasplinerange=r(c.arearange);d.areasplinerange=p(d.arearange,{type:"areasplinerange",getPointSpline:d.spline.prototype.getPointSpline});(function(){var e=d.column.prototype;c.columnrange=r(c.column,c.arearange,{lineWidth:1,pointRange:null});d.columnrange=p(d.arearange,{type:"columnrange",translate:function(){var t=this,i=t.yAxis,s;e.translate.apply(t);a(t.points,function(e){var n=e.shapeArgs,a=t.options.minPointLength,o;e.plotHigh=s=i.translate(e.high,0,1,0,1);e.plotLow=e.plotY;o=s;e=e.plotY-s;e<a&&(a-=e,e+=a,o-=a/2);n.height=e;n.y=o})},trackerGroups:["group","dataLabels"],drawGraph:A,pointAttrToOptions:e.pointAttrToOptions,drawPoints:e.drawPoints,drawTracker:e.drawTracker,animate:e.animate,getColumnMetrics:e.getColumnMetrics})})();c.gauge=r(c.line,{dataLabels:{enabled:!0,y:15,borderWidth:1,borderColor:"silver",borderRadius:3,crop:!1,style:{fontWeight:"bold"},verticalAlign:"top",zIndex:2},dial:{},pivot:{},tooltip:{headerFormat:""},showInLegend:!1});y={type:"gauge",pointClass:p(y,{setState:function(e){this.state=e}}),angular:!0,drawGraph:A,fixedBox:!0,forceDL:!0,trackerGroups:["group","dataLabels"],translate:function(){var e=this.yAxis,t=this.options,i=e.center;this.generatePoints();a(this.points,function(s){var n=r(t.dial,s.dial),a=u(h(n.radius,80))*i[2]/200,o=u(h(n.baseLength,70))*a/100,l=u(h(n.rearLength,10))*a/100,c=n.baseWidth||3,d=n.topWidth||1,p=t.overshoot,m=e.startAngleRad+e.translate(s.y,null,null,null,!0);p&&typeof p==="number"?(p=p/180*Math.PI,m=Math.max(e.startAngleRad-p,Math.min(e.endAngleRad+p,m))):t.wrap===!1&&(m=Math.max(e.startAngleRad,Math.min(e.endAngleRad,m)));m=m*180/Math.PI;s.shapeType="path";s.shapeArgs={d:n.path||["M",-l,-c/2,"L",o,-c/2,a,-d/2,a,d/2,o,c/2,-l,c/2,"z"],translateX:i[0],translateY:i[1],rotation:m};s.plotX=i[0];s.plotY=i[1]})},drawPoints:function(){var e=this,t=e.yAxis.center,i=e.pivot,s=e.options,n=s.pivot,o=e.chart.renderer;a(e.points,function(t){var i=t.graphic,n=t.shapeArgs,a=n.d,l=r(s.dial,t.dial);i?(i.animate(n),n.d=a):t.graphic=o[t.shapeType](n).attr({stroke:l.borderColor||"none","stroke-width":l.borderWidth||0,fill:l.backgroundColor||"black",rotation:n.rotation}).add(e.group)});i?i.animate({translateX:t[0],translateY:t[1]}):e.pivot=o.circle(0,0,h(n.radius,5)).attr({"stroke-width":n.borderWidth||0,stroke:n.borderColor||"silver",fill:n.backgroundColor||"black"}).translate(t[0],t[1]).add(e.group)},animate:function(e){var t=this;if(!e)a(t.points,function(e){var i=e.graphic;i&&(i.attr({rotation:t.yAxis.startAngleRad*180/Math.PI}),i.animate({rotation:e.shapeArgs.rotation},t.options.animation))}),t.animate=null},render:function(){this.group=this.plotGroup("group","series",this.visible?"visible":"hidden",this.options.zIndex,this.chart.seriesGroup);w.prototype.render.call(this);this.group.clip(this.chart.clipRect)},setData:function(e,t){w.prototype.setData.call(this,e,!1);this.processData();this.generatePoints();h(t,!0)&&this.chart.redraw()},drawTracker:S.drawTrackerPoint};d.gauge=p(d.line,y);c.boxplot=r(c.column,{fillColor:"#FFFFFF",lineWidth:1,medianWidth:2,states:{hover:{brightness:-.3}},threshold:null,tooltip:{pointFormat:'<span style="color:{series.color};font-weight:bold">{series.name}</span><br/>Maximum: {point.high}<br/>Upper quartile: {point.q3}<br/>Median: {point.median}<br/>Lower quartile: {point.q1}<br/>Minimum: {point.low}<br/>'
},whiskerLength:"50%",whiskerWidth:2});d.boxplot=p(d.column,{type:"boxplot",pointArrayMap:["low","q1","median","q3","high"],toYData:function(e){return[e.low,e.q1,e.median,e.q3,e.high]},pointValKey:"high",pointAttrToOptions:{fill:"fillColor",stroke:"color","stroke-width":"lineWidth"},drawDataLabels:A,translate:function(){var e=this.yAxis,t=this.pointArrayMap;d.column.prototype.translate.apply(this);a(this.points,function(i){a(t,function(t){i[t]!==null&&(i[t+"Plot"]=e.translate(i[t],0,1,0,1))})})},drawPoints:function(){var e=this,i=e.points,s=e.options,n=e.chart.renderer,o,r,l,u,c,d,p,m,f,g,_,y,b,S,v,w,C,x,D,A,L,I,k=e.doQuartiles!==!1,P=parseInt(e.options.whiskerLength,10)/100;a(i,function(i){f=i.graphic;L=i.shapeArgs;_={};S={};w={};I=i.color||e.color;if(i.plotY!==t)if(o=i.pointAttr[i.selected?"selected":""],C=L.width,x=T(L.x),D=x+C,A=M(C/2),r=T(k?i.q1Plot:i.lowPlot),l=T(k?i.q3Plot:i.lowPlot),u=T(i.highPlot),c=T(i.lowPlot),_.stroke=i.stemColor||s.stemColor||I,_["stroke-width"]=h(i.stemWidth,s.stemWidth,s.lineWidth),_.dashstyle=i.stemDashStyle||s.stemDashStyle,S.stroke=i.whiskerColor||s.whiskerColor||I,S["stroke-width"]=h(i.whiskerWidth,s.whiskerWidth,s.lineWidth),w.stroke=i.medianColor||s.medianColor||I,w["stroke-width"]=h(i.medianWidth,s.medianWidth,s.lineWidth),w["stroke-linecap"]="round",p=_["stroke-width"]%2/2,m=x+A+p,g=["M",m,l,"L",m,u,"M",m,r,"L",m,c,"z"],k&&(p=o["stroke-width"]%2/2,m=T(m)+p,r=T(r)+p,l=T(l)+p,x+=p,D+=p,y=["M",x,l,"L",x,r,"L",D,r,"L",D,l,"L",x,l,"z"]),P&&(p=S["stroke-width"]%2/2,u+=p,c+=p,b=["M",m-A*P,u,"L",m+A*P,u,"M",m-A*P,c,"L",m+A*P,c]),p=w["stroke-width"]%2/2,d=M(i.medianPlot)+p,v=["M",x,d,"L",D,d,"z"],f)i.stem.animate({d:g}),P&&i.whiskers.animate({d:b}),k&&i.box.animate({d:y}),i.medianShape.animate({d:v});else{i.graphic=f=n.g().add(e.group);i.stem=n.path(g).attr(_).add(f);if(P)i.whiskers=n.path(b).attr(S).add(f);if(k)i.box=n.path(y).attr(o).add(f);i.medianShape=n.path(v).attr(w).add(f)}})}});c.errorbar=r(c.boxplot,{color:"#000000",grouping:!1,linkedTo:":previous",tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.low}</b> - <b>{point.high}</b><br/>'},whiskerWidth:null});d.errorbar=p(d.boxplot,{type:"errorbar",pointArrayMap:["low","high"],toYData:function(e){return[e.low,e.high]},pointValKey:"high",doQuartiles:!1,drawDataLabels:d.arearange?d.arearange.prototype.drawDataLabels:A,getColumnMetrics:function(){return this.linkedParent&&this.linkedParent.columnMetrics||d.column.prototype.getColumnMetrics.call(this)}});c.waterfall=r(c.column,{lineWidth:1,lineColor:"#333",dashStyle:"dot",borderColor:"#333"});d.waterfall=p(d.column,{type:"waterfall",upColorProp:"fill",pointArrayMap:["low","y"],pointValKey:"y",init:function(e,t){t.stacking=!0;d.column.prototype.init.call(this,e,t)},translate:function(){var e=this.options,t=this.yAxis,i,s,n,a,o,r,l,h,u;i=e.threshold;e=e.borderWidth%2/2;d.column.prototype.translate.apply(this);h=i;n=this.points;for(s=0,i=n.length;s<i;s++){a=n[s];o=a.shapeArgs;r=this.getStack(s);u=r.points[this.index];if(isNaN(a.y))a.y=this.yData[s];l=x(h,h+a.y)+u[0];o.y=t.translate(l,0,1);a.isSum||a.isIntermediateSum?(o.y=t.translate(u[1],0,1),o.height=t.translate(u[0],0,1)-o.y):h+=r.total;o.height<0&&(o.y+=o.height,o.height*=-1);a.plotY=o.y=M(o.y)-e;o.height=M(o.height);a.yBottom=o.y+o.height}},processData:function(e){var t=this.yData,i=this.points,s,n=t.length,a=this.options.threshold||0,o,r,l,h,u,c;r=o=l=h=a;for(c=0;c<n;c++)u=t[c],s=i&&i[c]?i[c]:{},u==="sum"||s.isSum?t[c]=r:u==="intermediateSum"||s.isIntermediateSum?(t[c]=o,o=a):(r+=u,o+=u),l=Math.min(r,l),h=Math.max(r,h);w.prototype.processData.call(this,e);this.dataMin=l;this.dataMax=h},toYData:function(e){if(e.isSum)return"sum";else if(e.isIntermediateSum)return"intermediateSum";return e.y},getAttribs:function(){d.column.prototype.getAttribs.apply(this,arguments);var t=this.options,i=t.states,s=t.upColor||this.color,t=e.Color(s).brighten(.1).get(),n=r(this.pointAttr),o=this.upColorProp;n[""][o]=s;n.hover[o]=i.hover.upColor||t;n.select[o]=i.select.upColor||s;a(this.points,function(e){if(e.y>0&&!e.color)e.pointAttr=n,e.color=s})},getGraphPath:function(){var e=this.data,t=e.length,i=M(this.options.lineWidth+this.options.borderWidth)%2/2,s=[],n,a,o;for(o=1;o<t;o++)a=e[o].shapeArgs,n=e[o-1].shapeArgs,a=["M",n.x+n.width,n.y+i,"L",a.x,n.y+i],e[o-1].y<0&&(a[2]+=n.height,a[5]+=n.height),s=s.concat(a);return s},getExtremes:A,getStack:function(e){var t=this.yAxis.stacks,i=this.stackKey;this.processedYData[e]<this.options.threshold&&(i="-"+i);return t[i][e]},drawGraph:w.prototype.drawGraph});c.bubble=r(c.scatter,{dataLabels:{inside:!0,style:{color:"white",textShadow:"0px 0px 3px black"},verticalAlign:"middle"},marker:{lineColor:null,lineWidth:1},minSize:8,maxSize:"20%",tooltip:{pointFormat:"({point.x}, {point.y}), Size: {point.z}"},turboThreshold:0,zThreshold:0});d.bubble=p(d.scatter,{type:"bubble",pointArrayMap:["y","z"],parallelArrays:["x","y","z"],trackerGroups:["group","dataLabelsGroup"],bubblePadding:!0,pointAttrToOptions:{stroke:"lineColor","stroke-width":"lineWidth",fill:"fillColor"},applyOpacity:function(e){var t=this.options.marker,i=h(t.fillOpacity,.5),e=e||t.fillColor||this.color;i!==1&&(e=D(e).setOpacity(i).get("rgba"));return e},convertAttribs:function(){var e=w.prototype.convertAttribs.apply(this,arguments);e.fill=this.applyOpacity(e.fill);return e},getRadii:function(e,t,i,s){var n,a,o,r=this.zData,l=[],h=this.options.sizeBy!=="width";for(a=0,n=r.length;a<n;a++)o=t-e,o=o>0?(r[a]-e)/(t-e):.5,h&&o>=0&&(o=Math.sqrt(o)),l.push(C.ceil(i+o*(s-i))/2);this.radii=l},animate:function(e){var t=this.options.animation;if(!e)a(this.points,function(e){var i=e.graphic,e=e.shapeArgs;i&&e&&(i.attr("r",1),i.animate({r:e.r},t))}),this.animate=null},translate:function(){var e,i=this.data,s,n,a=this.radii;d.scatter.prototype.translate.call(this);for(e=i.length;e--;)s=i[e],n=a?a[e]:0,s.negative=s.z<(this.options.zThreshold||0),n>=this.minPxSize/2?(s.shapeType="circle",s.shapeArgs={x:s.plotX,y:s.plotY,r:n},s.dlBox={x:s.plotX-n,y:s.plotY-n,width:2*n,height:2*n}):s.shapeArgs=s.plotY=s.dlBox=t},drawLegendSymbol:function(e,t){var i=u(e.itemStyle.fontSize)/2;t.legendSymbol=this.chart.renderer.circle(i,e.baseline-i,i).attr({zIndex:3}).add(t.legendGroup);t.legendSymbol.isMarker=!0},drawPoints:d.column.prototype.drawPoints,alignDataLabel:d.column.prototype.alignDataLabel});g.prototype.beforePadding=function(){var e=this,i=this.len,o=this.chart,r=0,l=i,c=this.isXAxis,d=c?"xData":"yData",p=this.min,m={},f=C.min(o.plotWidth,o.plotHeight),g=Number.MAX_VALUE,_=-Number.MAX_VALUE,y=this.max-p,b=i/y,S=[];this.tickPositions&&(a(this.series,function(t){var i=t.options;if(t.bubblePadding&&(t.visible||!o.options.chart.ignoreHiddenSeries))if(e.allowZoomOutside=!0,S.push(t),c)a(["minSize","maxSize"],function(e){var t=i[e],s=/%$/.test(t),t=u(t);m[e]=s?f*t/100:t}),t.minPxSize=m.minSize,t=t.zData,t.length&&(g=C.min(g,C.max(s(t),i.displayNegative===!1?i.zThreshold:-Number.MAX_VALUE)),_=C.max(_,n(t)))}),a(S,function(e){var t=e[d],i=t.length,s;c&&e.getRadii(g,_,m.minSize,m.maxSize);if(y>0)for(;i--;)typeof t[i]==="number"&&(s=e.radii[i],r=Math.min((t[i]-p)*b-s,r),l=Math.max((t[i]-p)*b+s,l))}),S.length&&y>0&&h(this.options.min,this.userMin)===t&&h(this.options.max,this.userMax)===t&&(l-=i,b*=(i+r-l)/i,this.min+=r/b,this.max+=l/b))};(function(){function e(e,t,i){e.call(this,t,i);if(this.chart.polar)this.closeSegment=function(e){var t=this.xAxis.center;e.push("L",t[0],t[1])},this.closedStacks=!0}function t(e,t){var i=this.chart,s=this.options.animation,n=this.group,a=this.markerGroup,o=this.xAxis.center,r=i.plotLeft,l=i.plotTop;if(i.polar){if(i.renderer.isSVG)if(s===!0&&(s={}),t){if(i={translateX:o[0]+r,translateY:o[1]+l,scaleX:.001,scaleY:.001},n.attr(i),a)a.attrSetters=n.attrSetters,a.attr(i)}else i={translateX:r,translateY:l,scaleX:1,scaleY:1},n.animate(i,s),a&&a.animate(i,s),this.animate=null}else e.call(this,t)}var i=w.prototype,s=b.prototype,n;i.toXY=function(e){var t,i=this.chart,s=e.plotX;t=e.plotY;e.rectPlotX=s;e.rectPlotY=t;s=(s/Math.PI*180+this.xAxis.pane.options.startAngle)%360;s<0&&(s+=360);e.clientX=s;t=this.xAxis.postTranslate(e.plotX,this.yAxis.len-t);e.plotX=e.polarPlotX=t.x-i.plotLeft;e.plotY=e.polarPlotY=t.y-i.plotTop};i.orderTooltipPoints=function(e){if(this.chart.polar&&(e.sort(function(e,t){return e.clientX-t.clientX}),e[0]))e[0].wrappedClientX=e[0].clientX+360,e.push(e[0])};d.area&&f(d.area.prototype,"init",e);d.areaspline&&f(d.areaspline.prototype,"init",e);d.spline&&f(d.spline.prototype,"getPointSpline",function(e,t,i,s){var n,a,o,r,l,h,u;if(this.chart.polar){n=i.plotX;a=i.plotY;e=t[s-1];o=t[s+1];this.connectEnds&&(e||(e=t[t.length-2]),o||(o=t[1]));if(e&&o)r=e.plotX,l=e.plotY,t=o.plotX,h=o.plotY,r=(1.5*n+r)/2.5,l=(1.5*a+l)/2.5,o=(1.5*n+t)/2.5,u=(1.5*a+h)/2.5,t=Math.sqrt(Math.pow(r-n,2)+Math.pow(l-a,2)),h=Math.sqrt(Math.pow(o-n,2)+Math.pow(u-a,2)),r=Math.atan2(l-a,r-n),l=Math.atan2(u-a,o-n),u=Math.PI/2+(r+l)/2,Math.abs(r-u)>Math.PI/2&&(u-=Math.PI),r=n+Math.cos(u)*t,l=a+Math.sin(u)*t,o=n+Math.cos(Math.PI+u)*h,u=a+Math.sin(Math.PI+u)*h,i.rightContX=o,i.rightContY=u;s?(i=["C",e.rightContX||e.plotX,e.rightContY||e.plotY,r||n,l||a,n,a],e.rightContX=e.rightContY=null):i=["M",n,a]}else i=e.call(this,t,i,s);return i});f(i,"translate",function(e){e.call(this);if(this.chart.polar&&!this.preventPostTranslate)for(var e=this.points,t=e.length;t--;)this.toXY(e[t])});f(i,"getSegmentPath",function(e,t){var i=this.points;if(this.chart.polar&&this.options.connectEnds!==!1&&t[t.length-1]===i[i.length-1]&&i[0].y!==null)this.connectEnds=!0,t=[].concat(t,[i[0]]);return e.call(this,t)});f(i,"animate",t);f(i,"setTooltipPoints",function(e,t){this.chart.polar&&o(this.xAxis,{tooltipLen:360});return e.call(this,t)});if(d.column)n=d.column.prototype,f(n,"animate",t),f(n,"translate",function(e){var t=this.xAxis,i=this.yAxis.len,s=t.center,n=t.startAngleRad,a=this.chart.renderer,o,r;this.preventPostTranslate=!0;e.call(this);if(t.isRadial){t=this.points;for(r=t.length;r--;)o=t[r],e=o.barX+n,o.shapeType="path",o.shapeArgs={d:a.symbols.arc(s[0],s[1],i-o.plotY,null,{start:e,end:e+o.pointWidth,innerR:i-h(o.yBottom,i)})},this.toXY(o)}}),f(n,"alignDataLabel",function(e,t,s,n,a,o){if(this.chart.polar){e=t.rectPlotX/Math.PI*180;if(n.align===null)n.align=e>20&&e<160?"left":e>200&&e<340?"right":"center";if(n.verticalAlign===null)n.verticalAlign=e<45||e>315?"bottom":e>135&&e<225?"top":"middle";i.alignDataLabel.call(this,t,s,n,a,o)}else e.call(this,t,s,n,a,o)});f(s,"getIndex",function(e,t){var i,s=this.chart,n;s.polar?(n=s.xAxis[0].center,i=t.chartX-n[0]-s.plotLeft,s=t.chartY-n[1]-s.plotTop,i=180-Math.round(Math.atan2(i,s)/Math.PI*180)):i=e.call(this,t);return i});f(s,"getCoordinates",function(e,t){var i=this.chart,s={xAxis:[],yAxis:[]};i.polar?a(i.axes,function(e){var n=e.isXAxis,a=e.center,o=t.chartX-a[0]-i.plotLeft,a=t.chartY-a[1]-i.plotTop;s[n?"xAxis":"yAxis"].push({axis:e,value:e.translate(n?Math.PI-Math.atan2(o,a):Math.sqrt(Math.pow(o,2)+Math.pow(a,2)),!0)})}):s=e.call(this,t);return s})})()})(Highcharts);SM.InfiniteScroll=SM.Widgets.register({__NAME:"infiniteScroll",__defaults:{threshold:100,markerID:"",windowScroll:false,onReachedEnd:function(e){},isActive:true},LATENCY:200,removeMarker:function(){this._getMarker().remove()},__init:function(){var e=this;this._$window=$(window);this.__settings.markerID="#"+this.__settings.markerID;this._hasLeftThreshold=true;if(this.__settings.isActive){this._bindEvents();setTimeout(function(){if(e._isInThreshold()){e._hitThreshold()}},0)}},__setters:{isActive:function(e,t){if(t){e._activate()}else{e._deactivate()}}},_activate:function(){if(!this._hasMarker()){this._deactivate()}if(!this.__settings.isActive){this.__settings.isActive=true;this._hasLeftThreshold=true;this._bindEvents();if(this._isInThreshold()){this._hitThreshold()}}},_deactivate:function(){if(this.__settings.isActive||!this._hasMarker()){this.__settings.isActive=false;this._unbindEvents()}},__destroy:function(){this.set("isActive",false)},_bindEvents:function(){if(this.get("windowScroll")){this._$window.on("scroll",{self:this},this._onScroll)}else{this.$el.on("scroll",{self:this},this._onScroll)}this._$window.on("resize",{self:this},this._onScroll)},_unbindEvents:function(){if(this.get("windowScroll")){this._$window.off("scroll",this._onScroll)}else{this.$el.off("scroll",this._onScroll)}this._$window.off("resize",this._onScroll)},_hasMarker:function(){return this._getMarker().length>0},_hitThreshold:function(){if(this.__settings.isActive){this.set("isActive",false);this.__settings.onReachedEnd(this);this.trigger("reachedEnd")}},_getScrollBottom:function(){if(this.__settings.windowScroll){return this._$window.scrollTop()+this._$window.height()}else{return this.$el.scrollTop()+this.el.clientHeight}},_getMarker:function(){return $(this.get("markerID"))},_getMarkerTop:function(){var e=this._getMarker(),t;if(this.__settings.windowScroll){t=SM.DOM.getCoordinates(e[0])}else{t=SM.DOM.getCoordinates(e[0],this.$el[0])}return t.top},_isInThreshold:function(){var e;if(!this._hasMarker()){this.set("isActive",false);return false}e=this._getScrollBottom()>=this._getMarkerTop()-this.get("threshold");return e},_checkIfHitThreshold:function(){var e=this._isInThreshold();if(e){if(this._hasLeftThreshold){this._hitThreshold()}}this._hasLeftThreshold=!e},_onScroll:function(e){var t=e.data.self;if(!t._isThrottling&&t.__settings.isActive){t._isThrottling=true;t._checkIfHitThreshold();setTimeout(function(){if(t.__settings.isActive){t._checkIfHitThreshold()}t._isThrottling=false},t.LATENCY)}}});SM.MultiSelect=SM.Widgets.register({__NAME:"multiselect",__defaults:{checkboxSelector:'input[type="checkbox"]'},__init:function(){this.set("lastTarget",null);this._checkedSelector=this.get("checkboxSelector")+":checked";$(document).on("keydown",{self:this},this._onKeydown).on("keyup",{self:this},this._onKeyup);this.$el.on("change",this.get("checkboxSelector"),{self:this},this._onCheckboxChange)},__destroy:function(){this.set("lastTarget",null);$(document).off("keydown",this._onKeydown).off("keyup",this._onKeyup)},reset:function(){this.set("lastTarget",null)},_applySelection:function(e){var t=this._getLastTarget(),i,s,n,a;i=this.$el.find(this.get("checkboxSelector"));s=i.index(t);n=i.index(e);if(s===n){return}if(s<n){a=s;s=n;n=a}i=i.slice(n,s+1);i.each(function(){this.checked=true});this.trigger({type:"applied",$checkboxes:i})},_getLastTarget:function(){return this.get("lastTarget")||this.$el.find(this.get("checkboxSelector")).first().get(0)},_onCheckboxChange:function(e){var t=e.data.self,i=$(e.target),s=i.prop("checked");if(s&&t._isShiftPressed){t._applySelection(e.target)}t.set("lastTarget",e.target);if(!s&&!t.$el.find(t._checkedSelector).length){t.reset()}},_onKeyup:function(e){if(e.which===SM.KeyCodes.SHIFT){e.data.self._isShiftPressed=false}},_onKeydown:function(e){if(e.which===SM.KeyCodes.SHIFT){e.data.self._isShiftPressed=true}}});var Hightables=new function(e){var t=this,i=SM.log;t.renderTable=function(e){var t=e.tableData,i=e.tableClasses,a=e.tableAttrs,o=e.target,u;var c=$('<table cellpadding="0" cellspacing="0"></table>'),d=$("<thead></thead>"),p=$("<tbody></tbody>"),m=$("<tfoot></tfoot>");if(t.caption){s(t.caption,c)}if(t.thead.rows){n(t.thead.rows,d);c.append(d)}n(t.tbody.rows,p);c.append(p);if(t.tfoot){n(t.tfoot.rows,m);c.append(m)}c.addClass(i);_.each(a,function(e,t){c.attr("data-"+t,e)});if(e.useDivs||e.flattenNestedTables){u=c[0].outerHTML;if(e.useDivs){u=r(u)}if(e.flattenNestedTables){u=l(u)}c=$(u)}h(c,e.events);o.append(c)};function s(e,t){var i=SM.Template.renderHTML(e.template,e.context);t.append(i)}function n(e,t){var i,s,n;_.each(e,function(e){i=a(e);n=$(i);if(e.cells){_.each(e.cells,function(e){s=o(e);n.append(s)})}t.append(n)})}function a(e){var t;if(e.template){t=SM.Template.renderHTML(e.template,e.context)}else{t="<tr></tr>"}return t}function o(e){var t=SM.Template.renderHTML(e.template,e.context);return t}function r(e){var t,i,s,n,a;t=["table","caption","thead","tbody","tfoot","tr","th","td"];_.each(t,function(t){i=new RegExp("<"+t,"g");n="<div display='"+t+"'";e=e.replace(i,n);s=new RegExp("</"+t,"g");a="</div";e=e.replace(s,a)});return e}function l(e){var t=$(e),i=t.find(".nested-table"),s;if(i.length){s=i.html();i.remove();e=t[0].outerHTML+s}return e}function h(e,t){var i=t.captionClick,s=t.tdMouseEnter,n=t.tdMouseLeave,a=t.thClick,o=t.tdClick;e.on("click","caption",function(e){if(i){i(e)}});e.on("click","th",function(e){if(a){a(e)}});e.on("click","td",function(e){if(o){o(e)}});e.on("mouseenter","td",function(e){if(s){s(e)}});e.on("mouseleave","td",function(e){if(n){n(e)}})}};SM.Highcharts={};SM.Highcharts.CHART_WIDTH=594;SM.Highcharts.MARGIN_TOP=0;SM.Highcharts.MARGIN_BOTTOM=40;SM.Highcharts.MARGIN_LEFT=95;SM.Highcharts.PLOT_AREA_WIDTH=SM.Highcharts.CHART_WIDTH-SM.Highcharts.MARGIN_LEFT;SM.Highcharts.X_AXIS_MAX_VISIBLE_LINES=4;SM.Highcharts.Y_AXIS_MAX_VISIBLE_LINES=3;SM.Highcharts.AXIS_LABEL_CHARACTER_WIDTH=8;SM.Highcharts.DATA_LABEL_CHARACTER_WIDTH=8;SM.Highcharts.DATA_LABEL_CHARACTER_HEIGHT=15;SM.Highcharts.DATA_LABEL_PADDING=10;SM.Highcharts.LEGEND_MARGIN_TOP=20;SM.Highcharts.NUM_SIGNIFICANT_DIGITS=2;SM.Highcharts.MAX_TITLE_CHARS=85;SM.Highcharts.calculateBarHeight=function(e){return Math.max(120-Math.ceil(e/2)*20,50)};SM.Highcharts.calculateChartHeight=function(e,t){var i=t.answerStructures,s=t.titleHeight,n=t.labelHeight,a=t.legendHeight,o,r=e==="pie"?320:250,l=e==="boxplot"?145:200,h=SM.Highcharts.calculateMarginTop(s),u=SM.Highcharts.calculateMarginBottom(n,a),c;if(e==="bar"){l=SM.Highcharts.calculateBarChartHeight(t)}if(e==="pie"||e==="donut"){c=i.rows.length;l=c*18}o=l+h+u;return Math.max(o,r)};SM.Highcharts.calculateBarChartHeight=function(e){var t=e.answerStructures.rows,i=e.answerStructures.cols,s=e.chartIndex,n=!_.isEmpty(i),a=n&&!_.isEmpty(i[0].items),o=a?i[0].items:null,r=0,l,h,u;l=t.length;if(a){r=_.isArray(o)?_.size(o):_.size(_.keys(o))}if(e.isStacked){if(n){if(e.isMirrored){if(a){l=r}else{l=i.length}}else{l=t.length}}else{l=1}}else{if(n){if(e.isDistribution){l=l*i.length;if(a){if(e.isCompared){l=_.flatten(_.map(i,function(e){return e.items})).length}else{l=i[s].items.length*i.length}}}else{if(a){if(e.isCompared){l=r}else{l=t.length}}else{if(e.isMirrored){l=i.length}else{l=t.length}}}}}h=SM.Highcharts.calculateBarHeight(l);u=l*h;return u};SM.Highcharts.calculateTrendChartHeight=function(e,t,i,s,n){var a,o=250,r=200,l=SM.Highcharts.calculateMarginTop(t),h=SM.Highcharts.calculateMarginBottom(i,s);n=n||0;a=r+l+h+n;return Math.max(a,o)};SM.Highcharts.calculateChartWidth=function(e,t){var i,s=0,n;var a=t.numSeries,o=t.numXAxisLabels,r=t.isCompared;if(t.isStacked){n=o}else if(r){if(_.include(["line","area"],e)){n=a}else{n=o*a}}else{n=Math.max(a,o)}i=Math.max(100-Math.ceil(n/5)*20,30);if(_.contains(["column","line","area"],e)){s=i*n}return Math.max(s,SM.Highcharts.CHART_WIDTH)};SM.Highcharts.calculateMarginTop=function(e,t){var i=e;if(t){i+=t}return i};SM.Highcharts.calculateMarginBottom=function(e,t,i){var s=10,n=SM.Highcharts.LEGEND_MARGIN_TOP,a;a=s+e;if(t&&t>0){a+=n+t}if(i){a+=i}return a};SM.Highcharts.calculateSpacingBottom=function(e,t){if(t&&t>0){e+=SM.Highcharts.LEGEND_MARGIN_TOP+t}return e};SM.Highcharts.calculateMarginBottom=function(e,t){var i=20,s=SM.Highcharts.LEGEND_MARGIN_TOP,n;n=i+e;if(t&&t>0){n+=s+t}return n};SM.Highcharts.calculateLegendHeight=function(e){var t=SM.Highcharts.PLOT_AREA_WIDTH,i=18,s=10,n=15,a=5,o=5,r=n+a+o,l,h,u=5,c=0,d=1,p;if(!_.isEmpty(e)){p=e[0].name?e:e[0].data;_.each(p,function(e){if(e.showInLegend!==false){h=(e.name?e.name.length:0)*u+6;l=i+s+h;if(c+l>t){c=l;d+=1}else{c+=l}}})}return d*r};SM.Highcharts.calculateLegendHeight_fixedItemWidth=function(e){var t=SM.Highcharts.PLOT_AREA_WIDTH,i=15,s=5,n=5,a=i+s+n,o=20,r=99,l=1,h=99,u=3.5,c,d=e[0].name?e:e[0].data;if(e[0].name){h=e[0].name.length*u;if(r<h){l=Math.ceil(h/r)}}c=Math.floor(t/r);return l*_.size(d)*a/c+o};SM.Highcharts.calculateXAxisLabelHeight=function(e,t){var i,s,n,a,o,r;if(_.isEmpty(t)){return 0}if(_.contains(["column","line","area"],e)){i=_.max(_.map(t,function(e){return e.length}));s=514/t.length;n=Math.ceil(s/SM.Highcharts.AXIS_LABEL_CHARACTER_WIDTH);a=Math.ceil(i/n);o=SM.Highcharts.X_AXIS_MAX_VISIBLE_LINES;r=a>o?o:a;return r*15}else{return 30}};SM.Highcharts.formatAxisLabel=function(e,t,i){if(_.isNumber(e)&&_.isFinite(e)){return SM.Highcharts.formatNumericAxisLabel(e)}else{return SM.Highcharts.formatTextualAxisLabel(e,t,i)}};SM.Highcharts.formatNumericAxisLabel=function(e){if(Math.abs(e)<=1e3){return e}var t=["k","M","B","T"],i=Math.floor(Math.log(Math.abs(e))/Math.log(1e3));return e/Math.pow(1e3,i)+t[i-1]};SM.Highcharts.formatTextualAxisLabel=function(e,t,i){var s=Math.ceil(t/SM.Highcharts.AXIS_LABEL_CHARACTER_WIDTH),n=[],a,o,r;if(e.length>s){o=e.replace(/\ /g,"\xa0").split("\xa0");r="";_.each(o,function(e,t){if(e.length+1+r.length<=s){r+=" "+e}else{if(t!==0){n.push(r)}if(e.length>=s){var i=Math.ceil(e.length/s);_.times(i,function(t){r=e.slice(t*s,(t+1)*s);if(r.length===s&&t!==i-1){n.push(r)}})}else{r=e}}if(t===o.length-1){n.push(r)}});n=_.map(n,function(e){return $.trim(e)});a=n.slice(0,i);if(n.length>i){var l=a[a.length-1];if(l.length+3>s){a[a.length-1]=l.slice(0,s-3)+"..."}else{a[a.length-1]+="..."}}e=_.map(a,function(e){return"<div>"+_.escape(e)+"</div>"});e=e.join(" ")}else{e=_.escape(e)}return e};SM.Highcharts.xAxisLabelFormatter=function(){var e=this.axis.options.categories.length,t=this.axis.width/e,i=SM.Highcharts.X_AXIS_MAX_VISIBLE_LINES;return SM.Highcharts.formatAxisLabel(this.value,t,i)};SM.Highcharts.yAxisLabelFormatter=function(){var e=100,t=SM.Highcharts.Y_AXIS_MAX_VISIBLE_LINES,i=this.value;if(_.isNumber(i)&&_.isFinite(i)&&this.axis.max<i){return""}return SM.Highcharts.formatAxisLabel(i,e,t)};SM.Highcharts.percentageLabelFormatter=function(){var e=this.value;if(_.isNumber(e)&&_.isFinite(e)&&this.axis.max<e){return""}return e+"%"};SM.Highcharts.highchartsRenderLegendItem=Highcharts.Legend.prototype.renderItem;SM.Highcharts.renderLegendItem=function(e){var t=e.userOptions&&e.userOptions.__options?e.userOptions.__options.hideLegendItem:false;if(!t){SM.Highcharts.highchartsRenderLegendItem.call(this,e)}};Highcharts.Legend.prototype.renderItem=SM.Highcharts.renderLegendItem;Highcharts.Legend.prototype.preExistingPositionItem=Highcharts.Legend.prototype.positionItem;SM.Highcharts.legendPositionItem=function(e){var t=e.userOptions&&e.userOptions.__options?e.userOptions.__options.hideLegendItem:false;if(!t){Highcharts.Legend.prototype.preExistingPositionItem.call(this,e)}};Highcharts.Legend.prototype.positionItem=SM.Highcharts.legendPositionItem;SM.Highcharts.legendFormatter=function(){var e=this;e.name=_.escape(e.name);e.name=_.string.truncate(e.name,90);return e.name};SM.Highcharts.legendUnescapedFormatter=function(){var e=this;e.name=_.string.truncate(e.name,90);return e.name};SM.Highcharts.formatTooltip=function(){var e=SM.Highcharts.formatYValue(this.point.absoluteY,"absolute",0),t=SM.Highcharts.formatYValue(this.point.percentageY,"percent",2),i;if(t){i="<span>"+e+"</span>"+" "+"<span>("+t+")</span>"}else if(e){i="<span>"+e+"</span>"}return i};SM.Highcharts.formatTooltipNpsScore=function(){var e=SM.Highcharts.formatYValue(this.point.absoluteY,"absolute",0),t;if(e){t="<span>"+e+"</span>"}return t};SM.Highcharts.formatTooltipNpsDetailed=function(){var e=SM.Highcharts.formatYValue(this.point.absoluteY,"absolute",0),t=SM.Highcharts.formatYValue(this.point.percentageY,"percent",2),i="",s,n;if(this.point.name){i=this.point.name}else if(this.series.name){i=this.series.name}s='<span style="font-weight: bold; text-align:center">'+i+"</span><br>";if(t){n=s+"<span>"+e+"</span>"+" "+"<span>("+t+")</span>"}else if(e){n="<span>"+e+"</span>"}return n};SM.Highcharts.getGlobalizeFormatType=function(e,t){var i;if(e==="percent"){i="p"+t}else{i="n"+t}return i};SM.Highcharts.formatYValue=function(e,t,i){var s=SM.Highcharts.getGlobalizeFormatType(t,i);if(e){if(t==="percent"){e=parseFloat(e)/100}e=Globalize.format(e,s)}return e};SM.Highcharts.floatingPointFormatter=function(){return Globalize.format(this.point.y,"n2")};SM.Highcharts.integerPointFormatter=function(){return Globalize.format(this.point.y,"n0")};SM.Highcharts.bindYAxisEvents=function(e,t){if(t&&t.ticks){_.each(t.ticks,function(t,i){var s=$(t.label.element);s.unbind("click");s.click({tickPos:i,self:self},function(t){if(self.display&&!self.display.getBenchmarkDisplay()){SM.CustomizeActionMenu.actionMenu.call(self,t,"yAxisLabel",{parent:e})}})})}};SM.Highcharts.bindXAxisEvents=function(e){};SM.Highcharts.bindAreaChartEvents=function(e){var t=e.find(".highcharts-series path");t.click(function(t){if(self.display&&!self.display.getBenchmarkDisplay()){SM.CustomizeActionMenu.actionMenu.call(self,t,"area",{parent:e})}})};SM.Highcharts.onPointMouseOver=function(e){SM.Highcharts.toggleLegendItemHighlighting(e)};SM.Highcharts.onPointMouseOut=function(e){SM.Highcharts.toggleLegendItemHighlighting(e)};SM.Highcharts.toggleLegendItemHighlighting=function(e){var t=e.currentTarget.series.chart,i=t.options.legend.enabled,s=t.options.chart.type,n=[];if(i){if(s==="pie"||s==="donut"){n=$(e.currentTarget.legendItem.element)}else{if(e.currentTarget.series.legendItem){n=$(e.currentTarget.series.legendItem.element)}}if(n.length){n.toggleClass("point-hovered")}}};SM.Highcharts.calculateSeriesRange=function(e){var t,i,s;t=_.map(e,function(e){s=_.map(e.data,function(e){return e.y});return _.max(s)});i=_.map(e,function(e){s=_.map(e.data,function(e){return e.y});return _.min(s)});return{max:_.max(t),min:_.min(i)}};SM.Highcharts.calculateStackedSeriesRange=function(e){var t=[],i,s;if(_.isEmpty(e)){return{min:0,max:0}}s=e[0].data.length;_.times(s,function(s){i=0;_.map(e,function(e){i+=e.data[s].y});t.push(i)});return{min:_.min(t),max:_.max(t)}};SM.Highcharts.calculateYAxisScaleOptions=function(e,t){var i,s=1,n=false,a;if(_.isUndefined(t)){t=0;n=true}a=e-t||10;if(!_.isFinite(a)){a=10}if(a>100){while(a>100){a/=10;s*=10}}else if(a<10){while(a<10){a*=10;s/=10}}if(a<=5){a=5;i=1}else if(a<=10){a=10;i=1}else if(a<=20){a=20;i=2}else if(a<=50){a=50;i=10}else if(a<=100){a=100;i=10}if(n){t=Math.floor(t*s/i)*i;e=Math.ceil((t+a)*s/i)*i}return{min:t,max:e,tickInterval:i*s}};SM.Highcharts.renderGaugeShapes=function(e,t,i,s){var n=$.extend(true,{},SM.Highcharts.NPS_SCORE_CHART_MISC_OPTIONS),a=e.userOptions.labels?e.userOptions.labels:n.labels,o=e.userOptions&&e.userOptions.chart&&e.userOptions.chart.noResponses,r=t+"",l;if(e.userOptions.chart.showingBenchmark){n.innerradius=50.5;n.tHeight=20;n.alpha=14;n.radius=52/n.handRatio}_.each(a,function(t){e.renderer.text(t.text,t.x,t.y).css(n.labelCSS).attr({zIndex:999}).add()});if(s){l=n.cx-r.length/2*n.letterSize;e.renderer.text(r,l,n.scoreTextY).attr(n.exportInnerScoreCSS).add();e.renderer.text("NPS",n.npsTextX,n.npsTextY).attr(n.exportInnerTextCSS).add();SM.Highcharts.renderGaugeClockHandForExports(e,n,t)}else{if(e.renderer.isVML||(SM.Browser.isIE||SM.Browser.isSafari&&window.navigator.userAgent.indexOf("Chrome")===-1)){SM.Highcharts.renderGaugeClockHandForExports(e,n,t)}else{SM.Highcharts.renderGaugeClockHand(e,n,t)}setTimeout(function(){var s,n,a,l,h,u,c,d,p=i.position(),m=33;s=SM.Template.render("highcharts-gauge-text-template",{scoreString:r,noResponses:o});i.after(s);h=i.siblings(".gauge-text").last();if(e.userOptions.chart.showingBenchmark){m=0}if(e.userOptions.chart.isBenchmark){m+=e.plotWidth}h.css({left:m+"px",top:p.top+"px"});u=h.find(".gauge-inner-text");c=h.find(".gauge-top-text");d=h.find(".gauge-bottom-text");if(!o){c.css("padding-left",4-r.length);c.css("letter-spacing",-1.5);if(t===-100||t===100){c.css("font-size",42)}}n=e.plotLeft+e.plotWidth*.5+u.width()*-.5;a=e.plotTop+e.plotHeight*.5+u.height()*-.5+3;u.css("left",n);u.css("top",a);if(e.userOptions&&e.userOptions.__options&&e.userOptions.__options.innerTextColor){c.css("color",e.userOptions.__options.innerTextColor);d.css("color",e.userOptions.__options.innerTextColor)}},0)}};SM.Highcharts.renderGaugeClockHand=function(e,t,i){var s=e.userOptions&&e.userOptions.chart&&e.userOptions.chart.noResponses,n,a,o,r,l,h,u,c,d,p,m,f,g,_,y,b;f="\n"+'    <filter id="gaugeShadow" x="0" y="0" height="130%" width="100%">\n'+'    <feoffset dx="0" dy="1" in="SourceAlpha" result="offsetOut"></feoffset>\n'+'    <feColorMatrix result="matrixOut" in="offsetOut" type="matrix"\n'+'     values="0.3 0.3 0.3 0.3 0 0.3 0.3 0.3 0.3 0 0.3 0.3 0.3 0.3 0 0.3 0.3 0.3 0.3 0" />\n'+'       <fegaussianblur result="blurOut" in="matrixOut" stdDeviation="1"></fegaussianblur>\n'+'       <feblend in="SourceGraphic" in2="blurOut" mode="normal"></feblend>\n'+"    </filter>\n";g=$(e.container).find("svg");_=g.find("defs");y=_.find("#gaugeShadow");if(y.length===0){b=_.html()+f;_.html(b)}t.cx=e.chartWidth/2;t.cy=e.chartHeight/2;if(s){e.renderer.circle(t.cx,t.cy,t.innerradius).attr(t.clockHandCSS).attr("filter","url(#gaugeShadow)").add()}else{p=i/100*360/5*2;o=t.cx+(t.innerradius+t.tHeight)*Math.sin(p/360*(2*Math.PI));r=t.cy-(t.innerradius+t.tHeight)*Math.cos(p/360*(2*Math.PI));l=t.cx+t.innerradius*Math.sin((p-t.alpha)/360*(2*Math.PI));h=t.cy-t.innerradius*Math.cos((p-t.alpha)/360*(2*Math.PI));u=t.cx+t.innerradius*Math.sin((p+t.alpha)/360*(2*Math.PI));c=t.cy-t.innerradius*Math.cos((p+t.alpha)/360*(2*Math.PI));d=["M",u,c,"A",t.innerradius,t.innerradius,0,1,1,l,h,"L",o,r,"Z"];e.renderer.path(d).attr(t.clockHandCSS).attr("filter","url(#gaugeShadow)").add()}};SM.Highcharts.renderGaugeClockHandForExports=function(e,t,i){var s,n,a,o,r,l,h,u,c;t.cx=e.chartWidth/2;t.cy=e.chartHeight/2;e.renderer.circle(t.cx,t.cy,t.innerradius).attr(t.exportInnerCircleCSS).add();s=i/100*360/5*2;n=t.innerradius;a=t.cx+(n+t.tHeight)*Math.sin(s/360*(2*Math.PI));o=t.cy-(n+t.tHeight)*Math.cos(s/360*(2*Math.PI));r=t.cx+(n-2)*Math.sin((s-t.alpha)/360*(2*Math.PI));l=t.cy-(n-2)*Math.cos((s-t.alpha)/360*(2*Math.PI));h=t.cx+(n-2)*Math.sin((s+t.alpha)/360*(2*Math.PI));u=t.cy-(n-2)*Math.cos((s+t.alpha)/360*(2*Math.PI));c=["M",a,o,"L",r,l,"L",h,u,"Z"];e.renderer.path(c).attr(t.clockHandCSSExport).add()};SM.Highcharts.renderTMBCShapes=function(e,t,i,s){var n=$.extend(true,{},SM.Highcharts.NPS_SCORE_CHART_MISC_OPTIONS),a=e.userOptions||{},o=a.chart||{},r=a.labels?a.labels:n.labels,l=o.noResponses,h=t+"",u=o.tmbcType==="tmbc_engagement"||o.isTop2,c=o.isBenchmark,d=o.tmbcType==="tmbc_gei"&&!c,p;if(s){p=n.cx-h.length/2*n.letterSize;if(u){h=h+"%"}e.renderer.text(h,p,n.scoreTextY).attr(n.exportInnerScoreCSS).add()}else{setTimeout(function(){var s,n,o,r,p,m,f,g,_=i.position(),y=_.top-5,b=0;s=SM.Template.render("highcharts-tmbc-text-template",{scoreString:h,noResponses:l,usePercent:u,isGEI:d});i.after(s);p=i.siblings(".gauge-text").last();m=p.find(".gauge-inner-text");if(!u&&!c){m.append('<div class="popout sidi-popout tmbc"></div>');m.tmbcpopout(a.tooltip.settings)}if(!e.userOptions.chart.showingBenchmark){y+=20}if(c){b+=e.plotWidth}p.css({left:b+"px",top:y+"px"});f=p.find(".gauge-top-text");g=p.find(".gauge-bottom-text");if(!l){f.css("padding-left",4-h.length);f.css("letter-spacing",-1.5);if(t===-100||t===100){f.css("font-size",42)}}n=e.plotLeft+e.plotWidth*.5+m.width()*-.5;o=e.plotTop+e.plotHeight*.5+m.height()*-.5+3;m.css("left",n);m.css("top",o);if(e.userOptions&&e.userOptions.__options&&e.userOptions.__options.innerTextColor){f.css("color",e.userOptions.__options.innerTextColor);g.css("color",e.userOptions.__options.innerTextColor)}},0)}};SM.Highcharts.renderBoxPlotLabels=function(e,t,i){var s=[],n,a,o,r,l,h,u,c,d=e.userOptions&&e.userOptions.chart&&e.userOptions.chart.forcePercent||false;var p=function(e,t){var i,s,n;s=0;i=[];$.each(e,function(e,t){if(s>t.left){t.left=s+1}i.push(t);s=t.left+t.width});e=i.reverse();n=t;i=[];$.each(e,function(e,t){if(n<t.left+t.width){t.left=n-t.width-1}i.push(t);n=t.left});return i};o=SM.Highcharts.BOX_PLOT_LABELING_OPTIONS.fontsize;l=SM.Highcharts.BOX_PLOT_LABELING_OPTIONS.labelCSS;u=i?SM.Highcharts.BOX_PLOT_LABELING_OPTIONS.plotLabelY:SM.Highcharts.BOX_PLOT_LABELING_OPTIONS.ypos;
n=e.userOptions.yAxis.min;a=e.userOptions.yAxis.max-n;c=!e.userOptions.chart.isNPS||i;$.each(t,function(t,i){var r,l,h,u,p;if(d){p=SM.Highcharts.getGlobalizeFormatType("percent",0);l=Globalize.format(i/100,p)}else{r=c&&i!==Math.floor(i);l=r?Globalize.format(i,"n2"):""+i}h=l.length;u=(i-n)/a*e.plotWidth;s.push({val:l,left:u-o*h/2,width:o*h})});s=p(s,e.plotWidth);$.each(s,function(t,i){e.renderer.text(i.val,e.plotLeft+i.left,e.plotTop+u).css(l).attr({zIndex:999}).add()})};SM.Highcharts.DEFAULT_COLORS=["#CED428","#33BDBF","#F7AF1C","#898A7A","#2F606E","#CFCDBE","#5B5A4B","#A9BD38","#C8441A","#00898B"];SM.Highcharts.DEFAULT_BENCHMARK_COLORS=["#A9BD38","#2D606F","#33BDBF","#F7AF1C","#898B7A","#CFCDBE","#00898B","#CDD52A","#5B5A4B","#C8441A"];SM.Highcharts.NPS_BENCHMARK_DISTRIBUTION_COLORS=["#FD8623","#FFE651","#C6D9%C","#999A8A","#3F707E","#DFDDCE","#6B6A5B","#B9CD48","#D8542A","#10999B"];SM.Highcharts.NPS_DISTRIBUTION_COLORS=["#FC7613","#FFD641","#B6C94C","#898A7A","#2F606E","#CFCDBE","#5B5A4B","#A9BD38","#C8441A","#00898B"];SM.Highcharts.NPS_DETAILED_DISTRIBUTION_COLORS=["#870504","#9C0A09","#B10F0D","#C51716","#D81E1D","#EC2624","#FF2B2A","#F3BA2F","#FFD641","#BED056","#91AD43"];SM.Highcharts.NPS_SCORE_CHART_BASE_OPTIONS={chart:{margin:[0,0,0,0],spacingTop:0,spacingBottom:0,spacingLeft:0,spacingRight:0,style:{fontFamily:"Arial"},plotBackgroundColor:"#FFF",type:"pie",width:594,height:240,renderTo:{},events:{}},title:{text:null},colors:["#355F6D","#355F6D","#355F6D","#355F6D"],plotOptions:{series:{animation:false,point:{events:{}},events:{},innerSize:"50%"},pie:{marker:{states:{hover:{enabled:false}}},size:"90%",center:["50%","50%"],colorByPoint:true,borderWidth:2,dataLabels:{enabled:false},startAngle:-144,endAngle:144}},legend:{enabled:false},tooltip:{enabled:false},credits:{enabled:false},series:[{data:[{y:1},{y:1},{y:1},{y:1}]}]};SM.Highcharts.NPS_SCORE_CHART_MISC_OPTIONS={innerradius:60,radius:85,tHeight:20,cx:297,cy:120,handRatio:.73,alpha:14,letterSize:28,exportInnerCircleCSS:{fill:"#F0F0F0",zIndex:99},exportInnerScoreCSS:{color:"#366",textAlign:"center","font-family":"Arial","font-weight":"bold","font-size":"50px",zIndex:999},exportInnerTextCSS:{textAlign:"center",color:"#366","font-size":"16px",zIndex:999},labelCSS:{textAlign:"center",color:"#333","font-family":"Arial","font-weight":"bold","font-size":"13px",zIndex:999},clockHandCSS:{fill:"#FFFFFF",zIndex:999},clockHandCSSExport:{fill:"#F0F0F0",zIndex:999},scoreTextY:135,npsTextX:280,npsTextY:155,labels:[{text:"0",x:293,y:10},{text:"-50",x:180,y:90},{text:"50",x:395,y:90},{text:"-100",x:224,y:215},{text:"100",x:345,y:215}]};SM.Highcharts.NPS_SCORE_BAR_CHART_OPTIONS={xAxis:{labels:{gridLineWidth:2},lineWidth:0,lineColor:"#FFF"},yAxis:{plotLines:[{color:"#DEDEDE",zIndex:1,width:2,value:0}]}};SM.Highcharts.DEFAULT_OPTIONS={chart:{marginLeft:SM.Highcharts.MARGIN_LEFT,spacingRight:0,style:{fontFamily:"Arial"},plotBackgroundColor:"#F0F0F0"},title:{text:null,style:{fontFamily:"Arial",fontWeight:"bold",fontSize:"18px",color:"#333"}},colors:SM.Highcharts.DEFAULT_COLORS,xAxis:{title:{text:null},labels:{style:{fontFamily:"Arial",fontWeight:"bold",color:"#333"},gridLineColor:"#FFF",overflow:"justify",useHTML:true},lineColor:"#CCCCCC",tickLength:0},yAxis:{labels:{overflow:"justify",style:{fontFamily:"Arial",paddingTop:"10px",color:"#333"},useHTML:true},title:{text:null},offset:0,lineColor:"#DEDEDE",lineWidth:2,gridLineColor:"#FFF"},plotOptions:{series:{pointPadding:.05,groupPadding:.1,animation:false,dataLabels:{style:{fontWeight:"bold",fontSize:"12px",color:"#000"},useHTML:true},point:{events:{legendItemClick:function(){return false}}},events:{legendItemClick:function(){return false}}}},legend:{labelFormatter:SM.Highcharts.legendFormatter,enabled:false,floating:true,borderWidth:0,x:0,y:0,useHTML:true,itemDistance:20,itemMarginTop:5,itemMarginBottom:5,itemStyle:{display:"block",color:"#000",fontFamily:"Arial",fontSize:"11px",lineHeight:"14px"}},tooltip:{animation:false,hideDelay:100,backgroundColor:"#000",borderWidth:0,shadow:false,headerFormat:"",followPointer:true,style:{fontFamily:"Arial",fontSize:"12px",color:"#FFF"},useHTML:true,formatter:SM.Highcharts.formatTooltip},credits:{enabled:false}};SM.Highcharts.BOX_PLOT_LABELING_OPTIONS={fontsize:7,labelCSS:{color:"#333","font-family":"Lucida Grande","font-weight":"bold","font-size":"10px"},min:-100,range:200,ypos:48,plotLabelY:135};SM.CustomizeActionMenu={};SM.CustomizeActionMenu.ActionMenuOptionsSettings={h1:{template:"customize-label-action-menu-template",visibleOptions:{labels:true},isTable:false},background:{template:"chart-customization-bg-action-menu-template",isTable:false},dataPoint:{template:"chart-customization-action-menu-template",isTable:false,visibleOptions:{change:true,customize:true}},dataLabel:{template:"chart-customization-action-menu-template",isTable:false,visibleOptions:{change:false,customize:true}},dataPointNPS:{template:"chart-customization-action-menu-template",isTable:false,visibleOptions:{change:false,customize:true}},legend:{template:"chart-customization-action-menu-template",isTable:false,visibleOptions:{change:true,customize:true}},legendNPS:{template:"chart-customization-action-menu-template",isTable:false,visibleOptions:{change:false,customize:true}},area:{template:"chart-customization-action-menu-template",isTable:false,visibleOptions:{change:true,customize:true}},yAxisLabel:{template:"chart-customization-action-menu-template",isTable:false,visibleOptions:{change:false,customize:true}},xAxisLabel:{template:"chart-customization-xAxis-action-menu-template",isTable:false},th:{template:"chart-customization-thead-action-menu-template",visibleOptions:{ascending:true,descending:true,unsorted:true,labels:true},isTable:true},caption:{template:"customize-label-action-menu-template",isTable:true},td:{template:"customize-label-action-menu-template",isTable:true,visibleOptions:{labels:true}}};SM.CustomizeActionMenu.actionMenu=function(e,t,i){var s=false,n=SM.CustomizeActionMenu.ActionMenuOptionsSettings[t],a,o=n.isTable?$(e.currentTarget):$(e.target),r=o.data("actionMenu"),l=0,h,u,c,d;if(t==="merveys-th"){l=3e3}a=i.visibleOptions?SM.Object.deepExtend(n.visibleOptions,i.visibleOptions):n.visibleOptions;if(!r){o.actionMenu({templateID:n.template,visibleOptions:a,answerID:i.answerID,position:{collision:"none none"}});r=o.data("actionMenu");o.one("actionMenu.afterOpen",function(e){d=e.actionMenu.get("menuView");d.$el.mouseover(function(){s=true}).mouseout(function(){s=false;setTimeout(function(){if(r&&!s){r.close()}},1e3)});d.$el.find(".options").on("mouseenter",function(){s=true})}).mouseout(function(){setTimeout(function(){if(r&&!s){r.close()}},l)});r.open()}d=r.get("menuView");if(t==="merveys-th"){d.$el.css({top:i.parent.offset().top+i.parent.outerHeight()+"px",left:i.parent.offset().left+i.parent.outerWidth()-d.$el.width()+4+"px"})}else{if(e.pageX||e.pageY){h=e.pageX;u=e.pageY}else if(e.clientX||e.clientY){h=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;u=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}else if(i.parent){c=i.parent.offset();h=e.chartX+c.left;u=e.chartY+c.top}d.$el.css({left:h+"px",top:u+"px"})}d.$el.find(".q").popout()};SM.CustomizeActionMenu.popout=function(e,t,i){var s=$(e.currentTarget);s.popout()};SM.SortedSummary=function(e){var t=this;var i="ascending",s="descending",n="unsorted";var a={order:SM.QuestionDisplayModel.SORTING_ORDERS.UNSORTED,dimensionType:null,dimensionID:null};function o(e){var i=e.question,s=e.labels,n=e.isMirrored,a=e.shouldHideEmptyData;t.summary=t._getSortedSummaryData(i,s,n,a,e)}function r(e){var t={};$.each(e,function(e,i){$.each(i.items,function(e,i){if(i.id){t[i.id]=i}})});return t}function l(e){return _.find(t.rows,function(t){return t.id===e})}function h(e){return _.find(t.columns,function(t){return t.id===e})}function u(e){return _.find(t.columnChoices,function(t){return t.id===e})}function c(){var e={};_.each(t.rows,function(t){e[t.id]=f(t.id)});return e}function d(){var e={};_.each(t.columns,function(t){e[t.id]=g(t.id)});return e}function p(){var e={},i;_.each(t.rows,function(s){i=t.summary.summary.options[s.id];if(i&&i.row_total!==undefined){e[s.id]=i.row_total}else{e[s.id]=0}});return e}function m(){var e={},i;if(t.isCompared){i=t.summary.summary.answered_subtotals}else{i=t.summary.summary.options.col_totals}_.each(t.columns,function(s,n){if(i){if(t.isCompared){e[s.id]=i[s.id]}else{e[s.id]=i[n]}}else{e[s.id]=0}});return e}function f(e){var i=0,s=t.summary.summary.options[e],n;if(s&&s.options){_.each(t.columns,function(e,t){n=s.options[e.id];if(n){i+=n.count}})}return i}function g(e){var i=0,s,n;_.each(t.rows,function(a,o){s=t.summary.summary.options[a.id];if(s&&s.options){n=s.options[e];if(n){i+=n.count}}});return i}function y(){var e={};_.each(t.columns,function(t){e[t.id]={count:b(t.id)}});return e}function b(e){var i,s,n,a,o=0,r=0,l=0;_.each(t.rows,function(a,h){i=t.summary.summary.options[a.id];if(i&&i.options){s=i.options[e];if(s){n=a.id;if(n==="Detractors"){r=s.count}else if(n==="Promoters"){o=s.count}else{l=s.count}}}});if(r+o+l===0){a=0}else{a=Math.round(100*(o-r)/(r+o+l))}return a}function S(){var e={},i;_.each(t.columns,function(t){i=g(t.id);e[t.id]=i});return e}function v(){var e={},i,s;$.each(t.columns,function(n,a){$.each(t.rows,function(n,o){if(e[o.id]===undefined){e[o.id]={}}e[o.id][a.id]=0;i=t.summary.summary.options[o.id];if(i){s=i.options[a.id];if(s){if(s.row_total!==undefined&&s.row_total>=0){e[o.id][a.id]=s.row_total}else{e[o.id][a.id]=s.count}}}})});return e}function w(e){var i={},s;$.each(t.rows,function(n,a){var o=t.summary.summary.options[a.id];if(o){$.each(o.options,function(t,n){$.each(e,function(e,t){if(i[t.id]===undefined){i[t.id]=0}s=n.options[t.id];if(s){i[t.id]+=s.count}})})}});return i}function C(e){var i={},s,n,a;_.each(t.rows,function(o,r){_.each(t.columns,function(r,l){e=e||r.items;_.each(e,function(e,l){if(i[o.id]===undefined){i[o.id]={}}if(i[o.id][e.id]===undefined){i[o.id][e.id]=0}s=t.summary.summary.options[o.id];if(s){n=s.options[r.id];if(n){a=n.options[e.id];if(a){i[o.id][e.id]+=a.count}}}})})});return i}function M(e){var i={},s,n;$.each(t.rows,function(a,o){n=t.summary.summary.options[o.id];if(n){$.each(n.options,function(t,n){$.each(e,function(e,t){if(i[t.id]===undefined){i[t.id]=0}s=n.options[t.id];if(s){i[t.id]+=s.count}})})}else{$.each(e,function(e,t){i[t.id]=0})}});return i}function T(){var e=[],i=t.sortedRowsList[0];if(i){_.each(i,function(t,i){e[i]=f(t.id)})}return e}function x(){var e=[],i=t.sortedColumnsList[0];if(i){$.each(i,function(t,i){e[t]=g(i.id)})}return e}function D(){if(t.isCompared){return true}else{return t.sortOptions.dimensionType!=="labels"}}function A(){return t.others!==undefined&&t.others[0].options.is_answer_choice}function L(){var e=t.sortedRowsList[0];if(A()){$.each(t.others,function(t,i){e.push(i)})}}function I(){if(A()){$.each(t.others,function(e,i){t.rows.push(i)});t.rows[t.rows.length-1].position=t.rows.length}}function k(){t.rows=_.filter(t.rows,function(e){return t.summary.summary.options[e.id]!==undefined})}function P(){var e={},i,s,n,a,o,r,l;_.each(t.columns,function(h,u){o=l=0;_.each(t.rows,function(e,i){n=t.summary.summary.options[e.id];if(n){a=n.options[h.id];if(a){r=a.count}else{r=0}}else{r=0}s=i+1;l+=s*r;o+=r});if(o===0){i=0}else{i=l/o}e[h.id]=i});return e}function E(){var e={},i,s,n,a,o;$.each(t.rows,function(r,l){i=t.summary.summary.options[l.id];if(i===undefined){e[l.id]=0}else{n=i.options;s=i.row_total;if(n){a=0;if(t.question.naCol!==undefined){var h=n[t.question.naCol.id];if(h&&h.count){a=h.count}}o=H(t.columns,n,{naCount:a,total:s});e[l.id]=o}else{e[l.id]=0}}});return e}function V(){var e={},i,s,n,a;$.each(t.rows,function(o,r){e[r.id]={};i=t.summary.summary.options[r.id];if(i){$.each(t.columns,function(o,l){s=i.options[l.id];if(s===undefined){e[r.id][l.id]=0}else{n=s.options;if(n){a=q(t.columnChoices,n,{naCount:0});e[r.id][l.id]=a}}})}else{SM.log("No data for Row#"+r.id+" on Question#"+t.question.ID)}});return e}function O(){var e={},i,s;$.each(t.rows,function(n,a){e[a.id]={};i=t.summary.summary.options[a.id];if(i){if(t.isMirrored){$.each(t.columnChoices,function(n,o){s=z(t.columns,i,o);e[a.id][o.id]=s})}else{$.each(t.columns,function(n,o){s=z(t.columnChoices,i,o);e[a.id][o.id]=s})}}else{if(t.isMirrored){$.each(t.columnChoices,function(t,i){e[a.id][i.id]=0})}else{$.each(t.columns,function(t,i){e[a.id][i.id]=0})}}});return e}function R(){}function B(e){var t={};$.each(e,function(e,i){if(i.options!=undefined&&i.options.is_na){t[i.id]=0;return}if(i.options===undefined||i.options.weight===undefined){t[i.id]=e+1}else{t[i.id]=i.options.weight}});return t}function N(e){var t={};$.each(e,function(e,i){var s=i.items;$.extend(t,B(s))});return t}function H(e,t,i){return F(e,t,i)}function q(e,t,i){return F(e,t,i)}function z(e,i,s){var n=0,a=0,o=0,r,l;$.each(e,function(e,h){if(h.options!=undefined&&h.options.is_na){return}if(t.isMirrored){r=i.options[h.id];if(r){l=r.options[s.id];if(l){o=l.count;n+=o*t.weights[h.id];a+=o}}}else{r=i.options[s.id];if(r){l=r.options[h.id];if(l){o=l.count;n+=o*t.weights[s.id];a+=o}}}});return Y(n,a)}function F(e,i,s){var n=s.total,a=s.naCount||0,o=false,r=0;s=s||{};if(_.isUndefined(n)){o=true;n=0}$.each(e,function(e,s){var a=0;if(undefined!==i[s.id]){a=i[s.id].count}r+=a*t.weights[s.id];if(o){n+=a}});n-=a;return Y(r,n)}function Y(e,t){var i=0;if(0!==t){i=e/t}i=parseFloat(i.toFixed(2));return i}t._getSortedSummaryData=function(e,i,s,n,a){t.question=e;t.isMirrored=s;t.isCompared=t.question.isCompared();t.rollup=t.question.getRollup();t.display=t.rollup.display;t.summary=t.rollup.getContextSummary();if(a&&a.summary){t.summary=a.summary}t.questionType=t.summary.type;t.questionSubType=t.question.subtype;t.summaryType=t.isCompared?t.summary.summary.type:t.summary.type;t.hasColumnChoices=t.summaryType==="menu_matrix";t.answerStructures=SM.Summarizable.labelAnswerStructures(t.question.getContextAnswerStructure(),t.display,null,t.question);if(a&&a.answerStructures){t.answerStructures=a.answerStructures}t.rows=t.answerStructures.rows;t.columns=t.answerStructures.cols;t.columnChoices=t.hasColumnChoices?r(t.columns):null;t.columnChoicesArray=t.columnChoices?_.values(t.columnChoices):null;t.others=t.answerStructures.other;t.crossedOptions=t.answerStructures.crossedOptions;t.sortOptions=t.rollup.display.getDisplayData().sort_data;t.sortOptionsBS=t.rollup.display.getDisplayData().bs_sort_data;if(D()){I()}if(n){k()}t.rowIds=_.map(t.rows,function(e){return e.id});if(t.columns){t.columnIds=_.map(t.columns,function(e){return e.id})}if(t.hasColumnChoices){t.columnChoiceIds=_.map(t.columnChoices,function(e){return e.id})}if(t.summaryType!=="menu_matrix"){t.responsesCountsByRow=c();t.responsesCountsByColumn=d();t.respondentCountsByColumn=m();t.respondentCountsByRow=p()}if(t.question.isNPS()&&t.question.isCompared()){t.scoresByColumn=y()}t.columnTotals=S();if(t.isCompared||t.summaryType==="menu_matrix"){t.columnTotalsByRow=v()}if(t.hasColumnChoices){t.columnChoiceTotalsByRow=C();t.columnChoiceTotalsByColumnChoice=M(t.columnChoices)}t.numRows=t.rows.length;t.numColumns=t.columns?t.columns.length:0;if(t.numColumns>0){if(t.hasColumnChoices){if(t.isCompared){t.weights=B(t.columns);t.weightedAveragesByRowAndColumnChoice=O()}else{t.weights=N(t.columns);t.weightedAveragesByRowAndColumn=V()}}else{t.weights=B(t.columns);if(t.isCompared){t.weightedAveragesByColumn=P()}else{t.weightedAveragesByColumn=t.weights;t.weightedAveragesByRow=E()}}}t.sortedPositions={rows:[],columns:[],columnChoices:[]};t.sortingBS=false;U(t.sortOptions);G();if(t.question.getRollup().hasBasicStats()){t.sortedPositions={rows:[],columns:[],columnChoices:[]};t.sortingBS=true;U(t.sortOptionsBS);W();t.sortingBS=false}if(!_.isEmpty(t.sortedRowsList)){t.sortedRowTotals=T()}if(!_.isEmpty(t.sortedColumnsList)){t.sortedColumnTotals=x()}if(!D()){L()}return{sortedAnswers:{rowsList:t.sortedRowsList,columnsList:t.sortedColumnsList,columnChoicesList:t.sortedColumnChoicesList},sortedBS:{rowsList:t.sortedRowsListBS,columnsList:t.sortedColumnsListBS,columnChoicesList:t.sortedColumnChoicesListBS},totals:{sortedRowTotals:t.sortedRowTotals,sortedColumnTotals:t.sortedColumnTotals,columnTotalsByRow:t.columnTotalsByRow,columnChoiceTotalsByRow:t.columnChoiceTotalsByRow,columnChoiceTotalsByColumnChoice:t.columnChoiceTotalsByColumnChoice},counts:{responsesCountsByColumn:t.responsesCountsByColumn,responsesCountsByRow:t.responsesCountsByRow,respondentCountsByColumn:t.respondentCountsByColumn,respondentCountsByRow:t.respondentCountsByRow,scoresByColumn:t.scoresByColumn},weightedAverages:{weightedAveragesByRow:t.weightedAveragesByRow,weightedAveragesByColumn:t.weightedAveragesByColumn,weightedAveragesByRowAndColumn:t.weightedAveragesByRowAndColumn,weightedAveragesByRowAndColumnChoice:t.weightedAveragesByRowAndColumnChoice},weights:t.weights}};function U(e){var i,s,n,o,r,l;if(t.summaryType==="menu_matrix"){if(!e){e={}}if(t.question.isCompared()){_.each(t.rows,function(t){if(!e[t.id]){e[t.id]=a}})}else{_.each(t.columns,function(t){if(!e[t.id]){e[t.id]=a}})}s=_.keys(e).sort();_.each(s,function(t){i=e[t];n=i.order;r=i.dimensionID;o=i.dimensionType;Q(n,o,r,t)})}else{if(!e){e=a}n=e.order;o=e.dimensionType;r=e.dimensionID;l=true;if(r){l=t.rollup.combinehideModel.canApplySort(r)}if(l){Q(n,o,r)}else{X()}}}function G(){t.sortedRowsList=[];t.sortedColumnsList=[];t.sortedColumnChoicesList=[];$.each(t.sortedPositions.rows,function(e,i){var s=[];$.each(i,function(e,t){s[t]=l(e)});t.sortedRowsList.push(s)});if(_.isEmpty(t.sortedRowsList)){t.sortedRowsList.push(t.rows)}$.each(t.sortedPositions.columns,function(e,i){var s=[];$.each(i,function(e,t){if(e!=="undefined"){s[t]=h(e)}});t.sortedColumnsList.push(s)});if(_.isEmpty(t.sortedColumnsList)){t.sortedColumnsList.push(t.columns)}$.each(t.sortedPositions.columnChoices,function(e,i){var s=[];$.each(i,function(e,t){s[t]=u(e)});t.sortedColumnChoicesList.push(s)});if(_.isEmpty(t.sortedColumnChoicesList)){t.sortedColumnChoicesList.push(t.columnChoices)}}function W(){t.sortedRowsListBS=[];t.sortedColumnsListBS=[];t.sortedColumnChoicesListBS=[];$.each(t.sortedPositions.rows,function(e,i){var s=[];$.each(i,function(e,t){s[t]=l(e)});t.sortedRowsListBS.push(s)});if(_.isEmpty(t.sortedRowsListBS)){t.sortedRowsListBS.push(t.rows)}$.each(t.sortedPositions.columns,function(e,i){var s=[];$.each(i,function(e,t){if(e!=="undefined"){s[t]=h(e)}});t.sortedColumnsListBS.push(s)});if(_.isEmpty(t.sortedColumnsListBS)){t.sortedColumnsListBS.push(t.columns)}$.each(t.sortedPositions.columnChoices,function(e,i){var s=[];$.each(i,function(e,t){s[t]=u(e)});t.sortedColumnChoicesListBS.push(s)});if(_.isEmpty(t.sortedColumnChoicesListBS)){t.sortedColumnChoicesListBS.push(t.columnChoices)}}function Q(e,t,i,s){if(e===n||e===undefined||e===null){X(i,s)}else{if(t==="averageRating"){j(e)}else if(t==="averageNumber"){Me(e)}else if(t==="totals"){K(e,i,s)}else if(t==="labels"){Z(e,i,s)}else if(t==="responses"){Te(e)}else{J(e,t,i,s)}}}function X(e,i){if(t.sortingBS){if(t.isCompared){if(t.summaryType==="menu_matrix"){se(e)}else{te()}}else{ee()}}else{if(t.isMirrored){if(t.questionType==="menu_matrix"){ie(i)}else if(t.isCompared){if(t.summaryType==="menu_matrix"){se(e)}else{te()}}else{te()}}else{if(t.isCompared){if(t.summaryType==="menu_matrix"){te()}else{ee()}}else{ee()}}}}function j(e){if(t.isMirrored){Ce(e)}else{we(e)}}function K(e,i,s){if(t.questionType==="simple"){if(t.questionSubType==="numerical"){ve(e)}else{ne(e)}}else if(t.questionType==="menu_matrix"){if(t.isMirrored){be(s,e)}else{ge(s,e)}}else{if(t.isCompared){if(t.isMirrored){if(t.summaryType==="menu_matrix"){Se(s,e)}else{_e(e)}}else{if(t.summaryType==="menu_matrix"){ye(s,e)}else{fe(e)}}}else{if(t.isMirrored){_e(e)}else{fe(e)}}}}function Z(e,i,s){if(t.isCompared){if(t.isMirrored||t.sortingBS){if(t.summaryType==="menu_matrix"){me(i,e)}else{pe(e)}}else{if(t.summaryType==="menu_matrix"){pe(e)}else{de(e)}}}else{if(t.isMirrored&&!t.sortingBS){if(t.questionType==="menu_matrix"){me(s,e)}else{pe(e)}}else{de(e)}}}function J(e,i,s,n){if(t.sortingBS){if(t.isCompared){if(i==="row"){le(s,e)}else{ce(n,s,e)}}else{if(i==="column"){ae(s,e)}else{oe(s,e,n)}}}else{if(t.isMirrored){if(t.questionType==="menu_matrix"){if(i==="row"){ue(n,s,e)}else{ie(s)}}else{if(i==="row"){le(s,e)}else if(i==="column"){if(t.isCompared&&t.hasColumnChoices){ce(n,s,e)}else{te()}}else{if(t.isCompared&&t.hasColumnChoices){se(s)}else{le(s,e)}}}}else{if(t.summaryType==="menu_matrix"){if(t.isCompared){he(n,s,e)}else{re(s,e)}}else{if(i==="column"){ae(s,e)}else if(t.isCompared&&i==="row"){ae(s,e)}else if(i==="row"){le(s,e)}else{SM.log("Shouldn't have gotten here...");ee()}}}}}function ee(){var e={};$.each(t.rows,function(t,i){e[i.id]=t});t.sortedPositions.rows.push(e)}function te(){var e={};$.each(t.columns,function(t,i){e[i.id]=t});t.sortedPositions.columns.push(e)}function ie(e){var i,s;$.each(t.columns,function(n,a){if(a.id===e){s={};i=a.items;$.each(i,function(e,t){s[t.id]=e});t.sortedPositions.columnChoices.push(s)}})}function se(e){var i={};$.each(_.values(t.columnChoices),function(e,t){i[t.id]=e});t.sortedPositions.columnChoices.push(i)}function ne(e){var i=[],s;_.map(t.rows,function(e){s=t.summary.summary.options[e.id];if(s){i.push([e.id,s.count])}else{i.push([e.id,0])}});xe(i,e)}function ae(e,i){var s=[],n,a,o,r;a=t.sortingBS?SM.BasicStatsUtils.getStructure():t.columns;o=t.sortingBS?"stats":"options";_.map(t.rows,function(i){n=t.summary.summary.options[i.id];$.each(a,function(t,a){if(a.id===e){if(n){r=n[o][a.id];if(_.isNumber(r)){s.push([i.id,r])}else if(r){s.push([i.id,r.count])}else{s.push([i.id,0])}}else{s.push([i.id,0])}}})});xe(s,i)}function oe(e,i,s){var n=[],a,o,r,l,h,u;$.each(t.rows,function(i,c){r=t.summary.summary.options[c.id];if(r){a=t.sortingBS?SM.BasicStatsUtils.getStructure():t.columns[0].items;o=t.sortingBS?"stats":"options";u=_.pluck(a,"id");if(_.contains(u,e)){l=r.options[s];if(l){$.each(a,function(t,i){if(i.id===e){h=l[o][i.id];if(_.isNumber(h)){n.push([c.id,h])}else if(h){n.push([c.id,h.count])}else{n.push([c.id,0])}}})}else{n.push([c.id,0])}}}else{n.push([c.id,0])}});xe(n,i)}function re(e,i){var s=[],n,a,o,r,l,h;$.each(t.rows,function(i,u){o=t.summary.summary.options[u.id];if(o){$.each(t.columns,function(i,c){n=t.sortingBS?SM.BasicStatsUtils.getStructure():c.items;a=t.sortingBS?"stats":"options";h=_.pluck(n,"id");if(_.contains(h,e)){r=o.options[c.id];if(r){$.each(n,function(t,i){if(i.id===e){l=r[a][i.id];if(_.isNumber(l)){s.push([u.id,l])}else if(l){s.push([u.id,l.count])}else{s.push([u.id,0])}}})}else{s.push([u.id,0])}}})}else{s.push([u.id,0])}});xe(s,i)}function le(e,i){var s=[],n,a,o,r;o=t.sortingBS?SM.BasicStatsUtils.getStructure():t.rows;r=t.sortingBS?"stats":"options";_.map(t.columns,function(i){$.each(o,function(o,l){if(l.id===e){n=t.summary.summary[r][l.id];if(t.sortingBS){if(n&&n.compare){a=n.compare[i.id];if(_.isNumber(a)){s.push([i.id,a])}else{s.push([i.id,0])}}else{s.push([i.id,0])}}else{if(n&&n.options){a=n.options[i.id];if(a){s.push([i.id,a.count])}else{s.push([i.id,0])}}else{s.push([i.id,0])}}}})});De(s,i)}function he(e,i,s){var n=[],a,o,r,l;$.each(t.columns,function(s,h){$.each(t.rows,function(s,u){if(u.id===e){o=t.summary.summary.options[u.id];r=o.options[h.id];if(o&&r){a=h.items;$.each(a,function(e,t){if(t.id===i){l=r.options[t.id];n.push([h.id,l.count])}})}else{n.push([h.id,0])}}})});De(n,s)}function ue(e,i,s){var n=[],a,o,r,l;var u=h(e);a=u.items;$.each(a,function(e,s){$.each(t.rows,function(e,a){if(a.id===i){o=t.summary.summary.options[a.id];if(o){r=o.options[u.id];if(r){l=r.options[s.id];if(l){n.push([s.id,l.count])}else{n.push([s.id,0])}}else{n.push([s.id,0])}}else{n.push([s.id,0])}}})});Ae(n,s)}function ce(e,i,s){var n=l(e),a,o,r,u,c,d,p=[];if(!t.sortingBS){a=h(i);o=a.items}else{a=_.findWhere(SM.BasicStatsUtils.cols,{id:i});o=t.columns[0].items}r=t.sortingBS?"stats":"options";u=t.summary.summary.options[n.id];if(u){c=u[r][a.id];if(c){$.each(o,function(e,i){if(t.sortingBS){d=c.compare[i.id];p.push([i.id,d])}else{d=c.options[i.id];p.push([i.id,d.count])}})}else{$.each(o,function(e,t){p.push([t.id,0])})}}else{$.each(o,function(e,t){p.push([t.id,0])})}Ae(p,s)}function de(e){var i=[];_.map(t.rows,function(e){i.push([e.id,e.text])});xe(i,e)}function pe(e){var i=[];_.map(t.columns,function(e){i.push([e.id,e.text])});De(i,e)}function me(e,i){var s=[],n,a;if(t.isCompared){a=_.values(t.columnChoices)}else{n=h(e);a=n.items}_.map(a,function(e){s.push([e.id,e.text])});Ae(s,i)}function fe(e){var i=[],s;_.map(t.rows,function(e){s=t.summary.summary.options[e.id];if(s){i.push([e.id,s.row_total])}else{i.push([e.id,0])}});xe(i,e)}function ge(e,i){var s=[],n,a;_.map(t.rows,function(i){n=t.summary.summary.options[i.id];if(n){a=n.options[e];if(a){s.push([i.id,a.row_total])}else{s.push([i.id,0])}}else{s.push([i.id,0])}});xe(s,i)}function _e(e){var i=[];_.each(t.columns,function(e){i.push([e.id,t.columnTotals[e.id]])});De(i,e)}function ye(e,i){var s=[];$.each(t.columns,function(i,n){s.push([n.id,t.columnTotalsByRow[e][n.id]])});De(s,i)}function be(e,i){var s=[],n,a;$.each(t.columns,function(t,i){if(i.id===e){n=i.items;a=w(n);$.each(n,function(e,t){s.push([t.id,a[t.id]])})}});Ae(s,i)}function Se(e,i){var s=[];_.each(t.rows,function(i,n){if(i.id===e){_.each(t.columnChoices,function(e,n){s.push([e.id,t.columnChoiceTotalsByRow[i.id][e.id]])})}});Ae(s,i)}function ve(e){var i=[],s;_.map(t.rows,function(e){s=t.summary.summary.options[e.id];if(s){i.push([e.id,s.sum])}else{i.push([e.id,0])}});xe(i,e)}function we(e){var i=[];$.each(t.weightedAveragesByRow,function(e,t){i.push([e,t])});xe(i,e)}function Ce(e){var i=[];$.each(t.columns,function(e,t){i.push([t.id,t.options.weight])});De(i,e)}function Me(e){var i=[],s;_.each(t.rows,function(e){s=t.summary.summary.options[e.id];if(s){i.push([e.id,s.average])}else{i.push([e.id,0])}});xe(i,e)}function Te(e){var i=[],s;_.each(t.rows,function(e){s=t.summary.summary.options[e.id];if(s){i.push([e.id,s.count])}else{i.push([e.id,0])}});xe(i,e)}function xe(e,t){Le("rows",e,t)}function De(e,t){Le("columns",e,t)}function Ae(e,t){Le("columnChoices",e,t)}function Le(e,a,o){var r,l={};if(o===i){r=a.sort(Ie)}else if(o===s){r=a.sort(ke)}else if(o===n){r=a}$.each(r,function(e,t){var i=t[0];l[i]=e});t.sortedPositions[e].push(l)}function Ie(e,t){if(typeof e[1]==="string"){if(e[1].toLowerCase()>t[1].toLowerCase()){return 1}else if(e[1].toLowerCase()<t[1].toLowerCase()){return-1}else{return 0}}else{return e[1]-t[1]}}function ke(e,t){if(typeof e[1]==="string"){if(e[1].toLowerCase()<t[1].toLowerCase()){return 1}else if(e[1].toLowerCase()>t[1].toLowerCase()){return-1}else{return 0}}else{return t[1]-e[1]}}o(e)};SM.NPSSummary=function(e){var t=this,i="rows",s,n,a,o;function r(e){s.init(e);n.init(e);a.init(e);o.init(e)}function l(e){o._buildComposites();t.compositeSummary=a.compositeSummary;t.compositeAnswerStructure=s.compositeAnswerStructure}s=SM.Object.deepExtend(SM.QuestionModel,{init:function(e){this.structure={answers:e.answerStructures};this.answers=e.answerStructures;this.dim=i},canCombineHide:function(){return true},isMultipleChoice:function(){return true},getCombineHideDim:function(){return this.dim},getContextStructure:function(){return this.structure},getContextAnswerStructure:function(){return this.answers}});n=SM.Object.deepExtend(SM.QuestionDisplayModel,{init:function(e){this.question=s;this.rollup=a;this.display={}},getDisplayData:function(){return this.display}});a=SM.Object.deepExtend(SM.QuestionRollupModel,{init:function(e){this.question=s;this.summary=e.rollup;this.display=n;this.type=e.type}});o=SM.Object.deepExtend(SM.QuestionCombineHideModel,{init:function(e){this.question=s;this.rollup=a;if(e.type==="score"){this.buildSettings4Score(e.answerStructures[i])}else{this.buildSettings4Distribution(e.answerStructures[i])}},buildSettings4Score:function(e){var t=_.pluck(e,"id");this.settings={combines:[{id:"Score",title:"",combine:t}],hides:[]}},buildSettings4Distribution:function(e){var t=_.pluck(e,"id");this.settings={combines:[{combine:t.slice(0,7),id:"Detractors",title:Globalize.localize("Detractors (0-6)")},{combine:t.slice(7,9),id:"Passives",title:Globalize.localize("Passives (7-8)")},{combine:t.slice(9,11),id:"Promoters",title:Globalize.localize("Promoters (9-10)")}],hides:[]}}});r(e);l(e)};SM.Sortable={SORTING_ORDERS:{UNSORTED:"unsorted",ASCENDING:"ascending",DESCENDING:"descending"},DIMENSION_TYPES:{LABELS:"labels",RESPONSES:"responses",TOTALS:"totals",AVERAGE_RATING:"averageRating",AVERAGE_NUMBER:"averageNumber",ROW:"row",COLUMN:"column",COLUMN_CHOICE:"columnChoice",DATA_SEGMENT:"dataSegment",MIN:"min",LOWER_QUARTILE:"lowerQuartile",MEDIAN:"median",UPPER_QUARTILE:"upperQuartile",MAX:"max"}};SM.Summarizable={SCALE_TYPE_PERCENT:"percent",_createAsSummarizable:function(e){var t=this,i=e.question,s=i.getRollup(),n=s.display,a=n.getBenchmarkDisplay(),o=n.isTop2ChartType(),r=i.isTop2(),l=!a||r&&o,h=a&&r&&o,u=l?i.getContextAnswerStructure(h):i.getContextStructure().answers,c=l?s.getContextSummary(h):s.summary;t.question=i;t.isCompared=i.isCompared();t.rollup=s;t.display=n;t.summary=c;t.benchmarkSummary=this.question.page.survey.getBenchmarkRollup(t.question.ID);t.questionType=this.summary.type;t.questionSubType=this.question.subtype;t.questionFamily=this.question.family;t.answerStructures=t.labelAnswerStructures(u,t.display,{noLabelByWeight:e.noLabelByWeight,noLabelBySidi:e.noLabelBySidi});t._setAsSummarizable();t._mungeOtherData()},_setAsSummarizable:function(){var e=this;e.rows=e.answerStructures.rows.slice();e.columns=e.answerStructures.cols;e.others=e.answerStructures.other;e.crossedOptions=e.answerStructures.crossedOptions;e.numRows=e.rows.length;e.numColumns=e.columns?e.columns.length:0},_setAsSummarizableNps:function(e){var t=this,i,s;s=t.npsSummary[e];t.summary=s.summary;t.answerStructures=t.labelAnswerStructures(s.answerStructures,t.display);if(t.question.isCompared()){t._setAsSummarizable();i=t.rollup.getSortedSummary({summary:t.summary,answerStructures:t.answerStructures});t.setSortedSummaryAttributes(i);t.scoresByColumn=i.counts.scoresByColumn;t.sortedRowsList=[t.answerStructures["rows"]]}},_setAsSummarizableNpsScoreComparedChart:function(){var e=this,t,i;i=e.npsSummary["distribution"];e.summary=i.summary;e.answerStructures=e.labelAnswerStructures(i.answerStructures,e.display);e._setAsSummarizable();t=e.rollup.getSortedSummary({summary:e.summary,answerStructures:e.answerStructures});e.setSortedSummaryAttributes(t);e.scoresByColumn=t.counts.scoresByColumn;i=e.npsSummary["score"];e.answerStructures=e.labelAnswerStructures(i.answerStructures,e.display);e._setAsSummarizable();e.sortedRowsList=[e.answerStructures["rows"]];e.summary.summary.options={Score:{options:e.scoresByColumn}}},labelAnswerStructures:function(e,t,i,s){var n=this,a,o=t.getDisplayData().mirror,r=t.getDisplayData().show_basic_stats,l=t.getDisplayData().show_sig_diffs,h=i&&i.noLabelByWeight,u=i&&i.noLabelBySidi,c=t.getDisplayData().labels,d,p;s=s||n.question;if(r&&!h){a=s.labelByWeights(e)}else{a=SM.Object.deepCopy(e)}if(c){if(c.rows){_.each(a.rows,function(e){d=c.rows[e.id];if(d){if(!_.isEmpty(d.text)){e.text=d.text}}})}if(c.columns){_.each(a.cols,function(e){d=c.columns[e.id];if(d){if(!_.isEmpty(d.text)){e.text=d.text}}})}if(c.columnChoices){_.each(a.cols,function(e){_.each(e.items,function(e){d=c.columnChoices[e.id];if(d){if(!_.isEmpty(d.text)){e.text=d.text}}})})}if(c.crossedOptions){_.each(a.crossedOptions,function(e){d=c.crossedOptions[e.id];if(d){if(!_.isEmpty(d.text)){e.text=d.text;if(l){e.text+=" (A)"}}}});if(o){_.each(a.cols,function(e){_.each(e.items,function(e){d=c.crossedOptions[e.id];if(d){if(!_.isEmpty(d.text)){e.text=d.text}}})})}else{_.each(a.rows,function(e){_.each(e.items,function(e){d=c.crossedOptions[e.id];if(d){if(!_.isEmpty(d.text)){e.text=d.text}}})})}if(a.cols&&a.crossedOptions&&a.cols[0].id===a.crossedOptions[0].id){_.each(a.cols,function(e){d=c.crossedOptions[e.id];if(d){if(!_.isEmpty(d.text)){e.text=d.text;
}}})}}if(c.others){p=a.other[0];d=c.others[p.id];if(!_.isEmpty(d.text)){p.text=d.text}}}if(!u){n.labelBySidi(a,s,t)}return a},labelBySidi:function(e,t,i){var s=i.getDisplayData().mirror,n=i.getDisplayData().show_sig_diffs;if(n&&t.canSidi()&&t.isCompared()){if(t.isMenuMatrix()){if(s){_.each(e.cols,function(e){_.each(e.items,function(e){if(e.sidiLabel){e.text+=" ("+e.sidiLabel+")"}})})}else{_.each(e.rows,function(e){_.each(e.items,function(e){if(e.sidiLabel){e.text+=" ("+e.sidiLabel+")"}})})}}else{if(e.cols&&e.crossedOptions&&e.cols[0].id===e.crossedOptions[0].id){_.each(e.cols,function(e){if(e.sidiLabel){e.text+=" ("+e.sidiLabel+")"}})}}}return e},_getDisplayOptions:function(){var e=this;e.displayData=e.rollup.display.getDisplayData();e.showTable=e.displayData.show_table;e.showChart=e.displayData.show_chart;e.isMirrored=e.displayData.mirror;e.isStacked=e.displayData.isStacked;e.isWeightedAvg=e.displayData.isWeightedAvg;e.showDataLabels=e.displayData.show_data;e.hideEmptyData=!e.displayData.show_empty_data;e.scaleType=e.displayData.scale_type;e.scaleIsPercent=e.scaleType===e.SCALE_TYPE_PERCENT;e.decimalPlaces=e.scaleIsPercent?e.displayData.dp_percentage:e.displayData.dp_absolute;e.decimalPlacesAbsolute=e.displayData.dp_absolute;e.decimalPlacesPercentage=e.displayData.dp_percentage;e.showBasicStats=e.displayData.show_basic_stats;e.showSidi=e.displayData.show_sig_diffs},_getSortedSummaryData:function(){var e=this,t=e.rollup.getSortedSummary({summary:e.summary,answerStructures:e.answerStructures});e.summaryType=e.isCompared?e.summary.summary.type:e.summary.type;e.hasColumnChoices=e.summaryType==="menu_matrix";if(e.isCompared){e.aggregateOverColumns=e.summaryType==="matrix"&&e.isMirrored}else{e.aggregateOverColumns=e.isMirrored}e.setSortedSummaryAttributes(t)},setSortedSummaryAttributes:function(e){var t=this;t.sortedRowsList=e.sortedAnswers.rowsList;t.sortedColumnsList=e.sortedAnswers.columnsList;t.sortedColumnChoicesList=e.sortedAnswers.columnChoicesList;t.sortedRowsListBS=e.sortedBS.rowsList;t.sortedColumnsListBS=e.sortedBS.columnsList;t.sortedColumnChoicesListBS=e.sortedBS.columnChoicesList;t.responsesCountsByRow=e.counts.responsesCountsByRow;t.responsesCountsByColumn=e.counts.responsesCountsByColumn;t.respondentCountsByColumn=e.counts.respondentCountsByColumn;t.respondentCountsByRow=e.counts.respondentCountsByRow;t.sortedRowTotals=e.totals.sortedRowTotals;t.sortedColumnTotals=e.totals.sortedColumnTotals;t.columnTotalsByRow=e.totals.columnTotalsByRow;t.columnChoiceTotalsByRow=e.totals.columnChoiceTotalsByRow;t.columnChoiceTotalsByColumnChoice=e.totals.columnChoiceTotalsByColumnChoice;t.weightedAveragesByRow=e.weightedAverages.weightedAveragesByRow;t.weightedAveragesByColumn=e.weightedAverages.weightedAveragesByColumn;t.weightedAveragesByRowAndColumn=e.weightedAverages.weightedAveragesByRowAndColumn;t.weightedAveragesByRowAndColumnChoice=e.weightedAverages.weightedAveragesByRowAndColumnChoice;t.weights=e.weights},_getNpsData:function(){var e=this;e.npsSummary=e.rollup.buildNpsSummary()},_mungeOtherData:function(){var e=this;var t=e.others!==undefined&&e.others[0].options.is_answer_choice;if(t){_.each(e.others,function(t,i){e.rows.push(t)})}}};SM.SummarySeriesFactory=SM.Object.extend(SM.Summarizable,SM.Sortable,{buildSimpleSeries:function(e,t,i){var s=this,n=[],a,o,r,l,h,u,c;o=s._summarizeDimension(t,e.summary,function(e,i,n){h=t[i];u=h?h.text:null;c=s.summary.answered;r=s._buildSeriesItemDatum(e,c,u);return r},function(e,i){h=t[e];u=h?h.text:null;r=s._buildSeriesItemDatum(null,0,u);return r},i&&i.isBasicStats?{key:"stats"}:null);a=s._buildSeriesItem(o);n.push(a);return n},_makeWeights:function(e){var t={};_.each(e,function(e){t[e.id]=e.position});return t},buildSimpleWeightedAverageSeries:function(e,t,i){var s=this._makeWeights(t),n=[],a=0,o=0,r,l,h;_.each(e.summary.options,function(e,t){o+=e.count;a+=e.count*s[t]});if(o===0){r=1}else{r=a/o}l=this._buildSeriesItemDatum(r,o,"weightedAverage");h=this._buildSeriesItem([l]);n.push(h);return n},buildSimpleSeriesFromMatrixSummary:function(){var e=this,t=[],i,s,n,a,o,r,l,h,u;o=e.rows[0];r=e.summary.summary.options[o.id];a=e.sortedColumnsList[0];s=e._summarizeDimension(a,r,function(t,i,s){l=a[i];h=l?l.text:null;u=r.row_total;n=e._buildSeriesItemDatum(t,u,h);return n},function(t,i){l=a[t];h=l?l.text:null;n=e._buildSeriesItemDatum(null,0,h);return n});i=e._buildSeriesItem(s);t.push(i);return t},buildSimpleSeriesFromComparedMatrixSummary:function(){var e=this,t=[],i,s,n,a,o,r,l,h;a=e.columns[0];h=e.summary.answered;s=_.map(e.rows,function(t,i){o=e.summary.summary.options[t.id];l=t.text;if(o){r=o.options[a.id];if(r){n=e._buildSeriesItemDatum(r,h,l)}else{n=e._buildSeriesItemDatum(null,0,l)}}else{n=e._buildSeriesItemDatum(null,0,l)}return n});i=e._buildSeriesItem(s);t.push(i);return t},buildSimpleSeriesFromMenuMatrixSummary:function(e){var t=this,i=[],s,n,a,o,r,l,h,u,c,d;r=t.rows[0];l=t.summary.summary.options[r.id];h=l.options[e];o=t.sortedColumnChoicesList[0];n=t._summarizeDimension(o,h,function(e,i,s){u=o[i];c=u?u.text:null;d=h.row_total;a=t._buildSeriesItemDatum(e,d,c);return a},function(e,i,s){u=o[i];c=u?u.text:null;a=t._buildSeriesItemDatum(null,0,c);return a});s=t._buildSeriesItem(n);i.push(s);return i},buildSimpleStackedSeries:function(e,t){var i=this,s,n,a,o,r,l,h;s=i._summarizeDimension(t,e.summary,function(e,s,a){o=t[s];r=o?o.text:null;l=i.summary.answered;n=i._buildSeriesItemDatum(e,l,r);return n},function(e,s){o=t[e];r=o.text;n=i._buildSeriesItemDatum(null,0,r);return n});a=_.map(s,function(e,s){r=e.name;h=t.length;return i._buildSeriesItem([e],{name:r,index:s,numSeries:h})});return a},buildTop2StackedSeries:function(e){var t=this,i=e.isCompared?t.rollup.top2compositeSummary:t.summary,s=t.rollup.summary.summary.answered_subtotals,n=t.summary.summary.answered_subtotals,a=t.question.getBenchmarkRollup(),o=t.answerStructures,r=e.isCompared?o.cols:o.rows,l,h,u,c=[],d=[],p=[],m,f,g,y=t.rollup.answeredCount,b=t.summary.answered,S=a.getNumResponses(),v=a.getContextDistributionValues(),w=[],C,M,T,x=0,D,A,L,I,k=t.question.isTop2Ascending(),P=Globalize.localize("Your Top 2 Box Score"),E=a.getSegmentName()+" "+Globalize.localize("Top 2 Box Score");e=e||{};for(var V=0;V<r.length;V++){w[V]=0}if(e.isCompared){_.each(r,function(e,t){_.each(i.summary.options,function(i,s){_.each(i.options,function(i,s){if(s===e.id){w[t]+=i.count}})})});_.each(w,function(i,n){var a=t.summary.crossed_rows[n],o=s[a],r=o===0?0:i*100/o,l=y===0?0:o*100/y,h=i===0,u,m=P;c.push({__options:{disableDataLabels:h},y:r,absoluteY:i,percentageY:r,name:m});p.push({y:l,absoluteY:o,percentageY:l,name:m});if(e.isTable){T=o;u=o===0?0:T*100/b}else{T=o-i;u=o===0||i===0?0:T*100/o}d.push({__options:{disableDataLabels:true},y:u,absoluteY:T,percentageY:u,name:"rest"})})}else{l=t._summarizeDimension(r,i.summary,function(e,t,i){w[t]+=e.count;return{}},function(e,t){return{}});_.each(w,function(i,s){var n=y===0?0:i*100/y,a=y===0?0:(y-i)*100/y,o=e.isCompared?r[s].text:P,l=i===0;if(s===0){t.top2pct=n}c.push({__options:{decimalPlaces:1,disableDataLabels:l},y:n,absoluteY:i,percentageY:n,name:o});d.push({__options:{disableDataLabels:true},y:a,absoluteY:y-i,percentageY:a,name:"rest"})})}x=v.length===0?0:0 in v?v[0].count:0;g={y:0,absoluteY:0,percentageY:0,name:"blank"};D=S===0?0:x*100/S;A=S===0?0:(S-x)*100/S;t.bmTop2pct=D;m={y:D,absoluteY:x,percentageY:D,name:"BMtop2"};f={__options:{disableDataLabels:true},y:A,absoluteY:S-x,percentageY:A,name:"BMrest"};var O={y:100,absoluteY:S,percentageY:100};if(e.isTable){h=[];if(e.isCompared){if(e.distribution){u=t._buildSeriesItem([m],{dimension:{text:a.getSegmentName(),type:"responses"},index:0,numSeries:1,template:"benchmark-matrix-table-response-cell",name:"name of segment"});h.push(u);u=t._buildSeriesItem([O],{dimension:{text:Globalize.localize("Total"),type:"responses"},index:0,numSeries:1,template:"benchmark-matrix-table-response-cell",name:"sub totals"});h.push(u)}else{u=t._buildSeriesItem(c,{dimension:{text:Globalize.localize("Your Top 2 Box Score"),type:"row"},index:0,numSeries:c.length,template:"benchmark-matrix-table-response-cell",name:P});h.push(u);u=t._buildSeriesItem(p,{dimension:{text:Globalize.localize("Total"),type:"row"},index:0,numSeries:1,template:"benchmark-matrix-table-response-cell",name:"sub totals"});h.push(u)}}else{u=t._buildSeriesItem(c,{dimension:{text:Globalize.localize("Your Responses"),dimension:"row"},index:0,numSeries:c.length,template:"benchmark-matrix-table-response-cell",name:P});h.push(u);u=t._buildSeriesItem([m],{dimension:{text:a.getSegmentName(),dimension:"row"},index:0,numSeries:1,sampleSize:a.getSampleSize(),template:"benchmark-matrix-table-response-cell",name:"name of segment"});h.push(u)}}else{c.push(g);d.push(f);var R=[];for(V=0;V<w.length;V++){R.push(g)}R.push(m);h=[t._buildSeriesItem(c,{name:P,index:0,numSeries:c.length}),t._buildSeriesItem(R,{name:E,index:1,numSeries:R.length}),t._buildSeriesItem(d,{name:"rest",hideLegendItem:true,index:2,numSeries:d.length,disableHover:true})]}return h},buildNumericalSeries:function(e){var t=this,i=[],s,n,a,o,r,l,h,u,c;e=e||{};n=t.sortedRowsList[0];o=_.map(n,function(e){a=t.summary.summary.options[e.id];h=a?a.average:0;return{absoluteY:Globalize.format(h,"n0")}});s=t._buildTableSeriesItem(o,e.averageSeriesName,"averageNumber");i.push(s);r=_.map(n,function(e){a=t.summary.summary.options[e.id];u=a?a.sum:0;return{absoluteY:Globalize.format(u,"n0")}});s=t._buildTableSeriesItem(r,e.totalSeriesName,"totals");i.push(s);l=_.map(n,function(e){a=t.summary.summary.options[e.id];c=a?a.count:0;return{absoluteY:Globalize.format(c,"n0")}});s=t._buildTableSeriesItem(l,e.responsesSeriesName,"responses");i.push(s);return i},buildMatrixSeries:function(e){var t=this,i,s=[],n,a,o,r,l,h,u,c,d,p;e=e||{};i=e.columns||t.columns;l=e.isBasicStats?t.sortedRowsListBS[0]:t.sortedRowsList[0];_.each(i,function(i,d){a=t._summarizeDimension(l,t.summary.summary,function(s,n){if(e.isBasicStats&&s.stats){h=s.stats[i.id];o=t._buildSeriesItemDatum(h,0,null,{})}else if(s.options){u=l[n];h=s.options[i.id];p=t.respondentCountsByRow[u.id];r={};if(t._seriesDatumHasComments(u)){r.commentData=t._buildCommentData({option:u,crossedOption:i,crossedOptionSummary:h,matrixCross:t._isMatrixCross(t.summary)})}o=t._buildSeriesItemDatum(h,p,null,r)}else{o=t._buildSeriesItemDatum(null,0)}return o},function(e,i){u=l[e];c=u.text;o=t._buildSeriesItemDatum(null,0);return o});n=t._buildSeriesItem(a,{dimension:i,index:d,numSeries:t.numColumns});s.push(n)});if(e.includeTotal){d=_.map(l,function(e){var i=t.respondentCountsByRow[e.id];return{absoluteY:Globalize.format(i,"n0")}});n=t._buildTableSeriesItem(d,e.totalSeriesName,"totals");s.push(n)}if(e.includeAverage){var m=t._calculateAverage(l,function(e,i){return t.weightedAveragesByRow[e.id]});n=t._buildTableSeriesItem(m,e.averageSeriesName,"averageRating");s.push(n)}return s},buildMirroredMatrixSeries:function(e){var t=this,i,s,n=[],a,o,r,l,h,u,c,d,p,m,f;e=e||{};d=e.isBasicStats?t.sortedColumnsListBS[0]:t.sortedColumnsList[0];i=e.rows||t.rows;s=e.isBasicStats?"stats":"options";_.each(i,function(i,r){p=t.summary.summary[s][i.id];h=t._summarizeDimension(d,p,function(e,s){c={};m=d[s];f=t.respondentCountsByColumn[m.id];if(t.question.randomAssignmentOption!==undefined){f=t.respondentCountsByRow[i.id]}if(t._seriesDatumHasComments(i)){var n="0";if(t.question.randomAssignmentOption!==undefined){n=t.question.randomAssignmentOption.toString()}c.commentData=t._buildCommentData({option:i,crossedOption:m,crossedOptionSummary:e,matrixCross:t._isMatrixCross(t.summary),variationID:n})}u=t._buildSeriesItemDatum(e,f,null,c);return u},function(e,i){m=d[e];u=t._buildSeriesItemDatum(null,0);return u},e.isBasicStats?{key:"compare"}:null);o={dimension:i,index:r,numSeries:t.numRows};if(t.question.hasCommentsPerRow()){var l=p?p.row_other:0;o.hasCommentsPerRow=true;o.numComments=Globalize.format(l,"n0")}a=t._buildSeriesItem(h,o);n.push(a)});if(e.includeTotal){r=_.map(d,function(e){var i=t.responsesCountsByColumn[e.id];return{absoluteY:Globalize.format(i,"n0")}});a=t._buildTableSeriesItem(r,e.totalSeriesName,"totals");n.push(a)}if(e.includeScore){l=_.map(d,function(e){var i=t.scoresByColumn[e.id];return{absoluteY:Globalize.format(i.count,"n0")}});a=t._buildTableSeriesItem(l,e.scoreSeriesName,"score");n.push(a)}if(e.includeAverage){var g=t._calculateAverage(d,function(e){return t.weightedAveragesByColumn[e.id]});a=t._buildTableSeriesItem(g,e.averageSeriesName,"averageRating");n.push(a)}return n},buildMenuMatrixSeries:function(e,t,i,s,n){var a=this,o=[],r,l,h,u,c,d,p,m,f,g,y,b=n&&n.isBasicStats?"stats":"options",S;n=n||{};S=a.summary.summary;p=i.length;if(a.isMirrored&&!a.isBasicStats){f=a.sortedColumnChoicesList[t];_.each(a.rows,function(t,i){u=S.options[t.id];if(u){c=u.options[e.id];if(c){l=a._summarizeDimension(f,c,function(e,t,i){g=s[i];h=a._buildSeriesItemDatum(e,g);return h},function(e,t){h=a._buildSeriesItemDatum(null,0);return h})}else{l=a._dataForUnsummarizedDimension(f.length)}}else{l=a._dataForUnsummarizedDimension(f.length)}r=a._buildSeriesItem(l,{dimension:t,index:i,numSeries:a.numRows});o.push(r)});if(n.includeTotal){y=_.map(f,function(e){g=a.columnChoiceTotalsByColumnChoice[e.id];return{absoluteY:Globalize.format(g,"n0")}});r=a._buildTableSeriesItem(y,n.totalSeriesName,"totals");o.push(r)}}else{m=n.isBasicStats?a.sortedRowsListBS[t]:a.sortedRowsList[e.position-1];_.each(i,function(t,i){l=a._summarizeDimension(m,S,function(i){c=i.options[e.id];if(c){d=c[b][t.id];g=c.row_total;h=a._buildSeriesItemDatum(d,g)}else{h=a._buildSeriesItemDatum(null,0)}return h},function(e,t){h=a._buildSeriesItemDatum(null,0);return h});r=a._buildSeriesItem(l,{dimension:t,index:i,numSeries:p});o.push(r)});if(n.includeTotal){y=_.map(m,function(t){g=a.columnTotalsByRow[t.id][e.id];return{absoluteY:Globalize.format(g,"n0")}});r=a._buildTableSeriesItem(y,n.totalSeriesName,"totals");o.push(r)}}return o},buildComparedMatrixSeries:function(e,t,i,s){var n=this,a=[],o,r,l,h,u,c,d,p,m,f,g,y,b,S,v;s=s||{};m=t.length;u=n.summary.summary.options[e.id];if(n.isMirrored||n.isBasicStats){g=s.isBasicStats?n.sortedColumnChoicesListBS[e.position-1]:n.sortedColumnChoicesList[e.position-1];h=s.columns||n.columns;o=s.isBasicStats?"stats":"options";_.each(h,function(e,h){if(u){c=u[o][e.id];if(c){r=n._summarizeDimension(g,c,function(e,t,s){b=i[s];l=n._buildSeriesItemDatum(e,b);return l},null,s.isBasicStats?{key:"compare"}:null)}else{r=_.map(t,function(e){l=n._buildSeriesItemDatum(null,0);return l})}}else{r=_.compact(_.map(t,function(e){if(e.id){l=n._buildSeriesItemDatum(null,0);return l}}))}p=n._buildSeriesItem(r,{dimension:e,index:h,numSeries:n.numColumns});a.push(p)});if(s.includeTotal){y=_.map(g,function(t){b=n.columnChoiceTotalsByRow[e.id][t.id];return{absoluteY:Globalize.format(b,"n0")}});p=n._buildTableSeriesItem(y,s.totalSeriesName,"totals");a.push(p)}if(s.includeAverage){S=n._calculateAverage(g,function(t){return n.weightedAveragesByRowAndColumnChoice[e.id][t.id]});p=n._buildTableSeriesItem(S,s.averageSeriesName,"averageRating");a.push(p)}}else{f=n.sortedColumnsList[e.position-1];_.each(t,function(e,t){r=n._summarizeDimension(f,u,function(t){v=e.id||e.variable_id;d=t.options[v];b=t.row_total;l=n._buildSeriesItemDatum(d,b);return l},function(e,t){l=n._buildSeriesItemDatum(null,0);return l});p=n._buildSeriesItem(r,{dimension:e,index:t,numSeries:m});a.push(p)});if(s.includeTotal){y=_.map(f,function(t){b=n.columnTotalsByRow[e.id][t.id];return{absoluteY:Globalize.format(b,"n0")}});p=n._buildTableSeriesItem(y,s.totalSeriesName,"totals");a.push(p)}if(s.includeAverage){S=n._calculateAverage(f,function(t){return n.weightedAveragesByRowAndColumnChoice[e.id][t.id]});p=n._buildTableSeriesItem(S,s.averageSeriesName,"averageRating");a.push(p)}}return a},buildComparedMatrixSeriesNumericalBasicStats:function(e,t,i){var s=this,n=[],a,o,r,l,h,u,c,d,p,m,f,g,y;d=i.length;l=s.summary.summary.stats[e.id];_.each(t,function(e,t){if(l){h=l[e.id];if(h){o=s._summarizeDimension(i,h,function(e,t,i){r=s._buildSeriesItemDatum(e,1);return r},null,{key:"compare"})}else{o=_.map(i,function(e){r=s._buildSeriesItemDatum(null,0);return r})}}else{o=_.compact(_.map(i,function(e){if(e.id){r=s._buildSeriesItemDatum(null,0);return r}}))}c=s._buildSeriesItem(o,{dimension:e,index:t,numSeries:s.numColumns});n.push(c)});return n},_buildBenchmarkDistributionTableSeries:function(e,t){var i=[],s,n=e.getContextDistributionValues(),a=e.getNumResponses(),o=t.isTop2?"table-response-cell":"benchmark-table-percentage-cell",r=t.isTop2?"table-response-cell":"benchmark-table-response-cell";_.each(n,function(e,s){var n=[{absoluteY:e.count,percentageY:e.percent*100,name:s}];i.push({name:s,data:n,__options:{dimensionType:t.isTop2?SM.Sortable.DIMENSION_TYPES.RESPONSES:"percentage",template:o}})});s=[{y:a,absoluteY:a,percentageY:100,name:5}];i.push({name:"Total",data:s,__options:{dimensionType:SM.Sortable.DIMENSION_TYPES.RESPONSES,template:r}});return i},_buildBenchmarkNPSDistributionTableSeries:function(e,t){var i=[],s=e.getNpsDistributionValues(),n=this.getNPSScore();_.each(s,function(e,t){var s=[{absoluteY:e.responses,percentageY:e.percentage,name:t}];i.push({name:t,data:s,__options:{dimensionType:"averageRating",template:"benchmark-table-response-cell"}})});i.push({name:"Net promo",data:[{absoluteY:n,percentageY:n,name:"Nt prom"}],__options:{dimensionType:"averageRating",template:"benchmark-table-response-cell"}});return i},_buildBenchmarkQuartileTableSeries:function(e,t){var i=[],s,n=e.getQuartileValuesArray(),a=e.getNumResponses();_.each(n,function(e,n){s=[{y:e,absoluteY:e,percentageY:e,value:e,name:t.names[n]}];i.push({name:"Benchmark",data:s,__options:{dimensionType:"averageRating",template:"benchmark-table-response-cell"}})});if(!t.nps&&t.includeTotal){s=[{y:a,absoluteY:a,percentageY:a,name:5}];i.push({name:"Total",data:s,__options:{dimensionType:SM.Sortable.DIMENSION_TYPES.RESPONSES,template:"benchmark-table-response-cell"}})}return i},buildComparedAverageSeries:function(e){var t=this.question,i=t.compareStructure.answers.crossedOptions,s=this.question.getRollup(),n=s.summary.summary.options,a=s.summary.summary.answered_subtotals,o=0,r=[],l=[];if(t.isNPS()){n=this.npsSummary.distribution.summary.summary.options;_.each(i,function(e,t){var i=e.id,s=n.Detractors?n.Detractors.options||{}:{},a=s[i]?s[i].count||0:0,o=n.Passives?n.Passives.options||{}:{},l=o[i]?o[i].count||0:0,h=n.Promoters?n.Promoters.options||{}:{},u=h[i]?h[i].count||0:0,c;if(a+l+u>0){c=100*(u-a)/(a+l+u);r.push({y:c,absoluteY:c,percentageY:c,value:c,name:e.text})}});l.push({name:"User Scores",data:r,__options:{dimensionType:SM.Sortable.DIMENSION_TYPES.AVERAGE,template:"benchmark-table-response-cell"}});return l}_.each(i,function(e,i){var s=e.id,o=0,l=0;_.each(t.answers,function(e,t){var i=e.position;if(n[t]&&n[t].options[s]){o+=n[t].options[s].count*i}});if(a[s]){l=o/a[s]}r.push({y:l,absoluteY:l,percentageY:l,value:l,name:e.text})});l.push({name:"Weighted Averages",data:r,__options:{dimensionType:SM.Sortable.DIMENSION_TYPES.AVERAGE,template:"benchmark-table-response-cell"}});return l},NPS_MINIMUM:-100,NPS_MAXIMUM:100,BOXPLOT_LINE_WIDTH:4,BOXPLOT_MEDIAN_WIDTH:2,BOXPLOT_MEDIAN_COLOR:"#FFFFFF",BOXPLOT_USER_VALUE_LINE_WIDTH:2,_buildBenchmarkQuartileChartSeries:function(e,t){var i=e.getQuartileValues(),s,n,a=[],o=[],r,l,h=t.colors[0],u=SM.Highcharts.DEFAULT_BENCHMARK_COLORS.slice(1),c=this.BOXPLOT_LINE_WIDTH,d;if(this.question.isCompared()){n=this.buildComparedAverageSeries();_.each(n[0].data,function(e,t){a.push({name:e.name,color:u[t%u.length],lineWidth:this.BOXPLOT_USER_VALUE_LINE_WIDTH,data:[e],__options:{dimensionType:"userAverage"}})})}else{if(this.question.isNPS()){s=this.getNPSScore();d=Globalize.localize("Your Net Promoter&#174; Score")}else{s=e.getResponseMean(this.question.ID);if(this.question.is_tmbc){d=Globalize.localize("Your average")}else{d=Globalize.localize("Your score")}}a.push({name:d,color:u[0],lineWidth:this.BOXPLOT_USER_VALUE_LINE_WIDTH,data:[{y:s,absoluteY:s,percentageY:s,name:d}]})}_.each(i,function(e,i){o.push({y:e,absoluteY:e,percentageY:e,name:t.names[i]})});o=[[],[],o,[]];a.push({name:e.getSegmentName(),pointWidth:58,data:o,tooltip:{headerFormat:"<em>Experiment No {point.key}</em><br/>"},color:h,fillColor:h,stemColor:h,stemWidth:this.BOXPLOT_LINE_WIDTH,whiskerColor:h,whiskerWidth:this.BOXPLOT_LINE_WIDTH,medianColor:this.BOXPLOT_MEDIAN_COLOR,medianWidth:this.BOXPLOT_MEDIAN_WIDTH,__options:{dimensionType:"benchmark"}});return a},getNPSScore:function(){return this.npsSummary.score.summary.summary.options.Score.count},isNPSScoreValid:function(){if(this.question.isCompared()){var e=this.npsSummary.distribution.summary.summary.options;if(!e){return false}var t=e.Detractors?e.Detractors.row_total||0:0;var i=e.Passives?e.Passives.row_total||0:0;var s=e.Promoters?e.Promoters.row_total||0:0;return t+i+s!==0}return!this.npsSummary.score.summary.summary.options.Score.noResponses},buildSimpleBenchmarkSeries:function(e){var t=this.question.page.survey.getBenchmarkRollup(this.question.ID);e.names=[Globalize.localize("Minimum"),Globalize.localize("Lower Quartile"),Globalize.localize("Median"),Globalize.localize("Upper Quartile"),Globalize.localize("Maximum")];if(e.tableOutput){if(e.distribution){if(this.question.isNPS()){return this._buildBenchmarkNPSDistributionTableSeries(t,e)}if(e.isTop2&&e.isCompared){return this.buildTop2StackedSeries(e)}return this._buildBenchmarkDistributionTableSeries(t,e)}return this._buildBenchmarkQuartileTableSeries(t,e)}else{return this._buildBenchmarkQuartileChartSeries(t,e)}},_customizeColors:function(e,t){_.each(e,function(e,i){e.color=t[i]})},buildBenchmarkMatrixSeries:function(e){var t=this,i=[],s,n,a,o,r,l,h,u,c,d,p=t.question.isNPS(),m,f=!_.isUndefined(t.answerStructures.other),g=t.displayData.benchmark_chart_type===t.display.DISPLAY_VALUES.top2_vbar||t.displayData.benchmark_chart_type===t.display.DISPLAY_VALUES.top2_hbar||t.displayData.benchmark_chart_type===t.display.DISPLAY_VALUES.top2_donut,y;e=e||{};m=t.summary.summary;if(t.question.compositeAnswerStructure&&!(t.question.isTop2()&&g)){r=t.question.structure.answers.rows;m=t.rollup.summary.summary}else if(p){r=t.answerStructures.rows}else{r=t.sortedRowsList[0]}if(!e.ignoreUserData){c=0;_.each(m.options,function(e,i){var s,n;if(f){n=_.find(t.answerStructures.other,function(e){if(e.id===i){return true}});s=!!n}if(!s){c=c+e.count}});n=t._summarizeDimension(r,m,function(e,i){h=r[i];if(e){o={};a=t._buildSeriesItemDatum(e,c,null,o)}else{a=t._buildSeriesItemDatum(null,0)}return a},function(e,i){h=r[e];u=h.text;a=t._buildSeriesItemDatum(null,0);return a});if(p){t._customizeColors(n,SM.Highcharts.NPS_DISTRIBUTION_COLORS)}d=SM.Object.extend({},r[0]);d.text=Globalize.localize("Your Responses");s=t._buildSeriesItem(n,{dimension:d,index:0,numSeries:2,template:"benchmark-matrix-table-response-cell"});i.push(s);if(e.includeTotal){var b;b=_.map(r,function(e){var i=t.respondentCountsByRow[e.id];return{absoluteY:Globalize.format(i,"n0")}});s=t._buildTableSeriesItem(b,e.totalSeriesName,"totals");i.push(s)}if(e.includeAverage){var S=t._calculateAverage(r,function(e,i){return t.weightedAveragesByRow[e.id]});s=t._buildTableSeriesItem(S,e.averageSeriesName,"averageRating");i.push(s)}}y=g?t.benchmarkSummary.getContextDistributionValues():t.benchmarkSummary.getDistributionValues();n=t._summarizeBenchmarkRow(r,y);if(p){t._customizeColors(n,SM.Highcharts.NPS_BENCHMARK_DISTRIBUTION_COLORS)}s=t._buildSeriesItem(n,{dimension:{text:t.benchmarkSummary.getSegmentName()},index:1,numSeries:2,template:"benchmark-matrix-table-percent-cell",name:t.benchmarkSummary.getSegmentName()});s.__options.sampleSize=Globalize.format(t.benchmarkSummary.getSampleSize(),"n0");i.push(s);return i},buildComparedBenchmarkMatrixSeries:function(e){var t=this.buildMirroredMatrixSeries(e),i;e.ignoreUserdata=true;i=this.buildBenchmarkMatrixSeries(e);_.each(i[1].data,function(e,i){t[i].data.push(e)});return t},_dataForUnsummarizedDimension:function(e){var t=this,i=[],s;_.times(e,function(e){s=t._buildSeriesItemDatum(null,0);i.push(s)});return i},_summarizeDimension:function(e,t,i,s,n){var a,o,r=[],l=n&&n.key?n.key:"options",h=this.question.hasRandomAssignment(),u=this.question.randomAssignmentOption;_.each(e,function(e,n){if(t&&t[l]){a=t[l][e.id];if(!a&&h){a=t[l][u]}if(a||_.isNumber(a)){o=i(a,n,e.id)}else{if(s){o=s(n,e.id)}else{o=[0,0]}}}else{if(s){o=s(n,e.id)}else{o=[0,0]}}r.push(o)});return r},_summarizeBenchmarkRow:function(e,t){var i=[];if(_.isEmpty(t)){_.each(e,function(e,t){i.push({_options:{},absoluteY:0,name:null,percentageY:0,y:0})})}else{_.each(e,function(e,s){var n=_.find(t,function(t){if(e.id===t.option_ids[e.question_id]){return t}});if(!n){n={count:0,percent:0}}i.push({_options:{},absoluteY:n.count,name:null,percentageY:n.percent*100,y:n.percent*100})})}return i},_buildSeriesItemDatum:function(e,t,i,s){var n=this,a,o,r,l;if(_.isNumber(e)){o=e;r=null}else if(_.isEmpty(e)){o=0;if(n.get("isBasicStats")||n.isBasicStats){r=null}else{r=0}}else{l=n.questionSubType==="numerical"&&!n.isCompared;a=l?"average":"count";o=e[a];if(!l){r=n._calculatePercentage(o,t)}}return{y:n.scaleIsPercent?r:o,absoluteY:o,percentageY:r,name:i,__options:s}},_seriesDatumHasComments:function(e){var t=this;return t.isCompared&&e.is_openended&&!e.apply_all_rows},_buildCommentData:function(e){var t=this,i=e.option,s=e.crossedOption,n=e.crossedOptionSummary,a=e.matrixCross,o=n.count||0,r=i.id,l=s.id,h=e.variationID;return{optionID:r,crossedOptionID:l,matrixCross:a,numComments:o,variationID:h}},_isMatrixCross:function(e){return e.crossed_cols?"1":"0"},_calculatePercentage:function(e,t){if(t===undefined||t===0||e===undefined){return 0}else{return e/t*100}},_buildSeriesItem:function(e,t){var i=this,s,n,a,o;s={name:null,data:e,__options:{}};if(!_.isEmpty(t)){n=t.dimension;if(n){s.name=n.text;s.__options.labelText=n.text;s.__options.labelHTML=n.mediaHTML;s.__options.dimensionType=i._getDimensionType(n);s.__options.dimensionID=n.id}if(t.name!==undefined){s.name=t.name}s.__options.hasCommentsPerRow=t.hasCommentsPerRow;s.__options.numComments=t.numComments;a=t.index;o=t.numSeries;if(a!==undefined&&o!==undefined){s.index=i._seriesIndex(a,o);s.legendIndex=i._legendIndex(a,o)}if(t.template){s.__options.template=t.template}if(t.hideLegendItem){s.__options.hideLegendItem=t.hideLegendItem}if(t.disableHover){s.states={hover:{enabled:false}}}if(t.sampleSize){s.__options.sampleSize=t.sampleSize}}s.__options.scaleType=i.scaleType;s.__options.decimalPlaces=i.decimalPlaces;s.__options.showDataLabels=i.displayData.show_data;s.__options.isLegend=i.displayData.isLegend;if(i.questionSubType==="net_promoter_score"&&i.nps_depth==="score"){s.__options.decimalPlaces=0}return s},_seriesIndex:function(e,t){var i=this,s=i.highchartsChartType==="column"&&!i.isStacked;return s?e:t-e},_legendIndex:function(e,t){var i=false;return i?t-e:e},_getDimensionType:function(e){if(e.type==="column_choice"){return"columnChoice"}else{return e.type}},_buildTableSeriesItem:function(e,t,i){return{name:t,data:e,__options:{labelText:t,dimensionType:i}}},_calculateAverage:function(e,t){var i,s,n;n=_.map(e,function(e,n){i=t(e,n);s=Globalize.format(i,"n2");return{absoluteY:s}});return n}});SM.CompositeSummaryBuilder={buildCompositeSummary:function(e,t){var i=this,s=i.summary,n=s.summary;if(!e){if(t){i.top2compositeSummary=null}else{i.compositeSummary=null}return}if(s.type==="compare"&&n.type==="matrix"){i.buildCompositeSummaryComparedMatrix(s,e,t)}else if(s.type==="matrix"){i.buildCompositeSummaryMatrix(s,e,t)}else if(s.type==="simple"){i.buildCompositeSummarySimple(s,e,t)}},buildCompositeSummarySimple:function(e,t,i){var s=this,n,a,o;o=SM.Object.deepCopy(e);a=e.summary.options;n=s._buildCompositeOptions(a,t);o.summary.options=n;if(!s.question.isMultipleChoice()){o.answered=s._calcAnswered(n)}if(i){s.top2compositeSummary=o}else{s.compositeSummary=o}},_calcAnswered:function(e){var t=this,i=0;_.each(e,function(e,s){if(_.isArray(e)){return}if(s==="other_option"){return}if(t.question.isOther(s)&&!t.question.otherIsAnAnswerChoice()){return}if(e.count){i+=e.count}else if(e.options){_.each(e.options,function(e,t){i+=e.count})}});return i},_buildScoreByDistribution:function(e){var t=this,i={Score:{count:0}},s,n=0,a=0,o=0;_.each(e,function(e,t){if(t==="Detractors"){a=e.count}else if(t==="Promoters"){n=e.count}else{o=e.count}});if(a+n+o===0){s=0;i.Score.noResponses=true}else{s=Math.round(100*(n-a)/(a+n+o))}i.Score.count=s;return i},_buildCompositeOptions:function(e,t){var i=this,s,n,a,o;if(i.type==="score"){return i._buildScoreByDistribution(e)}n={};_.each(e,function(e,i){if(t[i]===null){return}if(i==="other_option"){return}if(_.isUndefined(t[i])){n[i]=[];n[i].push(e)}else{o=t[i].id;if(!n[o]){n[o]=[]}n[o].push(e)}});s={};_.each(n,function(e,t){a=i.combineSummaries(e);s[t]=a});return s},_calcColTotals:function(e,t,i){var s=this,n=false,a={},o=[];_.each(e,function(e,t){if(!e.options){return}if(t==="other_option"){return}_.each(e.options,function(e,t){if(e.count){if(!a[t]){a[t]=0}a[t]+=e.count}else if(e.options){n=true;_.each(e.options,function(e,t){if(!a[t]){a[t]=0}a[t]+=e.count})}})});_.each(t,function(e){if(!a[e]){a[e]=0}o.push(a[e])});if(!n){e.col_totals=o}if(i){i.answered_subtotals=a}},_calcOptionStats:function(e){var t=0,i=0,s;_.each(e.options,function(e,s){if(e.count){t+=e.count;i=Math.max(i,e.count)}else if(e.options){_.each(e.options,function(e,i){t+=e.count})}});e.row_max=i;e.row_total=t;return t===0},buildCompositeSummaryMatrix:function(e,t,i){var s=this,n,a,o;o=SM.Object.deepCopy(e);var r=e.summary.options;var l=o.summary.options;_.each(r,function(e,i){a=e.options;if(!a){return}n=s._buildCompositeOptions(a,t);l[i].options=n;if(s.question.isMultipleChoice()){l[i].row_total=e.row_total;l[i].row_max=e.row_max}else{s._calcOptionStats(l[i])}});var h=_.pluck(s.question.compositeAnswerStructure["cols"],"id");s._calcColTotals(l,h);if(!s.question.isMultipleChoice()){o.answered=s._calcAnswered(l)}if(i){s.top2compositeSummary=o}else{s.compositeSummary=o}},buildCompositeSummaryComparedMatrix:function(e,t,i){var s=this,n,a,o;o=SM.Object.deepCopy(e);a=e.summary.options;n=s._buildCompositeOptions(a,t);if(a.other_option){n.other_option=SM.Object.deepCopy(a.other_option)}s._calcColTotals(n,o.crossed_cols||o.crossed_rows,o.summary);o.summary.options=n;if(!s.question.isMultipleChoice()){o.answered=s._calcAnswered(n)}if(i){s.top2compositeSummary=o}else{s.compositeSummary=o}},combineSummaries:function(e){var t=this,i={};_.each(e,function(e){t.aggregate(i,e)});return i},aggregate:function(e,t){var i=this;_.each(t,function(t,s){if(!_.has(e,s)){if(_.isNumber(t)){e[s]=t}else{e[s]=SM.Object.deepCopy(t)}}else{if(_.isNumber(t)){e[s]+=t}else{i.aggregate(e[s],t)}}})}};SM.TMBCPopout=SM.Widgets.register({__NAME:"tmbcpopout",__defaults:{templateID:"tmbc-popout-msg-template",tipSideX:"left",tipSideY:"top",parentElement:document.body,offsetX:null,offsetY:null,at:"left top",showDelayTime:250,hideDelayTime:150,collision:"flip flip"},__init:function(e){this.$el.on("mouseenter",{popout:this},this._onMouseenter).on("mouseleave",{popout:this},this._onMouseleave)},_isHovered:false,_isMsgSetup:false,_$msg:undefined,_tipSideX:undefined,_tipSideY:undefined,_offsetX:undefined,_offsetY:undefined,_positions:{left:{css:"tip-left",offset:"+32",flip:"right"},right:{css:"tip-right",offset:"-15",flip:"left"},bottom:{css:"tip-bottom",offset:"+34",flip:"top"},top:{css:"tip-top",offset:"-14",flip:"bottom"}},_beforeShow:function(){var e,t=this;if(this.__settings.offsetX){this._offsetX=this.__settings.offsetX}else{this._offsetX=this._positions[this.__settings.tipSideX].offset}if(this.__settings.offsetY){this._offsetY=this.__settings.offsetY}else{this._offsetY=this._positions[this.__settings.tipSideY].offset}this._$msg=this.$el.find(".popout");this._$msg=this._$msg.clone();e=SM.Template.render(this.__settings.templateID,this.__settings);this._$msg.append(e);this._$msg.on("mouseenter",{popout:this},this._onMessageMouseenter).on("mouseleave",{
popout:this},this._onMessageMouseleave).addClass("sidi-tip-"+this.__settings.tipSideX).appendTo(this.__settings.parentElement);this._isMsgSetup=true;return this},_show:function(){var e=this;setTimeout(function(){var t=e.$el,i=t.offset(),s=i.left,n=i.top;if(e._isHovered){if(e.__settings.tipSideX==="left"){s+=t.outerWidth()+10}else{s-=e._$msg.outerWidth()}n+=(t.outerHeight()-e._$msg.outerHeight())/2;n+=e.__settings.offsetY;e._$msg.addClass("open").css({left:Math.floor(s)+"px",top:Math.floor(n)+"px"});e.trigger("opened")}},e.get("showDelayTime"));return e},_hide:function(){var e=this;setTimeout(function(){if(!e._isHovered){if(e._$msg){e._$msg.remove()}e._isMsgSetup=false}},e.get("hideDelayTime"));return e},_onMouseenter:function(e){var t=e.data.popout;t._isHovered=true;if(!t._isMsgSetup){t._beforeShow()._show()}},_onMouseleave:function(e){var t=e.data.popout;t._isHovered=false;t._hide()},_onMessageMouseenter:function(e){var t=e.data.popout;t._isHovered=true},_onMessageMouseleave:function(e){var t=e.data.popout;t._isHovered=false;t._hide()}});SM.Models.register("QuestionDisplay",SM.Object.deepExtend(SM.Sortable,{DISPLAY_VALUES:{show:"show",hide:"hide",percent:"percent",absolute:"absolute",labels:"labels",legend:"legend",wtd_avg:"weighted_avg",distribution:"distribution",pie:"pie",donut:"donut",hbar:"hbar",vbar:"vbar",area:"area",line:"line",boxplot:"boxplot",top2_vbar:"top2_vbar",top2_hbar:"top2_hbar",top2_donut:"top2_donut",stacked:"stacked",stacked_hbar:"stacked_hbar",stacked_vbar:"stacked_vbar",nps_score:"score",nps_detailed:"detailed",nps_distribution:"distribution",score_hbar:"score_hbar",score_vbar:"score_vbar",score_gauge:"score_gauge",none:"none",menu_matrix:"menu_matrix",matrix:"matrix",mirror:"mirror",disabled:"disabled"},DISPLAY_OPTIONS:{chart_type:"chart_type",benchmark_chart_type:"benchmark_chart_type",driver_state:"driver_state",colors:"colors",stacking:"stacking",benchmark_stacking:"benchmark_stacking",scale_type:"scale_type",scale_min_absolute:"scale_min_absolute",scale_min_percentage:"scale_min_percentage",scale_min_stacked:"scale_min_stacked",scale_min_wtd_avg:"scale_min_wtd_avg",scale_max_absolute:"scale_max_absolute",scale_max_percentage:"scale_max_percentage",scale_max_stacked:"scale_max_stacked",scale_max_wtd_avg:"scale_max_wtd_avg",dp_absolute:"dp_absolute",dp_percentage:"dp_percentage",mirror:"mirror",matrix_display:"matrix_display",label_type:"label_type",labels:"labels",show_data:"show_data",show_chart:"show_chart",show_table:"show_table",show_basic_stats:"show_basic_stats",show_sig_diffs:"show_sig_diffs",show_empty_data:"show_empty_data",show_benchmark:"show_benchmark",sort_data:"sort_data",bs_sort_data:"bs_sort_data",nps_depth:"nps_depth"},SHARED_DISPLAY_OPTIONS:["chart_type","benchmark_chart_type","stacking","scale_type","matrix_display","label_type","colors","show_data","show_chart","show_table","show_basic_stats","show_sig_diffs","show_empty_data","dp_absolute","dp_percentage"],DEFAULT_CHART_TYPE:"hbar",DRIVER_DEFAULT_DISPLAY_OPTIONS:{tmbc:{shared:{show_table:"hide"},by_question_type:{"single_choice.vertical":{matrix_display:"weighted_avg"}},by_depth_type:{},by_compared:{}},std:{shared:{},by_question_type:{},by_depth_type:{},by_compared:{}}},DEFAULT_DISPLAY_OPTIONS:{shared:{chart_type:"hbar",benchmark_chart_type:"hbar",stacking:"none",matrix_display:"distribution",scale_type:"percent",show_chart:"show",show_table:"show",show_data:"hide",show_basic_stats:"hide",show_sig_diffs:"hide",show_empty_data:"show",dp_absolute:"0",dp_percentage:"2"},by_question_type:{"matrix.rating":{matrix_display:"weighted_avg"},"single_choice.net_promoter_score":{nps_depth:"score",chart_type:"score_gauge"},"single_choice.net_promoter_score.compared":{nps_depth:"score",chart_type:"score_hbar"},"matrix.ranking":{matrix_display:"weighted_avg"},"single_choice.vertical":{show_benchmark:"hide"}},by_depth_type:{single:{label_type:"labels"},matrix:{label_type:"legend"},menu_matrix:{label_type:"legend"}},by_compared:{"true":{mirror:"mirror"},"false":{mirror:"none"}}},METAKEY_TYPE_COMPARE:"compare:",UNTYPED_DISPLAY_OPTIONS:{show_chart:true,show_table:true,show_empty_data:true,show_basic_stats:true,show_sig_diffs:true,colors:true,dp_absolute:true,dp_percentage:true,labels:true,show_benchmark:true,driver_state:true,tmbc_chart_type:true},BENCHMARKABLE_CHART_TYPES:{hbar:true,vbar:true,top2_hbar:true,top2_vbar:true,top2_donut:true},TOP2_CHART_TYPES:{top2_hbar:true,top2_vbar:true,top2_donut:true},__create:function(e){var t=this;t.question=e.question;t.rollup=e.rollup;t.tempDisplay={};t.displayUpdates={}},_fetchMetadata:function(){var e=this,t=e.rollup.isCompare(),i=this.METAKEY_TYPE_COMPARE,s=this.question.page.survey.anviews.defaultView.getDisplayData(this.question.ID),n={};_.each(s,function(a,o){var r=SM.String.beginsWith(o,i),l;if(!r){if(t){l=i+o;if(e.UNTYPED_DISPLAY_OPTIONS[o]&&s[l]===undefined){n[o]=s[o]}}else if(!t){n[o]=s[o]}}else{l=o;if(t){o=l.substr(i.length);n[o]=s[l]}}});return n},_updateMetadata:function(e,t){var i=this,s=t.noTypify?false:i.rollup.isCompare();i.question.page.survey.anviews.defaultView.updateDisplayData(i.question.ID,e,{isCompared:s,untypedKeys:i.UNTYPED_DISPLAY_OPTIONS,done:t.done,fail:t.fail})},getDisplayData:function(e){var t=this,i=t.question,s=i.page.survey,n=i.family+"."+i.subtype,a=s.getDriverType(),o=t.DRIVER_DEFAULT_DISPLAY_OPTIONS[a],r=i.depthType(),l=i.isCompared(),h=l.toString(),u=t._fetchMetadata(),c,d,p,m,f=t.DISPLAY_VALUES.show,g;e=e||{};if(t.question.isNPS()&&t.question.isCompared()){n+=".compared"}if(a==="tmbc"&&!i.is_tmbc){o=t.DRIVER_DEFAULT_DISPLAY_OPTIONS["std"]}g=SM.Object.extend(t.DEFAULT_DISPLAY_OPTIONS.shared,o.shared,t.DEFAULT_DISPLAY_OPTIONS.by_question_type[n],o.by_question_type[n],t.DEFAULT_DISPLAY_OPTIONS.by_depth_type[r],o.by_depth_type[r],t.DEFAULT_DISPLAY_OPTIONS.by_compared[h],o.by_compared[h],u,t.tempDisplay);if(i.isMatrix()&&g.matrix_display===t.DISPLAY_VALUES.wtd_avg){var y=t.question.isCompared()?t.DISPLAY_VALUES.mirror:t.DISPLAY_VALUES.none;if(g.mirror!==y){t._updateMetadata({mirror:y},{});g.mirror=y}}g.depth_type=r;g.show_chart=g.show_chart===f;g.show_table=g.show_table===f;g.show_data=g.show_data===f;g.show_empty_data=g.show_empty_data===f;g.show_basic_stats=g.show_basic_stats===f;g.show_sig_diffs=g.show_sig_diffs===f&&i.isCompared();g.mirror=g.mirror===this.DISPLAY_VALUES.mirror;g.show_benchmark=i.isBenchmarkable()&&g.show_benchmark===f&&!s.shouldShowProfiler()&&s.canShowBenchmarking();if(g.show_benchmark){if(!g.benchmark_chart_type){if(s.isTMBCTemplate()){g.benchmark_chart_type=t.DISPLAY_VALUES.boxplot}else if(i.isTop2()){g.benchmark_chart_type=t.DISPLAY_VALUES.top2_vbar}}if(g.benchmark_chart_type in t.TOP2_CHART_TYPES&&!t.question.isTop2()){g.benchmark_chart_type=t.DISPLAY_VALUES.hbar}if(g.benchmark_chart_type===t.DISPLAY_VALUES.top2_donut&&t.question.isCompared()&&t.question.compareStructure.answers.cols.length!==1){g.benchmark_chart_type=t.DISPLAY_VALUES.top2_vbar}if(g.benchmark_chart_type){g.chart_type=g.benchmark_chart_type}if(g.benchmark_stacking){g.stacking=g.benchmark_stacking}if(g.chart_type!==t.DISPLAY_VALUES.boxplot){if(t.question.isNPS()&&t.question.isCompared()){g.chart_type=t.DISPLAY_VALUES.boxplot}else{g.depth_type="matrix"}}if(g.matrix_display===t.DISPLAY_VALUES.wtd_avg){g.matrix_display=t.DISPLAY_VALUES.distribution}g.show_sig_diffs=false}else{if(g.chart_type===t.DISPLAY_VALUES.boxplot){g.chart_type=t.DISPLAY_VALUES.hbar}}if(t._shouldSetDefaultSortData(g)){t._setDefaultSortData(g)}if(t.question.isNPS()){t._setDefaultSortData(g)}m=[t.DISPLAY_VALUES.pie,t.DISPLAY_VALUES.donut,t.DISPLAY_VALUES.line,t.DISPLAY_VALUES.area];if(t.question.isNPS()&&_.contains(m,g.chart_type)){g.chart_type=t.question.isCompared()?t.DISPLAY_VALUES.score_hbar:t.DISPLAY_VALUES.score_gauge}c=t.tableHasOneRow(g);if(i.isMultiResponse()&&(t._isPieChart(g)||t._isDonutChart(g))){g.chart_type=t.DEFAULT_CHART_TYPE}if(t._isStacked(g)){g.stacking=t.DISPLAY_VALUES.stacked;if(t._isVerticalBarChart(g)){g.chart_type=t.DISPLAY_VALUES.stacked_vbar}else if(t._isHorizontalBarChart(g)){g.chart_type=t.DISPLAY_VALUES.stacked_hbar}}if(g.depth_type!==i.QTYPE.single){if(c&&(t._isAreaChart(g)||t._isLineChart(g))){g.chart_type=t.DEFAULT_CHART_TYPE}if(!c&&(t._isPieChart(g)||t._isDonutChart(g))){g.chart_type=t.DEFAULT_CHART_TYPE}}if(t._scaleIsPercent(g)&&(t._isStacked(g)||t._isAreaChart(g))&&t._tableRowsAddToMoreThan100Percent(g)){g.scale_type=this.DISPLAY_VALUES.absolute}if(t._isPieChart(g)||t._isDonutChart(g)){g.scale_type=this.DISPLAY_VALUES.percent;if(g.stacking===this.DISPLAY_VALUES.none){if(!c&&!i.isSingleChoice()){g.matrix_display=this.DISPLAY_VALUES.wtd_avg}}}if(i.QTYPE.open_ended===i.family&&i.QTYPE.numerical===i.subtype){g.scale_type=this.DISPLAY_VALUES.absolute}if(g.depth_type===i.QTYPE.single){if(g.stacking===this.DISPLAY_VALUES.stacked){g.label_type=this.DISPLAY_VALUES.legend}else if(!t._isPieChart(g)&&!t._isDonutChart(g)){g.label_type=this.DISPLAY_VALUES.labels}g.mirror=false;if(!i.isSingleChoice()||i.isNPS()){g.matrix_display=this.DISPLAY_VALUES.distribution}}if(this.DISPLAY_VALUES.wtd_avg===g.matrix_display){g.scale_type=this.DISPLAY_VALUES.absolute;g.stacking=this.DISPLAY_VALUES.none}if(i.isSimple()){if(!t.rollup.options){g.hasShowEmptyOptions=true}else{_.each(i.getContextStructure().answers.rows,function(e){if(!t.rollup.options[e.id]){g.hasShowEmptyOptions=true}})}}else{g.show_empty_data=true;g.hasShowEmptyOptions=false}if(g.show_benchmark){if(g.chart_type!==t.DISPLAY_VALUES.boxplot){if(!(g.chart_type in t.BENCHMARKABLE_CHART_TYPES)){g.chart_type=t.DISPLAY_VALUES.vbar}if(this.question.isNPS()){g.chart_type=t.DISPLAY_VALUES.score_gauge}}g.isStacked=false;g.label_type=this.DISPLAY_VALUES.legend;if(g.chart_type in t.BENCHMARKABLE_CHART_TYPES){g.isPercent=true}g.show_empty_data=true;g.show_basic_stats=false}var b=t._isDonutChart(g),S=t._isPieChart(g),v=t._isLineChart(g),w=t._isAreaChart(g),C=t._isBoxplotChart(g),M=g.matrix_display===this.DISPLAY_VALUES.distribution,T=t._isStacked(g)&&!g.show_benchmark;p=!(b||S||C);d=!(b||S||C)&&M;if((T||w)&&t._tableRowsAddToMoreThan100Percent(g)){d=false}if(i.isMultipleChoice()&&(T||w)&&!g.mirror){p=false}if(i.isSingleChoice()&&(v||w)){p=false}if(i.isMatrix()){if(T){p=false}}if(i.isMenuMatrix()){if(T){p=false}}g.isLegend=g.label_type===this.DISPLAY_VALUES.legend;g.isDistribution=g.matrix_display===this.DISPLAY_VALUES.distribution;g.isWeightedAvg=g.matrix_display!==this.DISPLAY_VALUES.distribution;g.isPercent=t._scaleIsPercent(g);g.isStacked=T;g.isDonutChart=b;g.isLineChart=v;g.isPieChart=S;g.isAreaChart=w;g.isBoxplotChart=C;g.isLableable=b||S;g.hasDepthOptions=p;g.hasScaleOptions=d;g.isMirrorable=this._isDisplayMirrorable(g);g.tableHasOneRow=c;if(i.isNPS()){if(!_.contains([t.DISPLAY_VALUES.score_gauge,t.DISPLAY_VALUES.score_hbar,t.DISPLAY_VALUES.score_vbar],g.chart_type)&&g.nps_depth===t.DISPLAY_VALUES.nps_score){g.nps_depth=t.DISPLAY_VALUES.nps_distribution}if(g.show_benchmark&&g.nps_depth===t.DISPLAY_VALUES.nps_detailed){g.nps_depth=t.DISPLAY_VALUES.nps_distribution}p=true;g.isDepthScore=g.nps_depth===t.DISPLAY_VALUES.nps_score;g.isDepthDistribution=g.nps_depth===t.DISPLAY_VALUES.nps_distribution;g.isDepthDetailed=g.nps_depth===t.DISPLAY_VALUES.nps_detailed;if(g.isDepthScore){g.isStacked=false;g.scale_type=t.DISPLAY_VALUES.absolute;g.isPercent=false}if(_.isUndefined(g.disable_show_data)){t.setNpsDisableShowDataSetting(g)}}if(i.hasRandomAssignment()){g.show_basic_stats=false}return g},getExportDisplayData:function(){var e=this,t=e.question,i=t.family+"."+t.subtype,s=t.depthType(),n=t.isCompared(),a=e._fetchMetadata(),o;o=SM.Object.extend(e.DEFAULT_DISPLAY_OPTIONS.shared,e.DEFAULT_DISPLAY_OPTIONS.by_question_type[i],e.DEFAULT_DISPLAY_OPTIONS.by_depth_type[s],e.DEFAULT_DISPLAY_OPTIONS.by_compared[n.toString()],a,e.tempDisplay);o.depth_type=s;o.show_chart=o.show_chart===this.DISPLAY_VALUES.show;o.show_table=o.show_table===this.DISPLAY_VALUES.show;o.show_data=o.show_data===this.DISPLAY_VALUES.show;o.show_empty_data=o.show_empty_data===this.DISPLAY_VALUES.show;o.show_basic_stats=o.show_basic_stats===this.DISPLAY_VALUES.show;o.mirror=o.mirror===this.DISPLAY_VALUES.mirror;o.show_sig_diffs=o.show_sig_diffs===this.DISPLAY_VALUES.show&&o.mirror&&t.isCompared();return o},updateDisplayData:function(e,t){var i=this,s=i.getDisplayData();t=t||{};if(_.isUndefined(t.notify)){t.notify=true}if(e.mirror){e.sort_data=i._setDefaultSortData(s)}i._updateMetadata(e,{done:t.done,fail:t.fail,noTypify:t.noTypify});if(t.notify){i._trigger({type:"displayChange"})}},getTempDisplay:function(){var e=this;return e.tempDisplay},setNpsUpdatesByDepthOption:function(e){var t=this,i=t.getChartType();if(e.nps_depth===t.DISPLAY_VALUES.nps_score){if(t.question.isCompared()){e.chart_type=t.DISPLAY_VALUES.score_hbar}else{e.chart_type=t.DISPLAY_VALUES.score_gauge}}else{if(_.contains([t.DISPLAY_VALUES.score_gauge,t.DISPLAY_VALUES.score_hbar,t.DISPLAY_VALUES.score_vbar],i)){e.chart_type=t.DISPLAY_VALUES.stacked_hbar;e.stacking=t.DISPLAY_VALUES.stacked}}t.setNpsDisableShowDataSetting(e)},setNpsDisableShowDataSetting:function(e){var t=this;if(e.nps_depth===t.DISPLAY_VALUES.nps_score){e.show_data=t.DISPLAY_VALUES.show;e.disable_show_data=t.DISPLAY_VALUES.disabled}else if(e.nps_depth===t.DISPLAY_VALUES.nps_distribution){e.show_data=t.DISPLAY_VALUES.show;e.disable_show_data=t.DISPLAY_VALUES.none}else{e.show_data=t.DISPLAY_VALUES.hide;e.disable_show_data=t.DISPLAY_VALUES.none}},updateTempDisplay:function(e){var t=this,i=t.getDisplayData(),s,n;s=e.show_basic_stats&&e.show_basic_stats===t.DISPLAY_VALUES.show;n=e.show_sig_diffs&&e.show_sig_diffs===t.DISPLAY_VALUES.show;if(n&&!i.mirror){e.mirror=this.DISPLAY_VALUES.mirror}if(e.mirror){e.sort_data=t._setDefaultSortData(i)}if(e.chart_type){t.updateChartDisplayOptions(e)}else if(e.nps_depth){t.setNpsUpdatesByDepthOption(e)}SM.Object.deepUpdate(t.tempDisplay,e);if((s||n)&&!t.question.getRollup().hasBasicStats()){t.question.getRollup().fetchStatsRollup()}else{t._trigger({type:"tempDisplayChange"})}},updateChartDisplayOptions:function(e){var t=this;e.disable_show_data=t.DISPLAY_VALUES.none;if(e.chart_type===t.DISPLAY_VALUES.score_gauge){t.setNpsDisableShowDataSetting(e)}},clearTempDisplay:function(e){var t=this;e=e||{};if(_.isUndefined(e.notify)){e.notify=true}t.tempDisplay={};if(e.notify){t._trigger({type:"tempDisplayChange"})}},getDisplayUpdates:function(){var e=this;return e.displayUpdates},setDisplayUpdates:function(e){var t=this,i=t.getDisplayUpdates();SM.Object.deepUpdate(i,e)},clearDisplayUpdates:function(){var e=this;e.displayUpdates={}},getSharedDisplayUpdates:function(){var e=this,t=e.getDisplayData(),i=e.getDisplayUpdates(),s,n;if(e.question.isNPS()){n={show_chart:t.show_chart?e.DISPLAY_VALUES.show:e.DISPLAY_VALUES.hide,show_table:t.show_table?e.DISPLAY_VALUES.show:e.DISPLAY_VALUES.hide,show_basic_stats:t.show_basic_stats?e.DISPLAY_VALUES.show:e.DISPLAY_VALUES.hide,show_sig_diffs:t.show_sig_diffs?e.DISPLAY_VALUES.show:e.DISPLAY_VALUES.hide};return n}else{n={colors:t.colors,show_chart:t.show_chart?e.DISPLAY_VALUES.show:e.DISPLAY_VALUES.hide,show_table:t.show_table?e.DISPLAY_VALUES.show:e.DISPLAY_VALUES.hide,show_data:t.show_data?e.DISPLAY_VALUES.show:e.DISPLAY_VALUES.hide,show_basic_stats:t.show_basic_stats?e.DISPLAY_VALUES.show:e.DISPLAY_VALUES.hide,show_sig_diffs:t.show_sig_diffs?e.DISPLAY_VALUES.show:e.DISPLAY_VALUES.hide,scale_type:t.scale_type,dp_absolute:t.dp_absolute,dp_percentage:t.dp_percentage,stacking:t.stacking,show_empty_data:t.show_empty_data?e.DISPLAY_VALUES.show:e.DISPLAY_VALUES.hide,label_type:t.label_type,matrix_display:t.matrix_display};if(t.show_benchmark){n.benchmark_chart_type=t.benchmark_chart_type}else{n.chart_type=t.chart_type}}if(i.chart_type){s=e.getChartTypeUpdates(t.chart_type)}n=SM.Object.extend(n,i,s);_.each(n,function(t,i){if(!_.contains(e.SHARED_DISPLAY_OPTIONS,i)){delete n[i]}});n.show_chart=t.show_chart?e.DISPLAY_VALUES.show:e.DISPLAY_VALUES.hide;return n},getChartType:function(){var e=this,t=e.getDisplayData(),i;i=t[e.DISPLAY_OPTIONS.chart_type]||e.DEFAULT_CHART_TYPE;return i},isTop2ChartType:function(){var e=this,t=e.getDisplayData(),i=t.benchmark_chart_type;return i===e.DISPLAY_VALUES.top2_hbar||i===e.DISPLAY_VALUES.top2_vbar||i===e.DISPLAY_VALUES.top2_donut},_getNpsChartTypeByDepth:function(e){var t=this,i=t.getChartType();if(e===t.DISPLAY_VALUES.nps_score){return t.DISPLAY_VALUES.score_gauge}else{if(_.contains([t.DISPLAY_VALUES.score_gauge,t.DISPLAY_VALUES.score_hbar,t.DISPLAY_VALUES.score_vbar],i)){return t.DISPLAY_VALUES.hbar}}return i},getChartTypeUpdates:function(e,t){var i=this,s={},n;if(e===i.DISPLAY_VALUES.stacked_hbar||e===i.DISPLAY_VALUES.stacked_vbar){n=i.DISPLAY_VALUES.matrix}else{n=i.DISPLAY_VALUES.none}if(i.question.isNPS()){var a=[i.DISPLAY_VALUES.score_gauge,i.DISPLAY_VALUES.score_hbar,i.DISPLAY_VALUES.score_vbar];if(_.contains(a,e)){s["nps_depth"]=i.DISPLAY_VALUES.nps_score;s["show_data"]="show"}else{var o=i.getChartType();if(_.contains(a,o)){s["nps_depth"]=i.DISPLAY_VALUES.nps_distribution}}}if(t){s[i.DISPLAY_OPTIONS.benchmark_chart_type]=e}else{s[i.DISPLAY_OPTIONS.chart_type]=e}s[i.DISPLAY_OPTIONS.stacking]=n;s[i.DISPLAY_OPTIONS.show_chart]=i.DISPLAY_VALUES.show;return s},setBenchmarkDisplay:function(e){var t=this,i={show_benchmark:e?t.DISPLAY_VALUES.show:t.DISPLAY_VALUES.hide};t.updateDisplayData(i,{notify:!e,noTypify:true})},getBenchmarkDisplay:function(){var e=this.getDisplayData();return e.show_benchmark},isTop2:function(){var e=this.getDisplayData();return e.chart_type===this.DISPLAY_VALUES.top2_vbar||e.chart_type===this.DISPLAY_VALUES.top2_hbar||e.chart_type===this.DISPLAY_VALUES.top2_donut},notifyBenchmarkDisplay:function(){this._trigger("displayChange")},getScaleMinOptionKey:function(){var e=this,t=e.getDisplayData(),i;var s=t.isStacked||t.isAreaChart&&!e.question.isSimple()&&!t.isWeightedAvg;if(t.isPercent){i=e.DISPLAY_OPTIONS.scale_min_percentage}else{if(s){i=e.DISPLAY_OPTIONS.scale_min_stacked}else if(t.isWeightedAvg){i=e.DISPLAY_OPTIONS.scale_min_wtd_avg}else{i=e.DISPLAY_OPTIONS.scale_min_absolute}}if(t.mirror){i=i+":"+e.DISPLAY_OPTIONS.mirror}return i},getScaleMaxOptionKey:function(){var e=this,t=e.getDisplayData(),i;var s=t.isStacked||t.isAreaChart&&!e.question.isSimple()&&!t.isWeightedAvg;if(t.isPercent){i=e.DISPLAY_OPTIONS.scale_max_percentage}else{if(s){i=e.DISPLAY_OPTIONS.scale_max_stacked}else if(t.isWeightedAvg){i=e.DISPLAY_OPTIONS.scale_max_wtd_avg}else{i=e.DISPLAY_OPTIONS.scale_max_absolute}}if(t.mirror){i=i+":"+e.DISPLAY_OPTIONS.mirror}return i},getCustomScale:function(e,t){var i=this,s=i.getDisplayData(),n=i.getScaleMinOptionKey(),a=s[n],o=i.getScaleMaxOptionKey(),r=s[o],l,h;if(_.isUndefined(a)||a>e.min){l=t?t.min:e.min}else{l=a}if(_.isUndefined(r)||r<e.max){h=t?t.max:e.max}else{h=r}return $.extend(t||{},{min:l,max:h})},buildLabelUpdates:function(e){var t=this,i=t.getDisplayData().labels,s,n=e.labelType,a=e.answerID,o=e.labelText;s={labels:i||{}};if(_.isEmpty(s.labels[n])){s.labels[n]={}}if(n==="questionHeading"){s.labels[n].text=o}else{s.labels[n][a]={text:o}}return s},labelUpdatesHaveEmptyLabel:function(){var e=this,t=e.getTempDisplay().labels,i=false;if(t){if(t["questionHeading"]){if(t["questionHeading"].text===""){i=true}}_.each(["rows","columns","columnChoices","crossedOptions","others"],function(e){_.each(t[e],function(e,t){if(e.text===""){i=true}})})}return i},getQuestionHeadingLabel:function(){return this.getLabel("questionHeading")},getLabel:function(e,t){var i=this,s=i.getDisplayData(),n;if(_.isEmpty(s.labels)||_.isEmpty(s.labels[e])){return}if(e==="questionHeading"){n=s.labels[e]}else{n=s.labels[e][t]}return n},_isDisplayMirrorable:function(e){if(e.isDonutChart||e.isPieChart||e.isBoxplotChart){return false}else if(e.isWeightedAvg&&(e.depth_type===this.DISPLAY_VALUES.matrix||e.depth_type===this.DISPLAY_VALUES.menu_matrix)){return false}return true},tableHasOneRow:function(e){var t=this,i=t.rollup.question,s=i.getContextStructure().answers,n=s.rows,a=s.cols,o=false;if(i.isMatrix()){if(i.isMenuMatrix()){if(e.mirror){o=true;_.each(a,function(e){if(e.items.length!==1){o=false}})}else{o=n.length===1}}else{o=e.mirror&&a.length===1||!e.mirror&&n.length===1}}else if(i.isSingleChoice()&&e.matrix_display!==this.DISPLAY_VALUES.distribution){o=true}return o},_tableRowsAddToMoreThan100Percent:function(e){var t=this,i=t.question,s=i.getCrossedQuestion(),n=!!s;if(e.mirror){if(i.family===i.QTYPE.multiple_choice){return true}}else{if(n){if(s.isMultiResponse()){return true}}else{if(i.isMultipleChoice()){return true}}}return false},_scaleIsAbsolute:function(e){return e.scale_type===this.DISPLAY_VALUES.absolute},_scaleIsPercent:function(e){return e.scale_type===this.DISPLAY_VALUES.percent},_isStacked:function(e){return e.stacking!==this.DISPLAY_VALUES.none},_isVerticalBarChart:function(e){return e.chart_type===this.DISPLAY_VALUES.vbar},_isHorizontalBarChart:function(e){return e.chart_type===this.DISPLAY_VALUES.hbar},_isAreaChart:function(e){return e.chart_type===this.DISPLAY_VALUES.area},_isLineChart:function(e){return e.chart_type===this.DISPLAY_VALUES.line},_isPieChart:function(e){return e.chart_type===this.DISPLAY_VALUES.pie},_isDonutChart:function(e){return e.chart_type===this.DISPLAY_VALUES.donut},_isBoxplotChart:function(e){return e.chart_type===this.DISPLAY_VALUES.boxplot},sort:function(e,t,i,s,n,a){var o=this,r,l,h={},u,c;if(a){r=this.DISPLAY_OPTIONS.bs_sort_data}else{r=this.DISPLAY_OPTIONS.sort_data}l=o.getDisplayData()[r];c={dimensionType:e,dimensionID:t,order:i};if(s){u=SM.Object.deepCopy(l);u[n]=c}else{u=c}h[r]=u;o.updateDisplayData(h)},_updateDisplaySortData:function(e){var t=this,i={};i[t.DISPLAY_OPTIONS.sort_data]=e;t.updateDisplayData(i)},_shouldSetDefaultSortData:function(e){var t=this,i=e.sort_data,s=t.question,n=s.isCompared(),a=!!e.mirror,o;o=_.isEmpty(i)||t._sortDataAppliesToDifferentQuestion(s,i,n,a);return o},_sortDataAppliesToDifferentQuestion:function(e,t,i,s){var n=this,a=e.summaryType(),o=e.getContextStructure().answers,r=o.crossedOptions,l,h,u,c=false;if(i&&!s){l=_.map(r,function(e){return e.id});if(a==="menu_matrix"){h=_.values(t);_.each(h,function(e){u=e.dimensionID;if(u&&!_.contains(l,u)){c=true}})}else{u=t.dimensionID;if(u&&!_.contains(l,u)){c=true}}}return c},_setDefaultSortData:function(e){var t=this,i=e.sort_data||{},s=t.question,n=s.summaryType(),a=s.isCompared(),o=s.structure.answers.rows,r=s.structure.answers.cols;if(n==="menu_matrix"){if(a){_.each(o,function(e){i[e.id]={order:t.SORTING_ORDERS.UNSORTED,dimensionType:null,dimensionID:null}})}else{_.each(r,function(e){i[e.id]={order:t.SORTING_ORDERS.UNSORTED,dimensionType:null,dimensionID:null}})}}else{i={order:t.SORTING_ORDERS.UNSORTED,dimensionType:null,dimensionID:null}}e.sort_data=i;return i},isBenchmarkShown:function(){var e=this,t=e.getDisplayData();return t[e.DISPLAY_OPTIONS.show_benchmark]}}));SM.Models.register("QuestionCombineHide",{__create:function(e){var t=this;t.question=e.question;t.hasTop2=e.question.isTop2();t.rollup=e.rollup},load:function(){var e=this;e._loadSettings();e._buildComposites()},_buildComposites:function(){var e=this,t,i;i=e._isSettingsEmpty();if(i||!e.question.canCombineHide()||!e._sanityCheckSettings()){e.question.buildCompositeAnswerStructure();e.rollup.buildCompositeSummary()}else{e.question.buildCompositeAnswerStructure(e.settings);t=e.question.buildCompositeMapping(e.settings);e.rollup.buildCompositeSummary(t)}if(e.hasTop2){e.question.buildCompositeAnswerStructure(e.top2settings,true);t=e.question.buildCompositeMapping(e.top2settings,true);e.rollup.buildCompositeSummary(t,true);e.benchmarkRollup=e.question.page.survey.getBenchmarkRollup(e.question.ID);if(e.benchmarkRollup){e.benchmarkRollup.buildCompositeSummary(e.top2settings,t,true)}}},_isSettingsEmpty:function(){var e=this;if(e.rollup.display.getBenchmarkDisplay()&&!e.question.isTop2()){return true}return _.size(e.settings.combines)===0&&_.size(e.settings.hides)===0},_sanityCheckSettings:function(){var e=this,t=e.question.getContextStructure(),i=t.answers,s=e.question.getCombineHideDim(),n=i[s],a,o=true;_.each(e.settings.combines,function(e){_.each(e.combine,function(e){a=_.findWhere(n,{id:e});if(_.isUndefined(a)){o=false}})});_.each(e.settings.hides,function(e){a=_.findWhere(n,{id:e.id});if(_.isUndefined(a)){o=false}});return o},_fetchSettings:function(){var e;e=this.question.page.survey.anviews.defaultView.getDisplayData(this.question.ID,{forTrends:true});return e.combine_hide},_updateSettings:function(e){var t=this,i=t.settings;e=e||{};t.question.page.survey.anviews.defaultView.updateDisplayData(this.question.ID,{combine_hide:i});t.rollup.display._trigger({type:"displayChange"})},_loadSettings:function(){var e=this,t={combines:[],hides:[]},i,s;if(e.question.isTop2()){e.top2settings=e._createTop2Settings()}else{e.top2settings=t}if(!e.question.canCombineHide()){e.settings=t;return}s=e._fetchSettings();if(!s){e.settings=t;return}e.settings=s;i=e._sanityCheckSettings();if(!i){e.settings=t}return},_createTop2Settings:function(){var e=this,t={combines:[],hides:[]},i=e.question.structure.answers.rows,s=i.length,n=[],a=[];_.each(i,function(t,i){if(e.question.isTop2Ascending()){if(t.position===s||t.position===s-1){n.push(t)}else{a.push(t)}}else{if(t.position===1||t.position===2){n.push(t)}else{a.push(t)}}});t.combines[0]={combine:_.map(n,function(e){return e.id}),id:n[0].id+"ch",title:Globalize.localize("Top 2 Box Score")};t.hides=_.map(a,function(e){return{id:e.id}});return t},addCombine:function(e){var t=this,i=[],s;_.each(e.combine,function(e){var s=_.findWhere(t.settings.combines,{id:e});if(!_.isUndefined(s)){i=i.concat(s.combine);t.settings.combines=_.reject(t.settings.combines,function(e){return e.id===s.id})}else{i.push(e)}});i=_.sortBy(i,function(e){return e});t.settings.combines.push({title:e.title,id:i[0]+"ch",combine:i});_.each(i,function(e){t.settings.hides=_.reject(t.settings.hides,function(t){return e===t.id})});t._buildComposites();t._updateSettings();SM.Bi.answersCombine(t.question);return true},editCombine:function(e,t){var i=this;i.settings.combines=_.reject(i.settings.combines,function(t){return t.id===e});i.addCombine(t);i._buildComposites();i._updateSettings();SM.Bi.answersEditCombine(i.question);return true},unCombine:function(e){var t=this,i=_.findWhere(t.settings.combines,{id:e});if(_.isUndefined(i)){return false}t.settings.combines=_.reject(t.settings.combines,function(t){return t.id===e});t._buildComposites();t._updateSettings();SM.Bi.answersUncombine(t.question);return true},addHide:function(e){var t=this,i,s;s=_.findWhere(t.settings.combines,{id:e});if(_.isUndefined(s)){this.settings.hides.push({id:e})}else{t.settings.combines=_.reject(t.settings.combines,function(t){return t.id===e});_.each(s.combine,function(e){t.settings.hides.push({id:e})})}t._buildComposites();t._updateSettings();SM.Bi.answersHide(t.question);return true},unHideAll:function(){var e=this;e.settings.hides=[];e._buildComposites();e._updateSettings();SM.Bi.answersUnhideAll(e.question)},unHide:function(e){var t=this,i;i=_.findWhere(t.settings.hides,{id:e});if(!i){return false}t.settings.hides=_.reject(t.settings.hides,function(t){return t.id===e});t._buildComposites();t._updateSettings();SM.Bi.answersUnhide(t.question);return true},getHides:function(){var e=this,t=e.question.hiddenComposites;return t},isCombined:function(e){var t=this,i=_.findWhere(t.settings.combines,{id:e});return!_.isUndefined(i)},canApplySort:function(e){var t=this;if(!t.question.canCombineHide()){return true}if(t.isContextAnswerOption(e)){return true}if(t.inCombine(e)||t.isHidden(e)){return false}if(e.indexOf("ch")!==-1){return false}return true},isContextAnswerOption:function(e){var t=this,i,s=t.question.getContextAnswerStructure(),n=t.question.getCombineHideDim();if(!n){return false}i=_.findWhere(s[n],{id:e});return!!i},inCombine:function(e){var t=this,i,s=t.question.combinedComposites;i=_.findWhere(s,{id:e});return!!i},isHidden:function(e){var t=this,i,s=t.question.hiddenComposites;i=_.findWhere(s,{id:e});return!!i},canCombineHide:function(e){var t=this,i,s,n;if(!t.question.canCombineHide()){return false}i=t.question.getContextAnswerStructure();s=t.question.getCombineHideDim();if(!s){return false}if(!t.getMenuVisibleOptions(e)){return false}n=_.findWhere(i[s],{id:e});return!!n},getMenuVisibleOptions:function(e){var t=this,i;i=_.findWhere(t.settings.combines,{id:e});if(_.isUndefined(i)){if(t._isOnlyComposite()){if(t.question.otherIsAnAnswerChoice()){return{combine:false,hide:true,editCombine:false,unCombine:false}}else{return null}}else{return{combine:true,hide:true,editCombine:false,unCombine:false}}}else{return{combine:false,hide:!t._isSingleComposite(),editCombine:true,unCombine:true}}},getActionMenuOption:function(e){var t=this,i;if(!t.canCombineHide(e)){return null}return{id:e,visibleOptions:t.getMenuVisibleOptions(e)}},getUnHidingStatus:function(){return _.size(this.settings.hides)},_isSingleComposite:function(){var e=this;return e._isOnlyComposite()&&!e.question.otherIsAnAnswerChoice()},_isOnlyComposite:function(){var e=this,t=e.question.getContextAnswerStructure(),i=e.question.getCombineHideDim(),s=_.pluck(t[i],"id");return _.size(s)===1},_getLabelTextById:function(e){var t=this,i=t.question.getCombineHideDim(),s=t.rollup.display,n=s.getDisplayData().labels;i=i==="cols"?"columns":i;if(n&&n[i]&&n[i][e]){return n[i][e].text}else{return null}},_getCompositeLabel:function(e){var t=this;return t._getLabelTextById(e.id)||e.text},_getCombinedAnswerTextsByIds:function(e){var t=this,i=t.question.combinedComposites,s;return _.map(e,function(e){s=_.findWhere(i,{id:e});return s?t._getLabelTextById(s.id)||s.text:""})},getCompositeAnswerTextById:function(e){var t=this,i=t.question.getContextAnswerStructure(),s=t.question.getCombineHideDim(),n;n=_.findWhere(i[s],{id:e});return n?t._getLabelTextById(n.id)||n.text:""},getCombinedDataInfo:function(e,t){var i=this,s=i.question.getContextAnswerStructure(),n=i.question.getCombineHideDim(),a=[],o;_.each(s[n],function(s){var n,o,r,l;if(s.id===e){if(!t){a.push({id:s.id,text:i._getCompositeLabel(s),isCombined:false,disabled:false,checked:true})}}else{r=_.findWhere(i.settings.combines,{id:s.id});if(r){l=i._getCombinedAnswerTextsByIds(r.combine);if(t){n=s.text+" ("+l.join(", ")+")"}else{n=s.text+" ("+_.size(r.combine)+")"}o=true}else{n=i._getCompositeLabel(s);o=false}a.push({id:s.id,text:n,isCombined:o,disabled:false,checked:false})}});if(t){_.each(i.question.combinedComposites,function(t){if(t.combineId===e){a.push({id:t.id,text:i._getCompositeLabel(t),isCombined:false,disabled:false,checked:true})}})}_.each(i.question.hiddenComposites,function(e){a.push({id:e.id,text:i._getCompositeLabel(e),isCombined:false,disabled:false,checked:false})});a=_.sortBy(a,function(e){return e.id});if(n==="rows"){o=s.other;if(!_.isUndefined(o)&&!_.isUndefined(o[0].options.is_answer_choice)){a.push({id:o[0].id,text:o[0].text,isCombined:false,disabled:true,checked:false})}}return a}});SM.Models.register("QuestionRollup",SM.Object.deepExtend(SM.Sortable,SM.CompositeSummaryBuilder,{METAKEY_TYPE_COMPARE:"compare:",__create:function(e){var t=this;this.isLoaded=e.isLoaded;this.question=e.question;this.questionID=this.question.ID;t.display=SM.Models.create("QuestionDisplay",{rollup:t,question:t.question});t.combinehideModel=SM.Models.create("QuestionCombineHide",{rollup:t,question:t.question});this.summary={answered_subtotals:{},options:{}};this.answered="";this.skipped="";this.type="null_rollup";this.taModelMap={};this.filoModelMap={};this.nestedQuestionDict={}},getContextSummary:function(e){return(e?this.top2compositeSummary:this.compositeSummary)||this.summary},load:function(e){var t=this,i=this.question.page.survey.anviews.currentView.compareRule,s,n,a,o;if(t.question.isNPS()){e=SM.ComparedByNps.rollup(e)}s=e.summary;if(e.type==="compare"&&this.question.isComparable()){a=this.question.page.survey.getQuestion(i.get("questionID"));if(a.ID===t.question.ID){t.comparedByMyself=true}t.comparedByRA=i.isRA;t.setComparedByNpsDistributed(i);
e=this._mungeCompareData(e,i,a,t.isComparedByNpsDistributed());SM.SidiUtils.labelBySidi(e,a);if(s.type==="menu_matrix"){e=this._mungeCompareMenuMatrixRollup(e,a);if(i.ruleType==="random_assignment"){o=this.question.mungeCompareMenuMatrixRA(e,a)}else{o=this.question.mungeCompareMenuMatrix(e,a,t.isComparedByNpsDistributed())}}else{e=this._mungeCompareMatrixRollup(e,a,this.question.isNumerical());if(i.ruleType==="random_assignment"){o=this.question.mungeCompareMatrixRA(e,a)}else{o=this.question.mungeCompareMatrix(e,a,t.isComparedByNpsDistributed())}}}this.question.setCompareStructure(o);this.summary=e;this.answeredCount=e.answered;this.answered=Globalize.format(e.answered,"n0");this.answered_subtotals=e.summary.answered_subtotals;this.skipped=Globalize.format(e.skipped,"n0");this.type=e.type;this.otherOption=e.other_option;this.options=s.options;if(s.type==="matrix"||this.type==="matrix"){this.options.col_totals=this._buildColumnTotals()}if(this.question.commentField&&!this.question.commentField.options.is_answer_choice){if(e.other_option){this.options[this.question.commentField.id]={count:e.other_option}}else if(s.type==="matrix"&&this.options.other_option){this.options[this.question.commentField.id]={count:this.options.other_option.row_total}}else if(s.type==="menu_matrix"){var r=this.options.other_option;if(r&&r.options&&r.options.other_option){this.options[this.question.commentField.id]=r.options.other_option}}}n=s.ta_data;if(n){_.each(n,function(t){t["flags"]=e.flags});this._loadTaModels(n)}this.combinehideModel.load();this._trigger({type:"loaded"})},hasBasicStats:function(){var e=this;return SM.BasicStatsUtils.hasBasicStats(this.summary)},fetchStatsRollup:function(){var e=this,t,i={},s;i.self=e;t={view_data:e.question.page.survey.anviews.currentView.dump(),questions:[e.question.ID],include_basic_stats:true};s=SM.API.fetchRollups(t);$.when(i,s).done(e._onFetchedStatsRollups).fail(function(e){})},_onFetchedStatsRollups:function(e,t){var i=t[0],s=e.self,n=i.question_rollups,a=_.values(n)[0];s.load(a);s.display._trigger({type:"displayChange"})},getSidiData:function(e,t,i){var s=this.summary.summary,n,a,o;if(!i){n=s.stats}else{if(!s.options[i]){return null}n=s.options[i].stats}if(!n||!n.sig_diffs){return null}a=n.sig_diffs.options;if(a[e]&&a[e][t]){o=SM.Object.deepCopy(a[e][t]);o.p=n.sig_diffs.p;o.confidence_level=n.sig_diffs.confidence_level;return o}else{return null}},updatePresentationRollup:function(e,t){var i=e[t];if(i){this.answered=i.count}else{this.answered=0}},isSimple:function(){return"simple"===this.type},isCompare:function(){return"compare"===this.type},getRowData:function(e){var t=this._getRowData(e);if(!t){t={count:0,row_max:0,row_total:0}}return t},getColData:function(e,t){var i=this._getColData(e,t);if(!i){i={count:0}}return i},getChoiceData:function(e,t,i){var s=this._getColData(e,t);if(s){s=s.options[i]}if(!s){s={count:0}}return s},getFileUploadModel:function(e,t,i,s){var n=this._makeTaModelID(e,t,s),a=this.filoModelMap[n];if(!a){a=this.filoModelMap[n]=SM.Models.create("FileUploadList",{ID:n,rollup:this,matrixCrossTab:i})}return a},getTaModel:function(e,t,i){var s=this._makeTaModelID(e,t,i);return this.taModelMap[s]},createTaModel:function(e,t,i,s){var n=this._makeTaModelID(e,t,s),a;if(this.taModelMap[n]){return this.taModelMap[n]}a=SM.Models.create("TextAnalysis",{ID:n,matrixCrossTab:i});if(s){a.variationID=s}a.rollup=this;this.taModelMap[n]=a;return a},hasTaModels:function(){return!$.isEmptyObject(this.taModelMap)},getDisplayMode:function(){var e=this.question,t=e.page.survey.anviews.currentView.compareRule,i=t&&t.get("selected")&&!t.get("isCorrupt");if(this.type==="compare"){return"compare"}if(i){if(this.type==="null_rollup"||e.isMenuMatrix()||this.type==="presentation_random_assignment"){return"compare"}}return"standard"},getSortedSummary:function(e){var t=this,i,s=t.display.getDisplayData(),n,a,o;n=s.mirror;a=!s.show_empty_data;i={question:t.question,labels:s.labels,isMirrored:n,shouldHideEmptyData:a};if(e){i=_.extend(i,e)}o=new SM.SortedSummary(i);return o.summary},buildNpsSummary:function(){var e=this,t,i,s;i=new SM.NPSSummary({rollup:e.summary,answerStructures:e.question.getContextAnswerStructure(),type:"distribution"});s=new SM.NPSSummary({rollup:i.compositeSummary,answerStructures:i.compositeAnswerStructure,type:"score"});t={score:{summary:s.compositeSummary,answerStructures:s.compositeAnswerStructure},distribution:{summary:i.compositeSummary,answerStructures:i.compositeAnswerStructure},detailed:{summary:e.summary,answerStructures:e.question.getContextAnswerStructure()}};return t},_buildColumnTotals:function(){var e=this.question,t=e.getContextStructure(),i=this.options,s=t.answers.cols,n=t.answers.rows,a=[];$.each(s,function(e,t){a.push(0);$.each(n,function(s,n){var o=n.id,r=t.id;if(i[o]&&i[o].options&&i[o].options[r]){a[e]+=i[o].options[r].count}})});return a},_makeTaModelID:function(e,t,i){var s;if(!e){e=0}if(!t){t=0}if(!i){i=0}s=["qid",this.questionID,"oid",e,"xid",t,"vid",i].join("_");return s},_loadTaModels:function(e){var t=this,i={},s;this.taModelMap=i;$.each(e,function(e,n){s=SM.Models.create("TextAnalysis",{ID:e});s.rollup=t;i[e]=s;s.load(n)})},_getRowData:function(e){return this.options[e]},_getColData:function(e,t){var i=this._getRowData(e);if(i){i=i.options[t]}return i},_mungeCompareData:function(e,t,i,s){var n=this,a=0,o,r,l=e.answered;if(t.ruleType==="random_assignment"){e.crossed_rows=this._getRACrossedList(t,i,"rows")}else{o=this._getCrossedList(t,i,"rows");e.crossed_rows=s?SM.ComparedByNps.mergeCrossedRows(o,i):o}if(t.ruleType==="random_assignment"){if(i.family==="matrix"){e.crossed_cols=this._getRACrossedList(t,i,"cols")}}else{if(i.family==="matrix"){e.crossed_cols=this._getCrossedList(t,i,"cols")}}e.type="compare";e.crossed_question_id=i.ID;if(!l){l={this_question:0,compare_options_total:{}};if(e.crossed_cols&&e.crossed_cols.length>0){r=e.crossed_rows[0];l.compare_options_total[r]={};for(;a<e.crossed_cols.length;a++){l.compare_options_total[r][e.crossed_cols[a]]=0}e.answered=l;e.summary.answered_subtotals=e.answered.compare_options_total[r]}else{for(;a<e.crossed_rows.length;a++){l.compare_options_total[e.crossed_rows[a]]=0}e.answered=l;e.summary.answered_subtotals=e.answered.compare_options_total}}else{if(e.crossed_cols&&e.crossed_cols.length>0){r=e.crossed_rows[0];e.summary.answered_subtotals=e.answered.compare_options_total[r]}else{e.summary.answered_subtotals=n._processCompareOptionsTotal(e.answered.compare_options_total,i)}}e.answered=e.answered.this_question;e.summary.type=this.question.getCompareType();return e},_getCrossedList:function(e,t,i){var s=i==="rows"?t.rowList:t.colList,n;if(t.family==="matrix"){n=e.choiceSetList[0][i]}else{n=e.choiceSet.get("rows")}return $.map(s,function(e){if(e.id in n){return e.id}})},_getRACrossedList:function(e,t,i){var s=t.randomAssignmentList,n;if(t.family==="matrix"){if(i==="rows"){n=e.get("rows")}else{return $.map(s,function(e){return e.id})}}else{n=e.get("rows")}return $.map(s,function(e){if(e.variable_id in n){return e.variable_id}})},_processCompareItem:function(e,t){var i=this,s;if(!t.isNPS()){return e}s=_.map(e,function(e){return e});if(i.isComparedByNpsDistributed()){return SM.ComparedByNps.aggregate(s[0],t)}else{return s[0]}},_processCompareOptionsTotal:function(e,t){var i=this,s;if(!t.isNPS()){return e}s=_.map(e,function(e){return e});if(i.isComparedByNpsDistributed()){return SM.ComparedByNps.answered_subtotals(s[0],t)}else{return s[0]}},_mungeCompareMenuMatrixRollup:function(e,t){var i=this,s,n=e.summary,a=n.options,o,r,l,h,u,c,d,p,m,f,g="-2";for(l in a){o=a[l];if(l===g){s=o}else{if(o.row_total===undefined){o.compare_options_total=-1;o.row_total=-1}else{r=o.row_total.compare_options_total;o.compare_options_total=r===undefined?-1:r;o.row_total=o.row_total.current_row}}h=o.options;for(p in h){u=h[p];if(l!==g){u.row_total=u.row_total.current_row;u.options=i._processCompareItem(u.compare,t);if(e.crossed_cols&&e.crossed_cols.length){for(m in u.options){}u.options=u.options[m]}delete u.compare}}c=o.stats;if(c){for(p in c){d=c[p];if(e.crossed_cols&&e.crossed_cols.length&&d.compare){for(m in d.compare){}d.compare=d.compare[m]}}}}if(s){a.other_option=s;delete a[g];if(s.options[g]!==undefined){s.other_option=s.options[g];delete s.options[g];f=s.other_option;if(f.row_total!==undefined&&f.row_total.current_row!==undefined){f.row_total=f.row_total.current_row;f.options=f.compare;delete f.compare;s.options.other_option=f;delete s.other_option}}}return e},setComparedByNpsDistributed:function(e){this.is_nps_distributed=e.is_nps_distributed},isComparedByNpsDistributed:function(){return this.is_nps_distributed},_mungeCompareMatrixRollup:function(e,t,i){var s=this,n,a=e.summary,o=e.crossed_cols!==undefined,r=a.options,l,h,u,c,d,p,m,f="-2";for(l in r){h=r[l];if(h.options){n=h.options[f]}else{h.row_total=h.row_total.current_row;h.options=s._processCompareItem(h.compare,t);if(e.crossed_cols&&e.crossed_cols.length){for(u in h.options){}h.options=h.options[u]}delete h.compare}}d=a.stats;if(d&&(e.crossed_cols&&e.crossed_cols.length)){if(!i){for(p in d){m=d[p];m.compare=_.values(m.compare)[0]}}else{for(l in d){m=d[l];for(p in m){m[p].compare=_.values(m[p].compare)[0]}}}}if(n&&n.row_total!==undefined&&n.row_total.current_row!==undefined){n.row_total=n.row_total.current_row;n.options=n.compare;delete n.compare;r.other_option=n;delete r[f]}return e}}));SM.Models.register("QuestionRollupList",{__create:function(){this.pages={};this.questions={};this.lastRollupsRequest=null;this.lastFetchFilteredStamp=-1;this.isLoading=false;this.failedLoad=false;this.failedLoadRequestID=null;this.isUpdating=false},loadSurvey:function(e){var t=e.anviews;this.survey=e;t.on("selectedViewLoaded",{self:this},this._onSelectedViewLoaded);t.on("selectedViewChanged",{self:this},this._onSelectedViewChanged);t.on("selectedViewFailed",{self:this},this._onSelectedViewFailed);t.currentView.on("failedLoadRequestID.set",{self:this},this._onSelectedViewFailed);t.currentView.on("lastSwitchRequest.changed",{self:this},this._onSwitchRequestChanged);t.currentView.on("ruleDeleted",{self:this},this._onRuleDeleted);t.currentView.on("ruleAdded",{self:this},this._onRuleAdded);t.currentView.on("ruleEdited",{self:this},this._onRuleEdited);this.createRollupModels()},createRollupModels:function(){var e=this;_.each(e.survey.questions,function(t,i){var s=t.page.ID,n;if(!e.pages[s]){e.pages[s]={}}n=SM.Models.create("QuestionRollup",{question:t});e.pages[s][i]=n;e.questions[i]=n})},clear:function(){this.pages={};this.questions={};_.each(this.survey.questions,function(e,t){e.compareStructure=undefined});this.createRollupModels()},loadRollups:function(e){var t=this,i,s={};s["nltkOptionEnabled"]=t.survey.nltkOptionEnabled;if(e){_.each(e,function(e,n){e["flags"]=s;i=t.questions[n];if(i){if(i.question.hasRandomAssignment()){t._loadRandomAssignmentRollups(i,e)}else{i.load(e)}}})}},_loadRandomAssignmentRollups:function(e,t){var i=e.question.randomAssignmentList,s=e.nestedQuestionDict,n=e.question.family==="presentation",a,o,r,l;_.each(i,function(i){var a=t[i.variable_id],o,l;if(!!a){if(a.type==="compare"&&(e.question.isEssay()||e.question.isFileUpload())&&a.answered){o=a.summary.options[i.variable_id];if(o){l=a.answered.compare_options_total;_.each(o.compare,function(e,t){_.each(e,function(e,i){l[t][i]=e.count})});a.answered.this_question=o.row_total.current_row;a.summary.options[0]=a.summary.options[i.variable_id]}else{a.summary.options[0].row_total=0;_.each(a.summary.options[0].compare,function(e,t){a.summary.options[0].compare[t].count=0})}}a["flags"]=t["flags"];e.load(a);if(n){e.updatePresentationRollup(a.summary,i.variable_id)}r=_.clone(e);s[i.variable_id]=r}else if(typeof t.answered!==undefined&&t.answered instanceof Object){a=t;e.load(a);if(n){e.updatePresentationRollup(a.summary,i.variable_id)}r=_.clone(e);s[i.variable_id]=r}})},fetchStatsRollups:function(){var e=this,t,i={},s=e.survey.shownQuestionList,n=[],a;e.set("isUpdating",true,{notify:true});i.self=e;_.each(s,function(e){if(e.hasRollupLoaded()){n.push(e.ID)}});t={view_data:e.survey.anviews.currentView.dump(),questions:n,include_basic_stats:true};a=SM.API.fetchRollups(t);$.when(i,a).done(e._onFetchedStatsRollups).fail(function(t){e.set("isUpdating",false,{notify:true})})},_onFetchedStatsRollups:function(e,t){var i=t[0],s=e.self,n=i.question_rollups;s.loadRollups(n);s.onSharedDisplayDataChange()},onSharedDisplayDataChange:function(){var e=this,t=_.values(e.questions),i=200;if(!e.get("isUpdating")){e.set("isUpdating",true,{notify:true})}e._clearTempDisplays();_.each(t,function(s,n){setTimeout(function(){s.display._trigger({type:"allDisplaysChange"});if(n===t.length-1){e.set("isUpdating",false,{notify:true})}},i*n)})},_clearTempDisplays:function(){var e=this,t=e.questions;_.each(t,function(e,t){e.display.clearTempDisplay({notify:false})})},isBuffered:function(){var e=true,t=this.survey,i=t.config.question_buffer_page_load_size,s=t.shownQuestionList,n=t.state.get("page");if(n!=="all"){s=this.survey.pageList[n].shownQuestionList}$.each(s,function(t,s){if(!s.hasRollupLoaded()&&t<i){e=false;return false}else if(t>=i){return false}});return e},hasAll:function(){var e=this.survey,t=true,i=e.shownQuestionList,s=e.state.get("page");if(s!=="all"){i=e.pageList[s].shownQuestionList}$.each(i,function(e,i){if(!i.hasRollupLoaded()){t=false;return false}});return t},isAfterLastLoadedPage:function(e){var t=this._getLastLoadedQuestion(),i;if(!t){return false}i=t.page;return e.position>i.position},isAfterLastLoadedQuestion:function(e){var t=this._getLastLoadedQuestion();if(!t){return false}return e.position>t.position},_getLastLoadedQuestion:function(){var e=this.survey,t,i=e.shownQuestionList,s=e.state.get("page");if(s!=="all"){i=e.pageList[s].shownQuestionList}$.each(i,function(e,i){if(!i.hasRollupLoaded()){t=i;return false}});return t},fetchMoreRollups:function(){var e=this,t=this.survey.state.get("page"),i={self:this},s=this._getNextUnloadedQuestionIndex(t);if(s>=0){$.when(i,this.lastRollupsRequest).always(function(){e._makeFetchMoreRequest(i)})}},fetchFiltered:function(){var e=this,t={self:this,timestamp:SM.Date.timestamp()};this.set("lastFetchFilteredStamp",t.timestamp);$.when(t,this.lastRollupsRequest).always(function(){e._makeFetchFilteredRequest(t)})},_makeFetchMoreRequest:function(e){var t=e.self,i,s=t.survey.state.get("page"),n=t._getNextUnloadedQuestionIndex(s),a;e.timestamp=SM.Date.timestamp();i={view_data:t.survey.anviews.currentView.dump(),questions:t._getQuestionIDBuffer(s,n)};if(i.questions.length===0){return}a=SM.API.fetchRollups(i);$.when(e,a).done(t._onFetchedMoreRollups).fail(function(i){t._onFetchMoreRollupsFailed(e,i)})},_getQuestionIDBuffer:function(e,t,i){var s=this.survey.shownQuestionList,n=this.survey.config.question_buffer_fetch_size,a=[];if(e!=="all"){s=this.survey.pageList[e].shownQuestionList}s=s.slice(t);$.each(s,function(e,t){if(!t.hasRollupLoaded()||i){a.push(t.ID)}else{return false}if(a.length===n){return false}});return a},_getNextUnloadedQuestionIndex:function(e){var t=this.survey.shownQuestionList,i=-1;if(e!=="all"){t=this.survey.pageList[e].shownQuestionList}$.each(t,function(e,t){if(!t.hasRollupLoaded()){i=e;return false}});return i},_makeFetchFilteredRequest:function(e){var t=e.self,i,s,n;if(e.timestamp===t.get("lastFetchFilteredStamp")){i=t.survey.state.get("page");s={view_data:t.survey.anviews.currentView.dump(),questions:t._getQuestionIDBuffer(i,0,true)};n=t.survey.anviews.defaultView.appliedSidiAll();if(n){s=_.extend(s,{include_basic_stats:true})}if(s.questions.length===0){return}t.set("failedLoad",false);t.set("failedLoadRequestID",null);t.set("isLoading",true,{notify:true});t.lastRollupsRequest=SM.API.fetchRollups(s);t.clear();$.when(e,t.lastRollupsRequest).done(t._onFetchFiltered).fail(function(i,s,n){t._onFetchFilteredFail(e,i)})}},_triggerRollupsLoaded:function(e){var t=-1,i,s=this;$.each(e,function(e,n){i=s.survey.getQuestion(e);if(i.position>t){t=i.position}i._trigger({type:"rollupLoaded"})});s.survey._trigger({type:"rollupsAppended",lastLoadedPosition:t})},_onFetchedMoreRollups:function(e,t){var i=t[0],s=t[1],n=t[2],a=e.self;if(e.timestamp>a.get("lastFetchFilteredStamp")){a.survey.set("respondentCounts",i.respondent_counts,{notify:true});a.loadRollups(i.question_rollups);a.survey.benchmarkRollups.loadRollups(i.benchmark_rollups);a._triggerRollupsLoaded(i.question_rollups)}},_onFetchMoreRollupsFailed:function(e,t){var i=t&&t.request_id;if(e.timestamp>this.get("lastFetchFilteredStamp")){this.survey._trigger({type:"fetchRollupsFailed"})}},_onFetchFiltered:function(e,t){var i=t[0],s=t[1],n=t[2],a=e.self;if(e.timestamp===a.get("lastFetchFilteredStamp")){a.survey.set("respondentCounts",i.respondent_counts,{notify:true});a.loadRollups(i.question_rollups);a.survey.benchmarkRollups.loadRollups(i.benchmark_rollups);a.survey.anviews.currentView.save();a.set("isLoading",false,{notify:true})}},_onFetchFilteredFail:function(e,t){var i=t&&t.request_id;if(e.timestamp===this.get("lastFetchFilteredStamp")){this.set("failedLoad",true);this.set("failedLoadRequestID",i);this.set("isLoading",false,{notify:true});this.survey.anviews.currentView.invalidateNewRules()}},_onSelectedViewChanged:function(e){var t=e.data.self,i=t.survey.anviews.currentView.get("lastSwitchStamp");t.set("lastFetchFilteredStamp",i);t.set("failedLoad",false);t.set("failedLoadRequestID",null);t.set("isLoading",true,{notify:true});t.clear()},_onSelectedViewLoaded:function(e){var t=e.data.self,i=e.respondentData.respondent_counts,s=e.respondentData.question_rollups;if(t.survey.anviews.currentView.get("lastSwitchStamp")===t.get("lastFetchFilteredStamp")){t.survey.set("respondentCounts",i,{notify:true});t.loadRollups(s);t.set("isLoading",false,{notify:true})}},_onSelectedViewFailed:function(e){var t=e.data.self;if(t.survey.anviews.currentView.get("lastSwitchStamp")===t.get("lastFetchFilteredStamp")){t.set("failedLoad",true);t.set("failedLoadRequestID",t.survey.anviews.currentView.get("failedLoadRequestID"));t.set("isLoading",false,{notify:true})}},_onSwitchRequestChanged:function(e){var t=e.data.self;t.lastRollupsRequest=e.value},_onRuleDeleted:function(e){var t=e.ruleModel,i=e.data.self;if(t.get("selected")&&!e.ruleModel.isShow){i.fetchFiltered()}},_onRuleEdited:function(e){var t=e.data.self;if(!e.ruleModel.isShow){t.fetchFiltered()}},_onRuleAdded:function(e){var t=e.data.self;if(!e.ruleModel.isShow&&e.ruleModel.get("selected")){t.fetchFiltered()}}});SM.Models.register("AppliedCategoriesSelection",{__create:function(e){this._state={};this.responseID=e.responseID},load:function(e){this.categories=e},reset:function(){this._state={}},update:function(e,t){this._state[e]=t;this._trigger({type:"selection.changed",isDirty:this.isDirty()})},dump:function(){var e={},t=this._state,i=this.responseID,s=this.categories.UNCATEGORIZED_ID,n=this.categories.map;$.each(n,function(n,a){var o,r;if(n!==s){o=a.getApplicationState(i);r=t[n];if(r&&o!==r){e[n]=r}else{e[n]=o}}});return e},isDirty:function(){var e=this._state,t=this.responseID,i=this.categories.map,s=false;$.each(e,function(e,n){var a=i[e].getApplicationState(t);if(a!==n){s=true;return false}});return s}});SM.Models.register("FilterCategoriesSelection",{__create:function(){this.reset()},loadSelection:function(){var e=this.categories.map,t,i;this.reset();t=this._state;i=this._list;$.each(e,function(e,s){if(s.isFiltering()){t[e]=true;i.push(e)}else{t[e]=false}})},reset:function(){this._state={};this._list=[]},isEmpty:function(){return this._list.length===0},update:function(e,t){this._state[e]=t;if(t){SM.Array.addUnique(this._list,e)}else{SM.Array.removeItem(this._list,e)}this._trigger({type:"selection.changed",isDirty:this.isDirty()})},clear:function(){var e=this;$.each(this.categories.map,function(t){e._state[t]=false});this._list=[];this._trigger({type:"selection.changed",isDirty:this.isDirty()})},isDirty:function(){var e=this._state,t=this.categories.map,i=false;$.each(e,function(e,s){var n=t[e].isFiltering();if(n!==s){i=true;return false}});return i},apply:function(){this.categories.taModel.filterCategories(this._list)}});SM.Models.register("TextPhrase",{MAX_CATNAME_LEN:25,DEFAULT_WEIGHTED_AVERAGE:.5,ID_PREFIX:"phrase-",__create:function(e){this.ID=this.ID_PREFIX+this.__uid},__getters:{localizedPercent:function(e){var t=e.phrases.taModel.filterCount;return Globalize.formatPercent(e.responseCount/t,2)},percent:function(e){var t=e.phrases.taModel.filterCount;return SM.Math.toPercentString(e.responseCount/t,2)},fontSize:function(e){var t=e.phrases,i=14,s=32,n;if(t.lowScore!=t.highScore){n=(e.dscore-t.lowScore)/(t.highScore-t.lowScore)}else{n=e.DEFAULT_WEIGHTED_AVERAGE}return i+s*n}},load:function(e){this.text=e.phrase;this.responseCount=e.count;this.score=e.score;this.dscore=e.dscore},hasManyResponses:function(){return this.responseCount>1}});SM.Models.register("TextPhraseList",{LINGO_MAX_COUNT:5e3,viewModes:{CLOUD:"cloud",LIST:"list",LINGO:"lingo",NLTK:"nltk"},__create:function(e){this.ID=e.ID;this.list=[];this.sortedList=[];this.map={};this.viewMode=this.viewModes.CLOUD},load:function(e){var t=this,i=100,s=0;this.viewMode=this.viewModes.CLOUD;t.list=[];t.sortedList=[];t.map={};_.each(e,function(e,n){var a=SM.Models.create("TextPhrase");a.phrases=t;a.load(e);a.set("rank",n+1);i=Math.min(a.dscore,i);s=Math.max(a.dscore,s);t.list.push(a);t.map[a.ID]=a;t.sortedList.push(a)});this.highScore=s;this.lowScore=i;this._sortListUneven()},isLanguageAvailable:function(e){return e!=="ja"&&e!=="zh"},isOverResponseLimit:function(){var e=this.taModel.responses;return this.taModel.filterCount>=this.LINGO_MAX_COUNT},_sortListByText:function(){this.sortedList.sort(function(e,t){e=e.text.toLowerCase();t=t.text.toLowerCase();if(e===t){return 0}return e<t?-1:1})},_sortListAsCurve:function(e){var t=[];e=_.sortBy(e,function(e,t){return e.dscore>t.dscore?-1:1});_.each(e,function(e,i){if(i%2==0)t.push(e);else t.unshift(e)});return t},_sortListUneven:function(){var e=[],t=this.sortedList,i,s,n,a,o,r=[];t.sort(function(e,t){return e.dscore>t.dscore?-1:1});i=t;s=i.length;n=i.length/2;a=i.slice(0,n+1);secondHalf=i.slice(n+1,s);a=this._sortListAsCurve(a);secondHalf=this._sortListAsCurve(secondHalf);_.each(a,function(e,t){r.push(a[t]);if(a.length===secondHalf.length){r.push(secondHalf[t])}else if(t<secondHalf.length){r.push(secondHalf[t])}});this.sortedList=r}});SM.Models.register("TextResponse",{__create:function(e){this.ID=e.ID},__setters:{categoryIDs:function(e,t){var i,s,n;e.categories={list:[],map:{}};e.categoryIDs=[];i=e.categories.list;n=e.categories.map;if(!e.responses.taModel.categories.failed){s=e.responses.taModel.categories.sortedList;$.each(s,function(s,a){$.each(t,function(t,s){s=String(s);if(s===a.ID){n[s]=a;i.push(a);e.categoryIDs.push(s);return false}})});e.set("isInFilter",e._isInFilter(),{notify:true});if(!e.get("isInFilter")){e.responses.remove(e.ID)}}}},load:function(e){var t=this.responses.taModel,i=this.responses.highlights,s=288e5,n=e.date-s,a=t.rollup.question.page.survey.owner,o=t.hasTextAnalysis(),r;this.localizedDate=new Date(n);if(_.isNumber(SM.TIMEZONE_OFFSET_SHIFT)){r=SM.Date.stdTimezoneOffset()*6e4;this.localizedDate=new Date(n+(r-SM.TIMEZONE_OFFSET_SHIFT))}this.dateStr=Globalize.format(this.localizedDate,"d")+" "+Globalize.format(this.localizedDate,"t");this.content=e.content;this.date=e.date;this.number=e.number;this.respondentID=e.respondent_id;this.highlights=i&&i[this.respondentID];this.respondentUrl=t.rollup.question.page.survey.getRespondentUrl(this.respondentID);if(o&&this.highlights){this.text=this._highlight()}else{this.text=[{text:this.decodeHTMLEntities(SM.Html.removeExternalAttributes(e.content))}]}this.categories={map:{},list:[]};if(o){this.set("categoryIDs",e.tag_ids||[])}},decodeHTMLEntities:function(e){return $("<textarea/>").html(e).text()},isSelected:function(){var e=this.responses.selection;if(e.isNone()){return false}return e.isAll()||e.map[this.ID]&&!e.selectUnloaded||!e.unselectedMap[this.ID]&&e.selectUnloaded},addCategoryID:function(e){var t=this.get("categoryIDs");t=t.concat([e]);this.set("categoryIDs",t,{notify:true})},removeCategory:function(e){var t=this.categories;delete t.map[e];SM.Array.removeItem(this.categoryIDs,e);t.list=$.map(t.list,function(t,i){if(t.ID!==e){return t}});this._trigger("category.removed")},applyCategories:function(e,t){var i=this,s=[],n=this.categories.map,a=i.responses.taModel.categories.sortedList,o;if(e){o=$.map(a,function(t,i){var s=e[t.ID];if(s==="checked"||s==="indeterminate"&&n[t.ID]){return t.ID}});s=this._diffCategories(o,this.categoryIDs);i.set("categoryIDs",o,{notify:true})}if(t&&t.label){s.push({action:"create",label:t.label,color:t.color})}return s},save:function(e){var t,i=this;if(e.length){t=this.responses.taModel._makeParams();t.commands=e;t.response_text_ids=[this.ID];SM.API.taTagAllText(t).done(function(e,t,s){var n;if(e.new_tags.length){n=SM.Models.create("TextCategory");n.categories=i.responses.taModel.categories;n.load(e.new_tags[0]);i.responses.taModel.categories.add(n);i.addCategoryID(n.ID)}i.responses.taModel.categories.updateCounts(e.tag_counts.tags)})}},_isInFilter:function(){var e,t,i=this;if(this.responses&&this.responses.taModel&&this.responses.taModel.categories){t=this.responses.taModel.categories;if(!t.hasFilter()){return true}if(!this.categoryIDs.length){return t.isInFilter(t.UNCATEGORIZED_ID)}$.each(this.categoryIDs,function(i,s){if(t.isInFilter(s)){e=true;return false}});return e}return true},_diffCategories:function(e,t){var i=[],s={};if(!e.length){if(!t.length){return[]}return $.map(t,function(e,t){return{action:"remove",tag_id:e}})}$.each(e,function(e,n){var a=false;$.each(t,function(e,t){if(t===n){a=true;s[t]=false}if(t!==n&&s[t]===undefined){s[t]=true}});if(!a){i.push({action:"add",tag_id:n})}});s=$.map(s,function(e,t){if(e){return{action:"remove",tag_id:t}}});return i.concat(s)},_highlight:function(){var e=this.content,t=e.length,i=[],s,n=0;$.each(this.highlights,function(t,a){var o=a[0],r=a[1],l=r-o,h=o-n;if(h>0){s=e.substr(n,h);i.push({text:SM.Html.strip(s)})}s=e.substr(o,l);n=r;i.push({text:SM.Html.strip(s),highlight:true})});if(n<t){s=e.substr(n);i.push({text:SM.Html.strip(s)})}return i}});SM.Models.register("TextResponseList",{TA_INVALID_OFFSET:0,MAX_SEARCH_STRING_LEN:60,__create:function(e){this.ID=e.ID;this.selection=SM.Models.create("ResponsesSelection",{ID:this.ID});this.selection.responses=this;this.map={};this.list=[];this.loadedCount=0;this.highlights={}},load:function(e){var t=this,i=this.taModel.get("survey").respondentCounts,s=this.taModel.rollup.question.page.survey.owner,n;this.map={};this.list=[];this.loadedCount=0;this.highlights={};this.removedCount=0;this.totalCount=e.question_response_count;n=this.taModel.filterCount<e.count?this.taModel.filterCount:e.count;this.queryCount=s.isOverResponseLimit(n)?s.responseLimit:n;this._append(e);this.failed=false;this._trigger({type:"loaded"})},append:function(e){this._append(e);this._trigger({type:"appended",respondents:this.list.slice(this.loadedCount-e.response_texts.length)})},isEmpty:function(){return this.list.length===0},applyCategories:function(e,t){var i=this,s=i.selection.selectedIDs(),n,a=false,o=[];$.each(s,function(s,n){o=o.concat(i.map[n].applyCategories(e,t))});n=this._cleanDiffs(o);i.selection.clear();return{diff:n,responseIDs:s,except:a}},remove:function(e){this.queryCount--;this.removedCount++;delete this.map[e];this.list=$.map(this.list,function(t){if(t.ID!==e){return t}});this._trigger("responseRemoved")},save:function(e,t,i){var s,n,a,o=this;function r(e,i,s){var n;if(e.new_tags.length){n=SM.Models.create("TextCategory");n.categories=o.taModel.categories;n.load(e.new_tags[0]);o.taModel.categories.add(n);$.each(t,function(e,t){o.map[t].addCategoryID(n.ID)})}o.taModel.categories.updateCounts(e.tag_counts.tags)}if(e.length){a=this._isRemovingFilteredCategory(e);if(a){this.taModel.set("isSearching",true,{notify:true})}n=this.taModel._makeParams();n.commands=e;if(i){n.except_response_text_ids=t;s=SM.API.taTagExceptText(n)}else{n.response_text_ids=t;s=SM.API.taTagAllText(n)}s.done(r);if(a){s.done(function(){o.taModel.filterCategories(o.taModel.categories.filter.list)})}}},_cleanDiffs:function(e){var t={};return $.map(e,function(e,i){if(!t[e.action]){t[e.action]={};if(e.action==="create"){return e}}if(e.action==="create"){return}if(!t[e.action][e.tag_id]){t[e.action][e.tag_id]=true;return e}})},_append:function(e){var t=this;SM.Object.update(this.highlights,e.highlights);$.each(e.response_texts,function(e,i){var s=SM.Models.create("TextResponse",{ID:i.response_text_id});s.responses=t;t.loadedCount++;i.number=t.loadedCount;s.load(i);t.map[i.response_text_id]=s;t.list.push(s)})},_isRemovingFilteredCategory:function(e){var t=false,i=this.taModel.categories.filter.map;$.each(e,function(e,s){if(s.action==="remove"&&i[s.tag_id]){t=true;return false}});return t}});SM.Models.register("TextCategory",{MAX_CATNAME_LEN:25,__getters:{localizedPercent:function(e){var t=e.categories.taModel.filterCount;return Globalize.formatPercent(e.responseCount/t,2)},percent:function(e){var t=e.categories.taModel.filterCount;return SM.Math.toPercentString(e.responseCount/t,2)}},__validators:{name:function(e,t){var i={isValid:true},s=$.trim(t);s=_.escape(s);if(!s){i.isValid=false;i.exception="empty"}if(s.length>e.MAX_CATNAME_LEN){i.isValid=false;i.exception="maxlength"}if(e._isDuplicateName(t)){i.isValid=false;i.exception="duplicate"}return i}},load:function(e){var t,i;if(e){try{t=decodeURIComponent(e.label);i=decodeURIComponent(e.color)}catch(s){t=e.label;i=e.color}this.name=SM.Html.strip(t);this.color=i;this.responseCount=e.response_text_count||0;this.ID=""+e.tag_id;this.isNew=false}else{this.responseCount=0;this.color="86A33B";this.name="";this.isNew=true}},getApplicationState:function(e){if(e){return this._getResponseApplication(e)}else{return this._getResponsesSelectedApplication()}},_getResponsesSelectedApplication:function(){var e=this.categories,t=e.taModel.responses,i=t.selection,s=this,n=this.categories.taModel.filterCount,a="unchecked",o;if(this.responseCount===0){return"unchecked"}if(i.isAll()){if(this.responseCount===n){return"checked"}else{return"indeterminate"}}else if(i.get("selectUnloaded")){o=0;$.each(i.unselectedMap,function(e,i){if(i&&t.map[e].categories.map[s.ID]){o++}});if(this.responseCount-o===i.get("count")){return"checked"}else if(this.responseCount-o===0){return"unchecked"}else{return"indeterminate"}}else{o=0;$.each(i.map,function(e,i){if(i&&t.map[e].categories.map[s.ID]){o++}});if(i.get("count")===o){return"checked"}else if(o===0){return"unchecked"}else{return"indeterminate"}}},_getResponseApplication:function(e){var t=this.categories.taModel.responses.map[e];return t.categories.map[this.ID]?"checked":"unchecked"},isFiltering:function(){return!!this.categories.filter.map[this.ID]},_colorOptions:[{name:"dkgreen",hex:"86A33B"},{name:"turquoise",hex:"4BBFBF"},{name:"blue",hex:"426496"},{name:"red",hex:"C6332A"},{name:"orange",hex:"F8922F"},{name:"ltgreen",hex:"ABBF38"},{name:"gray",hex:"898A7A"},{name:"purple",hex:"68264D"},{name:"lavender",hex:"9999FF"}],_isDuplicateName:function(e){var t=this.categories.list,i=this,s=false;$.each(t,function(t,n){if(n.ID!==i.ID&&n.name===e){s=true;return false}});return s},save:function(){var e,t=this;if(this.ID===this.categories.UNCATEGORIZED_ID){throw new Error("Cannot save uncategorized")}if(!this.isNew){throw new Error("Cannot save a category that is not new")}e=this.categories.taModel._makeParams();e.color=SM.Html.strip(this.color);e.label=SM.Html.strip(this.name);SM.API.taCreateTag(e).done(function(e,i,s){t.load(e);t.categories.add(t)})},edit:function(e){var t;if(this.ID===this.categories.UNCATEGORIZED_ID){throw new Error("Cannot delete the uncategorized id")}t=this.categories.taModel._makeParams();t.tag_id=this.ID;t.color=e.color?SM.Html.strip(e.color):this.color;t.label=e.name?SM.Html.strip(e.name):this.name;this.name=t.label;this.color=t.color;SM.API.taEditTag(t);this.categories._trigger({
type:"category.edited",category:this})},kill:function(){var e,t;if(this.ID===this.categories.UNCATEGORIZED_ID){throw new Error("Cannot delete the uncategorized id")}e=this.categories.taModel._makeParams();e.tag_id=this.ID;t=this.categories.map[this.categories.UNCATEGORIZED_ID];this.categories.remove(this);this.categories=null;SM.API.taDeleteTag(e).done(function(e,i,s){var n=e.tag_counts,a;if(n.status===200){a=n.tags[t.ID];if(a){t.set("responseCount",a.response_text_count,{notify:true})}}})}});SM.Models.register("TextCategoriesList",{__create:function(e){this.ID=e.ID,this.map={};this.sortedList=[],this.list=[];this.filter={list:[],map:{}}},UNCATEGORIZED_ID:"-1",load:function(e){this._buildStructures(e);this._ensureUncategorizedModel();this._sortListByName()},count:function(){return this.list.length?this.list.length-1:0},hasMany:function(){return this.count()>1},isEmpty:function(){return this.count()===0},hasFilter:function(){return this.filter.list.length>0},getFilterList:function(){var e=this;return $.map(this.filter.list,function(t){return e.map[t]})},isInFilter:function(e){if(this.hasFilter()){return!!this.filter.map[e]}return true},createModel:function(){var e=SM.Models.create("TextCategory");e.categories=this;e.load();return e},add:function(e){this._add(e);this._sortListByName();this.taModel._trigger({type:"category.added",category:e})},remove:function(e){this._remove(e);this.taModel._trigger({type:"category.deleted",category:e})},loadFilterSelection:function(e){this.filterSelection=e;this.filterSelection.categories=this},updateCounts:function(e){var t=this;$.each(e,function(e,i){t.map[e].set("responseCount",i.response_text_count,{notify:true})})},_remove:function(e){var t=this,i=e.ID,s,n=false,a=false;delete this.map[i];$.each(this.list,function(e,s){if(!n&&i===s.ID){t.list.splice(e,1);n=true}if(!a){s=t.sortedList[e];if(i===s.ID){t.sortedList.splice(e,1);a=true}}if(a&&n){return false}});if(this.filter.map[i]){SM.Array.removeItem(this.filter.list,i);this.taModel.filterCategories(this.filter.list)}$.each(this.taModel.responses.list,function(e,t){if(t.categories.map[i]){t.removeCategory(i)}});if(!a&&!n){throw new Error("Category was not deleted properly: deleted ordered: "+a," clearedUnordered: "+n)}},_add:function(e){this.map[e.ID]=e;this.list.push(e);this.sortedList.push(e)},_buildStructures:function(e){var t=this;$.each(e,function(e,i){var s=SM.Models.create("TextCategory");s.categories=t;s.load(i);t._add(s)})},_ensureUncategorizedModel:function(){var e;if(!this.map[this.UNCATEGORIZED_ID]){e=SM.Models.create("TextCategory");e.load({label:Globalize.localize("Uncategorized"),color:"333333",tag_id:this.UNCATEGORIZED_ID});this.map[this.UNCATEGORIZED_ID]=e;this.list.push(e);this.sortedList.push(e)}this.map[this.UNCATEGORIZED_ID].set("name",Globalize.localize("Uncategorized"));this.map[this.UNCATEGORIZED_ID].set("isUncategorized",true)},_sortListByName:function(){var e=Globalize.localize("Uncategorized").toLowerCase();this.sortedList.sort(function(t,i){t=t.name.toLowerCase();i=i.name.toLowerCase();if(t===e){return 1}if(i===e){return-1}if(t===i){return 0}return t<i?-1:1})}});SM.Models.register("ResponsesSelection",{__create:function(e){this.ID=e.ID;this.map={};this.unselectedMap={};this.count=0;this.selectUnloaded=false},isAll:function(){var e=this.count,t=this.responses.queryCount;return e===t&&e>0},isNone:function(){return this.count===0},isMany:function(){return this.count>1},add:function(e){var t=this.count;if(!this.selectUnloaded){this.map[e]=true}else{this.unselectedMap[e]=false}if(!this.isAll()){this.set("count",t+1,{notify:true})}},selectedIDs:function(){var e=this;if(this.selectUnloaded){return $.map(this.responses.list,function(t,i){var s=e.unselectedMap[t.ID];if(!s){return t.ID}})}else{return $.map(this.map,function(e,t){if(e){return t}})}},unselectedIDs:function(){var e=this;if(this.selectUnloaded){return $.map(this.unselectedMap,function(e,t){if(e){return t}})}else{return $.map(this.responses.list,function(t,i){var s=e.map[t.ID];if(!s){return t.ID}})}},remove:function(e){var t=this.count;if(!this.selectUnloaded){this.map[e]=false}else{this.unselectedMap[e]=true}if(!this.isNone()){this.set("count",t-1,{notify:true})}},clear:function(){this.map={};this.unselectedMap={};this.set("count",0,{notify:true});this.selectUnloaded=false},selectAll:function(){var e=this.responses.queryCount;this.unselectedMap={};this.map={};this.set("count",e,{notify:true});this.selectUnloaded=true}});SM.Models.register("TextAnalysis",{PAGE_SIZE:50,TA_SUCCESS:200,__create:function(e){var t;this.ID=e.ID;t=this.ID.split("_");this.optionID=t[3];this.crossedOptionID=t[5];this.matrixCrossTabID=e.matrixCrossTab||"0";this.variationID=t[7];this.inProgress=false;this.responses=SM.Models.create("TextResponseList",{ID:this.ID});this.responses.taModel=this;this.categories=SM.Models.create("TextCategoriesList",{ID:this.ID});this.categories.taModel=this;this.phrases=SM.Models.create("TextPhraseList",{ID:this.ID});this.phrases.taModel=this},__getters:{questionID:function(e){return e.rollup.question.ID},survey:function(e){return e.rollup.question.page.survey}},__setters:{searchDraft:function(e,t){var i=$.trim(t);i=SM.String.htmlStrip(i);e.searchDraft=i}},__validators:{searchDraft:function(e,t){var i=$.trim(t);i=SM.String.htmlStrip(i);if(!i){return{isValid:false,exception:"empty"}}return{isValid:true}}},load:function(e,t){this.enableAnalysis=e.text_data.enable_analysis;this.lingoEnabled=this.enableAnalysis&&this.hasTextAnalysis();if(t!=="analysisTypeChange"){this._loadCategoryData(e.tag_data)}this._loadResponseData(e.text_data);this._loadAnalysisData(e.analysis_data);this._hasLoaded=true;this.flags=e.flags;this.inProgress=e.inProgress;if(t!=="analysisTypeChange"){this._trigger("loaded")}},hasLoaded:function(){return this._hasLoaded},hasTextAnalysis:function(){return this.rollup.question.page.survey.hasTextAnalysis()},makeModelId:function(e,t,i){return["qid",e,"oid",t,"xid",i].join("_")},fetch:function(){var e=this._makeSearchParams(),t,i=this;e.offset=0;SM.API.taGetRollupQuestion(e).done(function(e,t,s){var n=e[i.ID];n["flags"]=i.rollup.summary.flags;i.load(n)})},fetchMoreResponses:function(){var e=this,t=this._makeSearchParams(),i,s;this._lastSearch=SM.Date.timestamp();s=this._lastSearch;if(this.categories.hasFilter()){t.restrict_by_tag_ids=this.categories.filter.list}t.offset=this.responses.loadedCount;if(this.get("query")){t.search_phrase=this.get("query");i=SM.API.taGetRollupSearch(t)}else if(this.get("phrase")){t.phrase=this.get("phrase");i=SM.API.taGetRollupPhrase(t)}else{i=SM.API.taGetRollupQuestion(t)}i.done(function n(t,i,a){var o=t[e.ID];if(e._lastSearch===s){if(o.text_data.status===e.TA_SUCCESS){e.responses.set("fetchFailErrorID",null);e.responses.append(o.text_data)}else{e.responses.set("fetchFailErrorID",t.request_id);e.responses._trigger("fetchMoreResponses.failed")}}}).fail(function a(t){if(e._lastSearch===s){e.responses.set("fetchFailErrorID",t.request_id);e.responses._trigger("fetchMoreResponses.failed")}});return i},fetchResponses:function(){var e=this._makeSearchParams(),t=this,i,s;e.offset=0;if(this.categories.hasFilter()){e.restrict_by_tag_ids=this.categories.filter.list}this._beforeResponseRequest();i=SM.API.taGetRollupQuestion(e);this._handleResponseRequest(i,this._lastSearch)},clearQuery:function(){var e=this._makeSearchParams(),t,i=this;e.offset=0;this.set("query","");this.set("phrase","");this.set("searchDraft","",{notify:true});this.categories.filter.list=[];this.categories.filter.map={};this._beforeResponseRequest();t=SM.API.taGetRollupQuestion(e);i._handleResponseRequest(t,this._lastSearch)},searchPhrase:function(e){var t=this._makeSearchParams(),i,s=this;t.offset=0;t.phrase=e;if(this.categories.hasFilter()){t.restrict_by_tag_ids=this.categories.filter.list}this.set("query","");this.set("phrase",e);this._beforeResponseRequest();i=SM.API.taGetRollupPhrase(t);this._handleResponseRequest(i,this._lastSearch)},searchQuery:function(e){var t=this._makeSearchParams(),i,s=this;t.offset=0;t.search_phrase=e;if(this.categories.hasFilter()){t.restrict_by_tag_ids=this.categories.filter.list}this.set("phrase","");this.set("query",e);this._beforeResponseRequest();i=SM.API.taGetRollupSearch(t);this._handleResponseRequest(i,this._lastSearch)},filterCategories:function(e){var t;this.categories.filter.map={};this.categories.filter.list=e;t=this.categories.filter.map;$.each(e,function(e,i){t[i]=true});if(this.query){this.searchQuery(this.query)}else if(this.phrase){this.searchPhrase(this.phrase)}else{this.fetchResponses()}},_lastSearch:null,_loadResponseData:function(e){if(e.status===200){this.responses.load(e)}else{this.responses.set("failed",true)}},_loadCategoryData:function(e){if(e.status===200){this.categories.load(e.tags)}else{this.categories.set("failed",true)}},_loadAnalysisData:function(e){if(e.status===200){this.phrases.set("failed",false);this.phrases.load(e.text_analysis)}else{this.phrases.set("failed",true)}},_makeParams:function(){var e=this.get("survey");return{question_id:this.get("questionID"),variation_id:this.get("variationID"),option_id:this.get("optionID"),crosstab_option_id:this.get("crossedOptionID"),matrix_crosstab:this.get("matrixCrossTabID"),view_data:e.anviews.currentView.dump(),survey_id:e.ID}},_makeSearchParams:function(){var e=this._makeParams();SM.Object.update(e,{language:this._getLanguageParam(),page_size:this.PAGE_SIZE,hide_ids:1,include_question_tags:1,include_question_response_count:1});return e},_getLanguageParam:function(){switch(Globalize.culture().name){case"en":return"english";case"nl":return"dutch";case"da":return"danish";case"fr":return"french";case"de":return"german";case"it":return"italian";case"no":return"norwegian";case"pt":return"portuguese";case"ru":return"russian";case"es":return"spanish";case"sv":return"swedish";default:return"not_supported"}},_handleResponseRequest:function(e,t){var i=this;e.done(function(e,s,n){var a=e[i.ID];if(i._lastSearch===t){i.set("isSearching",false);if(a.text_data.status===i.TA_SUCCESS){i.responses.load(a.text_data)}else{if(i._lastSearch===t){i.responses.set("failed",true,{notify:true})}}}}).fail(function(){i.set("isSearching",false);if(i._lastSearch===t){i.responses.set("failed",true,{notify:true})}})},_beforeResponseRequest:function(e,t){this.responses.selection.clear();this.responses.set("failed",false);this.set("isSearching",true,{notify:true});this._lastSearch=SM.Date.timestamp()}});SM.TaLearnMoreView=SM.Views.deepExtend(SM.DialogView,{__NAME:"TaLearnMore",__templateID:"ta-upgrade-dialog-template",__defaults:{width:850,isModal:true},__init:function(){this.$el.on("click",".cancel-btn",{self:this},this._onCancel).on("click",".upgrade-btn",{self:this},this._onUpgrade)},_onCancel:function(e){e.preventDefault();e.data.self.close()},_onUpgrade:function(e){e.data.self.close()}});SM.TaUpgradeView=SM.Views.register({__NAME:"TAUpgradeNow",__templateID:"upgrade-now-topbar-template",__model:"taModel",__init:function(){var e=this.taModel.get("survey");this.$el.on("click",".close",{self:this},this._onCloseBtnClick);this.bindModel(e.owner,"hasDismissedTaUpgrade.changed",{self:this},this._onDismissUpgrade)},_onCloseBtnClick:function(e){var t=e.data.self,i=t.taModel.get("survey");e.preventDefault();i.owner.set("hasDismissedTaUpgrade",true,{notify:true})},_onDismissUpgrade:function(e){var t=e.data.self;if(e.value){t.$el.remove()}}});SM.TaResponseShowTextView=SM.Views.register({__NAME:"TaResponseShowText",__templateID:"ta-response-summary-text-template",__model:"taModel",__init:function(){var e=this.taModel;if(e.hasTextAnalysis()){this.$el.on("click","[ta-reset-results-btn]",{self:this},this._onClear);this.bindModel(e.responses.selection,"count.changed",{self:this},this._update);this.bindModel(e.responses,"failed.set",{self:this},this._onResponsesFailed);this.bindModel(e.responses,"loaded",{self:this},this._update);this.bindModel(e.responses,"responseRemoved",{self:this},this._update);this.bindModel(e.categories,"category.edited",{self:this},this._update);this.bindModel(e,"isSearching.changed",{self:this},this._update)}},__beforeRender:function(){var e,t=this.taModel,i=t.responses,s=i.selection,n=t.query,a=t.phrase,o=t.categories.hasFilter(),r=(n||a||o)&&t.hasTextAnalysis()&&!t.isSearching;e=s.isNone()?i.queryCount:s.count;return{responsesFailed:i.failed,taQuery:n||a||null,isSearching:t.isSearching,hasFilter:o,categories:t.categories.getFilterList(),hasSelection:!s.isNone(),hasSingle:e===1,responsesCount:Globalize.format(e,"n0"),canClear:r}},_update:function(e){e.data.self.render()},_onClear:function(e){e.preventDefault();e.data.self.taModel.clearQuery()},_onResponsesFailed:function(e){if(e.value){e.data.self.render()}}});SM.TaResponseSearchFormView=SM.Views.register({__NAME:"TAResponseSearchFrom",__templateID:"ta-response-search-form-template",__model:"taModel",__init:function(){var e=this.taModel;if(e.hasTextAnalysis()){this.bindModel(e,"searchDraft.changed",{self:this},this._onSearchChange);this.$el.on("paste","[ta-search-responses-input]",{self:this},this._onPaste).on("keyup","[ta-search-responses-input]",{self:this},this._onKeyup)}this.$el.on("submit","form",{self:this},this._onFormSubmit).on("click","[ta-search-responses-btn]",{self:this},this._onSearchBtnClick)},__beforeRender:function(){return{requireUpgrade:!this.taModel.hasTextAnalysis(),isDisabled:!this.taModel.hasTextAnalysis(),query:this.taModel.query}},__afterRender:function(){this.$el.find("[ta-search-tip]").popout()},_onSearchBtnClick:function(e){var t=e.data.self,i=t.taModel;e.preventDefault();if(i.hasTextAnalysis()){if(i.validate("searchDraft",i.searchDraft).isValid){t.trigger({type:"search",query:i.searchDraft})}}},_onKeyup:function(e){var t=e.data.self,i=$(e.target);t._isCurrentForm=true;t.taModel.set("searchDraft",i.val(),{notify:true})},_onPaste:function(e){var t=e.data.self,i=$(e.target);setTimeout(function(){t._isCurrentForm=true;t.taModel.set("searchDraft",i.val(),{notify:true})},0)},_onFormSubmit:function(e){var t=e.data.self,i=t.taModel;e.preventDefault();if(i.hasTextAnalysis()){t.$el.find("[ta-search-responses-btn]").click()}},_onSearchChange:function(e){var t=e.data.self,i=t.$el.find("[ta-search-responses-input]");if(!i.is(":focus")){i.val(e.value)}}});SM.TaCategoryFormView=SM.Views.register({__NAME:"TaCategoryForm",__templateID:"ta-category-form-template",__model:"category",__setup:function(){this.__defaults.saveText=Globalize.localize("Save")},__defaults:{isDisabled:true,ignoreEmptyName:false},__init:function(){this.$el.on("submit",{self:this},this._onFormSubmit).on("keyup","[category-name-text]",{self:this},this._onKeyup).on("paste","[category-name-text]",{self:this},this._onPaste).on("click","[color-swatch]",{self:this},this._onSwatchClick).on("click","[save-btn]",{self:this},this._onSaveClick);this.category.on("validated",{self:this},this._onNameValidation)},__destroy:function(){this.category.off("validated",this._onNameValidation)},__beforeRender:function(){var e,t=this.category,i=this._getSelectedColor();this._currentName=t.name;e=$.map(t._colorOptions,function(e,t){return{isSelected:e.hex===i,name:e.name,hex:e.hex}});return{maxLen:this.category.MAX_CATNAME_LEN,name:t.name,colors:e,saveText:this.__settings.saveText,isDisabled:this.__settings.isDisabled,isEdit:!t.isNew}},__setters:{isDisabled:function(e,t){var i=e.$el.find("[save-btn]");if(t){i.addClass("disabled")}else{i.removeClass("disabled")}e.__settings.isDisabled=t},isSaving:function(e,t){e.__settings.isSaving=t;e.render()}},_isDirty:function(){var e=this.category,t=this._currentName,i=t!==e.name;if(!e.isNew){return i||this._getSelectedColor()!==e.color}else{return i}},_testDirty:function(){var e=this.$el.find("[save-btn]");if(this._dirty||this._isDirty()){this.set("isDisabled",false)}else if(!this._isDirty()&&!this._dirty){this.set("isDisabled",true)}},markDirty:function(e){this._dirty=e;this._testDirty()},_dirty:false,_selectedColor:"",_onSwatchClick:function(e){var t=e.data.self,i=$(e.target);e.preventDefault();t._selectedColor=i.attr("color-hex");t.$el.find("[color-swatch]").removeClass("selected");i.addClass("selected");t._testDirty()},_onSaveClick:function(e){var t=e.data.self,i,s;e.preventDefault();i=t._currentName;s=t._getSelectedColor();t._removeError();if(t.__settings.isDisabled){return}if(t.__settings.ignoreEmptyName&&!t._currentName||t.category.validate("name",i).isValid){t.trigger({type:"save",color:s,name:i,ID:t.category.ID})}},_onFormSubmit:function(e){var t=e.data.self;e.preventDefault();t.$el.find("[save-btn]").click()},_onNameValidation:function(e){var t=e.data.self,i=e.validations.invalids.name,s=SM.Template.renderHTML("ta-category-name-error-template",{isEmpty:i.exception==="empty",isTooLong:i.exception==="maxlength",isDuplicate:i.exception==="duplicate"});t.$el.prepend(s)},_onKeyup:function(e){var t=e.data.self;t._currentName=$.trim(t.$el.find("[category-name-text]").val());if(e.which!==SM.KeyCodes.ENTER&&e.which!==SM.KeyCodes.NUMPAD_ENTER){t._removeError();t._testDirty()}},_onPaste:function(e){var t=e.data.self;setTimeout(function(){t._currentName=$.trim(t.$el.find("[category-name-text]").val());t._removeError();t._testDirty()},0)},_removeError:function(){this.$el.find("[category-error-msg]").remove()},_getSelectedColor:function(){return this._selectedColor||this.category.color}});SM.TaCagetoriesAppliedView=SM.Views.register({__NAME:"TaCategoriesApplied",__templateID:"ta-categories-chkbox-list-template",__model:"categories",__init:function(){var e=this.categories;this.selection=SM.Models.create("AppliedCategoriesSelection",{responseID:this.__settings.responseID});this.selection.load(e);this.$el.on("change","[category-item-chkbx]",{self:this},this._onStateChange).on("click","[ta-list-item-overlay]",{self:this},this._onListItemClick)},__beforeRender:function(){var e=this.categories.sortedList;return{categories:this.categories.sortedList.slice(0,e.length-1)}},__afterRender:function(){var e=this.categories.sortedList,t=this.__settings.responseID;this.$el.find("[category-item-chkbx]").each(function(i,s){var n=e[i].getApplicationState(t);if(n==="indeterminate"){s.indeterminate=true}else{s.checked=n==="checked"}})},_onStateChange:function(e){var t=e.data.self,i=$(e.target),s=i.closest("[category-id]"),n=s.find("[category-item-chkbx]"),a=s.attr("category-id");t.selection.update(a,e.target.checked?"checked":"unchecked");t.trigger("selectionChanged")},_onListItemClick:function(e){var t=e.data.self,i=$(e.target),s=i.closest("[category-id]"),n=s.find("[category-item-chkbx]"),a=n.get(0).indeterminate;if(a){n.get(0).indeterminate=false;n.prop("checked",true)}else{n.prop("checked",!n.prop("checked"))}n.trigger("change").focus()}});SM.TaCategorizeMenuView=SM.Views.deepExtend(SM.BaseMenuView,{__NAME:"TaCategorizeMenu",__templateID:"ta-categorize-menu-template",__model:"categories",__init:function(){this.$el.on("TaCategoryForm.save",{self:this},this._onApplyCategories).on("TaCategoriesApplied.selectionChanged",{self:this},this._onSelectionChange)},__afterRender:function(){var e=this.categories,t,i,s=e.createModel();if(e.count()>0){this.categoriesView=SM.Views.create(SM.TaCagetoriesAppliedView,{model:e,responseID:this.__settings.responseID});this.el.appendChild(this.categoriesView.el)}this.formView=SM.Views.create(SM.TaCategoryFormView,{model:s,saveText:Globalize.localize("Apply"),ignoreEmptyName:true});this.el.appendChild(this.formView.el)},_onSelectionChange:function(e){var t=e.data.self,i=t.categoriesView;t.formView.markDirty(i.selection.isDirty())},_onApplyCategories:function(e){var t=e.data.self;e.selection=t.categoriesView&&t.categoriesView.selection.dump()}});SM.CategorizeMenu=SM.Widgets.deepExtend(SM.BaseMenu,{__NAME:"categorizeMenu",__onMenuInit:function(){this.get("menuView").$el.on("TaCategoryForm.save",{self:this},this._onApplyCategories).on("click","[cancel-btn]",{self:this},this._onCancelCategories)},__onBeforeMenuOpen:function(){SM.BaseMenu.__onBeforeMenuOpen.call(this);this.get("menuView").render()},_menuView:"TaCategorizeMenuView",_onApplyCategories:function(e){var t=e.data.self;e.preventDefault();t.close();t.trigger({type:"apply",responseID:t.__settings.responseID,selection:e.selection,name:e.name,color:e.color})},_onCancelCategories:function(e){e.preventDefault();e.data.self.close()}});SM.TaCategoryFilterListView=SM.Views.register({__NAME:"TaCagetoryFilterList",__templateID:"ta-categories-chkbox-list-template",__model:"categories",__init:function(){var e=this.categories,t;if(!e.filterSelection){t=SM.Models.create("FilterCategoriesSelection");e.loadFilterSelection(t)}e.filterSelection.loadSelection();this.$el.on("change","[category-item-chkbx]",{self:this},this._onStateChange).on("click","[ta-list-item-overlay]",{self:this},this._onListItemClick)},__beforeRender:function(){return{categories:this.categories.sortedList}},__afterRender:function(){var e=this.categories.sortedList;this.$el.find("[category-item-chkbx]").each(function(t,i){i.checked=e[t].isFiltering()})},_onStateChange:function(e){var t=e.data.self,i=$(e.target),s=i.closest("[category-id]"),n=s.find("[category-item-chkbx]"),a=s.attr("category-id");t.categories.filterSelection.update(a,e.target.checked)},_onListItemClick:function(e){var t=e.data.self,i=$(e.target),s=i.closest("[category-id]"),n=s.find("[category-item-chkbx]");n.prop("checked",!n.prop("checked")).trigger("change").focus()}});SM.TaFilterMenuView=SM.Views.deepExtend(SM.BaseMenuView,{__NAME:"TaFilterMenu",__templateID:"ta-filter-menu-template",__defaults:{isDisabled:true},__model:"categories",__init:function(){var e=this.categories;e.filterSelection.on("selection.changed",{self:this},this._onSelectionChange);this.$el.on("click","[clear-btn]",{self:this},this._onClearClick)},__destroy:function(){var e=this.categories;e.filterSelection.off("selection.changed",this._onSelectionChange)},__beforeRender:function(){return{isDisabled:this.__settings.isDisabled,hasFilter:this.categories.hasFilter()}},__afterRender:function(){var e=this.categories,t;t=SM.Views.create(SM.TaCategoryFilterListView,{model:e});this.$el.prepend(t.el)},_onClearClick:function(e){var t=e.data.self;e.preventDefault();t.categories.filterSelection.clear();t.$el.find("[clear-btn]").addClass("disabled");t.$el.find("input[type=checkbox]").prop("checked",false)},_onSelectionChange:function(e){var t=e.data.self,i=t.$el.find("[clear-btn]"),s=t.$el.find("[save-btn]");if(e.isDirty){s.removeClass("disabled")}else{s.addClass("disabled")}if(!t.categories.filterSelection.isEmpty()){i.removeClass("disabled")}}});SM.TaCategoriesShowTextView=SM.Views.register({__NAME:"TaCategoriesShowText",__templateID:"ta-categories-summary-text-template",__model:"categories",__init:function(){var e=this.categories.taModel;e.on("category.deleted",{self:this},this._onChangeCount);e.on("category.added",{self:this},this._onChangeCount)},__destroy:function(){var e=this.categories.taModel;e.off("category.deleted",this._onChangeCount);e.off("category.added",this._onChangeCount)},__beforeRender:function(){var e=this.categories;return{hasCategories:!e.isEmpty(),hasMany:e.hasMany(),hasError:e.failed,count:Globalize.format(e.count(),"n0")}},_onChangeCount:function(e){var t=e.data.self;t.render()}});SM.TaCategoriesToolbarView=SM.Views.register({__NAME:"TaCategoriesToolbar",__templateID:"ta-categories-toolbar-template",__model:"taModel",__beforeRender:function(){return{isDisabled:this.taModel.categories.failed}},__afterRender:function(){var e,t;t=SM.Views.create(SM.TaResponseSearchFormView,{model:this.taModel});e=SM.Views.create(SM.TaCategoriesShowTextView,{model:this.taModel.categories});this.$el.find("[ta-toolbar-row-a]").prepend(t.el);this.$el.append(e.el)}});SM.TaCategoryItemView=SM.Views.register({__NAME:"TaCategoryItem",__templateID:"ta-category-item-template",__model:"category",__defaults:{mode:"view"},__init:function(){this.category.on("responseCount.changed",{self:this},this._onCountChange)},__destroy:function(){this.category.off("responseCount.changed",this._onCountChange)},__beforeRender:function(){var e=this.category;return{deleteMode:this._isDeleteMode(),viewMode:this._isViewMode(),editMode:this._isEditMode(),isSaving:this.__settings.isSaving,isUncategorized:e.isUncategorized,name:e.name,color:e.color,ID:e.ID,count:e.responseCount,localizedPercent:e.get("localizedPercent"),percent:e.get("percent")}},__afterRender:function(){var e;if(this._isEditMode()){this.$el.on("leave",{self:this},this._onLeaveEdit).on("keyup",{self:this},this._onKeyup);e=SM.Views.create(SM.TaCategoryFormView,{model:this.category});this.el.appendChild(e.el);this.$el.find("input").focus()}},__setters:{mode:function(e,t){e.__settings.mode=t;e.render()}},modes:{VIEW:"view",DELETE:"delete",EDIT:"edit"},_cancel:function(){if(this.category.isNew){this.category.off("isLoading.changed",this._onLoading)}this.$el.find("[cancel-btn]").click()},_isDeleteMode:function(){return this.__settings.mode===this.modes.DELETE},_isViewMode:function(){return this.__settings.mode===this.modes.VIEW},_isEditMode:function(){return this.__settings.mode===this.modes.EDIT},_onLeaveEdit:function(e){var t=e.data.self;t.$el.off("leave");t._cancel()},_onKeyup:function(e){var t=e.data.self;if(e.which===SM.KeyCodes.ESCAPE){t.$el.off("keyup");t._cancel()}},_onCountChange:function(e){var t=e.data.self;t.render()}});SM.TaCategoriesListView=SM.Views.register({__NAME:"TaCategoriesListView",__templateID:"ta-categories-list-template",__model:"categories",__init:function(){this.categories.taModel.on("category.added",{self:this},this._onAdd);this.$el.on("TaCategoryForm.save",{self:this},this._onSave).on("click","[confirm-delete-btn]",{self:this},this._onConfirmDeleteClick).on("click","[delete-btn]",{self:this},this._onDeleteClick).on("click","[cancel-btn]",{self:this},this._onCancelClick).on("click","[edit-btn]",{self:this},this._onEditClick)},__destroy:function(){this.categories.taModel.off("category.added",this._onAdd)},__afterRender:function(){var e=this.categories,t,i;if(e.failed){t=SM.Template.render("ta-categories-error-template",{isServiceError:true});this.$el.html(t)}else{i=$.map(e.sortedList,function(e,t){return SM.Views.create(SM.TaCategoryItemView,{model:e}).el});this.$el.append(i)}},_onConfirmDeleteClick:function(e){var t=e.data.self,i;e.preventDefault();i=t._getViewData(e.target);i.model.kill();i.view.$el.remove()},_onDeleteClick:function(e){var t=e.data.self,i;e.preventDefault();i=t._getViewData(e.target);i.view.set("mode",i.view.modes.DELETE)},_onCancelClick:function(e){var t=e.data.self,i;e.preventDefault();i=t._getViewData(e.target);if(i.model.isNew){i.view.$el.remove()}else{i.view.set("mode",i.view.modes.VIEW)}},_onEditClick:function(e){var t=e.data.self,i;e.preventDefault();i=t._getViewData(e.target);i.view.set("mode",i.view.modes.EDIT)},_onSave:function(e){var t=e.data.self,i;e.preventDefault();i=t._getViewData(e.target);if(i.model.isNew){i.model.color=e.color;i.model.name=e.name;i.view.set("isSaving",true);i.view.set("mode",i.view.modes.VIEW);i.model.save()}else{i.model.edit({color:e.color,name:e.name});i.view.set("mode",i.view.modes.VIEW)}},createNewCategory:function(e){var t=SM.Views.create(SM.TaCategoryItemView,{model:e,mode:"edit",isNew:true});this.$el.prepend(t.el);this.$el.find("input").focus()},_getViewData:function(e){var t=$(e).closest("[category-id]"),i=t.data("TaCategoryItem");return{view:i,model:i.category}},_onAdd:function(e){e.data.self.render()}});SM.TaCategoriesPanelView=SM.Views.extend({__NAME:"TaCategoriesPanel",__templateID:"ta-categories-panel-template",__model:"taModel",__init:function(){this.$el.on("click","[ta-new-category-btn]",{self:this},this._onCreateClick)},__afterRender:function(e){var t,i,s=this.taModel;i=SM.Views.create(SM.TaCategoriesToolbarView,{model:s});this._listView=SM.Views.create(SM.TaCategoriesListView,{model:this.taModel.categories});this.$el.append(i.el);this.$el.append(this._listView.el)},_onCreateClick:function(e){var t=e.data.self,i;e.preventDefault();if(!t.taModel.categories.failed){i=t.taModel.categories.createModel();t._listView.createNewCategory(i)}}});SM.TaResponseBtnMenuView=SM.Views.register({__NAME:"TaResponseBtnMenu",__templateID:"ta-response-btn-menu-template",__model:"taModel",__init:function(){var e=this,t=e.taModel,i=t.responses.selection;if(t.hasTextAnalysis()){i.on("count.changed",{self:this},this._enableCategorizeMenu);t.on("category.deleted",{self:this},this._enableFilterMenu);t.on("category.added",{self:this},this._enableFilterMenu);this.$el.on("categorizeMenu.apply",{self:this},this._onApplyCategories).on("menu.menuInit","[filter-menu-btn]",{self:this},this._onFilterMenuInit).on("menu.beforeOpen","[filter-menu-btn]",{self:this},this._onFilterBeforeOpen).on("menu.afterOpen","[filter-menu-btn]",{self:this},this._onFilterAfterOpen)}},__destroy:function(){var e=this.taModel,t=e.responses.selection;if(e.hasTextAnalysis()){t.off("count.changed",this._enableCategorizeMenu);e.off("category.deleted",this._enableFilterMenu);e.off("category.added",this._enableFilterMenu)}},__beforeRender:function(){var e=this.taModel,t=e.responses,i=t.selection,s=!e.hasTextAnalysis()||e.categories.isEmpty()||e.filterCount===0||e.categories.failed,n=!e.hasTextAnalysis()||i.get("count")===0||e.categories.failed;return{hasSelectAll:e.hasTextAnalysis()&&!e.categories.failed,isCategorizeDisabled:n,isFilterDisabled:s,requireUpgrade:!e.hasTextAnalysis()}},__afterRender:function(){var e=this,t=e.taModel,i=t.responses.selection;if(t.hasTextAnalysis()){this.$el.find("[categorize-menu-btn]").categorizeMenu({model:this.taModel.categories});this._filterMenu=this.$el.find("[filter-menu-btn]").menu({menuView:"TaFilterMenuView",model:this.taModel.categories}).data("menu")}},_enableCategorizeMenu:function(e){var t=e.data.self,i=t.$el.find("[categorize-menu-btn]");if(t.taModel.responses.selection.isNone()){i.addClass("disabled")}else{i.removeClass("disabled")}},_enableFilterMenu:function(e){var t=e.data.self,i=t.$el.find("[filter-menu-btn]");if(t.taModel.categories.isEmpty()){i.addClass("disabled")}else{i.removeClass("disabled")}},_onApplyCategories:function(e){var t=e.data.self,i;i=t.taModel.responses.applyCategories(e.selection,{label:e.name,color:e.color});t.taModel.responses.save(i.diff,i.responseIDs,i.except)},_onFilterBeforeOpen:function(e){var t=e.menu.get("menuView");t.render()},_onFilterAfterOpen:function(e){var t=e.menu.get("menuView");t.$el.find("input:first").focus()},_onFilterMenuInit:function(e){var t=e.data.self,i=e.menu.get("menuView");i.$el.on("click","[save-btn]",{menu:e.menu,self:t},t._onApplyFilter).on("click","[cancel-btn]",{menu:e.menu,self:t},t._onCancelFilter)},_onApplyFilter:function(e){var t=e.data.self,i=t.taModel.categories.filterSelection;e.preventDefault();if(i.isDirty()){i.apply();e.data.menu.close()}},_onCancelFilter:function(e){e.preventDefault();e.data.menu.close()}});SM.TaResponseSelectAllView=SM.Views.register({__NAME:"TaResponseSelectAllView",__templateID:"ta-select-all-template",__model:"taModel",__init:function(){var e=this.taModel,t=e.responses,i=t.selection;t.on("loaded",{self:this},this._onResponsesLoaded);e.on("isSearching.changed",{self:this},this._onSearching);i.on("count.changed",{self:this},this._onCountChange);this.$el.on("click",{self:this},this._onSelectAllClick)},__destroy:function(){var e=this.taModel,t=e.responses,i=t.selection;i.off("count.changed",this._onCountChange);t.off("loaded",this._onResponsesLoaded)},__afterRender:function(){this.$el.prop("checked",this.taModel.responses.selection.isAll()).prop("disabled",this.taModel.responses.queryCount===0||this.taModel.isSearching)},_onSelectAllClick:function(e){var t=e.data.self,i=$(e.target),s=t.taModel.responses,n=i.prop("checked");if(n){s.selection.selectAll()}else{s.selection.clear()}},_onCountChange:function(e){e.data.self.render()},_onResponsesLoaded:function(e){e.data.self.render()},_onSearching:function(e){e.data.self.render()}});SM.TaResponseToolbarView=SM.Views.register({__NAME:"TAResponseTopBar",__templateID:"ta-response-toolbar-template",__model:"taModel",
__afterRender:function(){var e=this.taModel,t,i,s,n,a=e.hasTextAnalysis()&&!e.categories.failed,o=this.$el.find("[ta-toolbar-row-a]");s=SM.Views.create(SM.TaResponseSearchFormView,{model:this.taModel});o.append(s.el);if(a){n=SM.Views.create(SM.TaResponseSelectAllView,{model:this.taModel});o.append(n.el)}i=SM.Views.create(SM.TaResponseBtnMenuView,{model:this.taModel});o.append(i.el);t=SM.Views.create(SM.TaResponseShowTextView,{model:this.taModel});this.$el.append(t.el)}});SM.TaLoadMoreResponsesView=SM.Views.register({__NAME:"TaLoadMoreResponsesView",__model:"responses",__templateID:"ta-load-more-responses-template",__defaults:{fetchMoreFailed:false,fetchFailErrorID:null},__init:function(){this.$el.on(SM.Event.CLICK,"[ta-responses-try-again-btn]",{self:this},this._onTryAgainClicked);this.responses.on("fetchMoreResponses.failed",{self:this},this._onFetchFail)},__destroy:function(){this.responses.off("fetchMoreResponses.failed",this._onFetchFail)},__beforeRender:function(){return{id:this.get("ID"),failed:this.get("fetchMoreFailed"),errorID:this.get("fetchFailErrorID")}},_onFetchFail:function(e){var t=e.data.self;t.set("fetchMoreFailed",true);t.set("fetchFailErrorID",t.responses.fetchFailErrorID);t.render()},_onTryAgainClicked:function(e){var t=e.data.self;e.preventDefault();t.set("fetchMoreFailed",false);t.set("fetchFailErrorID",null);t.render();t.responses.taModel.fetchMoreResponses()}});SM.TaResponseItemView=SM.Views.register({__NAME:"TaResponseItem",__templateID:"ta-response-item-template",__model:"response",__init:function(){this.bindModel(this.response,"categoryIDs.changed",{self:this},this._onCategoryIDsChange);this.bindModel(this.response.responses.taModel.categories,"category.edited",{self:this},this._onCategoryEdited);this.bindModel(this.response,"category.removed",{self:this},this._onCategoryRemoved)},__beforeRender:function(){var e=this.response,t=e.responses.taModel;return{ID:e.ID,categories:e.categories.list,text:e.text,createDate:e.dateStr,respondentUrl:e.respondentUrl,isChecked:e.isSelected(),isBasic:!e.responses.taModel.hasTextAnalysis(),canCategorize:t.hasTextAnalysis()&&!t.categories.failed,actionsEnabled:this._areActionsEnabled()}},__afterRender:function(){var e=this.response.responses.taModel;if(e.hasTextAnalysis()&&!e.categories.failed){this.$el.find("[categorize-menu-btn]").categorizeMenu({model:e.categories,responseID:this.response.ID,parentEl:this.__settings.parentEl})}},_onCategoryIDsChange:function(e){var t=e.data.self;if(t.response.get("isInFilter")){t.render()}else{t.$el.remove()}},_onCategoryEdited:function(e){var t=e.data.self;if(t.response.categories.map[e.category.ID]){t.render()}},_onCategoryRemoved:function(e){var t=e.data.self;t.render()},_areActionsEnabled:function(){return!SM.App.isSharingApp()}});SM.TaResponseListView=SM.Views.register({__NAME:"TaResponseList",__templateID:"ta-response-list-template",__model:"responses",__create:function(){this.set("lazyLoaderID",this.__NAME+"loader"+this.__uid)},__init:function(){this.$el.on("infiniteScroll.reachedEnd",{self:this},this._requestMoreResponses).on("multiselect.applied",{self:this},this._onMultiSelectApplied);this.responses.on("appended",{self:this},this._onResponsesAppended);if(this.responses.taModel.hasTextAnalysis()){this.responses.selection.on("count.changed",{self:this},this._onCountChange);this.responses.taModel.on("isSearching.changed",{self:this},this._onIsSearching);this.responses.on("loaded",{self:this},this._onResponsesLoaded);this.responses.on("failed.set",{self:this},this._onResponsesFailed);this.$el.on("change","[response-item-chkbx]",{self:this},this._onItemSelected);this.$el.on("categorizeMenu.apply","[categorize-menu-btn]",{self:this},this._onApplyCategories)}this._infiniteScroll=this.$el.infiniteScroll({markerID:this.get("lazyLoaderID")}).data("infiniteScroll");this.$el.multiselect({checkboxSelector:"input[response-item-chkbx]"})},__destroy:function(){this.responses.off("appended",this._onResponsesAppended);if(this.responses.taModel.hasTextAnalysis()){this.responses.selection.off("count.changed",this._onCountChange);this.responses.taModel.off("isSearching.changed",this._onIsSearching);this.responses.off("failed.set",this._onResponsesFailed);this.responses.off("loaded",this._onResponsesLoaded)}},__afterRender:function(){var e=this.responses,t=this,i,s,n;if(e.failed){s=SM.Template.render("ta-responses-error-template",{isServiceError:true});this.$el.html(s)}else if(e.taModel.isSearching){s=SM.Template.render("qtext-search-spinner-template");this.$el.html(s)}else{if(!e.isEmpty()){n=this._createListFragment(e.list);this.$el.append(n)}if(this._hasUnloadedResponses()){i=SM.Views.create(SM.TaLoadMoreResponsesView,{model:this.responses,ID:this.get("lazyLoaderID")});this.$el.append(i.el)}}},_createListFragment:function(e){var t=document.createDocumentFragment(),i=this;$.each(e,function(e,s){var n=SM.Views.create(SM.TaResponseItemView,{model:s,parentEl:i.el}).el;t.appendChild(n)});return t},_requestMoreResponses:function(e){var t=e.data.self;t.responses.taModel.fetchMoreResponses();e.stopPropagation()},_hasUnloadedResponses:function(){return this.responses.loadedCount<this.responses.queryCount+this.responses.removedCount},_updateResponseSelection:function(e){var t=$(e),i=this.responses.selection,s=e.checked,n=t.closest("[data-response-id]"),a=n.attr("data-response-id");if(s){i.add(a)}else{i.remove(a)}},_onMultiSelectApplied:function(e){var t=e.data.self;e.$checkboxes.each(function(){t._updateResponseSelection(this)})},_onItemSelected:function(e){var t=e.data.self;if(!e.isEditingAll){t._updateResponseSelection(e.target)}},_onCountChange:function(e){var t=e.data.self;if(t.responses.selection.isAll()){t.$el.find("input[response-item-chkbx]").each(function(){this.checked=true});t.$el.data("multiselect").reset()}else if(t.responses.selection.isNone()){t.$el.find("input[response-item-chkbx]").each(function(){this.checked=false});t.$el.data("multiselect").reset()}},_onIsSearching:function(e){var t=e.data.self;t._infiniteScroll.set("isActive",false);t.render()},_onResponsesLoaded:function(e){var t=e.data.self;t.render();if(!t._hasUnloadedResponses()){t._infiniteScroll.removeMarker()}t._infiniteScroll.set("isActive",true)},_onResponsesFailed:function(e){var t=e.data.self;if(e.value){t.render()}},_onResponsesAppended:function(e){var t=e.data.self,i=t._createListFragment(e.respondents);t.$el.find("[data-response-id]").last().after(i);if(!t._hasUnloadedResponses()){t._infiniteScroll.removeMarker()}t._infiniteScroll.set("isActive",true)},_onApplyCategories:function(e){var t=e.data.self,i,s=t.responses.map[e.responseID];i=s.applyCategories(e.selection,{label:e.name,color:e.color});s.save(i)}});SM.TaResponsesPanelView=SM.Views.extend({__NAME:"TAResponsePanel",__templateID:"ta-response-panel-template",__model:"taModel",__create:function(){var e=this;e.survey=e.taModel.get("survey");e.hasTextAnalysis=e.taModel.hasTextAnalysis()},__afterRender:function(e){var t=this,i,s,n;if(t._shouldShowUpgradeView()){i=SM.Views.create(SM.TaUpgradeView,{model:t.taModel});t.$el.append(i.el)}if(t._shouldShowToolbar()){n=SM.Views.create(SM.TaResponseToolbarView,{model:t.taModel});t.$el.append(n.el)}s=SM.Views.create(SM.TaResponseListView,{model:t.taModel.responses});t.$el.append(s.el)},_shouldShowToolbar:function(){return!SM.App.isSharingApp()&&!SM.App.isMerveysApp()},_shouldShowUpgradeView:function(){var e=this;if(SM.App.isSharingApp()){return false}else{return!e.hasTextAnalysis&&!e.survey.owner.hasDismissedTaUpgrade}}});SM.TaAnalysisShowTextView=SM.Views.register({__NAME:"TaAnalysisShowText",__templateID:"ta-analysis-summary-text-template",__model:"phrases",__init:function(){this.bindModel(this.phrases,"TaAnalysisInProgress.changed",{self:this},this._onAnalysisInProgress)},__beforeRender:function(){var e=this.phrases,t=e.list.length;return{hasAny:t>0,count:t,hasError:e.failed,inProgress:e.inProgress}},_onAnalysisInProgress:function(e){var t=e.data.self;t.render()}});SM.TaAnalysisTypeBtnView=SM.Views.register({__NAME:"TaAnalysisTypeBtn",__templateID:"ta-analysis-type-btn-template",__model:"taModel",__init:function(){var e=this;this.$el.on("selectMenu.change","a[ta-analysis-type]",function(t){e.$el.trigger("analysisTypeChange",t.value)}).on("selectMenu.afterOpen","a[ta-analysis-type]",function(e){var t=e.selectMenu.get("menuView");t.$el.find(".q").popout()})},__afterRender:function(){this.$el.find("[ta-analysis-type]").selectMenu({selectedValue:"lingo",options:[{text:Globalize.localize("Most Important"),value:"lingo"},{text:Globalize.localize("Most Frequent"),value:"nltk"}]})}});SM.TaAnalysisToolbarView=SM.Views.register({__NAME:"TaAnalysisToolbar",__templateID:"ta-analysis-toolbar-template",__model:"taModel",__init:function(){var e=this;this._popouts={};this.taModel.phrases.on("viewMode.changed",{self:this},this._onViewModeChanged);this.$el.on(SM.Event.CLICK,"[ta-phrase-mode-tab]",{self:this},this._onTabClick).on(SM.Event.MOUSEENTER,"[ta-phrase-mode-tab]",{self:this},this._onMouseenter).on(SM.Event.MOUSELEAVE,"[ta-phrase-mode-tab]",{self:this},this._onMouseleave);this.$el.on({analysisTypeChange:function(t,i){e._onAnalysisClick(e,t,i)}})},__destroy:function(){this.taModel.phrases.off("viewMode.changed",this._onViewModeChanged)},__beforeRender:function(){var e=this.taModel.phrases.viewModes;return{cloudTab:e.CLOUD,listTab:e.LIST,lingoAnalysis:Globalize.localize(e.LINGO),nltkAnalysis:Globalize.localize(e.NLTK),isDisabled:this.taModel.phrases.failed}},__afterRender:function(){var e,t=this.taModel,i=t.phrases,s;s=SM.Views.create(SM.TaResponseSearchFormView,{model:t});e=SM.Views.create(SM.TaAnalysisShowTextView,{model:i});if(this.taModel.flags.nltkOptionEnabled){taTypeView=SM.Views.create(SM.TaAnalysisTypeBtnView,{model:t});this.$el.find("[ta-toolbar-row-a]").append(taTypeView.el)}if(!this.taModel.phrases.failed){this.$el.find("[ta-phrase-mode-tab="+i.viewMode+"]").addClass("open")}this.$el.find("[ta-toolbar-row-a]").prepend(s.el);this.$el.append(e.el)},_onViewModeChanged:function(e){var t=e.data.self;t.$el.find("[ta-phrase-mode-tab]").removeClass("open");t.$el.find("[ta-phrase-mode-tab="+e.value+"]").addClass("open")},_onTabClick:function(e){var t=e.data.self,i=$(e.target),s=t.taModel.phrases;e.preventDefault();if(!s.failed){s.set("viewMode",i.attr("ta-phrase-mode-tab"),{notify:true})}},_onAnalysisClick:function(e,t,i){var s=e.taModel.phrases,n=$(t.target),a=e.taModel._makeSearchParams();a.offset=0;e.taModel.phrases.set("inProgress",true);e.taModel.phrases._trigger("TaAnalysisInProgress.changed");a["is_lingo"]=i==="lingo";SM.API.taGetRollupQuestion(a).done(function(t,i,s){var n=t[e.taModel.ID],a;n["flags"]=e.taModel.flags;e.taModel.load(n,"analysisTypeChange");e.taModel.phrases._trigger("TaCloudDataLoaded");e.taModel.phrases.set("inProgress",false);e.taModel.phrases._trigger("TaAnalysisInProgress.changed")});t.preventDefault()},_getViewMode:function(e){return e==="cloud"?"Cloud":"List"},_onMouseenter:function(e){var t=e.data.self,i=$(e.target),s=t._getViewMode(i.attr("ta-phrase-mode-tab"));t._addTip(i,s)},_onMouseleave:function(e){var t=e.data.self,i=$(e.target),s=t._getViewMode(i.attr("ta-phrase-mode-tab"));t._removeTip(s)},_addTip:function(e,t){var i;if(!this._popouts[t]){i=SM.Template.renderHTML("ta-mode-tab-popout-template",{isCloudViewMode:t=="Cloud"});this._popouts[t]=$(i)}$(document.body).append(this._popouts[t]);this._popouts[t].removeClass("out").position({my:"center bottom",at:"center top",of:e,collision:"none"}).addClass("active")},_removeTip:function(e){var t=this;if(!this._popouts[e]){return}this._popouts[e].addClass("out");setTimeout(function(){if(t._popouts&&t._popouts[e]){t._popouts[e].removeClass("active").detach()}},200)}});SM.TaAnalysisListView=SM.Views.register({__NAME:"TaAnalysisListView",__templateID:"ta-analysis-list-template",__model:"phrases",__beforeRender:function(){var e=$.map(this.phrases.list,function(e,t){return{ID:e.ID,localizedPercent:e.get("localizedPercent"),percent:e.get("percent"),count:e.responseCount,text:e.text}});return{phrases:e}}});SM.TaAnalysisCloudView=SM.Views.register({__NAME:"TaAnalysisCloudView",__templateID:"ta-analysis-cloud-template",__model:"phrases",__init:function(){this._popouts={};this.$el.on("click","[phrase-filter-id]",{self:this},this._onClick).on("mouseenter","[phrase-filter-id]",{self:this},this._onMouseenter).on("mouseleave","[phrase-filter-id]",{self:this},this._onMouseleave);this.bindModel(this.phrases,"TaCloudDataLoaded",{self:this},this._newDataLoaded)},__beforeRender:function(){var e=$.map(this.phrases.sortedList,function(e,t){return{ID:e.ID,fontSize:e.get("fontSize"),text:SM.String.truncate(e.text,100,false)}});return{phrases:e}},__destroy:function(){if(!!this._popouts){$.each(this._popouts,function(e,t){t.remove()})}this._popouts=null},_onMouseenter:function(e){var t=e.data.self,i=$(e.target),s=i.attr("phrase-filter-id");t._addTip(i,s)},_onMouseleave:function(e){var t=e.data.self,i=$(e.target),s=i.attr("phrase-filter-id");t._removeTip(s)},_onClick:function(e){var t=e.data.self,i=$(e.target),s=i.attr("phrase-filter-id");t._removeTip(s)},_phraseWidth:function(e){if(e>500){return"right top"}return"center top"},_addTip:function(e,t){var i=this.phrases.map[t],s;if(!this._popouts[t]){s=SM.Template.renderHTML("ta-cloud-popout-template",{hasMany:i.hasManyResponses(),count:i.responseCount,percent:i.get("localizedPercent"),rank:i.rank});this._popouts[t]=$(s)}$(document.body).append(this._popouts[t]);this._popouts[t].removeClass("out").position({my:"center bottom",at:this._phraseWidth(e.width()),of:e,collision:"none"}).addClass("active")},_removeTip:function(e){var t=this;if(!this._popouts[e]){return}this._popouts[e].addClass("out");setTimeout(function(){if(t._popouts&&t._popouts[e]){t._popouts[e].removeClass("active").detach()}},200)},_newDataLoaded:function(e){var t=e.data.self;t.render()}});SM.TaAnalysisContentView=SM.Views.register({__NAME:"TaAnalysisContent",__templateID:"ta-analysis-panel-content-template",__model:"phrases",__init:function(){this.phrases.on("viewMode.changed",{self:this},this._onViewModeChanged);this.bindModel(this.phrases,"TaAnalysisInProgress.changed",{self:this},this._onAnalysisInProgress)},__destroy:function(){this.phrases.off("viewMode.changed",this._onViewModeChanged)},__afterRender:function(e){var t=this.phrases,i,s,n=Globalize.culture().name;if(!t.isLanguageAvailable(n)){i=SM.Template.render("ta-analysis-error-template",{isUnsupported:true})}else if(t.isOverResponseLimit()){i=SM.Template.render("ta-analysis-error-template",{isOverLimit:true,limit:Globalize.format(t.LINGO_MAX_COUNT,"n0")})}else if(t.failed){i=SM.Template.render("ta-analysis-error-template",{isServiceError:true})}else if(t.inProgress){i=SM.Template.render("ta-analysis-spinner-template")}else if(t.viewMode==="cloud"){i=SM.Views.create(SM.TaAnalysisCloudView,{model:t}).el}else{i=SM.Views.create(SM.TaAnalysisListView,{model:t}).el}this.$el.html(i)},_onViewModeChanged:function(e){var t=e.data.self;t.render()},_onAnalysisInProgress:function(e){var t=e.data.self;t.render()}});SM.TaAnalysisPanelView=SM.Views.extend({__NAME:"TaAnalysisPanel",__templateID:"ta-analysis-panel-template",__model:"taModel",__afterRender:function(e){var t,i;i=SM.Views.create(SM.TaAnalysisToolbarView,{model:this.taModel});t=SM.Views.create(SM.TaAnalysisContentView,{model:this.taModel.phrases});this.$el.append(i.el);this.$el.append(t.el)}});SM.TaTabsView=SM.Views.register({__NAME:"TaTabsView",__templateID:"ta-tabs-template",__model:"taModel",__defaults:{selectedTab:"responses"},__init:function(){var e=this.taModel;this.$el.tabs({selectedTab:this.__settings.selectedTab});e.on("category.deleted",{self:this},this._onCategoryCountChange);e.on("category.added",{self:this},this._onCategoryCountChange);this.$el.on("TAResponseSearchFrom.search",{self:this},this._onSearch).on("click","[category-filter-id]",{self:this},this._onCategoryClick).on("click","[phrase-filter-id]",{self:this},this._onPhraseClick).on("click","[learn-more-trigger]",{self:this},this._onLearnMoreClick)},__destroy:function(){this.taModel.off("category.deleted",this._onCategoryCountChange);this.taModel.off("category.added",this._onCategoryCountChange)},__beforeRender:function(){var e=this.taModel.hasTextAnalysis(),t=this.get("selectedTab"),i=this.taModel,s=[];s.push({name:"responses",icon:"w",hasCount:true,count:Globalize.format(i.filterCount,"n0"),text:Globalize.localize("Responses"),isDisabled:false});if(this._shouldShowAnalysisTab()){s.push({name:"analysis",icon:"C",text:Globalize.localize("Text Analysis"),isDisabled:!e})}if(this._shouldShowCategoriesTab()){s.push({name:"categories",icon:"z",text:Globalize.localize("My Categories"),hasCount:!i.categories.failed,count:e&&!i.categories.failed?Globalize.format(i.categories.count(),"n0"):0,isDisabled:!e})}$.each(s,function(e,i){i.isOpen=t===i.name});return{tabs:s}},__afterRender:function(e){var t=[],i,s,n,a=this.taModel.hasTextAnalysis(),o=this.$el.find("[ta-tabs-panel]");i=SM.Views.create(SM.TaResponsesPanelView,{model:this.taModel});t.push(i.el);if(a){s=SM.Views.create(SM.TaAnalysisPanelView,{model:this.taModel});n=SM.Views.create(SM.TaCategoriesPanelView,{model:this.taModel});t.push(s.el);t.push(n.el)}$.each(t,function(e,t){o.eq(e).append(t)})},_onLearnMoreClick:function(e){var t=e.data.self,i=SM.Views.create(SM.TaLearnMoreView);e.preventDefault();i.open()},_onCategoryClick:function(e){var t=e.data.self,i=t.$el.data("tabs"),s=$(e.target).attr("category-filter-id");e.preventDefault();t.taModel.filterCategories([s]);i.open("responses")},_onPhraseClick:function(e){var t=e.data.self,i=t.$el.data("tabs"),s,n;e.preventDefault();s=$(e.target).attr("phrase-filter-id");n=t.taModel.phrases.map[s].text;t.taModel.searchQuery(n);i.open("responses")},_onSearch:function(e){var t=e.data.self,i=t.$el.data("tabs");t.taModel.searchQuery(e.query);i.open("responses")},_onCategoryCountChange:function(e){var t=e.data.self,i=t.$el.find("[tab-target=categories] [ta-tab-count]");i.text("("+t.taModel.categories.count()+")")},_shouldShowAnalysisTab:function(){return!SM.App.isSharingApp()&&!SM.App.isMerveysApp()},_shouldShowCategoriesTab:function(){return!SM.App.isSharingApp()&&!SM.App.isMerveysApp()}});SM.TaContainerView=SM.Views.register({__NAME:"TaContainerView",__templateID:"ta-container-template",__model:"taModel",__afterRender:function(e){var t=SM.Views.create(SM.TaTabsView,{model:this.taModel});this.$el.append(t.$el)}});SM.SummaryChartContainerView=SM.Views.register({__NAME:"summaryQuestionChartView",__templateID:"summary-chart-container-template",__model:"question",__create:function(e){var t=this;t.survey=e.survey;t.question=e.question;t.rollup=t.question.getRollup();t.display=t.rollup.display;t.isExport=e.isExport;t.randomAssignmentOption=e.randomAssignmentOption;t.questionView=e.questionView},__beforeRender:function(){var e=this,t=e.display.getDisplayData();return{isShown:t.show_chart}},__afterRender:function(){var e=this,t,i;if(e._shouldHideChart()){return}try{if(e.display.getBenchmarkDisplay()){if(e.question.isNPS()&&e.display.getChartType()==="score_gauge"){i=SM.BenchmarkNpsSummaryChartView}else if(e.question.isTop2()){i=SM.BenchmarkTop2SummaryChartView}else{i=SM.BenchmarkSummaryChartView}}else if(e.question.isNPS()){i=SM.NpsSummaryChartView}else{i=SM.BaseSummaryChartView}t=SM.Views.create(i,{question:e.question,questionView:e.questionView});e.$el.html(t.el);e.chartView=t}catch(s){e._handleRenderingError(s)}},_shouldHideChart:function(){var e=this,t=e.display.getDisplayData();return!t.show_chart},_handleRenderingError:function(e){var t=this,i;i=document.createElement("div");i.innerHTML=SM.Template.render("summary-chart-display-error-template");t.$el.html(i);SM.Error.log(e,"question summary chart rendering error, QuestionID: "+t.question.ID)},__init:function(){var e=this;e.bindModel(e.display,"displayChange",{self:e},e._onDisplayChange);e.bindModel(e.display,"tempDisplayChange",{self:e},e._onDisplayChange);e.bindModel(e.display,"allDisplaysChange",{self:e},e._onDisplayChange)},_onDisplayChange:function(e){var t=e.data.self;if(t.question.hasRandomAssignment()&&!!t.randomAssignmentOption){t.question.randomAssignmentOption=t.randomAssignmentOption}t.render()}});SM.BaseSummaryChartView=SM.Views.register(SM.Object.deepExtend(SM.SummarySeriesFactory,{__NAME:"BaseSummaryChartView",__templateID:"summary-chart-template",HIGHCHARTS_CHART_TYPE_MAP:{vbar:"column",hbar:"bar",area:"area",line:"line",stacked_vbar:"column",stacked_hbar:"bar",pie:"pie",donut:"pie",boxplot:"boxplot",top2_hbar:"bar",top2_vbar:"column",top2_donut:"pie"},DATA_LABEL_OFFSETS:{column:[0,-10],bar:[10,0],pie:[10,0],donut:[10,0],line:[0,-10],area:[0,-10],boxplot:[10,0]},TITLE_HEIGHT:30,__create:function(e){var t=this;t._createAsSummarizable(_.extend(e,{noLabelByWeight:true,noLabelBySidi:true}));t.DEFAULT_HIGHCHARTS_OPTIONS=SM.Object.deepExtend(SM.Highcharts.DEFAULT_OPTIONS,{plotOptions:{series:{dataLabels:{formatter:this._formatDataLabel}}}});_.bindAll(this,"_compileChartOptions","_renderChart")},getSeriesList:function(){var e=this;return e.seriesList},__beforeRender:function(){var e=this;e._getDisplayOptions();e._getChartMetadata();e._getSortedSummaryData()},__afterRender:function(){var e=this,t,i,s,n=0,a=0,o=e.question.isBenchmarkable(),r=e.question.page.survey.isProfilerDialogEnabled(),l=e.displayData.show_benchmark,h="no-matching-responses-template";e.$el.empty();e.seriesList=[];if(SM.App.isSharingApp()||SM.App.isExportApp()){o=false}if(e.summary.answered===0&&!l){e.$el.html(SM.Template.render(h,{isBenchmarkable:o,showLink:!r,classes:"mod-no-header"}));return}t=e._buildQuestionOptions();i=_.map(t,e._compileChartOptions);if(_.size(i[0].series)===0){e.$el.html(SM.Template.render(h,{isBenchmarkable:false,classes:"mod-no-header"}));return}a=0;_.each(i,function(e){n=_.size(e.series)*_.size(e.series[0].data);a+=n});s=e.question.page.survey.config["question_chart_display_threshold"];if(n>s||a>s*3){e.$el.html(SM.Template.render("chart-too-big-template"));return}_.each(i,e._renderChart)},_compileChartOptions:function(e,t){var i=this,s,n,a,o,r,l,h,u,c,d;d=$("<div></div>");d.attr("chart-type",i.chartType);u=e.series;i.seriesList.push(u);c=e.xAxis.categories;s=i._buildChartOptions(u,c,d,t);n=i._buildEventOptions(d);l=i._buildColorOptions();a=i._buildPlotOptions(u);o=i._buildTooltipOptions();r=i._buildLegendOptions();if(i.question.isEmoji()&&u[0].__options.dimensionType==="row"&&i.question.structure.answers.rows[0].text===u[0].name){r.legend.itemStyle={fontFamily:"SMFont"}}i._setDataLabelCoordinates(u,e.yAxis,s.chart);h=SM.Object.deepExtend(i.DEFAULT_HIGHCHARTS_OPTIONS,s,n,l,a,o,r,e);return h},_renderChart:function(e){var t=this,i,s=$(e.chart.renderTo),n;t.$el.append(s);if(t.isBoxplot){n=t._renderBoxPlotLabels}else{n=function(e){}}i=new Highcharts.Chart(e,n);t._bindEvents(s,i)},_bindEvents:function(e,t){var i=this,s=t.yAxis[0];if(!SM.App.isSharingApp()){SM.Highcharts.bindYAxisEvents(e,s);SM.Highcharts.bindAreaChartEvents(e);SM.Highcharts.bindXAxisEvents(e)}},_getChartMetadata:function(){var e=this;e.chartMetadata=e.rollup.display.getDisplayData();e.chartType=e.chartMetadata.chart_type;e.scaleType=e.chartMetadata.scale_type;e.scaleIsPercent=e.scaleType===e.SCALE_TYPE_PERCENT;e.isMirrored=e.chartMetadata.mirror;e.isWeightedAvg=e.chartMetadata.isWeightedAvg;e.isDistribution=e.chartMetadata.isDistribution;e.isStacked=e.chartMetadata.isStacked;e.isArea=e.chartMetadata.isAreaChart;e.isPie=e.chartMetadata.isPieChart;e.isDonut=e.chartMetadata.isDonutChart;e.isBoxplot=e.chartMetadata.isBoxplotChart;e.showDataLabels=e.chartMetadata.show_data;e.hideEmptyData=!e.chartMetadata.show_empty_data;e.hasXAxis=!e.isPie&&!e.isDonut;e.showBenchmark=e.chartMetadata.show_benchmark;e.hasTitle=e._hasTitle();e.hasLegend=e._hasLegend();e.highchartsChartType=e.HIGHCHARTS_CHART_TYPE_MAP[e.chartType];e.isVertical=e._isVertical()},_buildQuestionOptions:function(){var e=this,t;if(e.summaryType==="menu_matrix"){if(e.isWeightedAvg){t=e._buildMenuMatrixWeightedAvgChartOptionsList()}else if(e.isPie||e.isDonut){t=e._buildMenuMatrixPieChartOptionsList()}else{t=e._buildMenuMatrixChartOptionsList()}}else if(e.summaryType==="matrix"){if(e.isWeightedAvg){t=[e._buildMatrixWeightedAvgChartOptions()]}else if(e.isPie||e.isDonut){t=[e._buildPieChartOptions()]}else{t=[e._buildMatrixChartOptions()]}}else{if(e.isPie||e.isDonut){t=[e._buildPieChartOptions()]}else{t=[e._buildSimpleChartOptions()]}}return t},_buildSimpleChartOptions:function(){var e=this,t,i,s,n;n=e.sortedRowsList[0];if(e.isStacked){i=[];s=e.buildSimpleStackedSeries(e.summary,n)}else if(e.isWeightedAvg){i=["Weighted Average"];s=e.buildSimpleWeightedAverageSeries(e.summary,n)}else{i=e.buildCategories(n);s=e.buildSimpleSeries(e.summary,n)}t={xAxis:e._buildXAxisOptions(i),series:s,yAxis:e._buildYAxisOptions(s)};return t},_buildPieChartOptions:function(e){var t=this,i,s,n,a;e=e||{};a=t.sortedRowsList[0];s=t.buildCategories(a);if(t.summaryType==="matrix"){if(t.isCompared){n=t.buildSimpleSeriesFromComparedMatrixSummary()}else{n=t.buildSimpleSeriesFromMatrixSummary()}}else if(t.summaryType==="menu_matrix"){n=t.buildSimpleSeriesFromMenuMatrixSummary(e.columnID)}else{n=t.buildSimpleSeries(t.summary,a)}i={xAxis:t._buildXAxisOptions(s),series:n,yAxis:t._buildYAxisOptions(n)};return i},_buildMatrixChartOptions:function(){var e=this,t,i,s;if(e.aggregateOverColumns){i=e.buildCategories(e.sortedColumnsList[0]);s=e.buildMirroredMatrixSeries()}else{i=e.buildCategories(e.sortedRowsList[0]);s=e.buildMatrixSeries()}t={xAxis:e._buildXAxisOptions(i),yAxis:e._buildYAxisOptions(s),series:s};return t},_buildMenuMatrixChartOptionsList:function(){var e=this,t,i,s,n,a,o,r,l,h;if(e.question.isCompared()){s=_.map(e.rows,function(s,a){t=s.items;if(_.isEmpty(t)){return}if(e.isMirrored){r=e.sortedColumnChoicesList[a];l=e.buildCategories(r)}else{o=e.sortedColumnsList[a];l=e.buildCategories(o)}i=e.columnChoiceTotalsByRow[s.id];h=e.buildComparedMatrixSeries(s,t,i);n=e._buildMenuMatrixChartOptions(l,h,s.text);return n})}else{s=_.map(e.columns,function(t,i){var s=t.items;if(e.isMirrored){r=e.sortedColumnChoicesList[i];l=e.buildCategories(r)}else{a=e.sortedRowsList[i];l=e.buildCategories(a)}h=e.buildMenuMatrixSeries(t,i,s,e.columnChoiceTotalsByColumnChoice);n=e._buildMenuMatrixChartOptions(l,h,t.text);return n})}s=_.compact(s);return s},_buildMenuMatrixChartOptions:function(e,t,i){var s=this;return{title:s._buildMenuMatrixTitleOptions(i),xAxis:s._buildXAxisOptions(e),series:t,yAxis:s._buildYAxisOptions(t)}},_buildMatrixWeightedAvgChartOptions:function(){var e=this;return e._buildWeightedAvgChartOptions(0,function(t){if(e.isCompared){return e.weightedAveragesByColumn[t]}else{return e.weightedAveragesByRow[t]}})},_buildMenuMatrixWeightedAvgChartOptionsList:function(){var e=this;var t=[],i;if(e.isCompared){_.each(e.rows,function(s,n){i=e._buildWeightedAvgChartOptions(n,function(t){return e.weightedAveragesByRowAndColumnChoice[s.id][t]});i.title=e._buildMenuMatrixTitleOptions(s.text);t.push(i)})}else{_.each(e.columns,function(s,n){i=e._buildWeightedAvgChartOptions(n,function(t){return e.weightedAveragesByRowAndColumn[t][s.id]});i.title=e._buildMenuMatrixTitleOptions(s.text);t.push(i)})}return t},_buildMenuMatrixPieChartOptionsList:function(){var e=this;var t=[],i;_.each(e.columns,function(s,n){i=e._buildPieChartOptions({columnID:s.id});i.title=e._buildMenuMatrixTitleOptions(s.text);t.push(i)});return t},_buildMenuMatrixTitleOptions:function(e){var t=this,i;e=_.string.truncate(e,SM.Highcharts.MAX_TITLE_CHARS);i={align:"left",text:e,useHTML:true,style:{padding:"10px 1500px 10px 10px",backgroundColor:"#DFDFDF",fontSize:"12px"},x:84,y:0};if(this.highchartsChartType==="bar"&&!t.isStacked){i.x=104}if(t.question.isEmoji()&&t.question.structure.answers.rows[0].text===e){i.style.fontFamily="SMFont"}return i},_buildWeightedAvgChartOptions:function(e,t){var i=this,s,n,a,o;n=[];o=[];var r,l;if(i.isCompared){if(i.summaryType==="menu_matrix"){if(i.sortedColumnChoicesList.length){_.each(i.sortedColumnChoicesList[e],function(e,i){r=e.text;l=t(e.id);n.push(r);o.push({y:l,absoluteY:l})})}}else{if(i.sortedColumnsList.length){_.each(i.sortedColumnsList[e],function(e,i){r=e.text;l=t(e.id);n.push(r);o.push({y:l,absoluteY:l})})}}}else{if(i.sortedRowsList.length){_.each(i.sortedRowsList[e],function(e,i){r=e.text;l=t(e.id);n.push(r);o.push({y:l,absoluteY:l})})}}a=[i._buildSeriesItem(o,{})];s={xAxis:i._buildXAxisOptions(n),series:a,yAxis:i._buildYAxisOptions(a)};return s},_buildChartOptions:function(e,t,i,s){var n=this,a=e.length,o=_.isEmpty(t)?0:t.length,r=n.hasTitle?n.TITLE_HEIGHT:0,l=n.hasXAxis?SM.Highcharts.calculateXAxisLabelHeight(n.highchartsChartType,t):0,h=n.hasLegend?SM.Highcharts.calculateLegendHeight(e):0,u=n.answerStructures;if(n.question.isSingleChoice()&&n.isWeightedAvg){u={rows:[{text:Globalize.localize("Weighted Average")}]}}var c={chart:{type:n.highchartsChartType,width:SM.Highcharts.calculateChartWidth(n.highchartsChartType,{numSeries:a,numXAxisLabels:o,isStacked:n.isStacked,isCompared:n.isCompared}),height:SM.Highcharts.calculateChartHeight(n.highchartsChartType,{answerStructures:u,titleHeight:r,labelHeight:l,legendHeight:h,isDistribution:n.question.isNPS()||n.isDistribution,isCompared:n.isCompared,isStacked:n.isStacked,isMirrored:n.isMirrored,chartIndex:s}),marginTop:SM.Highcharts.calculateMarginTop(0,r),marginBottom:SM.Highcharts.calculateMarginBottom(l,h),renderTo:i[0]}};if(n.isPie||n.isDonut){c.chart.plotBackgroundColor="#FFF";c.chart.marginLeft=0}if(n.question.isNPS()&&n.nps_depth===SM.QuestionDisplayModel.DISPLAY_VALUES.nps_score){c.chart.marginLeft=80;c.chart.marginRight=50}else if(n.highchartsChartType==="bar"&&!n.isStacked){c.chart.marginLeft=115}return c},_buildEventOptions:function(e){var t,i,s=this;if(SM.App.isSharingApp()){return}t={chart:{events:{click:function(t){SM.CustomizeActionMenu.actionMenu.call(s,t,"background",{parent:e})}}},plotOptions:{series:{events:{legendItemClick:function(t){t.preventDefault();i=s.question.isNPS()?"legendNPS":"legend";SM.CustomizeActionMenu.actionMenu.call(s,t.browserEvent,i,{parent:e})}},point:{events:{click:function(t){i=s.question.isNPS()?"dataPointNPS":"dataPoint";SM.CustomizeActionMenu.actionMenu.call(s,t,i,{parent:e})},mouseOver:SM.Highcharts.onPointMouseOver,mouseOut:SM.Highcharts.onPointMouseOut}}}}};return t},_buildColorOptions:function(){var e=this,t={};if(_.isEmpty(e.chartMetadata.colors)){return}t.colors=e.chartMetadata.colors;return t},_buildXAxisOptions:function(e){var t=this,i={};if(_.isEmpty(e)){i.labels={enabled:false}}else{i.categories=e;if(_.contains(["column","line","area"],t.highchartsChartType)){SM.Object.deepUpdate(i,{labels:{y:25,formatter:SM.Highcharts.xAxisLabelFormatter}})}if(_.include(["bar"],t.highchartsChartType)){var s={textAlign:"right"};SM.Object.deepUpdate(i,{labels:{formatter:function(){return SM.Highcharts.formatAxisLabel(this.value,115,2)},style:s}})}if(this.question.isEmoji()&&!t.aggregateOverColumns&&this.question.structure.answers.rows.length>=1&&this.question.structure.answers.rows[0].text===e[0]){SM.Object.deepUpdate(i,{labels:{style:{fontFamily:"SMFont"}}})}}return i},buildCategories:function(e){return _.map(e,function(e){return e.text})},_buildYAxisOptions:function(e){var t=this,i,s,n={startOnTick:false,endOnTick:false};i=t._getYAxisScaleOptions(e);s={labels:{formatter:t.scaleIsPercent?SM.Highcharts.percentageLabelFormatter:SM.Highcharts.yAxisLabelFormatter}};SM.Object.deepUpdate(n,i);SM.Object.deepUpdate(n,s);return n},_otherIsAnAnswerChoice:function(){var e=this;return e.others!==undefined&&e.others[0].options.is_answer_choice},_getYAxisScaleOptions:function(e){var t=this,i=t.displayData,s=SM.Highcharts,n=t.isStacked||t.isArea&&!t.question.isSimple()&&!t.isWeightedAvg,a,o,r,l;if(t.scaleIsPercent){if(n){return{min:0,max:100,tickInterval:10}}l=s.calculateSeriesRange(e);a={min:0,max:Math.ceil(l.max/100)*100||100};a.tickInterval=a.max/10}else if(n){l=s.calculateStackedSeriesRange(e);a=s.calculateYAxisScaleOptions(l.max);
}else if(t.question.isSingleChoice()&&t.isWeightedAvg){r=t._otherIsAnAnswerChoice()?t.question.rowList.length+1:t.question.rowList.length;l={min:0,max:r};a=s.calculateYAxisScaleOptions(r,0)}else{l=s.calculateSeriesRange(e);if(l.max<0){l.max=0}a=s.calculateYAxisScaleOptions(Math.max(l.max,-l.min));if(l.min<0){a.min=-a.max;a.tickInterval*=2}}a=t.display.getCustomScale(l,a);if(n){a.min=0}o=s.calculateYAxisScaleOptions(a.max,a.min);a.tickInterval=o.tickInterval;return a},_buildPlotOptions:function(e){var t=this,i=e.length,s,n={plotOptions:{series:{}}};n.plotOptions[t.highchartsChartType]={colorByPoint:t._shouldColorByPoint(i),borderWidth:0,dataLabels:{enabled:t.showDataLabels,x:t.DATA_LABEL_OFFSETS[t.highchartsChartType][0],y:t.DATA_LABEL_OFFSETS[t.highchartsChartType][1]}};if(t.isStacked){n.plotOptions.series.stacking="normal";n.plotOptions[t.highchartsChartType].dataLabels.x=0;n.plotOptions[t.highchartsChartType].dataLabels.y=0}if(t.isArea){n.plotOptions.area.stacking="normal";n.plotOptions.area.dataLabels.y=30}if(t.isPie||t.isDonut){n.plotOptions.pie.dataLabels={enabled:t.showDataLabels||t.chartMetadata.label_type==="labels",color:"#000000",connectorColor:"#000000"};n.plotOptions.series.dataLabels={formatter:t._formatPieChartDataLabel};if(t.isDonut){n.plotOptions.series.innerSize="40%"}if(t._hasLegend()){n.plotOptions.pie.showInLegend=true}}s=t._calculatePointWidth(e);if(s){n.plotOptions[t.highchartsChartType].pointWidth=s}return n},_getNumPoints:function(e){var t=this,i,s;i=_.map(e,function(e){return e.data?e.data.length:0});if(t.isStacked){s=_.max(i)}else{s=_.reduce(i,function(e,t){return e+t},0)}return s},_calculatePointWidth:function(e){var t=this,i=t._getNumPoints(e),s;if(t.highchartsChartType==="column"){if(i<=4){s=80}else if(i<=6){s=60}}if(t.highchartsChartType==="bar"){if(i<=4){s=50}else if(i<=6){s=40}}return s},_shouldColorByPoint:function(e){var t=this,i;if(e===1){if(_.contains(["line","area"],t.highchartsChartType)||t.isStacked||t.isMirrored&&!t.isCompared||t.isCompared&&!t.isMirrored){i=false}else{i=true}}else{i=false}return i},_buildTooltipOptions:function(){var e=this,t={tooltip:{}};if(e.showDataLabels){t.tooltip.enabled=false}return t},_buildLegendOptions:function(){var e=this,t={legend:{enabled:e._hasLegend()}};if(e._hasLegend()){t.legend.enabled=true;if(e.isPie||e.isDonut){t.legend.align="center"}else{t.legend.x=75;t.legend.align="left";t.legend.width=514}if(e.question.isNPS()&&e.nps_depth===SM.QuestionDisplayModel.DISPLAY_VALUES.nps_detailed&&e.isStacked){t.legend.itemDistance=15}}return t},_hasTitle:function(){var e=this;return e.questionType==="menu_matrix"||e.questionType==="compare"&&e.questionFamily==="matrix"},_hasLegend:function(){var e=this;if((e.isPie||e.isDonut)&&e.chartMetadata.label_type!=="legend"){return false}if(e.nps_depth===SM.QuestionDisplayModel.DISPLAY_VALUES.nps_score&&e.question.isCompared()){return false}return(e.questionType==="simple"&&e.isStacked||e.questionType==="matrix"||e.questionType==="menu_matrix"||e.questionType==="compare"||(e.isPie||e.isDonut)&&e.chartMetadata.label_type==="legend")&&!e.isWeightedAvg},_isVertical:function(){var e=this;if(!e.highchartsChartType){throw"_isVertical requires highchartsChartType to be set"}return _.contains(["column","area","line"],e.highchartsChartType)},_formatDataLabel:function(){var e=this.series.options.__options,t=this.point.__options||{},i=e.scaleType,s=e.decimalPlaces;if(t.disableDataLabels){return null}if(this.y===0){return null}return SM.Highcharts.formatYValue(this.y,i,s)},_formatPieChartDataLabel:function(){var e=this.series.options.__options,t=e.showDataLabels,i=e.isLegend,s,n,a;s=SM.Highcharts.formatTextualAxisLabel(this.point.name,150,4);n=this.point.absoluteY;a=SM.Highcharts.formatYValue(this.point.percentageY,"percent",e.decimalPlaces);if(n===0){return null}if(t){if(i){return a+"<br>"+"("+n+")"}else{return"<b>"+s+"</b> <br>"+a+" ("+n+")"}}else{return"<b>"+s+"</b>"}},_setDataLabelCoordinates:function(e,t,i){var s=this,n=i.type,a=i.height-i.marginTop-i.marginBottom,o=t.max,r,l,h;if(s.isStacked){return}_.each(e,function(t,i){_.each(t.data,function(t,h){if(typeof t==="number"){r=SM.Highcharts.formatYValue(t,s.scaleType,s.decimalPlaces);l=r.length;if(s._shouldPlaceLabelInsidePoint(l,t.y,o,n,a)){e[i].data[h]={y:t,dataLabels:s._buildDataLabelCoordinateOptions(l)}}}else if(typeof t==="object"){if(t.y){r=SM.Highcharts.formatYValue(t.y,s.scaleType,s.decimalPlaces);l=r.length;if(s._shouldPlaceLabelInsidePoint(l,t.y,o,n,a)){t.dataLabels=s._buildDataLabelCoordinateOptions(l)}}}})})},_shouldPlaceLabelInsidePoint:function(e,t,i,s,n){var a=this;if(a.isVertical){return SM.Highcharts.DATA_LABEL_CHARACTER_HEIGHT+Math.abs(a.DATA_LABEL_OFFSETS[s][1])+SM.Highcharts.DATA_LABEL_PADDING>(i-t)/i*n}else{return e*SM.Highcharts.DATA_LABEL_CHARACTER_WIDTH+a.DATA_LABEL_OFFSETS[s][0]+SM.Highcharts.DATA_LABEL_PADDING>(i-t)/i*SM.Highcharts.PLOT_AREA_WIDTH}},_buildDataLabelCoordinateOptions:function(e){var t=this,i,s,n=10,a=30;i=t.isVertical?0:Math.min(-e*n,-a);s=t.isVertical?Math.max(-e*n,a):0;return{x:i,y:s}}}));SM.NpsSummaryChartView=SM.Views.deepExtend(SM.BaseSummaryChartView,{__NAME:"NpsSummaryChartView",HIGHCHARTS_CHART_TYPE_MAP:{vbar:"column",hbar:"bar",stacked_vbar:"column",stacked_hbar:"bar",score_gauge:"score",score_vbar:"column",score_hbar:"bar"},__beforeRender:function(){var e=this;e._getDisplayOptions();e._getChartMetadata();e._getSortedSummaryData();e._getNpsData();if(e.nps_depth===SM.QuestionDisplayModel.DISPLAY_VALUES.nps_score&&e.question.isCompared()){e._setAsSummarizableNpsScoreComparedChart()}else{e._setAsSummarizableNps(e.nps_depth)}},__afterRender:function(){var e=this,t,i,s=e.displayData.show_benchmark,n=true,a=e.question.page.survey.isProfilerDialogEnabled(),o="no-matching-responses-template";e.$el.empty();e.seriesList=[];if(SM.App.isSharingApp()||SM.App.isExportApp()){n=false}e.$el.empty();e.seriesList=[];if(e.summary.answered===0&&!s){e.$el.html(SM.Template.render(o,{isBenchmarkable:n,showLink:!a,classes:"mod-no-header"}));return}if(e.chartType===SM.QuestionDisplayModel.DISPLAY_VALUES.score_gauge){_.bindAll(this,"_renderGaugeShapes");e._renderScoreChart();return}t=e._buildQuestionOptions();i=_.map(t,e._compileChartOptions);_.each(i,e._renderChart)},_buildColorOptions:function(){var e=this,t={};if(e.nps_depth===SM.QuestionDisplayModel.DISPLAY_VALUES.nps_distribution){t.colors=SM.Highcharts.NPS_DISTRIBUTION_COLORS}else if(e.nps_depth===SM.QuestionDisplayModel.DISPLAY_VALUES.nps_detailed){t.colors=SM.Highcharts.NPS_DETAILED_DISTRIBUTION_COLORS}else{t.colors=SM.Highcharts.DEFAULT_COLORS}return t},_buildTooltipOptions:function(){var e=this,t;t=SM.BaseSummaryChartView._buildTooltipOptions.call(this);if(e.nps_depth===SM.QuestionDisplayModel.DISPLAY_VALUES.nps_score){t.tooltip.formatter=SM.Highcharts.formatTooltipNpsScore}else if(e.nps_depth===SM.QuestionDisplayModel.DISPLAY_VALUES.nps_detailed){t.tooltip.formatter=SM.Highcharts.formatTooltipNpsDetailed}return t},_getChartMetadata:function(){var e=this;e.chartType=e.displayData.chart_type;e.nps_depth=e.displayData.nps_depth;e.hasXAxis=true;e.showDataLabels=e.displayData.show_data;e.hasTitle=e._hasTitle();e.hasLegend=e._hasLegend();e.highchartsChartType=e.HIGHCHARTS_CHART_TYPE_MAP[e.chartType];e.isVertical=e._isVertical()},_buildQuestionOptions:function(){var e=this,t;if(e.summaryType==="matrix"){t=[e._buildMatrixChartOptions()]}else{t=[e._buildSimpleChartOptions()]}if(e.nps_depth===SM.QuestionDisplayModel.DISPLAY_VALUES.nps_score){SM.Object.deepUpdate(t[0],SM.Highcharts.NPS_SCORE_BAR_CHART_OPTIONS)}return t},_buildSimpleChartOptions:function(){var e=this,t,i,s,n,a;n=e.summary;a=e.answerStructures["rows"];if(e.isStacked){i=[];s=e.buildSimpleStackedSeries(n,a)}else{i=e.buildCategories(a);s=e.buildSimpleSeries(n,a)}t={xAxis:e._buildXAxisOptions(i),series:s,yAxis:e._buildYAxisOptions(s)};return t},buildCategories:function(e){var t=this,i;if(t.nps_depth===SM.QuestionDisplayModel.DISPLAY_VALUES.nps_detailed&&t.chartType===SM.QuestionDisplayModel.DISPLAY_VALUES.vbar&&!t.question.isCompared()){i=true}else{i=false}return _.map(e,function(e,t){if(t===0&&i){return"0"}else if(t===10&&i){return"10"}else{return e.text}})},_renderScoreChart:function(){var e=this,t;t=SM.Highcharts.NPS_SCORE_CHART_BASE_OPTIONS;e.$el.highcharts(t,e._renderGaugeShapes)},_renderGaugeShapes:function(e){var t=this,i=t.question.page.survey.isExport,s;s=t.npsSummary.score.summary.summary.options.Score.count;SM.Highcharts.renderGaugeShapes(e,s,t.$el,i)}});SM.SummaryTMBCChartContainerView=SM.Views.register({__NAME:"summaryTMBCChartContainerView",__templateID:"summary-tmbc-chart-container-template",__model:"tmbc",__create:function(e){var t=this;if(t.get("isTop2")){t.question=e.question;t.survey=t.question.page.survey}else{t.survey=t.tmbc.survey}t.tmbcType=e.tmbcType;t.chartType=e.chartType;t.questionView=e.questionView},__beforeRender:function(){var e=this;return{isShown:true}},__afterRender:function(){var e=this,t,i,s=e.get("showBenchmark");if(e._shouldHideChart()){return}try{if(e.chartType===SM.QuestionDisplayModel.DISPLAY_VALUES.donut||e.get("isTop2")){i=SM.TMBCSummaryChartView;e.$el.addClass("short")}else{i=SM.TMBCBoxPlotView}t=SM.Views.create(i,{model:e.tmbc,tmbcType:e.tmbcType,benchmarkDisplay:s,questionView:e.questionView,question:e.question});e.$el.html(t.el);e.chartView=t}catch(n){e._handleRenderingError(n)}},_shouldHideChart:function(){return false},_handleRenderingError:function(e){var t=this,i;i=document.createElement("div");i.innerHTML=SM.Template.render("summary-chart-display-error-template");t.$el.html(i);SM.Error.log(e,"tmbc summary chart rendering error")},__init:function(){var e=this},_onDisplayChange:function(e){var t=e.data.self;if(t.question.hasRandomAssignment()&&!!t.randomAssignmentOption){t.question.randomAssignmentOption=t.randomAssignmentOption}t.render()}});SM.TMBCSummaryChartView=SM.Views.register({__NAME:"TMBCSummaryChartView",__templateID:"summary-chart-template",__model:"tmbc",TEXT_RADIUS:115,CHAR_W:7,CHAR_H:12,COLOR_EMPTY:"#CCC",TMBC_COLOR_OPTIONS:{colors:["#A9BD38","#E0E0E0"]},TMBC_CHART_OPTIONS:{chart:{width:328,height:215,noResponses:false,margin:[0,0,0,0],spacingTop:0,spacingBottom:0,spacingLeft:0,spacingRight:0,style:{fontFamily:"Arial"},plotBackgroundColor:"#FFF",type:"pie",renderTo:{},events:{}},title:{text:null},colors:["#2D606F","#E0E0E0"],plotOptions:{series:{animation:false,point:{events:{}},events:{},innerSize:156},pie:{size:186,marker:{states:{hover:{enabled:false}}},center:["50%","50%"],colorByPoint:true,borderWidth:1,borderColor:null,dataLabels:{enabled:false},startAngle:0,endAngle:360.5}},labels:[],legend:{enabled:false},tooltip:{enabled:false},credits:{enabled:false},series:[{data:[{y:1},{y:1}]}]},__create:function(e){this.chartType=SM.QuestionDisplayModel.DISPLAY_VALUES.donut;this.tmbcType=e.tmbcType;this.benchmarkDisplay=e.benchmarkDisplay;if(SM.Browser.isIE8){this.TMBC_CHART_OPTIONS.plotOptions.pie.borderWidth=0}this.isTop2=e.question?e.question.isTop2():false;this.survey=e.question?e.question.page.survey:this.tmbc.survey;if(this.isTop2){this.summary=e.summary;this.series=e.series;this.rollup=e.question.getRollup()}this.DEFAULT_HIGHCHARTS_OPTIONS=SM.Object.deepExtend(SM.Highcharts.DEFAULT_OPTIONS,{plotOptions:{series:{dataLabels:{formatter:this._formatDataLabel}}}});_.bindAll(this,"_compileChartOptions","_renderChart")},__afterRender:function(){var e=this.survey,t={};if(!this.isTop2&&this.tmbc.hasError()){this.$el.addClass("bm-error");t.notApplicable=this.tmbc.getError()==="no_access";t.noData=this.tmbc.getError()==="no_data";t.isNPS=true;t.user_id=e.currentUserID;t.name=this.tmbc.getSegmentName();t.useBMStr=t.name.indexOf("Benchmark")===-1;t.source="tmbc";this.$el.html(SM.Template.render("summary-benchmark-data-not-available-template",t));return}this.$el.removeClass("bm-error");this.$el.addClass("sm-bm-nps");if(this.isTop2){this.$el.addClass("top2")}var i=this,s,n,a=true,o="no-matching-responses-template";i.$el.empty();i.seriesList=[];if(SM.App.isSharingApp()||SM.App.isExportApp()){a=false}i.$el.empty();i.seriesList=[];if(i.chartType===SM.QuestionDisplayModel.DISPLAY_VALUES.donut){_.bindAll(this,"_renderTMBCShapes");i._renderTMBCChart();return}s=i._buildQuestionOptions();n=_.map(s,i._compileChartOptions);_.each(n,i._renderChart)},__init:function(){this.$el.on(SM.Event.CLICK,"[cta]",{self:this},this._onBuyBenchmarksClicked)},_compileChartOptions:function(e,t){var i=this,s,n,a,o,r,l,h,u,c,d;d=$("<div></div>");d.attr("chart-type",i.chartType);u=e.series;i.seriesList.push(u);c=e.xAxis.categories;s=i._buildChartOptions(u,c,d,t);n=i._buildEventOptions(d);l=i._buildColorOptions();a=i._buildPlotOptions(u);o=i._buildTooltipOptions();r=i._buildLegendOptions();i._setDataLabelCoordinates(u,e.yAxis,s.chart);h=SM.Object.deepExtend(i.DEFAULT_HIGHCHARTS_OPTIONS,s,n,l,a,o,r,e);return h},_renderChart:function(e){var t=this,i,s=$(e.chart.renderTo),n;t.$el.append(s);if(t.isBoxplot){n=t._renderBoxPlotLabels}else{n=function(e){}}i=new Highcharts.Chart(e,n);t._bindEvents(s,i)},_onBuyBenchmarksClicked:function(e){var t=e.data.self,i=$(e.target),s=i.attr("link"),n=i.attr("source");e.preventDefault();e.stopPropagation();SM.Bi.benchmarkingAbout(t.question.ID,n,s,t.question.isNPS());s=s+"?param="+t.question.page.survey.currentUserID;window.open(s,"_blank")},_renderTMBCShapes:function(e){var t=this,i=t.survey.isExport,s,n,a;if(e.userOptions.chart.isBenchmark){a=t._$bmNpsCtnr;if(t.isTop2){n=Math.round(t.series[1].data[1].y*10)/10}else{n=Math.round(t.tmbc.getTMBCBenchmarkValue(t.tmbcType))}}else{a=t._$userNpsCtnr;if(t.isTop2){n=Math.round(t.series[0].data[0].y*10)/10}else{n=Math.round(t.tmbc.getTMBCValue(t.tmbcType))}}SM.Highcharts.renderTMBCShapes(e,n,a,i)},_renderTMBCChart:function(){var e=this,t,i,s=this.survey,n,a,o,r,l,h=0,u=0,c="Segment";e.$el.addClass("sm-bm-nps");t=$.extend(true,{},e.TMBC_CHART_OPTIONS);t.chart.showingBenchmark=e.benchmarkDisplay;t.chart.tmbcType=e.tmbcType;t.chart.isTop2=e.isTop2;if(e.benchmarkDisplay){if(e.isTop2){n=$("<div/>").html(e.series[0].name).text();h=e.rollup.answered;u=e.rollup.skipped;c=e.survey.benchmarkRollups.getSegmentName()}else{n=$("<div/>").html(e.tmbc.getTMBCName(e.tmbcType)).text();c=e.tmbc.getSegmentName()}a=SM.Template.render("tmbc-chart-template",{title:n,side:"left",isBenchmark:false,isTop2:e.isTop2,answered:h,skipped:u});o=SM.Template.render("tmbc-chart-template",{title:c,isTop2:e.isTop2,side:"right",isBenchmark:true});e.$el.append($(a));e.$el.append($(o));e._$userNpsCtnr=e.$el.find(".sm-bm-nps-chart.left");e._$bmNpsCtnr=e.$el.find(".sm-bm-nps-chart.right")}else{e.$el.addClass("tmbc");e._$userNpsCtnr=e.$el;t.chart.width*=2}if(e.isTop2){r=e.series[0].data[0].y}else{r=e.tmbc.getTMBCValue(e.tmbcType)}if(e.tmbcType===SM.TMBCModel.TMBC_TYPE_GEI){l=e.tmbc.getGrade(r);t.tooltip.settings={grade:l.grade};t.tooltip.settings[l.key]=true;r=r/1.1}else{t.tooltip.settings={}}if(e.isTop2){t.chart.score=Math.round(r*10)/10}else{t.chart.score=Math.round(r)}if(r<1){r=50;t.colors[0]=t.colors[1];t.plotOptions.pie.borderColor=t.colors[0]}else if(r>99){r=50;t.colors[1]=t.colors[0];t.plotOptions.pie.borderColor=t.colors[0]}t.series[0].data[0].y=r;t.series[0].data[1].y=100-r;e._$userNpsCtnr.highcharts(t,e._renderTMBCShapes);if(e.benchmarkDisplay){t=$.extend(true,{},e.TMBC_CHART_OPTIONS,e.TMBC_COLOR_OPTIONS);t.chart.showingBenchmark=e.benchmarkDisplay;t.chart.tmbcType=e.tmbcType;if(e.isTop2){r=e.series[1].data[1].y;t.chart.isTop2=true}else{r=e.tmbc.getTMBCBenchmarkValue(e.tmbcType)}if(e.tmbcType===SM.TMBCModel.TMBC_TYPE_GEI){r=r/1.1}if(e.isTop2){t.chart.score=Math.round(r*10)/10}else{t.chart.score=Math.round(r)}if(r<1){r=50;t.colors[0]=t.colors[1];t.plotOptions.pie.borderColor=t.colors[0]}else if(r>99){r=50;t.colors[1]=t.colors[0];t.plotOptions.pie.borderColor=t.colors[0]}t.series[0].data[0].y=r;t.series[0].data[1].y=100-r;t.chart.isBenchmark=true;e._$bmNpsCtnr.highcharts(t,e._renderTMBCShapes)}}});SM.TMBCBoxPlotView=SM.Views.register({__NAME:"TMBCBoxPlotView",__templateID:"summary-chart-template",__model:"tmbc",__create:function(e){this.chartType="boxplot";this.isBoxplot=true;this.tmbcType=e.tmbcType;this.highchartsChartType="boxplot";this.hasLegend=true;this.DEFAULT_HIGHCHARTS_OPTIONS=SM.Object.deepExtend(SM.Highcharts.DEFAULT_OPTIONS,{chart:{forcePercent:this.tmbcType===this.tmbc.TMBC_TYPE_ENGAGEMENT},plotOptions:{series:{dataLabels:{formatter:this._formatDataLabel}}}});_.bindAll(this,"_compileChartOptions","_renderChart")},__afterRender:function(){var e=this.tmbc.survey,t={};if(this.showBenchmark&&(this.tmbc.hasError()||this.tmbc.wasEdited())){this.$el.addClass("bm-error");t.notApplicable=this.tmbc.getError()==="no_access";t.noData=this.tmbc.getError()==="no_data";t.wasEdited=this.tmbc.wasEdited();t.isNPS=false;t.user_id=e.currentUserID;t.name=this.tmbc.getSegmentName();t.source="tmbc";this.$el.html(SM.Template.render("tmbc-data-not-available-template",t));return}this.$el.removeClass("bm-error");_.bindAll(this,"_renderBoxPlotLabels");var i=this,s,n;i.$el.empty();i.seriesList=[];s=i._buildQuestionOptions();n=_.map(s,i._compileChartOptions);_.each(n,i._renderChart)},__init:function(){},_buildPlotOptions:function(e){var t=this,i=e.length,s,n={plotOptions:{series:{}}};n.plotOptions[t.highchartsChartType]={colorByPoint:false,borderWidth:0,dataLabels:{enabled:t.showDataLabels,x:10,y:0}};return n},_buildTooltipOptions:function(){var e=this,t={tooltip:{}};if(e.showDataLabels){t.tooltip.enabled=false}return t},_buildLegendOptions:function(){var e=this,t={legend:{enabled:true}};t.legend.x=75;t.legend.align="left";t.legend.width=514;return t},_compileChartOptions:function(e,t){var i=this,s,n,a,o,r,l,h,u,c,d;d=$("<div></div>");d.attr("chart-type",i.chartType);u=e.series;i.seriesList.push(u);c=e.xAxis.categories;s=i._buildChartOptions(u,c,d,t);n=i._buildEventOptions(d);l=i._buildColorOptions();a=i._buildPlotOptions(u);o=i._buildTooltipOptions();r=i._buildLegendOptions();h=SM.Object.deepExtend(i.DEFAULT_HIGHCHARTS_OPTIONS,s,n,l,a,o,r,e);return h},_renderChart:function(e){var t=this,i,s=$(e.chart.renderTo),n;t.$el.append(s);if(t.isBoxplot){n=t._renderBoxPlotLabels}else{n=function(e){}}i=new Highcharts.Chart(e,n)},_buildQuestionOptions:function(){var e=[];if(this.isBoxplot){e=[this._buildBoxPlotOptions()]}return e},BOXPLOT_LINE_WIDTH:4,BOXPLOT_MEDIAN_WIDTH:2,BOXPLOT_MEDIAN_COLOR:"#FFFFFF",BOXPLOT_USER_VALUE_LINE_WIDTH:2,_buildTMBCQuartileChartSeries:function(e){var t=this.tmbc.getQuartileValues(this.tmbcType),i,s,n=[],a=[],o,r,l=e.colors[0],h=SM.Highcharts.DEFAULT_BENCHMARK_COLORS.slice(1),u=this.BOXPLOT_LINE_WIDTH,c;e.names=[Globalize.localize("Minimum"),Globalize.localize("Lower Quartile"),Globalize.localize("Median"),Globalize.localize("Upper Quartile"),Globalize.localize("Maximum")];i=this.tmbc.getTMBCValue(this.tmbcType);c=Globalize.localize("Your average");n.push({name:c,color:h[0],lineWidth:this.BOXPLOT_USER_VALUE_LINE_WIDTH,data:[{y:i,absoluteY:i,percentageY:i,name:c}]});_.each(t,function(t,i){a.push({y:t,absoluteY:t,percentageY:t,name:e.names[i]})});a=[[],[],a,[]];n.push({name:this.tmbc.getSegmentName(),pointWidth:58,data:a,tooltip:{headerFormat:"<em>Experiment No {point.key}</em><br/>"},color:l,fillColor:l,stemColor:l,stemWidth:this.BOXPLOT_LINE_WIDTH,whiskerColor:l,whiskerWidth:this.BOXPLOT_LINE_WIDTH,medianColor:this.BOXPLOT_MEDIAN_COLOR,medianWidth:this.BOXPLOT_MEDIAN_WIDTH,__options:{dimensionType:"benchmark"}});return n},_fixBoxPlotSeries:function(e){var t=[],i=2,s;s=_.filter(e,function(e,t){if(e.__options&&e.__options.dimensionType==="benchmark"){return e}});_.each(s[0].data[i],function(e,i){t.push(e.y)});s[0].data[i]=t;this.dataBoxPlot=t;return e},_buildBoxPlotOptions:function(e,t){var i=function(){var e=this.axis.width/3,t=SM.Highcharts.X_AXIS_MAX_VISIBLE_LINES,i=this.value,n;if(s.tmbcType===s.tmbc.TMBC_TYPE_ENGAGEMENT){n=SM.Highcharts.getGlobalizeFormatType("percent",0);i=Globalize.format(this.value/100,n)}return SM.Highcharts.formatAxisLabel(i,e,t)};var s=this,n=this.tmbc,a={colors:SM.Highcharts.DEFAULT_BENCHMARK_COLORS},o,r=2,l=this._buildTMBCQuartileChartSeries(a),h=0,u=s.tmbcType===s.tmbc.TMBC_TYPE_GEI?110:100,c=s.tmbcType===s.tmbc.TMBC_TYPE_GEI?27.5:25,d={chart:{type:"boxplot",inverted:true,width:SM.Highcharts.CHART_WIDTH,isNPS:false},plotOptions:{boxplot:{dataLabels:{enabled:true}}},xAxis:{categories:["","","",""]},yAxis:{tickInterval:c,min:h,max:u,labels:{formatter:i}},legend:{labelFormatter:SM.Highcharts.legendUnescapedFormatter},series:this._fixBoxPlotSeries(l),tooltip:{enabled:false}};o=this.tmbc.getTMBCValue(this.tmbcType);d.yAxis.plotLines=[{__options:{grade:this.tmbc.getGrade(o),tmbcType:this.tmbcType},value:o,color:a.colors[1],width:r,zIndex:100,events:{mouseover:s._tmbcMouseOver,mouseout:s._tmbcMouseOut}}];this.dataPlotLabels=[o];d.yAxis.gridLineColor="#FFF";return d},buildCategories:function(e){return _.map(e,function(e){var t=e.text.replace(/\/([^\s])/g,"/ $1");return t})},_buildChartOptions:function(e,t,i,s){var n=this,a=e.length,o=_.isEmpty(t)?0:t.length,r=n.hasTitle?n.TITLE_HEIGHT:0,l=n.hasXAxis?SM.Highcharts.calculateXAxisLabelHeight(n.highchartsChartType,t):0,h=n.hasLegend?SM.Highcharts.calculateLegendHeight(e):0;var u={chart:{type:n.highchartsChartType,width:SM.Highcharts.calculateChartWidth(n.highchartsChartType,{numSeries:a,numXAxisLabels:o,isStacked:n.isStacked,isCompared:n.isCompared}),height:SM.Highcharts.calculateChartHeight(n.highchartsChartType,{answerStructures:{rows:[0,50,100],cols:[]},titleHeight:r,labelHeight:l,legendHeight:h,isDistribution:true,isCompared:false,isStacked:false,isMirrored:false,chartIndex:0})-25,marginTop:SM.Highcharts.calculateMarginTop(0,r),marginBottom:SM.Highcharts.calculateMarginBottom(l,h),renderTo:i[0]}};return u},_tmbcMouseOver:function(e){var t=this,i=t.axis.chart.series[0],s=t.axis.chart.userOptions.yAxis.plotLines[0].__options,n=$(e.currentTarget),a=$(i.legendItem.element);if(a.length){a.toggleClass("point-hovered")}if(s.tmbcType==="tmbc_engagement"){return}if(n.find(".popout.tmbc").length<1){n.append('<div class="popout sidi-popout tmbc"></div>')}if(t._tmbcpopout){t._tmbcpopout.__settings.offsetY=e.offsetY}else{s.grade.offsetY=e.offsetY;t._tmbcpopout=n.tmbcpopout(s.grade).data("tmbcpopout");t._tmbcpopout._beforeShow()}t._tmbcpopout._isHovered=true;t._tmbcpopout._show()},_tmbcMouseOut:function(e){var t=this.axis.chart.series[0],i=$(e.currentTarget),s=$(t.legendItem.element),n;if(s.length){s.toggleClass("point-hovered")}},_buildEventOptions:function(e){var t,i=this;if(SM.App.isSharingApp()){return}t={plotOptions:{series:{point:{events:{mouseOver:SM.Highcharts.onPointMouseOver,mouseOut:SM.Highcharts.onPointMouseOver}}}}};return t},_buildColorOptions:function(){return{}},_hasLegend:function(){if(this.isBoxplot){return true}return false},_renderBoxPlotLabels:function(e){var t=this,i=t.dataBoxPlot;SM.Highcharts.renderBoxPlotLabels(e,i);if(t.dataPlotLabels){SM.Highcharts.renderBoxPlotLabels(e,t.dataPlotLabels,true)}}});SM.SummaryTableContainerView=SM.Views.register({__NAME:"SummaryTableContainerView",__templateID:"summary-table-container-template",__create:function(e){var t=this;t.survey=e.survey;t.question=e.question;t.rollup=t.question.getRollup();t.display=t.rollup.display;t.tableViewType=e.tableViewType;t.hasBenchmarkingOptions=e.hasBenchmarkingOptions;t.isExport=e.isExport;t.randomAssignmentOption=e.randomAssignmentOption;t._showingBenchmark=t.display.getDisplayData().show_benchmark;t.benchmarkRollup=t.question.page.survey.getBenchmarkRollup(t.question.ID);if(t.hasBenchmarkingOptions&&t.question.isTop2()){t.isTop2=t.display.isTop2()}_.bindAll(this,"_onTableDisplayChange","_onDisplaySaving","_setHighlightedLabelCell")},__init:function(){var e=this;e.bindModel(e.display,"displayChange",{self:e},e._onTableDisplayChange);e.bindModel(e.display,"tempDisplayChange",{self:e},e._onTableDisplayChange);e.bindModel(e.display,"allDisplaysChange",{self:e},e._onTableDisplayChange);e.bindModel(e.display,"saving",{self:e},e._onDisplaySaving);if(e.benchmarkRollup){e.benchmarkRollup.rollupList.on("benchmarkRollupLoaded",{self:e},e._onBenchmarkRollupLoaded);e.bindModel(e.benchmarkRollup,"revertBenchmarkRollup",{self:e},e._onRevertBenchmarkRollup)}e.$el.on("setHighlightedLabelCell",e._setHighlightedLabelCell)},__afterRender:function(){var e=this,t,i,s,n,a,o,r=e.question.isTop2()?" top2":"";if(e._shouldHideTable()){return}try{if(e.question.isTop2()){e.$el.addClass("top2")}i=e._getTableViewType();t=SM.Views.create(i,{question:e.question,highlightedDimensionID:e.highlightedDimensionID,isExport:e.isExport,isTop2:e.isTop2});if(e.question.isNPS()&&!t.isNPSScoreValid()&&!e._hasBenchmarking()){return}e.$el.html(t.el);n=t.showBasicStats&&e.question.getRollup().hasBasicStats();i=e._getAuxiliaryTableViewType(n);if(i){e.$el.append($('<div class="sm-bs-space'+r+'"></div>'));if(e.question.isTop2()){e.$el.append($('<div class="sm-bs-space top2 ledger"></div>'))}a=e._hasBenchmarking()&&this.question.isNPS()&&this.question.isCompared();if(a){o=SM.Template.render("benchmark-nps-distribution-table-title",{});e.$el.append($(o))}t=SM.Views.create(i,{question:e.question,isBasicStats:n,highlightedDimensionID:e.highlightedDimensionID,isExport:e.isExport,isTop2:e.isTop2});e.$el.append(t.el);if(a){e.$el.append($('<div class="sm-bs-space"></div>'));t=SM.Views.create(SM.BenchmarkNpsDistributionTableView,{question:e.question,highlightedDimensionID:e.highlightedDimensionID,isExport:e.isExport});e.$el.append(t.el)}}if(!SM.App.isSharingApp()&&!e.isExport&&!e._hasBenchmarking()){s=SM.Views.create(SM.CombineHideFooterView,{rollup:e.rollup,isMultiple:true,isSingle:true,isNone:false});e.$el.append(s.el)}}catch(l){e._handleRenderingError(l)}},_hasBenchmarking:function(){return this.hasBenchmarkingOptions&&this.survey.owner.hasBenchmarking()&&this._showingBenchmark},_getTableViewType:function(){var e=this,t;if(e._hasBenchmarking()){if(!e.question.isNPS()&&e.display.getDisplayData().isDistribution&&e.display.getChartType()!=="boxplot"){if(e.question.isCompared()){t=SM.ComparedMatrixSummaryTableView}else{t=SM.BenchmarkMatrixTableView}}else{t=SM.BenchmarkQuartileTableView}}else if(e.question.isNPS()){if(e.question.isCompared()){t=SM.NpsComparedMatrixSummaryTableView}else{t=SM.NpsSimpleSummaryTableView}}else if(e.question.isCompared()){if(e.question.isMenuMatrix()){t=SM.ComparedMenuMatrixSummaryTablesView}else{t=SM.ComparedMatrixSummaryTableView}}else{if(e.question.isMenuMatrix()){t=SM.MenuMatrixSummaryTablesView}else if(e.question.isMatrix()){t=SM.MatrixSummaryTableView}else if(e.question.isNumerical()){t=SM.NumericalSummaryTableView}else{t=SM.SimpleSummaryTableView}}return t},_getAuxiliaryTableViewType:function(e){if(this._hasBenchmarking()&&(this.question.isNPS()||this.question.isCompared())){if(this.benchmarkRollup.hasError()){return}if(this.question.isNPS()){if(this.question.isCompared()){return SM.NpsComparedMatrixSummaryTableView}return SM.BenchmarkNpsDistributionTableView}if(this.display.getChartType()==="boxplot"){return SM.ComparedAverageTableView}return SM.BenchmarkDistributionTableView}if(e&&!this._hasBenchmarking()){if(this.question.isMenuMatrix()){return}if(this.question.isCompared()&&this.question.isNumerical()){return SM.MenuMatrixBasicStatsTableView}if(this.question.isSimpleRating()){return SM.SimpleBasicStatsTableView}if(this.question.isCompared()||this.question.isMatrix()||this.question.isNumerical()){return SM.MatrixBasicStatsTableView}if(this.question.isSimple()){return SM.SimpleBasicStatsTableView}}return},_shouldHideTable:function(){var e=this,t=e.display.getDisplayData(),i,s;if(!t.show_table){return true}if(t.show_benchmark){i=e.question.page.survey;s=i.getBenchmarkRollup(e.question.ID);return s.hasError()}return false},_handleRenderingError:function(e){var t=this,i;i=document.createElement("div");i.innerHTML=SM.Template.render("summary-table-display-error-template");t.$el.html(i);SM.Error.log(e,"question summary table rendering error, QuestionID: "+t.question.ID)},_setHighlightedLabelCell:function(e){var t=this;t.highlightedDimensionID=e.answerID},_unsetHighlightedLabelCell:function(){var e=this;e.highlightedDimensionID=null},_onTableDisplayChange:function(e){var t=this;if(t.question.hasRandomAssignment()&&!!t.randomAssignmentOption){t.question.randomAssignmentOption=t.randomAssignmentOption}t.render()},_onDisplaySaving:function(e){var t=this;t._unsetHighlightedLabelCell()},_onBenchmarkRollupLoaded:function(e){var t=e.data.self,i=e.questionID;if(i===t.question.ID){t._showingBenchmark=true;t.render()}},_onRevertBenchmarkRollup:function(e){var t=e.data.self;t._showingBenchmark=false;t.render()}});SM.BaseSummaryTableView=SM.Object.deepExtend(SM.SummarySeriesFactory,{__defaults:{tableOptions:{headingsType:null,showFooter:false,hideExpandLinks:false},seriesOptions:{},seriesData:{},labelsData:{}},__create:function(e){var t=this;if(e.question.page.survey.owner.isBasic()||e.question.page.survey.owner.isSelect()){e=_.extend(e,{noLabelBySidi:true})}t._createAsSummarizable(e);t._buildLocalizedLabels();t._bindEvents(e.events);t._runIntegrityChecks();t.seriesOptions=t.__settings.seriesOptions;t.tableOptions=t.__settings.tableOptions;t.isExport=e.isExport;t.highlightedDimensionID=e.highlightedDimensionID},_runIntegrityChecks:function(){var e=this;if(e.__settings.tableOptions.headingsType===undefined){throw"You must define tableOptions.headingsType as one of 'series' or 'labels'"}},_buildLocalizedLabels:function(){var e=this;e.localizedLabels={answerChoices:Globalize.localize("Answer Choices"),responses:Globalize.localize("Responses"),total:Globalize.localize("Total"),score:Globalize.localize("Net Promoter&#174; Score"),totalNumber:Globalize.localize("Total Number"),totalRespondents:Globalize.localize("Total Respondents"),averageNumber:Globalize.localize("Average Number"),averageRating:Globalize.localize("Weighted Average"),averageRanking:Globalize.localize("Score")}},_bindEvents:function(e){var t=this;_.bindAll(this,"_onCaptionClick","_onThClick","_onTdClick","_onThActionSelected","_onTAToggleLinkClick")},__beforeRender:function(){var e=this;e._getDisplayOptions();e._getSortedSummaryData();if(e._setSeriesOptions){e._setSeriesOptions(e.get("seriesOptions"))}},__afterRender:function(){var e=this;e.$el.empty();e._renderTable();e.$el.find(".q").popout();if(e.question.page.survey.owner.canSigDiffs()&&e.question.canSidi()&&!e.rollup.comparedByRA&&e.showSidi&&e.isMirrored){e._renderSidiPopout()}},_renderSidiPopout:function(){var e=this,t=SM.App.isSharingApp(),i=e.question.page.survey.isExport,s=Globalize.culture().name==="en",n=e.$el.find("tbody td"),a="tr",o="td",r="table",l="th",h="caption";if(i){n=e.$el.find("div[display=tbody] div[display=td]");r="div[display=table]";a="div[display=tr]";o="div[display=td]";l="div[display=th]";h="div[display=caption]"}n.each(function(n){var u=$(this),c,d,p,m,f,g,y,b,S,v,w,C;if(!u.find(".sm-data-table-liner").length){return}m=u.closest(a);g=m.find(o+":first-child");f=m.find(o).length/2;d=u.closest(r);if(d.hasClass("basic-stats-matrix-table")){return}y=g.attr("data-dimension-id");if(!y){return}b=u.closest(r).find(l).eq(u.index());S=b.attr("data-dimension-id");v=b.attr("data-dimension-type")==="totals";if(v){v=parseInt($.trim(u.find(".sm-data-total").text()).replace(/[,\s]+|[,\s]+/g,""))<30}if(!S&&!v){return}if(v&&t){return}if(S){if(e.question.isMenuMatrix()){c=d.find(h);p=c.attr("data-dimension-id")}C=e.question.getSidiOptions(S,y,p);if(!C){return}if(C.hasSidi){if(!i){u.css({"background-color":"#D9E7E9"})}u.append('<div class="sm-data-table-liner sm-data-sidi">'+C.groups+"</div>")}}else if(v){C={hasSidi:false,needMore:true}}if(!i){u.append('<div class="popout sidi-popout"></div>');w=u.index()<f?"left":"right";C=_.extend(C,{question:e.question,surveyID:e.question.page.survey.ID,isSharing:t,canBuy:s,tipSide:w});u.sidipopout(C)}})},_renderTable:function(){var e=this,t;_.each(["_buildTableHeaderRowData","_buildTableBodyRowData","_buildTableFooterRowData"],function(t){if(e[t]===undefined){throw"You must define "+t+" in "+e.__NAME;
}});if(e.display.isBenchmarkShown()&&e.benchmarkSummary.hasError()){return}if(e._setLabelsAndSeriesData){e._setLabelsAndSeriesData()}if(e.showTitle&&e._renderTitle){e._renderTitle()}t=e._getTableOptions();Hightables.renderTable(t);if(e.highlightedDimensionID){e._highlightLabelCell(e.highlightedDimensionID)}},__init:function(){var e=this;e.$el.on(SM.Event.CLICK,"[ta-toggle-link]",{self:e},e._onTAToggleLinkClick);e.$el.on("actionMenu.actionSelected","th",{self:e},e._onThActionSelected);e.$el.on("actionMenu.actionSelected","td",{self:e},e._onTdActionSelected);e.$el.on("highlightLabelCell",function(t){e._highlightLabelCell(t.answerID)});e.$el.on("unHighlightLabelCell",function(t){e._unHighlightLabelCell(t.answerID)})},_highlightLabelCell:function(e){var t=this;t.$el.find(".highlight").removeClass("highlight");t.$el.find("[data-dimension-id='"+e+"']").addClass("highlight")},_unHighlightLabelCell:function(e){var t=this;t.$el.find("[data-dimension-id='"+e+"']").removeClass("highlight")},_getTableOptions:function(){var e=this,t=e._getTableData(),i=e._getTableClasses(),s=!!e.isExport,n;n={target:e.$el,tableData:t,tableClasses:i,useDivs:s,flattenNestedTables:s,events:e._getTableEvents()};return n},_getTableData:function(e){var t=this,i,s,n,a;e=e||{};if(t._buildTableCaptionData&&t._enableCaption!==false){i=t._buildTableCaptionData(e)}n=t._buildTableBodyRowData(e);s=t._buildTableHeaderRowData(e);a=t._buildTableFooterRowData(e);return{caption:i,thead:{rows:s},tbody:{rows:n},tfoot:{rows:a}}},_getTableLabelsData:function(e){var t=this,i=t.question,s=false,n,a,o,r,l;a=_.map(e,function(e){if(i.isEmoji()&&e.type==="row"&&i.structure.answers.rows[0].text===e.text){s=true}o={dimensionID:e.id,labelText:e.text,useEmoji:s};if(e.mediaHTML){o.labelHTML=e.mediaHTML}if(t._labelCellHasComments(e)&&t._shouldShowCommentsInLabelCell()){n=t.summary.summary.options[e.id];if(!!i.randomAssignmentOption){o.variationID=t.question.randomAssignmentOption.toString();if(t.questionFamily==="demographic"){n=t.summary.summary.options[i.randomAssignmentOption]}}else{o.variationID="0"}if(n){r=n.count}else{r=0}o.hasComments=true;o.optionID=e.id;o.responsesCount=r}l=t.rollup.combinehideModel.canCombineHide(e.id);o.hideActionMenu=!t._shouldShowTdActionMenu(e.id,l);return o});return a},_shouldShowTdActionMenu:function(e,t){var i=this;if(i.question.isNPS()){if(!i.question.isCompared()){return false}if(!i.isMirrored){return false}}if(i.displayData.show_benchmark){return false}if(i.isBasicStats){return false}if(i.get("isBasicStats")){return false}return i._shouldAllowLabelEditing(e)||t},_labelCellHasComments:function(e){var t=this;return t.question.isNumerical()||t.question.isOpenEnded()||e.is_openended&&e.options.is_answer_choice},_shouldShowCommentsInLabelCell:function(){var e=this;return!e.isCompared&&e.__NAME!=="MatrixBasicStatsTableView"},_getTableHeaderRowDataForLabels:function(e){var t=this,i=e.labelsData,s=e.includeBlankCell,n=[],a={},o=[],r,l,h,u;h=t.numRows;u=h>1;if(s){r=t._buildBlankTableHeaderCell({isSortable:u});o.push(r)}_.each(i,function(e){l=t._getTableHeaderCellCSSClasses(u,e.dimensionType);r={template:e.template||"table-header-cell",context:{labelText:e.text,classes:l,dimensionType:e.dimensionType,hideActionMenu:e.hideActionMenu,variationID:"0"}};if(e.flags){$.extend(r.context,e.flags)}o.push(r)});a.cells=o;n.push(a);return n},_getTableHeaderRowDataForSeries:function(e){var t=e.series,i=e.includeBlankCell,s=e.scopedDimensionID;var n=this,a=[],o=[],r={},l,h,u,c,d,p;u=t[0].data.length;c=u>1;if(i){l=n._buildBlankTableHeaderCell({scopedDimensionID:s,isSortable:c});o.push(l)}var m,f,g;_.each(t,function(t){m=t.__options;f=m.dimensionType;g=m.dimensionID;h=n._getTableHeaderCellCSSClasses(c,f,g,s);if(e.hideActionMenu){d=true}else{d=n.isBasicStats&&n.question.isCompared()&&n.question.isNumerical()||!n.get("isBasicStats")&&n.question.isNPS()&&(n.isMirrored||!!!g)}p=n.question.isNPS()?m.labelText:m.labelHTML;var i=false;if(n.question.isEmoji()&&m.dimensionType==="row"&&n.question.getAnswer(m.dimensionID)&&n.question.getAnswer(m.dimensionID).text===m.labelText){i=true}l={template:"table-header-cell",context:{labelText:m.labelText,labelHTML:p,classes:h,dimensionType:f,dimensionID:g,hasCommentsPerRow:m.hasCommentsPerRow,optionID:g,variationID:"0",responsesCount:m.numComments,columnHasComments:m.numComments>0,colSpan:m.colSpan,hideActionMenu:d,useEmoji:i}};o.push(l)});r.cells=o;a.push(r);return a},_buildBlankTableHeaderCell:function(e){var t=this,i,s,n,a=e.scopedDimensionID,o=e.isSortable;n=t.isBasicStats||t.question.isCompared()&&(!t.get("isBasicStats")&&t.question.isNPS()||t.isBasicStats&&t.question.isNumerical());s="labels";i=t._getTableHeaderCellCSSClasses(o,s,null,a);return{template:"table-header-blank-cell",context:{classes:i,dimensionType:s,hideActionMenu:n,isStatsHeader:t.isBasicStats}}},_getTableBodyRowData:function(e){var t=this,i=[],s,n,a,o=e.labelsData,r=e.series;_.each(o,function(e,o){n=[];a=t._buildLabelCell(e);n.push(a);_.each(r,function(e){a=t._buildSeriesCell(e,o);n.push(a)});s={cells:n};i.push(s)});return i},_buildLabelCell:function(e){return{template:"table-label-cell",context:e}},_buildSeriesCell:function(e,t){var i=this,s,n,a=e.__options.defaultContext||{},o,r,l,h;s=e.data[t];n=e.__options.dimensionType;o=e.__options.template||"table-response-cell";l=s?s.absoluteY:0;if(l===null){l="--"}a.numResponses=i._formattedNumResponses(l,n);if(i._shouldIncludePercentageData(n)){h=s?s.percentageY:0;if(h!==null){a.percentage=i._formattedPercentage(h)}}if(n==="totals"&&i.question.isCompared()){if(i.summary.answered===0){h=0}else{h=100*Globalize.parseInt(l+"")/i.summary.answered;a.percentage=i._formattedPercentage(h)}}if(s&&s.__options&&s.__options.commentData){var u=s.__options.commentData;a.hasComments=true;a.numComments=u.numComments;a.optionID=u.optionID;a.crossedOptionID=u.crossedOptionID;a.matrixCrossTab=u.matrixCross;a.variationID=u.variationID||"0"}return{template:o,context:a}},_formattedNumResponses:function(e){var t=this.get("isBasicStats")||this.isBasicStats?2:0,i=SM.Highcharts.getGlobalizeFormatType("absolute",t);return Globalize.format(e,i)},_formattedPercentage:function(e){var t=SM.Highcharts.getGlobalizeFormatType("percent",this.decimalPlacesPercentage);return Globalize.format(e/100,t)},_shouldIncludePercentageData:function(e){return!_.include(["totals","averageRating","averageNumber","responses","score"],e)},_getTableFooterRowData:function(e){var t=this,i=[],s;if(t.question.isSimple()){s={template:"simple-table-footer-row",context:{questionIsMultiResponse:t.question.isMultiResponse(),numRespondents:Globalize.format(t.rollup.getContextSummary().answered,"n0")}};i.push(s)}else if(t.question.isNumerical()){s={template:"numerical-table-footer-row",context:{colSpan:e.colSpan===4,numRespondents:Globalize.format(t.rollup.getContextSummary().answered,"n0")}};i.push(s)}if(t._shouldShowCommentsRow()){s={template:"table-footer-comments-row",context:{colSpan:e.colSpan,optionID:e.optionID,variationID:e.variationID,hasComments:e.hasComments,numComments:e.numComments}};i.push(s)}return i},_shouldShowCommentsRow:function(){var e=this;if(e.isExport){return false}return e._hasCommentField()&&!e._commentFieldIsAnswer()&&!e._hasCommentFieldPerRow()},_getTableClasses:function(){var e=this,t=[];t.push("sm-data-table");if(SM.App.isSharingApp()){t.push("shared")}if(e.questionType==="simple"){t.push("sm-data-table-summary")}else if(e.questionType==="matrix"||e.questionType==="menu_matrix"||e.question.isCompared()){t.push("sm-matrix-table")}if(e.question.isNPS()){if(!e.question.isCompared()){t.push("nps-detailed-table")}else{t.push("nps-compared-table")}}if(e.isBasicStats||e.__NAME==="MatrixBasicStatsTableView"){t.push("basic-stats-matrix-table")}return t.join(" ")},_getTableHeaderCellCSSClasses:function(e,t,i,s){var n=this,a=[],o;o=n._getSortData(s);if(e){a.push("sortable")}if(_.contains(["totals","averageRating","averageNumber","averageRanking","dataSegment"],t)){a.push(t)}if(o&&o.dimensionType===t){if(i){if(o.dimensionID===i){a.push(o.order)}}else{a.push(o.order)}}if(n.isBasicStats){a.push("basic-stats")}return a.join(" ")},_hasCommentField:function(){var e=this;return!!e.question.commentField},_commentFieldIsAnswer:function(){var e=this;return!!e.question.commentField.options.is_answer_choice},_hasCommentFieldPerRow:function(){var e=this;return e._hasCommentField()&&e.question.commentField.options.apply_all_rows},_shouldAllowLabelEditing:function(e){var t=this,i=true;if(!e||t.question.isOpenEnded()||t.question.isCompared()&&t.question.isNumerical()||t.rollup.combinehideModel.isCombined(e)){i=false}return i},_getSortData:function(e){var t=this,i;if(e){i=t.displayData.sort_data[e]}else{i=t.displayData.sort_data}return i},_getTableEvents:function(){return{tdMouseEnter:this._onTdMouseEnter,tdMouseLeave:this._onTdMouseLeave,thClick:this._onThClick,tdClick:this._onTdClick}},_onCaptionClick:function(e){var t=this,i=$(e.currentTarget),s=i.attr("data-dimension-id"),n={answerID:s,visibleOptions:{labels:true}};SM.CustomizeActionMenu.actionMenu.call(t,e,"caption",n)},_onThClick:function(e){var t=this,i=$(e.currentTarget),s=i.attr("data-dimension-type"),n=i.attr("data-dimension-id"),a,o={parent:i,visibleOptions:{}};if(_.isEmpty(s)){return}if(SM.App.isSharingApp()){return}if(i.hasClass("no-action-menu")){return}if(_.contains(["labels","totals","averageRating","averageNumber","responses"],s)||n&&t.rollup.combinehideModel.isCombined(n)){o.visibleOptions.labels=false}else{o.visibleOptions.labels=true}if(s==="labels"){o.visibleOptions.number=false}else{o.visibleOptions.number=true}o.visibleOptions.labels=t._shouldAllowLabelEditing(n);o.answerID=n;if(!t.get("isBasicStats")&&t.question.isNPS()&&!!n){o.visibleOptions.ascending=false;o.visibleOptions.descending=false;o.visibleOptions.unsorted=false}if(i.hasClass("basic-stats")||this.__NAME==="MatrixBasicStatsTableView"){o.visibleOptions.labels=false}if(t.display.getBenchmarkDisplay()){return}a=t.rollup.combinehideModel.getActionMenuOption(n);SM.CustomizeActionMenu.actionMenu.call(t,e,"th",SM.Object.deepExtend(o,a))},_onThActionSelected:function(e){var t=this,i=$(e.target),s=i,n=s.parents("table").eq(0),a=s.attr("data-dimension-type"),o=s.attr("data-dimension-id"),r,l,h,u;if(_.contains(["unsorted","ascending","descending"],e.action)){h=e.action;if(n.attr("data-dimension-id")){r=n.attr("data-dimension-id");l=n.attr("data-dimension-type")}u=n.hasClass("basic-stats-matrix-table");t.rollup.display.sort(a,o,h,l,r,u)}else{t._onCombineHideActionSelected(e)}},_onTdClick:function(e){var t=this,i=$(e.target),s=$(e.currentTarget),n,a,o,r={visibleOptions:{}};if(SM.App.isSharingApp()){return}if(s.parents("tfoot").length){return}if(i.is("a")){return}if(s.hasClass("no-action-menu")){return}n=s.attr("data-dimension-id");if(!n){return}r.answerID=n;r.visibleOptions.labels=t._shouldAllowLabelEditing(n);a=t.rollup.combinehideModel.canCombineHide(n);if(t._shouldShowTdActionMenu(n,a)){o=t.rollup.combinehideModel.getActionMenuOption(n);SM.CustomizeActionMenu.actionMenu.call(t,e,"td",SM.Object.deepExtend({parent:s},r,o))}},_onTdActionSelected:function(e){var t=e.data.self;if(t._onCombineHideActionSelected(e)){e.stopPropagation()}},_onTdMouseLeave:function(e){},_onTdMouseEnter:function(e){},_onCombineHideActionSelected:function(e){var t=e.data.self,i,s;i=e.action;s=e.$action.attr("data-answer-id");if(_.contains(["combine","editCombine","unCombine","hide"],i)){t._handleCombineHideAction(i,s);return true}else{return false}},_handleCombineHideAction:function(e,t){var i=this;switch(e){case"combine":SM.Bi.uiTrigger="addCombineQuestionSummaryTableAnswerChoiceMenu";i._openCombineDialog(t,false);break;case"editCombine":SM.Bi.uiTrigger="editCombineQuestionSummaryTableAnswerChoiceMenu";i._openCombineDialog(t,true);break;case"unCombine":SM.Bi.uiTrigger="unCombineQuestionSummaryTableAnswerChoiceMenu";i.rollup.combinehideModel.unCombine(t);break;case"hide":SM.Bi.uiTrigger="hideQuestionSummaryTableAnswerChoiceMenu";i.rollup.combinehideModel.addHide(t);break;default:break}},_openCombineDialog:function(e,t){var i=this,s;s=SM.Views.create(SM.CombineDialogView,{model:i.rollup,answerID:e,isEditCombine:t});s.open();$("body").addClass("modal-open")},_onTAToggleLinkClick:function(e){e.preventDefault();var t=this,i="ta-visible",s="ta-visible",n=$(e.target),a,o,r;if(t.question.hasCommentsPerRow()&&!t.question.isCompared()&&t.isMirrored){a=n.parents("th:eq(0)")}else{a=n.parents("td:eq(0)")}o=n.closest("tr").find("["+i+"=true]").not(a);r=a.attr(i)==="true";if(o.length){o.attr(i,"false");o.removeClass(s);t._hideTARowView(o)}if(r){t._hideTARowView(n);a.attr(i,"false");a.removeClass(s)}else{t._expandTARowView(n);a.attr(i,"true");a.addClass(s)}},_expandTARowView:function(e){var t=this,i=e.attr("option-id"),s=e.attr("variation-id"),n=e.attr("crossed-option-id"),a=e.attr("matrix-crosstab"),o=e.data("responseCount"),r,l,h=e.closest("tr");if(t.question.isFileUpload()){r=t.rollup.getFileUploadModel(i,n,a,s)}else{r=t.rollup.getTaModel(i,n,s);if(!r){r=t.rollup.createTaModel(i,n,a,s)}r.set("filterCount",o)}l=SM.Views.create(SM.SummaryTaRowView,{question:t.question,model:r});h.after(l.el);$(l.el).data("containerView",l)},_hideTARowView:function(e){var t=e.closest("tr"),i=t.next();i.data("containerView").destroy();i.remove()}});SM.SimpleSummaryTableView=SM.Views.deepExtend(SM.BaseSummaryTableView,{__NAME:"SimpleSummaryTableView",__templateID:"summary-table-template",_buildTableHeaderRowData:function(){var e=this,t,i;i=[{text:e.localizedLabels.answerChoices,dimensionType:e.DIMENSION_TYPES.LABELS},{text:e.localizedLabels.responses,dimensionType:e.DIMENSION_TYPES.RESPONSES}];t=e._getTableHeaderRowDataForLabels({labelsData:i});return t},_buildTableBodyRowData:function(){var e=this,t,i=e.sortedRowsList[0],s,n;s=e._getTableLabelsData(i);n=e.buildSimpleSeries(e.summary,i,e.seriesOptions);t=e._getTableBodyRowData({labelsData:s,series:n});return t},_buildTableFooterRowData:function(){var e=this,t,i,s;i={colSpan:2};if(e._hasCommentField()&&!e._commentFieldIsAnswer()){s=e.summary.other_option||0;var n="0";if(e.question.randomAssignmentOption){n=e.question.randomAssignmentOption.toString()}_.extend(i,{optionID:e.question.commentField.id,variationID:n,hasComments:s>0,numComments:s})}t=e._getTableFooterRowData(i);return t}});SM.NpsSimpleSummaryTableView=SM.Views.deepExtend(SM.SimpleSummaryTableView,{__NAME:"NpsSimpleSummaryTableView",__templateID:"summary-table-template",__beforeRender:function(){var e=this;e._getDisplayOptions();e._getSortedSummaryData();e._getNpsData()},__afterRender:function(){var e=this;e.$el.empty();if(e.isDepthDetailed){e._renderTable()}e._renderDistributionTable()},_buildTableHeaderRowData:function(){var e=this,t,i;i=[{text:"",dimensionType:e.DIMENSION_TYPES.LABELS,hideActionMenu:true},{text:e.localizedLabels.responses,dimensionType:e.DIMENSION_TYPES.RESPONSES,hideActionMenu:true}];t=e._getTableHeaderRowDataForLabels({labelsData:i});return t},_renderDistributionTable:function(){var e=this,t,i;t=e._buildDistributionSeries();t.hasHeader=e.isDepthDetailed;i=SM.Template.renderHTML("nps-distribution-table",t);e.$el.prepend(i)},_buildTableCaptionData:function(e){var t=this;return{template:"table-caption",context:{caption:Globalize.localize("Answer Choices"),dimensionID:"scopedDimension.id",mediaCaption:Globalize.localize("Answer Choices"),classes:""}}},_buildDistributionSeries:function(){var e=this,t,i=e.decimalPlacesPercentage;t=e.buildSimpleSeries(e.npsSummary.distribution.summary,e.npsSummary.distribution.answerStructures.rows);if(e.nps_depth==="score"){i=e.decimalPlaces}return{Detractors:{name:t[0].data[0].name,percent:SM.Highcharts.formatYValue(t[0].data[0].percentageY,"percent",i),value:e._formattedNumResponses(t[0].data[0].absoluteY)},Passives:{name:t[0].data[1].name,percent:SM.Highcharts.formatYValue(t[0].data[1].percentageY,"percent",i),value:e._formattedNumResponses(t[0].data[1].absoluteY)},Promoters:{name:t[0].data[2].name,percent:SM.Highcharts.formatYValue(t[0].data[2].percentageY,"percent",i),value:e._formattedNumResponses(t[0].data[2].absoluteY)},Score:Math.round(t[0].data[2].percentageY-t[0].data[0].percentageY)}},_getDisplayOptions:function(){var e=this;SM.Summarizable._getDisplayOptions.call(e);e.nps_depth=e.displayData.nps_depth;e.isDepthDetailed=e.displayData.isDepthDetailed}});SM.NumericalSummaryTableView=SM.Views.extend(SM.BaseSummaryTableView,{__NAME:"NumericalSummaryTableView",__templateID:"summary-table-template",_setSeriesOptions:function(e){var t=this;e.averageSeriesName=t.localizedLabels.averageNumber;e.totalSeriesName=t.localizedLabels.totalNumber;e.responsesSeriesName=t.localizedLabels.responses},_buildTableHeaderRowData:function(){var e=this,t,i,s;i=[{text:e.localizedLabels.answerChoices,dimensionType:e.DIMENSION_TYPES.LABELS},{text:e.localizedLabels.averageNumber,dimensionType:e.DIMENSION_TYPES.AVERAGE_NUMBER},{text:e.localizedLabels.totalNumber,dimensionType:e.DIMENSION_TYPES.TOTALS},{text:e.localizedLabels.responses,dimensionType:e.DIMENSION_TYPES.RESPONSES}];s=i;t=e._getTableHeaderRowDataForLabels({labelsData:s});return t},_buildTableBodyRowData:function(){var e=this,t,i=e.sortedRowsList[0],s,n,a=e.get("seriesOptions");n=e.buildNumericalSeries(a);s=e._getTableLabelsData(i);t=e._getTableBodyRowData({labelsData:s,series:n});return t},_buildTableFooterRowData:function(){var e=this,t;t=e._getTableFooterRowData({colSpan:4});return t}});SM.MatrixSummaryTableView=SM.Views.extend(SM.BaseSummaryTableView,{__NAME:"MatrixSummaryTableView",__templateID:"summary-table-template",_setSeriesOptions:function(e){var t=this;e.includeTotal=true;if(t.question.isMultiResponse()){e.totalSeriesName=t.localizedLabels.totalRespondents}else{e.totalSeriesName=t.localizedLabels.total}if(t.question.isRating()||t.question.isRanking()){e.includeAverage=true;if(t.question.isRating()){e.averageSeriesName=t.localizedLabels.averageRating}else{e.averageSeriesName=t.localizedLabels.averageRanking}}},_setLabelsAndSeriesData:function(){var e=this,t,i,s=e.get("seriesOptions");if(e.isMirrored){i=e.sortedColumnsList[0];e.labelsData=e._getTableLabelsData(i);e.seriesData=e.buildMirroredMatrixSeries(s)}else{t=e.sortedRowsList[0];e.seriesData=e.buildMatrixSeries(s);if(e._hasCommentFieldPerRow()){e.labelsData=e._getCommentsPerRowTableLabelsData(t)}else{e.labelsData=e._getTableLabelsData(t)}}},_getCommentsPerRowTableLabelsData:function(e){var t=this,i,s,n,a;return _.map(e,function(e){i=t.summary.summary.options[e.id];n=i&&i.row_other?i.row_other:0;a=t.question.randomAssignmentOption?t.question.randomAssignmentOption:0;s={variationID:a,labelText:e.text,labelHTML:e.mediaHTML,hasCommentsPerRow:true,optionID:e.id,responsesCount:n,rowHasComments:n>0};return s})},_buildTableHeaderRowData:function(){var e=this,t;t=e._getTableHeaderRowDataForSeries({series:e.seriesData,includeBlankCell:true});return t},_buildTableBodyRowData:function(){var e=this,t;t=e._getTableBodyRowData({labelsData:e.labelsData,series:e.seriesData});return t},_buildTableFooterRowData:function(){var e=this,t,i;if(e._hasCommentField()&&!e._hasCommentFieldPerRow()){var s=e.summary.other_option||0,n=e.seriesData.length+1;i={colSpan:n,optionID:e.question.commentField.id,variationID:e.question.randomAssignmentOption,hasComments:s>0,numComments:s};t=e._getTableFooterRowData(i);return t}}});SM.BaseMenuMatrixSummaryTablesView=SM.Views.extend(SM.BaseSummaryTableView,{__NAME:"BaseMenuMatrixSummaryTablesView",__templateID:"summary-table-template",_setSeriesOptions:function(e){var t=this;e.includeTotal=true;e.totalSeriesName=t.localizedLabels.total;e.averageSeriesName=t.localizedLabels.averageNumber;if(t.question.isRating()||t.question.isRanking()){e.includeAverage=true;if(t.question.isRating()){e.averageSeriesName=t.localizedLabels.averageRating}else{e.averageSeriesName=t.localizedLabels.averageRanking}}},__afterRender:function(){var e=this,t;e.$el.empty();if(!e.dimensionalSplitKey){throw"You must define self.dimensionalSplitKey for menu-matrix questions"}_.each(e[e.dimensionalSplitKey],function(i,s){e._setLabelsAndSeriesData(i,s);t=e._getTableOptions(i,s);Hightables.renderTable(t);if(e.showBasicStats&&e.question.getRollup().hasBasicStats()&&!e.question.isNumerical()){e.isBasicStats=true;e._enableCaption=false;e._setLabelsAndSeriesData(i,s);t=e._getTableOptions(i,s);Hightables.renderTable(t);e._enableCaption=true;e.isBasicStats=false}});if(e._hasOtherCommentsTable()){e._renderOtherCommentsTable()}if(e.highlightedDimensionID){e._highlightLabelCell(e.highlightedDimensionID)}e.$el.find(".q").popout();if(e.question.page.survey.owner.canSigDiffs()&&e.showSidi&&e.isMirrored){e._renderSidiPopout()}},_getTableOptions:function(e,t){var i=this,s=i._getTableData({scopedDimension:e,scopedDimensionIndex:t}),n=i._getTableClasses(),a=!!i.isExport,o,r;if(i.isBasicStats){r=$('<div class="sm-bs-menu-matrix-table"></div>')}else if(i.showBasicStats){r=$('<div class="sm-bs-table"></div>')}else{r=$("<div></div>")}i.$el.append(r);o={target:r,tableData:s,tableClasses:n,tableAttrs:{"dimension-id":e.id,"dimension-type":e.type},events:{captionClick:i._onCaptionClick,thClick:i._onThClick,tdClick:i._onTdClick},useDivs:a,flattenNestedTables:a};return o},_buildTableCaptionData:function(e){var t=this,i=e.scopedDimension,s=false;if(t.question.isEmoji()&&i.type==="row"&&t.question.getAnswer(i.id)["text"]===i.text){s=true}return{template:"table-caption",context:{caption:i.text,dimensionID:i.id,mediaCaption:i.mediaHTML,classes:"",useEmoji:s}}},_buildTableHeaderRowData:function(e){var t=this,i,s=e.scopedDimension.id;i=t._getTableHeaderRowDataForSeries({series:t.seriesData,includeBlankCell:true,scopedDimensionID:s});return i},_buildTableBodyRowData:function(e){var t=this,i,s=e.scopedDimension.id;i=t._getTableBodyRowData({labelsData:t.labelsData,series:t.seriesData,scopedDimensionID:s});return i}});SM.MenuMatrixSummaryTablesView=SM.Views.extend(SM.BaseMenuMatrixSummaryTablesView,{__NAME:"MenuMatrixSummaryTablesView",dimensionalSplitKey:"columns",_setLabelsAndSeriesData:function(e,t){var i=this,s=i.get("seriesOptions"),n,a,o,r;if(i.isBasicStats){n=i.sortedRowsListBS[t]}else if(i.isMirrored){n=i.sortedColumnChoicesList[t]}else{n=i.sortedRowsList[t]}i.labelsData=i._getTableLabelsData(n);if(i.isBasicStats){a=SM.BasicStatsUtils.getStructure("column_choice");s={isBasicStats:true}}else{a=e.items}i.seriesData=i.buildMenuMatrixSeries(e,t,a,i.columnChoiceTotalsByColumnChoice,s)},_buildTableFooterRowData:function(e){},_hasOtherCommentsTable:function(){var e=this;return e._hasCommentField()},_getOtherTableData:function(){var e=this,t=e.summary.other_option||0;return{optionID:e.question.commentField.id,hasComments:t>0,numComments:t,variationID:"0"}},_renderOtherCommentsTable:function(){var e=this,t=e._getOtherTableData();e.$el.append(SM.Template.render("other-comments-for-menu-matrix-table",t))}});SM.ComparedMatrixSummaryTableView=SM.Views.deepExtend(SM.BaseSummaryTableView,{__NAME:"ComparedMatrixSummaryTableView",__templateID:"summary-table-template",__create:function(e){SM.BaseSummaryTableView.__create.call(this,e);this.isTop2=e.isTop2;this.showTitle=this.isTop2},_renderTitle:function(){var e=this,t=e.rollup.answeredCount,i=t===0?0:e.rollup.top2compositeSummary.answered/t,s=Globalize.format(i,"p1"),n=SM.Template.render("top2-table-title",{score:s});e.$el.prepend($(n))},_setSeriesOptions:function(e){var t=this;e.includeTotal=true;e.totalSeriesName=t.localizedLabels.total},_setLabelsAndSeriesData:function(){var e=this,t,i,s=e.get("seriesOptions"),n=e.get("isTop2");if(n){e.decimalPlacesPercentage=1}if(e.isMirrored){i=e.sortedColumnsList[0];e.labelsData=e._getTableLabelsData(i);if(n){s.isTable=true;s.isCompared=true;e.seriesData=e.buildTop2StackedSeries(s)}else{e.seriesData=e.buildMirroredMatrixSeries(s)}}else{t=e.sortedRowsList[0];e.seriesData=e.buildMatrixSeries(s);e.labelsData=e._getTableLabelsData(t)}},_buildTableHeaderRowData:function(){var e=this,t;t=e._getTableHeaderRowDataForSeries({series:e.seriesData,includeBlankCell:true,hideActionMenu:e.display.getBenchmarkDisplay()});return t},_buildTableBodyRowData:function(){var e=this,t;t=e._getTableBodyRowData({labelsData:e.labelsData,series:e.seriesData});return t},_buildTableFooterRowData:function(){var e=this,t,i={};if(e._hasCommentField()&&!e._commentFieldIsAnswer()){i.showComments=true}t=e._getTableFooterRowData(i);return t},_getTableFooterRowData:function(e){var t=this,i=[],s,n;s=t._getTableFooterTotalsRowData();i.push(s);if(e.showComments){if(t.isMirrored){n=t._getMirroredTableFooterCommentsRowData();i.push(n)}else{n=t._getTableFooterCommentsRowData();i.push(n)}}return i},_getTableFooterTotalsRowData:function(){var e=this,t,i,s=[],n,a,o=e.get("isTop2"),r=o&&e.sortedColumnsList[0].length>1;n={template:"table-label-cell",context:{hideActionMenu:e.question.isNPS(),labelText:e.localizedLabels.totalRespondents}};s.push(n);if(o){t=[e.rollup.top2compositeSummary.answered]}else if(e.isMirrored){t=_.map(e.rows,function(t){return e.respondentCountsByRow[t.id]})}else{t=_.map(e.columns,function(t){return e.respondentCountsByColumn[t.id]})}_.each(t,function(t){var i=o?t===0?0:t*100/e.rollup.answeredCount:0;e.top2Percentage=e._formattedPercentage(i);n={template:"table-footer-total-cell",context:{hasPercentage:r,percentage:e.top2Percentage,total:e._formattedNumResponses(t)}};s.push(n)});n={template:"table-footer-total-cell",context:{hasPercentage:r,percentage:e._formattedPercentage(100),total:e._formattedNumResponses(e.rollup.answeredCount)}};s.push(n);if(e.get("seriesOptions").includeScore){n={template:"table-footer-total-cell",context:{total:""}};s.push(n)}i={cells:s};return i},_getTableFooterCommentsRowData:function(){var e=this,t=e.question.getRollup(),i,s=e.sortedColumnsList[0],n,a,o=0,r,l=[],h,u;try{i=t.options.other_option.options}catch(c){}n=t.summary.crossed_cols?"1":"0";h={template:"table-label-cell",context:{labelText:e.question.commentField.text}};l.push(h);_.each(s,function(t){if(i&&i[t.id]){u=i[t.id];a=u.count}else{a=0}o+=a;h={template:"table-footer-comment-cell",context:{hasComments:a>0,numComments:a,optionID:e.question.commentField.id,crossedOptionID:t.id,matrixCrossTab:n,responsesCount:a}};l.push(h)});h={template:"table-footer-total-cell",context:{total:o}};l.push(h);r={cells:l};return r},_getMirroredTableFooterCommentsRowData:function(){var e=this,t=e.question.getRollup(),i,s=e.sortedColumnsList[0],n=[],a,o,r,l,h,u;try{i=t.options.other_option.options}catch(c){}l=t.summary.crossed_cols?"1":"0";_.each(s,function(t){if(i&&i[t.id]){r=i[t.id].count}else{r=0}if(l==="2"){u=t.id||0;u.toString()}else{u="0"}o=[{labelText:t.text,numComments:r,hasComments:r>0,optionID:e.question.commentField.id,crossedOptionID:t.id,matrixCrossTab:l,variationID:u}];a={cells:o};n.push(a)});h=e.numRows+2;return{template:"mirrored-compared-other-comments-for-matrix-table",context:{otherFieldLabel:e.question.commentField.text,rows:n,colSpan:h,variationID:"0"}}}});SM.NpsComparedMatrixSummaryTableView=SM.Views.deepExtend(SM.ComparedMatrixSummaryTableView,{__NAME:"NpsComparedMatrixSummaryTableView",__templateID:"summary-table-template",_setSeriesOptions:function(e){var t=this;e.includeTotal=true;e.totalSeriesName=t.localizedLabels.total;e.includeScore=true;e.scoreSeriesName=t.localizedLabels.score},_unsetSeriesOptions:function(e){var t=this;e.includeScore=false},__beforeRender:function(){var e=this;e._getDisplayOptions();e._getSortedSummaryData();e._getNpsData()},__afterRender:function(){var e=this;e.$el.empty();e._enableCaption=e.nps_depth===SM.QuestionDisplayModel.DISPLAY_VALUES.nps_detailed;e.isMirrored=true;e._setAsSummarizableNps(SM.QuestionDisplayModel.DISPLAY_VALUES.nps_distribution);e._setSeriesOptions(e.get("seriesOptions"));e._renderTable();if(e.nps_depth===SM.QuestionDisplayModel.DISPLAY_VALUES.nps_detailed){e.isMirrored=false;e._setAsSummarizableNps(SM.QuestionDisplayModel.DISPLAY_VALUES.nps_detailed);e._unsetSeriesOptions(e.get("seriesOptions"));e._renderTable()}e.isMirrored=true},_buildTableCaptionData:function(e){var t=this;return{template:"table-caption",context:{caption:Globalize.localize("Net Promoter Score"),dimensionID:"",mediaCaption:t.isMirrored?Globalize.localize("Net Promoter Score"):Globalize.localize("Answer Choices"),classes:""}}},_getDisplayOptions:function(){var e=this;e.displayData=e.rollup.display.getDisplayData();e.isDepthDetailed=e.displayData.isDepthDetailed;e.showTable=e.displayData.show_table;e.showChart=e.displayData.show_chart;e.isMirrored=e.displayData.mirror;e.isStacked=e.displayData.isStacked;e.isWeightedAvg=e.displayData.isWeightedAvg;e.showDataLabels=e.displayData.show_data;e.hideEmptyData=!e.displayData.show_empty_data;e.scaleType=e.displayData.scale_type;e.scaleIsPercent=e.scaleType===e.SCALE_TYPE_PERCENT;e.decimalPlaces=e.scaleIsPercent?e.displayData.dp_percentage:e.displayData.dp_absolute;if(e.displayData.nps_depth==="score"){e.decimalPlacesAbsolute="0";e.decimalPlacesPercentage=e.displayData.dp_absolute}else{e.decimalPlacesAbsolute=e.displayData.dp_absolute;e.decimalPlacesPercentage=e.displayData.dp_percentage}e.nps_depth=e.displayData.nps_depth;e.showBasicStats=e.displayData.show_basic_stats;e.showSidi=e.displayData.show_sig_diffs}});SM.ComparedMenuMatrixSummaryTablesView=SM.Views.extend(SM.BaseMenuMatrixSummaryTablesView,{__NAME:"ComparedMenuMatrixSummaryTablesView",dimensionalSplitKey:"rows",_setLabelsAndSeriesData:function(e,t){var i=this,s,n,a,o,r,l,h,u,c,d;s=i.get("seriesOptions");n=e.items;if(i.isMirrored||i.isBasicStats){a=i.isBasicStats?i.sortedColumnChoicesListBS[t]:i.sortedColumnChoicesList[t];i.labelsData=i._getTableLabelsData(a);if(i.isMirrored&&i._hasCommentFieldPerRow()){h=i.summary.summary.options[e.id];l=h&&h.row_other?h.row_other:0;d=i.summary.crossed_question_id?i.summary.crossed_question_id:0;c=d&&i.question.page.survey.questions[d].family=="matrix"?1:0;u=i.question.randomAssignmentOption?i.question.randomAssignmentOption:0;if(!i.isBasicStats){i.labelsData=_.map(i.labelsData,function(t){t.hasCommentsPerRow=true;t.optionID=e.id;t.variationID=u;t.matrixCrossTab=c;if(t.dimensionID&&t.dimensionID>0){t.crossedOptionID=t.dimensionID}t.responsesCount=l;t.rowHasComments=t.responsesCount>0;return t})}}}else{o=i.sortedColumnsList[t];i.labelsData=i._getTableLabelsData(o)}r=i.columnChoiceTotalsByRow[e.id];if(i.isBasicStats){s={columns:SM.BasicStatsUtils.getStructure(),isBasicStats:true}}i.seriesData=i.buildComparedMatrixSeries(e,n,r,s)},_buildTableFooterRowData:function(e){},_hasOtherCommentsTable:function(){var e=this;return e._hasCommentField()&&!e._commentFieldIsAnswer()&&!e._hasCommentFieldPerRow()},_crossedOptionInOtherSummary:function(e,t){var i=this,s;s=_.find(e,function(e){return t in e});return s[t]},_getOtherTableData:function(){var e=this,t=e.question.getRollup(),i,s=[],n,a=[],o,r,l=0,h,u,c;try{i=t.options.other_option.options.other_option.options}catch(d){}u=t.summary.crossed_cols?"1":"0";_.each(e.crossedOptions,function(t){n={text:t.text};s.push(n);if(i){if(i[t.id]){r=i[t.id].count}else if(e._crossedOptionInOtherSummary(i,t.id)){r=e._crossedOptionInOtherSummary(i,t.id).count}}else{r=0}h=t.variable_id||0;h=h.toString();l+=r;o={hasComments:r>0,numComments:r,optionID:e.question.commentField.id,crossedOptionID:t.id,matrixCrossTab:u,variationID:h};a.push(o)});if(e.isMirrored){c=e.columns.length+2}else{c=e.crossedOptions.length+2}return{crossedOptionLabels:s,otherOptionLabel:e.question.commentField.text,crossedOptionCells:a,totalNumComments:l,colSpan:c}},_renderOtherCommentsTable:function(){var e=this,t=e._getOtherTableData();e.$el.append(SM.Template.render("compared-other-comments-for-menu-matrix-table",t))}});SM.MenuMatrixBasicStatsTableView=SM.Views.extend(SM.BaseMenuMatrixSummaryTablesView,{__NAME:"MenuMatrixBasicStatsTableView",dimensionalSplitKey:"rows",_setLabelsAndSeriesData:function(e,t){var i=this,s,n;n=i.columns;s=SM.BasicStatsUtils.getStructure();i.isBasicStats=true;i.labelsData=i._getTableLabelsData(i.columns);i.seriesData=i.buildComparedMatrixSeriesNumericalBasicStats(e,s,n)},_hasOtherCommentsTable:function(){
return false},_buildTableFooterRowData:function(e){}});SM.MatrixBasicStatsTableView=SM.Views.extend(SM.BaseSummaryTableView,{__NAME:"MatrixBasicStatsTableView",__templateID:"summary-table-template",_buildTableCaptionData:function(e){var t=this;return{template:"table-caption-bs-stats",context:{caption:"Basic Statistics",dimensionID:"",mediaCaption:Globalize.localize("Basic Statistics"),classes:""}}},_setLabelsAndSeriesData:function(){var e=this,t,i;if(e.question.isCompared()){i=e.sortedColumnsListBS[0];e.labelsData=e._getTableLabelsData(i);e.seriesData=e.buildMirroredMatrixSeries({isBasicStats:true,rows:SM.BasicStatsUtils.getStructure("row")})}else{t=e.sortedRowsListBS[0];e.seriesData=e.buildMatrixSeries({isBasicStats:true,columns:SM.BasicStatsUtils.getStructure()});e.labelsData=e._getTableLabelsData(t)}},_buildTableHeaderRowData:function(){var e=this,t;t=e._getTableHeaderRowDataForSeries({series:e.seriesData,includeBlankCell:true});return t},_buildTableBodyRowData:function(){var e=this,t;t=e._getTableBodyRowData({labelsData:e.labelsData,series:e.seriesData});return t},_buildTableFooterRowData:function(){}});SM.SimpleBasicStatsTableView=SM.Views.extend(SM.BaseSummaryTableView,{__NAME:"SimpleBasicStatsTableView",__templateID:"summary-table-template",__afterRender:function(){var e=this;e.$el.empty();e._renderTable();e.$el.find(".q").popout()},_renderTable:function(){var e=this,t,i;t=e._buildTemplateData();i=SM.Template.renderHTML("simple-basic-stats-table",t);e.$el.prepend(i)},_buildTemplateData:function(){var e=this,t;if(e.question.isMatrix()){t=e.buildMatrixSeries({isBasicStats:true,columns:SM.BasicStatsUtils.getStructure()});return{min:e._formattedNumResponses(t[0].data[0].absoluteY),max:e._formattedNumResponses(t[1].data[0].absoluteY),median:e._formattedNumResponses(t[2].data[0].absoluteY),mean:e._formattedNumResponses(t[3].data[0].absoluteY),std:e._formattedNumResponses(t[4].data[0].absoluteY)}}else{t=e.buildSimpleSeries(e.summary,SM.BasicStatsUtils.getStructure(),{isBasicStats:true});return{min:e._formattedNumResponses(t[0].data[0].absoluteY),max:e._formattedNumResponses(t[0].data[1].absoluteY),median:e._formattedNumResponses(t[0].data[2].absoluteY),mean:e._formattedNumResponses(t[0].data[3].absoluteY),std:e._formattedNumResponses(t[0].data[4].absoluteY)}}}});SM.SummaryTaRowView=SM.Views.register({__NAME:"SummaryTaRowView",__templateID:"summary-ta-row-template",__model:"taModel",__init:function(){if(!this.taModel.hasLoaded()){this.taModel.on("loaded",{self:this},this._onLoaded);this.taModel.fetch()}},__create:function(e){this.question=e.question;this.containerView=null},__destroy:function(){this.taModel.off("loaded",this._onLoaded);if(this.containerView){this.containerView.destroy()}},__beforeRender:function(){return{isLoading:!this.taModel.hasLoaded()}},__afterRender:function(){if(this.taModel.hasLoaded()){this.containerView=SM.Views.create(this.taModel.filoData?SM.SummaryFileUploadContainerView:SM.TaContainerView,{question:this.question,model:this.taModel});this.$el.find("td").append(this.containerView.el)}},_onLoaded:function(e){e.data.self.render()}});SM.TMBCTableContainerView=SM.Views.register({__NAME:"TMBCTableContainerView",__templateID:"summary-table-container-template",__model:"tmbc",__create:function(e){var t=this;t.tmbcType=e.tmbcType;t.tableViewType=e.tableViewType;t.isExport=e.isExport;t._showingBenchmark=true;_.bindAll(this,"_onTableDisplayChange","_setHighlightedLabelCell")},__init:function(){var e=this;e.$el.on("setHighlightedLabelCell",e._setHighlightedLabelCell)},__afterRender:function(){var e=this,t,i;if(e._shouldHideTable()){return}try{i=e._getTableViewType();t=SM.Views.create(i,{model:e.tmbc,tmbcType:e.tmbcType,highlightedDimensionID:e.highlightedDimensionID,isExport:e.isExport});e.$el.html(t.el)}catch(s){e._handleRenderingError(s)}},_hasBenchmarking:function(){return this.survey.owner.hasBenchmarking()&&this._showingBenchmark},_getTableViewType:function(){var e=this,t;t=SM.TMBCQuartileTableView;return t},_shouldHideTable:function(){return false},_handleRenderingError:function(e){var t=this,i;i=document.createElement("div");i.innerHTML=SM.Template.render("summary-table-display-error-template");t.$el.html(i);SM.Error.log(e,"tmbc summary table rendering error")},_setHighlightedLabelCell:function(e){var t=this;t.highlightedDimensionID=e.answerID},_unsetHighlightedLabelCell:function(){var e=this;e.highlightedDimensionID=null},_onTableDisplayChange:function(e){var t=this;t.render()},_onDisplaySaving:function(e){var t=this;t._unsetHighlightedLabelCell()}});SM.TMBCQuartileTableView=SM.Views.extend(SM.Sortable,{__NAME:"TMBCQuartileTableView",__templateID:"summary-table-template",__model:"tmbc",__defaults:{tableOptions:{headingsType:null,showFooter:false,hideExpandLinks:false},seriesOptions:{},seriesData:{},labelsData:{}},__create:function(e){var t=this;t._buildLocalizedLabels();t._bindEvents(e.events);t.seriesOptions=t.__settings.seriesOptions;t.tableOptions=t.__settings.tableOptions;t.isExport=e.isExport;t.tmbcType=e.tmbcType},_bindEvents:function(e){var t=this;_.bindAll(this,"_onCaptionClick","_onThClick","_onTdClick","_onThActionSelected")},__beforeRender:function(){},__afterRender:function(){this.$el.empty();this._renderTable();this.$el.find(".q").popout();this._renderTitle()},_renderTable:function(){var e=this,t;_.each(["_buildTableHeaderRowData","_buildTableBodyRowData","_buildTableFooterRowData"],function(t){if(e[t]===undefined){throw"You must define "+t+" in "+e.__NAME}});if(e.tmbc.hasError()){return}if(e._setLabelsAndSeriesData){e._setLabelsAndSeriesData()}t=e._getTableOptions();Hightables.renderTable(t)},_renderTitle:function(){var e,t;this.$el.prepend($("<br/>"));t=this.tmbc.calculateQuartile(this.tmbcType);e=SM.Template.render("tmbc-quartile-table-title",t);this.$el.prepend($(e));this.$el.find(".q").popout()},__init:function(){var e=this;e.$el.on("actionMenu.actionSelected","td",{self:e},e._onTdActionSelected)},_getTableOptions:function(){var e=this,t=e._getTableData(),i=e._getTableClasses(),s=!!e.isExport,n;n={target:e.$el,tableData:t,tableClasses:i,useDivs:s,flattenNestedTables:s,events:e._getTableEvents()};return n},_getTableData:function(e){var t=this,i,s,n,a;e=e||{};n=t._buildTableBodyRowData(e);s=t._buildTableHeaderRowData(e);a=t._buildTableFooterRowData(e);return{caption:i,thead:{rows:s},tbody:{rows:n},tfoot:{rows:a}}},_getTableHeaderRowDataForLabels:function(e){var t=this,i=e.labelsData,s=e.includeBlankCell,n=[],a={},o=[],r,l,h,u;h=t.numRows;u=h>1;if(s){r=t._buildBlankTableHeaderCell({isSortable:u});o.push(r)}_.each(i,function(e){l=t._getTableHeaderCellCSSClasses(u,e.dimensionType);r={template:e.template||"table-header-cell",context:{labelText:e.text,classes:l,dimensionType:e.dimensionType,hideActionMenu:e.hideActionMenu,variationID:"0"}};if(e.flags){$.extend(r.context,e.flags)}o.push(r)});a.cells=o;n.push(a);return n},_getTableHeaderRowDataForSeries:function(e){var t=e.series,i=e.includeBlankCell,s=e.scopedDimensionID;var n=this,a=[],o=[],r={},l,h,u,c,d,p;u=t[0].data.length;c=u>1;if(i){l=n._buildBlankTableHeaderCell({scopedDimensionID:s,isSortable:c});o.push(l)}var m,f,g;_.each(t,function(t){m=t.__options;f=m.dimensionType;g=m.dimensionID;h=n._getTableHeaderCellCSSClasses(c,f,g,s);if(e.hideActionMenu){d=true}else{d=false}p=m.labelHTML;l={template:"table-header-cell",context:{labelText:m.labelText,labelHTML:p,classes:h,dimensionType:f,dimensionID:g,hasCommentsPerRow:m.hasCommentsPerRow,optionID:g,variationID:"0",responsesCount:m.numComments,columnHasComments:m.numComments>0,colSpan:m.colSpan,hideActionMenu:d}};o.push(l)});r.cells=o;a.push(r);return a},_buildBlankTableHeaderCell:function(e){var t=this,i,s,n,a=e.scopedDimensionID,o=e.isSortable;n=false;s="labels";i=t._getTableHeaderCellCSSClasses(o,s,null,a);return{template:"table-header-blank-cell",context:{classes:i,dimensionType:s,hideActionMenu:n,isStatsHeader:false}}},_getTableBodyRowData:function(e){var t=this,i=[],s,n=[],a,o=e.series;_.each(o,function(e){a=t._buildSeriesCell(e,0);n.push(a)});s={cells:n};i.push(s);return i},_buildLabelCell:function(e){return{template:"table-label-cell",context:e}},_buildSeriesCell:function(e,t){var i=this,s,n,a=e.__options.defaultContext||{},o,r,l,h;s=e.data[t];n=e.__options.dimensionType;o=e.__options.template||"table-response-cell";l=s?s.absoluteY:0;if(i.tmbcType===i.tmbc.TMBC_TYPE_GEI){a.numResponses=i._formattedNumResponses(l,n)}else{a.numResponses=i._formattedPercentage(l)}return{template:o,context:a}},_formattedNumResponses:function(e,t){var i=0,s=SM.Highcharts.getGlobalizeFormatType("absolute",i);return Globalize.format(e,s)},_formattedPercentage:function(e){var t=SM.Highcharts.getGlobalizeFormatType("percent",0);return Globalize.format(e/100,t)},_getTableFooterRowData:function(e){var t=this,i=[],s;s={template:"simple-table-footer-row",context:{questionIsMultiResponse:false,numRespondents:Globalize.format(t.tmbc.getTMBCValue(t.tmbcType),"n0")}};i.push(s);return i},_getTableHeaderCellCSSClasses:function(e,t,i,s){var n=this,a=[],o;o=n._getSortData(s);if(e){a.push("sortable")}if(_.contains(["totals","averageRating","averageNumber","averageRanking","dataSegment"],t)){a.push(t)}if(o&&o.dimensionType===t){if(i){if(o.dimensionID===i){a.push(o.order)}}else{a.push(o.order)}}return a.join(" ")},_getSortData:function(e){var t=this,i;if(e){}else{}i={order:"ascending"};return i},_onCaptionClick:function(e){var t=this,i=$(e.currentTarget),s=i.attr("data-dimension-id"),n={answerID:s,visibleOptions:{labels:true}};SM.CustomizeActionMenu.actionMenu.call(t,e,"caption",n)},_onThClick:function(e){var t=this,i=$(e.currentTarget),s=i.attr("data-dimension-type"),n=i.attr("data-dimension-id"),a,o={parent:i,visibleOptions:{}};if(_.isEmpty(s)){return}if(SM.App.isSharingApp()){return}if(i.hasClass("no-action-menu")){return}o.visibleOptions.labels=false;if(s==="labels"){o.visibleOptions.number=false}else{o.visibleOptions.number=true}o.visibleOptions.labels=false;o.answerID=n},_onThActionSelected:function(e){},_onTdActionSelected:function(e){},_onTdMouseLeave:function(e){},_onTdMouseEnter:function(e){},_getTableClasses:function(){var e=[];e.push("sm-data-table");if(SM.App.isSharingApp()){e.push("shared")}e.push("sm-data-table-summary");e.push("benchmark");return e.join(" ")},_getTableEvents:function(){return{tdClick:this._onTdClick}},_onTdClick:function(e){var t=this,i=$(e.currentTarget),s=i.closest("td").attr("data-dimension-id"),n=this.tmbc.survey,a=n.dataSegmentList.getSelectedSegment();if(s==="segment-name"){SM.BenchmarkActionMenu.actionMenu(this,i,a,"tmbc",e,true)}},_buildTableHeaderRowData:function(){var e=this,t,i=[];i=i.concat([{text:e.localizedLabels.min,dimensionType:e.DIMENSION_TYPES.MIN,hideActionMenu:true,template:"benchmark-table-header-cell",flags:{hasHelp:true,isMinimum:true}},{text:e.localizedLabels.lowerQuartile,dimensionType:e.DIMENSION_TYPES.LOWER_QUARTILE,hideActionMenu:true,template:"benchmark-table-header-cell",flags:{hasHelp:true,isLowerQuartile:true}},{text:e.localizedLabels.median,dimensionType:e.DIMENSION_TYPES.MEDIAN,hideActionMenu:true,template:"benchmark-table-header-cell",flags:{hasHelp:true,isMedian:true}},{text:e.localizedLabels.upperQuartile,dimensionType:e.DIMENSION_TYPES.UPPER_QUARTILE,hideActionMenu:true,template:"benchmark-table-header-cell",flags:{hasHelp:true,isUpperQuartile:true}},{text:e.localizedLabels.max,dimensionType:e.DIMENSION_TYPES.MAX,hideActionMenu:true,template:"benchmark-table-header-cell",flags:{hasHelp:true,isMaximum:true}}]);t=e._getTableHeaderRowDataForLabels({labelsData:i});return t},_buildLocalizedLabels:function(){var e=this;e.localizedLabels={dataSegment:Globalize.localize("Segment"),min:Globalize.localize("Minimum"),lowerQuartile:Globalize.localize("Lower Quartile"),median:Globalize.localize("Median"),upperQuartile:Globalize.localize("Upper Quartile"),max:Globalize.localize("Maximum"),total:Globalize.localize("Total")}},_getTMBCTableBodyRowData:function(e){var t=this,i,s=[],n,a=e.series;_.each(a,function(e){e.__options={template:"benchmark-nps-simple-table-response-cell",defaultContext:{value:e.data[0].value}};n=t._buildSeriesCell(e,0);s.push(n)});i={cells:s};return[i]},_buildTMBCQuartileTableSeries:function(e){var t=this,i=[],s,n=this.tmbc.getQuartileValuesArray(this.tmbcType);_.each(n,function(n,a){s=[{y:n,absoluteY:n,percentageY:n,value:n,name:e.names[a]}];i.push({name:t.tmbc.getSegmentName(),data:s,__options:{dimensionType:"averageRating",template:"benchmark-table-response-cell"}})});return i},buildTMBCSeries:function(e){e.names=[Globalize.localize("Minimum"),Globalize.localize("Lower Quartile"),Globalize.localize("Median"),Globalize.localize("Upper Quartile"),Globalize.localize("Maximum")];if(e.tableOutput){return this._buildTMBCQuartileTableSeries(e)}else{return this._buildTMBCQuartileChartSeries(e)}},_buildTableBodyRowData:function(){var e=this,t,i=e.buildTMBCSeries({colors:["#000","#000"],tableOutput:true,nps:false,includeTotal:false}),s={name:this.tmbc.getSegmentName()};t=e._getTableBodyRowData({series:i});return t},_buildTableFooterRowData:function(){var e,t,i=this.tmbcType===this.tmbc.TMBC_TYPE_GEI?"Your Global Engagement Index":"Your % Fully Engaged";t={colSpan:5};e=[{context:{tmbcValue:Globalize.format(this.tmbc.getTMBCValue(this.tmbcType),"n0"),isFE:this.tmbcType===this.tmbc.TMBC_TYPE_ENGAGEMENT,tmbcName:i},template:"tmbc-quartile-table-footer-row"}];return e}});SM.SummaryQuestionViewContainer=SM.Views.register({__NAME:"summaryQuestionViewContainer",__templateID:"summary-question-container-template",__model:"question",nestedQuestionDict:{},__create:function(e){this.questionViewProto=e.questionViewProto;this.isBenchmarkable=false},__beforeRender:function(){var e=this,t=this.question,i=t.getRollup(),s=t.hasRollupLoaded(),n=t.page.survey,a=n.currentUserID,o=this.questionViewProto,r;if(s){if(t.hasRandomAssignment()&&t.isPresentation()){r=t.heading}return{isVisible:!t.isAfterLastLoadedRollup()&&s&&t.isShown(),question:t,questionHeading:r,encryptedID:e.question.page.survey.encryptedID,userID:a,hasTable:o._hasTableView,hasChart:o._hasChartView,hasBenchmarking:false,exportEnabled:n.isExportFormatTypeEnabled("png","chart")}}else{return{isVisible:!t.isAfterLastLoadedRollup()&&s&&t.isShown(),question:t}}},__afterRender:function(e){var t=this,i=this.question,s=i.hasRandomAssignment();if(e.isDisabledQuestionType||!e.isVisible){return}t.$questionContent=this.$el.find("[sm-questionview-content-container]");if(s){t._renderRandomAssignmentQuestionViews()}else{t._renderQuestionView()}if(!SM.App.isSharingApp()){t.$el.find(".share-btn").popout()}if(this._shouldShowExportBtn()){t.$el.find("[export-btn]").append(SM.Views.create(SM.ExportAllBtnView,{model:t.question.page.survey,noBorder:false,buttonName:"ExportQuestionButton",singleMode:true,question:t.question,hasTACloud:t.question.hasTACloud(),hasCloudView:t.question.hasCloudView(),hasChartView:t.question.hasChartView()}).el)}},_renderQuestionView:function(){var e=this,t=e.questionViewProto,i;e.questionView=SM.Views.create(t,{model:e.question,isBenchmarkable:e.isBenchmarkable});e.$questionContent.append(e.questionView.el)},_renderRandomAssignmentQuestionViews:function(){var e=this,t,i,s,n,a,o=0;s=this.question.randomAssignmentList;for(o;o<s.length;o++){i=s[o];n=i.variable_id;a=e.__settings.nestedQuestionDict[n];if(a){t=SM.Views.create(this.questionViewProto,{model:a.question,isRandomAssignment:true,optionTypeID:n,randomAssignmentIndex:o});e.$questionContent.append(t.el)}}},__init:function(){var e=this,t;e.$el.on(SM.Event.CLICK,"[customize-btn]",{self:e},e._onCustomizeBtnClick).on(SM.Event.CLICK,"[share-btn]",{self:e},e._onShareBtnClick);e.$el.on("openCustomizeView",{self:e},e._onOpenCustomizeView);e.$el.on("beforeCustomizeViewAnimateIn","[sm-customize-question-view]",{self:e},e._onBeforeCustomizeViewAnimateIn);e.$el.on("afterCustomizeViewAnimateOut","[sm-customize-question-view]",{self:e},e._onAfterCustomizeViewAnimateOut);e.bindModel(e.question,"rollupLoaded",{self:e},e._onQuestionLoaded);e.bindModel(e.question.page.survey,"rollupsAppended",{self:e},e._onSurveyRollupsAppended)},_onCustomizeBtnClick:function(e){var t=e.data.self,i=$(e.target);e.preventDefault();if(i.hasClass("disabled")){return}SM.Bi.uiTrigger="questionCustomizeButton";t.openCustomizeView("chartType")},_onBeforeCustomizeViewAnimateIn:function(e){var t=e.data.self;t.$el.find("[customize-btn]").hide();t.$el.find("[export-btn]").hide();t.$el.find("[share-btn]").hide()},_onAfterCustomizeViewAnimateOut:function(e){var t=e.data.self;t.$el.find("[customize-btn]").show();t.$el.find("[export-btn]").show();t.$el.find("[share-btn]").show();t.customizeView.$el.remove();t.customizeView=null},_onOpenCustomizeView:function(e){var t=e.data.self,i=e.action,s=e.answerID;t.openCustomizeView(i,{answerID:s})},_onShareBtnClick:function(e){e.preventDefault()},_onQuestionLoaded:function(e){e.data.self.render()},_onSurveyRollupsAppended:function(e){var t=e.data.self;if(t.question.position>e.lastLoadedPosition){t.render()}},openCustomizeView:function(e,t){var i=this,s,n;t=t||{};if(!i.customizeView){s=i._buildCustomizeViewOptions();i.customizeView=SM.Views.create(SM.CustomizeQuestionSummaryView,s)}if(e!=="top2ChartType"){i.customizeView.tabs.open(e)}n=i.$el.offset().top-20;$("body").animate({scrollTop:n},250,function(){i.customizeView.animateIn(i.$el.find("[sm-questionview-content-container]"),function(){if(e==="labels"){i.customizeView.currentView.scrollToLabel(t.answerID)}})})},_buildCustomizeViewOptions:function(){var e=this,t=this.questionViewProto;return{question:e.question,questionView:e.questionView,hasMirrorOptions:t._hasMirrorOptions,hasDepthOptions:t._hasDepthOptions,hasScaleOptions:t._hasScaleOptions,hasShowEmptyOptions:t._hasShowEmptyOptions,hasPieDonutCharts:t._hasPieDonutCharts,hasStackedCharts:t._hasStackedCharts}},_shouldShowExportBtn:function(){var e=this.question.page.survey;return e.isExportEnabled()&&!SM.App.isSharingApp()}});SM.SummaryBaseQuestionView={__templateID:"summary-question-template",__model:"question",_hasTableView:false,_hasChartView:false,_hasTextView:false,_hasFileUploadView:false,_hasPieDonutCharts:false,_hasStackedCharts:false,_hasScaleOptions:false,_hasDepthOptions:false,_hasMirrorOptions:false,_hasShowEmptyOptions:false,_hasBenchmarkingOptions:false,_tableViewType:undefined,_textViewType:undefined,_isDisabledQuestionType:false,_isPresentation:false,isRandomAssignment:false,optionTypeID:undefined,randomAssignmentIndex:undefined,__create:function(e){var t=this;if(!!t.__settings.optionTypeID&&!!t.__settings.isRandomAssignment){t.question.randomAssignmentOption=t.__settings.optionTypeID}t.rollup=t.question.getRollup();t.survey=t.question.page.survey;t.display=t.rollup.display;t.currentQuestionHeading=t._getQuestionHeading();t.questionContainerView=e.questionContainerView;t.isBenchmarkable=e.isBenchmarkable},__beforeRender:function(){var e=this,t=this.question,i=t.getRollup(),s=t.hasRollupLoaded(),n=t.page.survey,a=n.currentUserID,o=this.__settings.isRandomAssignment,r=e.currentQuestionHeading,l,h,u,c,d,p,m,f=n.getTemplateName(),g=n.isTMBCTemplate(),_=n.isStoreTemplate(),y=n.owner.hasBenchmarkingRestricted();p=i.summary.crossed_rows;if(p!==undefined&&o){for(m=0;m<p.length;m++){if(t.randomAssignmentOption===p[m]){o=false;break}}}if(o){c=t.randomAssignmentList[this.__settings.randomAssignmentIndex];r=c.variable_name||c.heading;u=this.__settings.randomAssignmentIndex;l=parseInt(i.answered,0);if(this._isPresentation){h=Globalize.formatPercent(l/i.answeredCount,2);if(t.subtype===t.QTYPE.descriptive_text){r="";d=true}}else{h=Globalize.formatPercent(l/(parseInt(i.skipped,0)+l),2)}}if(!!f){f="&qbcat="+f}return{isVisible:!t.isAfterLastLoadedRollup()&&s&&t.isShown(),questionHeading:r,question_id:t.ID,answered:i.answered,skipped:i.skipped,hasBenchmarking:this.isBenchmarkable,isActive:this.display.getBenchmarkDisplay(),isBenchmarkable:this.isBenchmarkable,showBenchmark:this.showBenchmark,sampleSize:5467,dateStart:"1/10/2010",dateEnd:"1/30/2012",isDisabledQuestionType:this._isDisabledQuestionType,disabledMsg:this.__settings.disabledMsg,encryptedID:this.question.page.survey.encryptedID,userID:a,hasRandomAssignment:o,optionLetter:u+1,viewedPercentage:h,viewedNumber:Globalize.format(l,"n0"),isPresentation:this._isPresentation,isTextPresentation:d,templateName:f,isTMBC:g,toStore:_,hasPaid:y,user_id:n.currentUserID,surveyId:n.ID}},__afterRender:function(e){var t=this;if(e.isDisabledQuestionType||!e.isVisible){return}t.$questionContent=t.$el;if(t._hasChartView){t._renderChartView()}if(t._hasTableView){t._renderTableView()}if(t._hasTextView){if(t._shouldRenderTextView()){t._renderTextView()}else{t._renderUnavailableTextView()}}if(t._hasFileUploadView){t._renderFileUploadView()}if(t._isPresentation){t._renderPresentationView()}t._setMinHeight()},__init:function(){var e=this;e.$el.on(SM.Event.CLICK,"[question-heading]",{self:e},e._onQuestionHeadingClick);e.$el.on("actionMenu.actionSelected","[question-heading]",{self:e},e._onQuestionHeadingActionSelected);e.$el.on("actionMenu.actionSelected",".sm-chart-container *",{self:e},e._onChartActionSelected);e.$el.on("actionMenu.actionSelected",".sm-data-table-container *",{self:e},e._onTableActionSelected);e.bindModel(e.display,"displayChange",{self:e},e._onDisplayChange);e.bindModel(e.display,"tempDisplayChange",{self:e},e._onDisplayChange);e.bindModel(e.display,"allDisplaysChange",{self:e},e._onDisplayChange)},_getQuestionHeading:function(){var e=this.display.getQuestionHeadingLabel();if(e&&!_.isEmpty(e.text)){return e.text}else{return this.question.heading}},_onChartActionSelected:function(e){var t=e.data.self,i,s,n,a=t.survey.owner.isBasic();e.stopPropagation();if(e.action==="colors"&&a){SM.Bi.uiTrigger="questionChartEditColorsMenuButton";i=SM.Views.create(SM.DialogView,{width:800,isModal:true,templateID:"customize-upgrade-dialog-template"});i.open()}else{SM.Bi.uiTrigger="questionChart"+e.action+"MenuButton";t.$el.trigger({type:"openCustomizeView",action:e.action})}},_renderQuestionHeading:function(){var e=this,t=e._getQuestionHeading();if(e.currentQuestionHeading!==t){e.$el.find("[question-heading]").text(t);e.currentQuestionHeading=t}},_renderChartView:function(){var e=this,t;t=SM.Views.create(SM.SummaryChartContainerView,{survey:e.survey,question:e.question,randomAssignmentOption:e.question.randomAssignmentOption,questionView:e});e.$questionContent.append(t.el);e.chartContainerView=t},_renderTableView:function(){var e=this,t;t=SM.Views.create(SM.SummaryTableContainerView,{survey:this.survey,question:this.question,tableViewType:this._tableViewType,hasBenchmarkingOptions:this._hasBenchmarkingOptions,randomAssignmentOption:e.question.randomAssignmentOption});e.$questionContent.append(t.el)},_renderTextView:function(){var e=this,t=this.question.getRollup(),i=t.getTaModel(),s;if(this.question.hasRandomAssignment()){i=t.getTaModel(0,0,this.question.randomAssignmentOption)}i.set("filterCount",t.answeredCount);s=SM.Views.create(SM.TaContainerView,{model:i});e.$questionContent.append(s.el)},_renderPresentationView:function(){var e=this,t;t=SM.Views.create(SM.SummaryPresentationContainerView,{question:this.question,randomAssignmentOption:this.question.randomAssignmentList[this.__settings.randomAssignmentIndex]});e.$questionContent.append(t.el)},_renderUnavailableTextView:function(){var e=this.$el.find(".summary-question-text-analysis-container"),t=SM.Template.render("response-data-unavailable-template");e.append(t)},_renderFileUploadView:function(){var e=SM.Views.create(SM.SummaryFileUploadContainerView,{question:this.question,model:this.question.getRollup().getFileUploadModel()});this.$questionContent.append(e.el)},_onQuestionHeadingClick:function(e){var t=e.data.self,i={};if(t.question.isNPS()){return}if(t._hasChartView){if(t._hasBenchmarkingOptions&&!t.display.getBenchmarkDisplay()||!t._hasBenchmarkingOptions){SM.CustomizeActionMenu.actionMenu.call(t,e,"h1",i)}}},_onDisplayChange:function(e){var t=e.data.self;t._setMinHeight();t._renderQuestionHeading();if(t.isBenchmarkable){t._updateBenchmarkIcon()}},_onQuestionHeadingActionSelected:function(e){var t=e.data.self;e.stopPropagation();if(e.action==="labels"){SM.Bi.uiTrigger="questionHeadingEditLabelMenuButton";t.$el.trigger({type:"openCustomizeView",action:e.action,answerID:null})}},_onTableActionSelected:function(e){var t=e.data.self;if(e.action==="labels"){e.stopPropagation();t.$el.trigger({type:"openCustomizeView",action:e.action,answerID:e.$action.attr("data-answer-id")})}},_setMinHeight:function(){var e=this,t;setTimeout(function(){t=0;if(e.$questionContent!==undefined){_.each(e.$questionContent.children(":visible"),function(e){t+=$(e).outerHeight()});e.$questionContent.css({"min-height":t})}},150)},_shouldRenderTextView:function(){if(SM.App.isSharingApp()){return!SM.App.sharedView.hideOpenEnded()}else{return true}},_updateBenchmarkIcon:function(){var e=this.$el.find(".benchmarkable-icon-ctnr"),t=this.display.getBenchmarkDisplay();if(t){e.addClass("active")}else{e.removeClass("active")}},getCurrentChartView:function(){var e=this;return e.chartContainerView.chartView}};SM.SummarySingleChoiceQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summarySingleChoiceQuestionView",_hasTableView:true,_hasChartView:true,_hasPieDonutCharts:true,_hasStackedCharts:true,_hasScaleOptions:true,_hasShowEmptyOptions:true,_hasBenchmarkingOptions:true,_hasDepthOptions:true});SM.SummaryMultipleChoiceQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryMultipleChoiceQuestionView",_hasTableView:true,_hasChartView:true,_hasStackedCharts:true,_hasScaleOptions:true,_hasShowEmptyOptions:true});SM.SummaryPresentationQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryPresentationQuestionView",_isPresentation:true});SM.SummaryNumericalQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryNumericalQuestionView",_hasTableView:true,_hasChartView:true});SM.SummaryDemographicQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryDemographicQuestionView",_hasTableView:true});SM.SummaryOpenEndedMultiQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryOpenEndedQuestionView",_hasTableView:true});SM.SummaryDateTimeQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryDateTimeQuestionView",_hasTableView:true});SM.SummaryEssayQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryEssayQuestionView",_hasTextView:true,_textViewType:SM.SummaryTextView});SM.SummaryFileUploadQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryFileUploadQuestionView",_hasFileUploadView:true});SM.SummaryMatrixRatingQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryMatrixRatingQuestionView",_hasTableView:true,_hasChartView:true,_hasStackedCharts:true,_hasScaleOptions:true,_hasDepthOptions:true,_hasMirrorOptions:true});SM.SummarySingleMatrixQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summarySingleMatrixQuestionView",_hasTableView:true,_hasChartView:true,_hasStackedCharts:true,_hasScaleOptions:true,_hasDepthOptions:true,_hasMirrorOptions:true});SM.SummaryMatrixRankingQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryMatrixRankingQuestionView",_hasTableView:true,_hasChartView:true,_hasStackedCharts:true,_hasScaleOptions:true,_hasDepthOptions:true,_hasMirrorOptions:true});SM.SummaryMultiMatrixQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryMultiMatrixQuestionView",_hasTableView:true,_hasChartView:true,_hasStackedCharts:true,_hasScaleOptions:true,_hasDepthOptions:true,_hasMirrorOptions:true});SM.SummaryMenuMatrixQuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"summaryMenuMatrixQuestionView",_hasTableView:true,_hasChartView:true,_hasStackedCharts:true,_hasScaleOptions:true,_hasDepthOptions:true,_hasMirrorOptions:true});SM.SummaryDisabledQuestionView=SM.Views.deepExtend(SM.SummaryBaseQuestionView,{__NAME:"summaryDisabledQuestionView",__defaults:{disabledMsg:"This question is disabled"},_hasTableView:false,_hasChartView:false,_isDisabledQuestionType:true});SM.SummaryCompareNumericalQuestionView=SM.Views.deepExtend(SM.SummarySingleMatrixQuestionView,{__NAME:"summaryCompareNumericalQuestionView",_hasChartView:false,_tableViewType:SM.SummaryCompareMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMatrixTableView});SM.SummaryCompareDemographicQuestionView=SM.Views.deepExtend(SM.SummarySingleMatrixQuestionView,{__NAME:"summaryCompareDemographicQuestionView",_hasChartView:false,_tableViewType:SM.SummaryCompareMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMatrixTableView});SM.SummaryCompareOpenEndedMultiQuestionView=SM.Views.deepExtend(SM.SummarySingleMatrixQuestionView,{__NAME:"summaryCompareOpenEndedQuestionView",_hasChartView:false,_tableViewType:SM.SummaryCompareMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMatrixTableView});SM.SummaryCompareDateTimeQuestionView=SM.Views.deepExtend(SM.SummarySingleMatrixQuestionView,{__NAME:"summaryCompareDateTimeQuestionView",_hasChartView:false,_tableViewType:SM.SummaryCompareMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMatrixTableView});SM.SummaryCompareEssayQuestionView=SM.Views.deepExtend(SM.SummarySingleMatrixQuestionView,{__NAME:"summaryCompareEssayQuestionView",_hasChartView:false,_hasTextView:false,_tableViewType:SM.SummaryCompareMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMatrixTableView});SM.SummaryCompareMenuMatrixQuestionView=SM.Views.deepExtend(SM.SummaryDisabledQuestionView,{__setup:function(){this.__defaults.disabledMsg=Globalize.localize("Compare rules do not apply to this question")},__defaults:{},__NAME:"summaryCompareMenuMatrixQuestionView"});SM.SummaryCompareSingleChoiceQuestionView=SM.Views.extend(SM.SummarySingleMatrixQuestionView,{__NAME:"summaryCompareSingleChoiceQuestionView",_tableViewType:SM.SummaryCompareMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMatrixTableView,_hasBenchmarkingOptions:true});SM.SummaryCompareMultipleChoiceQuestionView=SM.Views.extend(SM.SummaryCompareSingleChoiceQuestionView,{__NAME:"summaryCompareMultipleChoiceQuestionView",_tableViewType:SM.SummaryCompareMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMatrixTableView});SM.SummaryCompareMatrixRatingQuestionView=SM.Views.extend(SM.SummaryMenuMatrixQuestionView,{__NAME:"summaryCompareMatrixRatingQuestionView",_tableViewType:SM.SummaryCompareMenuMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMenuMatrixTableView});SM.SummaryCompareMatrixRankingQuestionView=SM.Views.extend(SM.SummaryMenuMatrixQuestionView,{__NAME:"summaryCompareMatrixRatingQuestionView",_tableViewType:SM.SummaryCompareMenuMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMenuMatrixTableView});SM.SummaryCompareSingleMatrixQuestionView=SM.Views.extend(SM.SummaryMenuMatrixQuestionView,{__NAME:"summaryCompareSingleMatrixQuestionView",_tableViewType:SM.SummaryCompareMenuMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMenuMatrixTableView});SM.SummaryCompareMultiMatrixQuestionView=SM.Views.extend(SM.SummaryMenuMatrixQuestionView,{__NAME:"summaryCompareMultiMatrixQuestionView",_tableViewType:SM.SummaryCompareMenuMatrixTableView,_exportTableViewType:SM.ExportSummaryCompareMenuMatrixTableView});SM.SummaryComparePresentationQuestionView=SM.Views.deepExtend(SM.SummaryDisabledQuestionView,{__setup:function(){this.__defaults.disabledMsg=Globalize.localize("Compare rules do not apply to this question")},__defaults:{},__NAME:"summaryComparePresentationQuestionView"});SM.SummaryQuestionListView=SM.Views.register({__NAME:"summaryQuestionList",__templateID:"summary-question-list-template",__model:"page",qTypes:{standard:{single_choice:SM.SummarySingleChoiceQuestionView,multiple_choice:SM.SummaryMultipleChoiceQuestionView,matrix_rating:SM.SummaryMatrixRatingQuestionView,matrix_ranking:SM.SummaryMatrixRankingQuestionView,matrix_single:SM.SummarySingleMatrixQuestionView,
matrix_multi:SM.SummaryMultiMatrixQuestionView,matrix_menu:SM.SummaryMenuMatrixQuestionView,open_ended_essay:SM.SummaryEssayQuestionView,open_ended_single:SM.SummaryEssayQuestionView,open_ended_multi:SM.SummaryOpenEndedMultiQuestionView,open_ended_numerical:SM.SummaryNumericalQuestionView,open_ended_file_upload:SM.SummaryFileUploadQuestionView,demographic:SM.SummaryDemographicQuestionView,datetime:SM.SummaryDateTimeQuestionView,presentation:SM.SummaryPresentationQuestionView},compare:{single_choice:SM.SummaryCompareSingleChoiceQuestionView,multiple_choice:SM.SummaryCompareMultipleChoiceQuestionView,matrix_rating:SM.SummaryCompareMatrixRatingQuestionView,matrix_ranking:SM.SummaryCompareMatrixRankingQuestionView,matrix_single:SM.SummaryCompareSingleMatrixQuestionView,matrix_multi:SM.SummaryCompareMultiMatrixQuestionView,matrix_menu:SM.SummaryCompareMenuMatrixQuestionView,open_ended_essay:SM.SummaryCompareEssayQuestionView,open_ended_single:SM.SummaryCompareEssayQuestionView,open_ended_multi:SM.SummaryCompareOpenEndedMultiQuestionView,open_ended_numerical:SM.SummaryCompareNumericalQuestionView,open_ended_file_upload:SM.SummaryCompareEssayQuestionView,demographic:SM.SummaryCompareDemographicQuestionView,datetime:SM.SummaryCompareDateTimeQuestionView,presentation:SM.SummaryComparePresentationQuestionView}},__afterRender:function(){var e=this,t=e.page.shownQuestionList,i=document.createDocumentFragment(),s=e.page.survey.isExport;_.each(t,function(t){var n,a,o;if(SM.App.isSharingApp()&&t.subtype==="file_upload"){return}n=t.isBenchmarkable()&&!s&&!SM.App.isSharingApp()?SM.SummaryBenchmarkQuestionViewContainer:SM.SummaryQuestionViewContainer;a=e._getQuestionViewForQuestionType(t);o=SM.Views.create(n,{model:t,nestedQuestionDict:e.page.survey.questionRollups.questions[t.ID].nestedQuestionDict,questionViewProto:a});i.appendChild(o.el)},e);e.el.appendChild(i)},_getQuestionViewForQuestionType:function(e){var t=e.family,i=e.subtype,s=e.getRollup().getDisplayMode(),n;switch(t){case"matrix":n="matrix_"+i;break;case"open_ended":n="open_ended_"+i;break;case"single_choice":case"multiple_choice":case"demographic":case"datetime":case"presentation":default:n=t;break}return this.qTypes[s][n]}});SM.SummaryTMBCViewContainer=SM.Views.register({__NAME:"summaryTMBCViewContainer",__templateID:"tmbc-view-container-template",__model:"survey",__create:function(e){this.tmbcType=e.tmbcType},__beforeRender:function(){var e=this,t=e.survey.tmbc,i={tmbcType:e.tmbcType,isGEI:e.tmbcType===t.TMBC_TYPE_GEI,isFE:e.tmbcType===t.TMBC_TYPE_ENGAGEMENT};if(this.survey.owner.hasBenchmarkingOptOut()&&!this.survey.owner.hasBenchmarkingRestricted()||this.survey.driverRollups.hasError()||SM.App.isSharingApp()){this._showingBenchmark=false}else{this._showingBenchmark=this.survey.tmbc.getTMBCShowHide(this.tmbcType)}if(!this._showingBenchmark){this.chartType=SM.QuestionDisplayModel.DISPLAY_VALUES.donut}else{this.chartType=this.survey.tmbc.getTMBCChartType(this.tmbcType)}return i},__afterRender:function(e){var t=this,i=t.survey.anviews.currentView,s=t.survey.tmbc.hasError(),n=t.survey.tmbc.hasTooFewResponses(),a=!!i.getCompareRuleSelected()||i.hasFilterRule(),o=t.survey.tmbc.wasEdited(),r=t.survey.isCurrentUserAlsoOwner(),l;t.$tmbcContent=this.$el.find("[tmbc-content-container]");if(!s&&!n&&!a&&!o){t.tmbcView=SM.Views.create(SM.TMBCView,{model:t.survey.tmbc,tmbcType:t.tmbcType,chartType:t.chartType,showBenchmark:t._showingBenchmark});t.$tmbcContent.append(t.tmbcView.$el);t._dataNotAvailable=false}else{if(s){n=false;a=false;o=false}else if(o){n=false;a=false}else if(n){a=false;o=false}else{n=false;o=false}l=SM.Template.render("tmbc-data-not-available-template",{hasError:s,tooFewResponses:n,hasFilter:a,wasEdited:o,isGEI:t.tmbcType===t.survey.tmbc.TMBC_TYPE_GEI,isFE:t.tmbcType===t.survey.tmbc.TMBC_TYPE_ENGAGEMENT,isTMBC:true,toStore:t.survey.isStoreTemplate(),user_id:t.survey.currentUserID,tmbcType:t.tmbcType});t.$tmbcContent.html(l);t._dataNotAvailable=true}t._setupBenchmarkMenus();this._setBenchmarkSubheading();this._showOrHideButtons();this._showOrHideBenchmarkSubheading();this.$el.find(".q").popout();if(r&&!t.survey.isProfilerDialogEnabled()){var h=this.$el.find(".benchmarkable-icon-ctnr");this._popout=h.popout({at:"right top",offsetX:10,tmbcType:this.tmbcType});this._popout.tmbcType=this.tmbcType}},__init:function(){this.survey.anviews.currentView.on("ruleEdited",{self:this},this._onRuleEdited);this.$el.on("actionMenu.actionSelected",{self:this},this._onBenchmarkingBtnClick);this.$el.on(SM.Event.CLICK,"a[summary-btn], a[benchmarking-btn]",{self:this},this._onBenchmarkingBtnClick);this.$el.on(SM.Event.CLICK,"[hide-link]",{self:this},this._onHideBenchmarksClicked);this.$el.on(SM.Event.CLICK,"[show-link]",{self:this},this._onShowBenchmarksClicked);this.$el.on(SM.Event.CLICK,"[bm-chart-type-btn]",{self:this},this._onChartTypeBtnClicked);this.$el.on("actionMenu.actionSelected","[bm-chart-type-btn]",{self:this},this._onChartTypeSelected);this.$el.on(SM.Event.CLICK,".benchmarkable-icon-ctnr",{self:this},this._onBenchmarkableIconClicked);this.__subscribe("popout.opened",this._onPopoutOpened,{self:this});this.$el.on(SM.Event.CLICK,".tmbc-chart-header.right",{self:this},this._onTMBCChartHeaderClick)},__destroy:function(){this.__unsubscribe("popout.opened",this._onPopoutOpened)},_onPopoutOpened:function(e){var t=e.data.self,i=$(".popout.open");if(t.tmbcType===e.popout.__settings.tmbcType){SM.Bi.logUpsellTooltipOpened(t.tmbcType)}i.on(SM.Event.CLICK,".upsell-btn",{self:t},t._onPopoutGetBenchmarksClicked)},_onPopoutGetBenchmarksClicked:function(e){var t=e.data.self,i=$(e.target),s=i.attr("destination"),n=i.attr("tmbcType"),a=t.survey.owner,o=a.hasBenchmarkingRestricted(),r=t.survey.isTMBCTemplate(),l;var h=function(e){if(r){var i=SM.Views.create(SM.BenchmarkRequestDialogView,{model:t.survey,type:t.survey.getTemplateType(),triggeredFrom:"tmbc",lqid:"",canonical_name:""});i.open()}else{window.location.href=s}};e.preventDefault();e.stopPropagation();if(t.tmbcType===n){l=t._popout.data("popout");l._isHovered=false;l._$msg.remove();SM.Bi.benchmarkingBuyMore(n,"upsell_popout","icon",s,o,false).done(h).fail(h)}},_onRuleEdited:function(e){var t=e.data.self;if(!e.ruleModel.isShow){t.render()}},_onTMBCChartHeaderClick:function(e){var t=e.data.self,i=$(e.currentTarget),s=t.survey,n=s.dataSegmentList.getSelectedSegment();SM.BenchmarkActionMenu.actionMenu(t,i,n,"tmbc",e,true)},_initBenchmarkMenu:function(e,t){var i,s;e.actionMenu({templateID:t});i=e.data("actionMenu");if(i){s=i.get("menuView");s.$el.find(".q").popout()}},_initChartMenu:function(e){this.chartMenu=e.actionMenu({menuView:"TMBCChartOptionsMenuView",position:{my:"left top",at:"left bottom"},model:this.survey.tmbc,tmbcType:this.tmbcType}).data("actionMenu");this.chartMenu.open()},_onChartTypeBtnClicked:function(e){var t=e.data.self,i=$(e.target);e.stopPropagation();e.preventDefault();if(t._showingBenchmark){t._initChartMenu(i)}},_setupBenchmarkMenus:function(){var e=this.$el.find("span[benchmarking-btn]").find("a[show-menu]"),t=this.$el.find("span[summary-btn]").find("a[hide-menu]"),i=this.$el.find("span[bm-chart-type-btn]");this._initBenchmarkMenu(e,"show-benchmarks-menu-template");this._initBenchmarkMenu(t,"hide-benchmarks-menu-template")},_setBenchmarkSubheading:function(){var e=this.chartType===SM.QuestionDisplayModel.DISPLAY_VALUES.donut,t=e?".benchmark-nps-chart-footer [benchmark]":"[benchmark-sub-heading]",i=this.$el.find(t),s=this.survey.tmbc,n=s.getSegmentName(),a=Globalize.format(s.getSampleSize(this.tmbcType),"n0"),o=moment.unix(s.getDateStart(this.tmbcType)).toDate(),r=moment.unix(s.getDateEnd(this.tmbcType)).toDate(),l=SM.Template.render("summary-benchmark-question-subheading-template",{isGaugeChart:e,isTMBC:true,segmentName:n,sampleSize:a,dateStart:Globalize.format(o,"d"),dateEnd:Globalize.format(r,"d")});i.html(l)},_showOrHideBenchmarkSubheading:function(){var e=this.chartType===SM.QuestionDisplayModel.DISPLAY_VALUES.donut,t=this.$el.find("[question-sub-heading][standard]"),i=this.$el.find("[benchmark-sub-heading]"),s=this.survey.tmbc;if(this._showingBenchmark){t.hide();if(this.isBenchmarkable){if(s.hasError()){i.hide()}else if(e){i.hide()}else{i.show()}}}else{t.show();i.hide()}},_showOrHideButtons:function(){var e=this,t=e.$el.find("span[summary-btn]"),i=t.find("a[summary-btn]"),s=t.find("a[hide-menu]"),n=e.$el.find("span[benchmarking-btn]"),a=n.find("a[benchmarking-btn]"),o=n.find("a[show-menu]"),r=e.$el.find("a[bm-chart-type-btn]"),l=e.$el.find("[customize-btn]"),h=e.$el.find("[export-btn]"),u=e.$el.find("[share-btn]"),c=e.survey.driverRollups.getError()==="no_access";if(e._dataNotAvailable||e.survey.driverRollups.hasError()&&!c){i.addClass("disabled");s.addClass("disabled");a.addClass("disabled");o.addClass("disabled")}else{i.removeClass("disabled");s.removeClass("disabled");a.removeClass("disabled");o.removeClass("disabled")}if(e._showingBenchmark){t.show();n.hide();if(e._dataNotAvailable){r.addClass("disabled")}else{r.removeClass("disabled")}}else{t.hide();n.show();r.addClass("disabled")}},_toggleBenchmarkingBtn:function(){this._showingBenchmark=!this._showingBenchmark;this._showOrHideButtons();this._showOrHideBenchmarkSubheading()},_hideBenchmarks:function(e,t){if(t){this.survey.dataSegmentList.enableAllBenchmarks(false)}else{this.survey.tmbc.setTMBCShowHide(e,false);this.render()}SM.Bi.benchmarkingShowHide(e,"show",t)},_showBenchmarks:function(e,t){if(t){this.survey.dataSegmentList.enableAllBenchmarks(true)}else{this.survey.tmbc.setTMBCShowHide(e,true);this.render()}SM.Bi.benchmarkingShowHide(e,"show",t)},_onHideBenchmarksClicked:function(e){var t=e.data.self;e.preventDefault();e.stopPropagation();t._hideBenchmarks(t.tmbcType,false)},_onShowBenchmarksClicked:function(e){var t=e.data.self;e.preventDefault();e.stopPropagation();t._showBenchmarks(t.tmbcType,false)},_onBenchmarkingBtnClick:function(e){var t=e.data.self,i=t.survey,s=e.$action?e.$action:$(e.target),n=s.attr("data-action"),a;var o=function(e){t._showBenchmarks(t.tmbcType,n==="show-all-benchmarks")};var r=function(e,t,i){SM.API.logError({name:"Profile could not be saved",message:"Error "+e+" saving profile"})};e.preventDefault();if($(e.target).hasClass("disabled")){return}if(n==="hide-benchmark"||n==="hide-all-benchmarks"){t._hideBenchmarks(t.tmbcType,n==="hide-all-benchmarks")}else if(n==="show-benchmark"||n==="show-all-benchmarks"){if(i.isProfilerDialogEnabled()){a=SM.Views.create(SM.ProfilerDialogView,{model:i.profiler,type:i.getTemplateType(),action_source:"driver",triggeredFrom:"driver_benchmarking_button"});a.open()}else{t._showBenchmarks(t.tmbcType,n==="show-all-benchmarks")}}},_hasBenchmarking:function(){var e=this,t=e.survey,i=t.owner;if(!t.isCurrentUserAlsoOwner()){return t.canShowBenchmarking()}return i.hasBenchmarking()},_onChartTypeSelected:function(e){var t=e.data.self,i=e.action,s=t.survey.tmbc.getTMBCChartType(t.tmbcType),n;if($(e.target).hasClass("disabled")){return}if(i!==s){t.chartType=i;t.survey.tmbc.setTMBCChartType(t.tmbcType,i);t.render()}},_onBenchmarkableIconClicked:function(e){var t=e.data.self,i=$(e.target),s=t.survey,n=s.profiler,a=s.isCurrentUserAlsoOwner(),o,r=t.$el.find("[sm-questionview-content]");e.preventDefault();e.stopPropagation();if(!a){return}if(i.hasClass("disabled")){return}if(s.isProfilerDialogEnabled()){if(t._profilerOverlay){t._profilerOverlay.close()}else{if(r.length===0){r=t.$el.find("[tmbc-content-container]")}t._profilerOverlay=SM.Views.create(SM.ProfilerDriverOverlayView,{model:s.profiler,type:s.getTemplateType(),action_source:"tmbc",triggeredFrom:"icon",owner:t,$tgt:i,$ctnr:r});t._profilerOverlay.open(r)}}}});SM.TMBCView=SM.Views.register({__NAME:"tmbcView",__templateID:"summary-tmbc-template",__model:"tmbc",_hasTableView:false,_hasChartView:false,_chartViewType:undefined,_tableViewType:undefined,__create:function(e){var t=this;t.survey=t.tmbc.survey;t.tmbcType=e.tmbcType;t.chartType=e.chartType;this._hasChartView=true;this._hasTableView=true},__beforeRender:function(){var e=this,t=!e.tmbc.hasError(),i=e.tmbc.survey,s=i.currentUserID,n=i.isTMBCTemplate(),a=i.isStoreTemplate(),o,r,l,h,u,c,d;this._hasTableView=e.get("showBenchmark");return{isVisible:t,hasBenchmarking:true,isActive:e.get("showBenchmark"),isBenchmarkable:!SM.App.isSharingApp(),showBenchmark:e.get("showBenchmark"),sampleSize:e.tmbc.getSampleSize(e.tmbcType),dateStart:e.tmbc.getDateStart(e.tmbcType),dateEnd:e.tmbc.getDateEnd(e.tmbcType),userID:s,viewedPercentage:true,viewedNumber:Globalize.format(0,"n0"),isPresentation:false,isTextPresentation:false,isTMBC:n,toStore:a,tmbcType:e.tmbcType}},__afterRender:function(e){var t=this;if(!e.isVisible){return}t.$questionContent=this.$el;if(this._hasChartView){this._renderChartView()}if(this._hasTableView){this._renderTableView()}t._setMinHeight()},__init:function(){var e=this;e.$el.on(SM.Event.CLICK,"[question-heading]",{self:e},e._onQuestionHeadingClick);e.$el.on("actionMenu.actionSelected","[question-heading]",{self:e},e._onQuestionHeadingActionSelected);e.$el.on("actionMenu.actionSelected",".sm-chart-container *",{self:this},this._onChartActionSelected);e.$el.on("actionMenu.actionSelected",".sm-data-table-container *",{self:this},this._onTableActionSelected)},_onChartActionSelected:function(e){var t=e.data.self,i,s,n,a=t.survey.owner.isBasic();e.stopPropagation();if(e.action==="colors"&&a){SM.Bi.uiTrigger="questionChartEditColorsMenuButton";i=SM.Views.create(SM.DialogView,{width:800,isModal:true,templateID:"customize-upgrade-dialog-template"});i.open()}else{SM.Bi.uiTrigger="questionChart"+e.action+"MenuButton";t.$el.trigger({type:"openCustomizeView",action:e.action})}},_renderChartView:function(){var e=this,t;t=SM.Views.create(SM.SummaryTMBCChartContainerView,{model:e.tmbc,tmbcType:e.tmbcType,chartType:e.chartType,questionView:e,showBenchmark:e.get("showBenchmark")});e.$questionContent.append(t.el);e.chartContainerView=t},_renderTableView:function(){var e=this,t;t=SM.Views.create(SM.TMBCTableContainerView,{model:e.tmbc,tmbcType:e.tmbcType,tableViewType:this._tableViewType});e.$questionContent.append(t.el)},_onTableActionSelected:function(e){var t=e.data.self;if(e.action==="labels"){e.stopPropagation();t.$el.trigger({type:"openCustomizeView",action:e.action,answerID:e.$action.attr("data-answer-id")})}},_setMinHeight:function(){var e=this,t;setTimeout(function(){t=0;if(e.$questionContent!==undefined){_.each(e.$questionContent.children(":visible"),function(e){t+=$(e).outerHeight()});e.$questionContent.css({"min-height":t})}},150)},_updateBenchmarkIcon:function(){var e=this.$el.find(".benchmarkable-icon-ctnr"),t=this.display.getBenchmarkDisplay();if(t){e.addClass("active")}else{e.removeClass("active")}},getCurrentChartView:function(){var e=this;return e.chartContainerView.chartView}});SM.BenchmarkTop2QuestionView=SM.Views.extend(SM.SummaryBaseQuestionView,{__NAME:"benchmarkTop2QuestionView",__templateID:"summary-question-template",__model:"question",_hasTableView:true,_hasChartView:true,_hasTextView:false,_hasBenchmarkingOptions:true,_chartViewType:undefined,_tableViewType:undefined,__create:function(e){var t=this;t.survey=t.question.page.survey;t.rollup=t.question.getRollup();t.survey=t.question.page.survey;t.display=t.rollup.display;t.currentQuestionHeading=t._getQuestionHeading();t.questionContainerView=e.questionContainerView;t.isBenchmarkable=e.isBenchmarkable},__beforeRender:function(){var e=this,t=e.survey,i=t.currentUserID,s=t.isTMBCTemplate(),n=t.isStoreTemplate(),a=e.question.getBenchmarkRollup(),o=t.dataSegmentList.getSelectedSegment(),r=t.getTemplateName(),l,h,u,c,d,p,m;this._hasTableView=true;this.benchmarkRollup=a;if(!!r){r="&qbcat="+r}return{isVisible:true,hasBenchmarking:true,isActive:true,isBenchmarkable:!SM.App.isSharingApp(),answered:e.rollup.answered,skipped:e.rollup.skipped,showBenchmark:true,question_id:e.question.ID,sampleSize:a.getSampleSize(),dateStart:o.dateStart(),dateEnd:o.dateEnd(),userID:i,viewedPercentage:true,viewedNumber:Globalize.format(0,"n0"),isPresentation:false,isTextPresentation:false,isTMBC:s,templateName:r,toStore:n,tmbcType:e.tmbcType,questionHeading:e.currentQuestionHeading,user_id:t.currentUserID,surveyId:t.ID}},_onChartActionSelected:function(e){var t=e.data.self,i,s,n,a=t.survey.owner.isBasic();e.stopPropagation();if(e.action==="colors"&&a){SM.Bi.uiTrigger="questionChartEditColorsMenuButton";i=SM.Views.create(SM.DialogView,{width:800,isModal:true,templateID:"customize-upgrade-dialog-template"});i.open()}else{SM.Bi.uiTrigger="questionChart"+e.action+"MenuButton";t.$el.trigger({type:"openCustomizeView",action:e.action})}},__afterRender:function(e){SM.SummaryBaseQuestionView.__afterRender.call(this,e);this._renderQuestionHeading();if(this.isBenchmarkable){this._updateBenchmarkIcon();this._setBenchmarkSubheading();this._showOrHideBenchmarkSubheading()}},_setBenchmarkSubheading:function(){var e=this,t=e.display.getDisplayData(),i=t.benchmark_chart_type===e.display.DISPLAY_VALUES.top2_donut,s=i?this.$el.find(".benchmark-nps-chart-footer [benchmark]"):this.$el.find("[benchmark-sub-heading]"),n=this.question.page.survey.dataSegmentList.getSelectedSegment(),a=this.benchmarkRollup.getSegmentName(),o=Globalize.format(this.benchmarkRollup.getSampleSize(),"n0"),r=moment.unix(this.benchmarkRollup.getDateStart()).toDate(),l=moment.unix(this.benchmarkRollup.getDateEnd()).toDate(),h=SM.Template.render("summary-benchmark-question-subheading-template",{isGaugeChart:false,isTop2Donut:i,isTMBC:this.question.page.survey.isTMBCTemplate(),segmentName:a,sampleSize:o,dateStart:Globalize.format(r,"d"),dateEnd:Globalize.format(l,"d")});s.html(h)},_showOrHideBenchmarkSubheading:function(){var e=this.$el.find("[question-sub-heading][standard]"),t=this.$el.find("[benchmark-sub-heading]"),i=this.question.getRollup().display;e.hide();if(this.benchmarkRollup.hasError()){t.hide()}else if(i.getChartType()===i.DISPLAY_VALUES.score_gauge||i.getChartType()===i.DISPLAY_VALUES.top2_donut){t.hide()}else{t.show()}},_renderChartView:function(){var e=this,t=e.question.getRollup().display,i=t.getDisplayData(),s=i.show_benchmark?i.benchmark_chart_type:i.chart_type,n;if(s===t.DISPLAY_VALUES.top2_donut||s===t.DISPLAY_VALUES.top2_vbar||s===t.DISPLAY_VALUES.top2_hbar){n=SM.Views.create(SM.BenchmarkTop2SummaryChartView,{model:e.question,questionView:e,showBenchmark:true,question:e.question,isDonut:s===t.DISPLAY_VALUES.top2_donut})}else{n=SM.Views.create(SM.BenchmarkSummaryChartView,{question:e.question,isBenchmarkable:true})}e.$questionContent.append(n.el);e.chartContainerView=n},_renderTableView:function(){var e=this,t=e.question.getRollup().display,i=t.getDisplayData(),s=i.benchmark_chart_type,n;if(!i.show_table){return}if(s===t.DISPLAY_VALUES.hbar||s===t.DISPLAY_VALUES.vbar){n=SM.Views.create(SM.SummaryTableContainerView,{survey:e.survey,question:e.question,tableViewType:e._tableViewType,hasBenchmarkingOptions:e._hasBenchmarkingOptions,randomAssignmentOption:e.question.randomAssignmentOption})}else if(s===t.DISPLAY_VALUES.top2_hbar||s===t.DISPLAY_VALUES.top2_vbar||s===t.DISPLAY_VALUES.top2_donut){n=SM.Views.create(SM.SummaryTableContainerView,{survey:e.survey,question:e.question,tableViewType:e._tableViewType,hasBenchmarkingOptions:e._hasBenchmarkingOptions,randomAssignmentOption:e.question.randomAssignmentOption,isTop2:true})}else if(s===t.DISPLAY_VALUES.boxplot){n=SM.Views.create(SM.SummaryTableContainerView,{survey:e.survey,question:e.question,tableViewType:SM.BenchmarkQuartileTableView,hasBenchmarkingOptions:e._hasBenchmarkingOptions,randomAssignmentOption:e.question.randomAssignmentOption,isTop2:true})}else{n=SM.Views.create(SM.TMBCTableContainerView,{model:e.tmbc,tmbcType:e.tmbcType,tableViewType:this._tableViewType})}e.$questionContent.append(n.el)},_onTableActionSelected:function(e){var t=e.data.self;if(e.action==="labels"){e.stopPropagation();t.$el.trigger({type:"openCustomizeView",action:e.action,answerID:e.$action.attr("data-answer-id")})}},_onDisplayChange:function(e){var t=e.data.self;t.render()},_setMinHeight:function(){var e=this,t;setTimeout(function(){t=0;if(e.$questionContent!==undefined){_.each(e.$questionContent.children(":visible"),function(e){t+=$(e).outerHeight()});e.$questionContent.css({"min-height":t})}},150)},_updateBenchmarkIcon:function(){var e=this.$el.find(".benchmarkable-icon-ctnr"),t=this.display.getBenchmarkDisplay();if(t){e.addClass("active")}else{e.removeClass("active")}},getCurrentChartView:function(){var e=this;return e.chartContainerView.chartView}});SM.CustomizeQuestionSummaryView=SM.Views.register({__NAME:"CustomizeQuestionSummaryView",__templateID:"customize-question-summary-template",__create:function(e){var t=this;t.question=e.question;t.survey=t.question.page.survey;t.rollup=t.question.getRollup();t.display=t.rollup.display;t.questionView=e.questionView;t.applyToAll=false;t.hasMirrorOptions=e.hasMirrorOptions;t.hasDepthOptions=e.hasDepthOptions;t.hasScaleOptions=e.hasScaleOptions;t.hasShowEmptyOptions=e.hasShowEmptyOptions;t.hasAreaCharts=e.hasAreaCharts;t.hasPieDonutCharts=e.hasPieDonutCharts;t.hasStackedCharts=e.hasStackedCharts;t.isTop2Customizer=e.isTop2Customizer||false;t.currentView=null;_.bindAll(this,"_onBeforeTabOpen","_onTabClick","_onSaveBtnClick","_onCancelBtnClick","_onApplyToAllCheckBoxClick","_onDisplayChange","_enableSaveBtn")},__beforeRender:function(){var e=this,t=e.question.isNPS(),i=t&&!e.question.isCompared();return{questionID:e.question.ID,isNps:t,isNpsSimple:i,isTop2Customizer:e.isTop2Customizer}},__afterRender:function(){var e=this,t;e.$el.css("height","auto");if(e.isTop2Customizer){e._renderTop2ChartTypeView(e.$el.find("[top2-chart-type]"))}else{t=e.survey.owner.isBasic();if(t){e.tabs=e.$el.find(".tabs").tabs({requireOpenTab:true,noClickTab:"colors"}).data("tabs")}else{e.tabs=e.$el.find(".tabs").tabs({requireOpenTab:true}).data("tabs")}}e.$el.find(".sm-customize-actions [save-btn]").addClass("disabled")},_renderTab:function(e,t){var i=this;switch(e){case"chartType":i._renderCustomizeChartTypeView(t);break;case"displayOptions":i._renderCustomizeDisplayOptionsView(t);break;case"colors":i._renderCustomizeColorsView(t);break;case"labels":i._renderCustomizeLabelsView(t);break}},_renderCustomizeChartTypeView:function(e){var t=this;if(t.question.isNPS()){t.currentView=SM.Views.create(SM.NpsCustomizeChartTypeView,{question:t.question,rollup:t.rollup,display:t.display,hasPieDonutCharts:t.hasPieDonutCharts,hasStackedCharts:t.hasStackedCharts})}else{t.currentView=SM.Views.create(SM.CustomizeChartTypeView,{question:t.question,rollup:t.rollup,display:t.display,hasPieDonutCharts:t.hasPieDonutCharts,hasStackedCharts:t.hasStackedCharts})}e.html(t.currentView.el)},_renderTop2ChartTypeView:function(e){var t=this;t.currentView=SM.Views.create(SM.CustomizeTop2ChartTypeView,{question:t.question,rollup:t.rollup,display:t.display});e.html(t.currentView.el)},_renderCustomizeDisplayOptionsView:function(e){var t=this;t.currentView=SM.Views.create(SM.CustomizeDisplayOptionsView,{question:t.question,rollup:t.rollup,display:t.display,customizeView:t,hasMirrorOptions:t.hasMirrorOptions,hasDepthOptions:t.hasDepthOptions,hasScaleOptions:t.hasScaleOptions,hasShowEmptyOptions:t.hasShowEmptyOptions});$(t.currentView.el).on("displayOptionsValidation",function(e,i){if(!i&&t._canSave()){t._enableTabs();t._enableSaveBtn()}else{t._disableTabs();t._disableSaveBtn()}});e.html(t.currentView.el)},_renderCustomizeColorsView:function(e){var t=this;t.currentView=SM.Views.create(SM.CustomizeColorsView,{question:t.question,rollup:t.rollup,display:t.display});e.html(t.currentView.el)},_renderCustomizeLabelsView:function(e){var t=this;t.currentView=SM.Views.create(SM.CustomizeLabelsView,{question:t.question,rollup:t.rollup,display:t.display});e.html(t.currentView.el)},animateIn:function(e,t){var i=this;if(e.find("[sm-customize-question-view]").length===0){i.$el.prependTo(e)}i.$el.trigger({type:"beforeCustomizeViewAnimateIn"});i.$el.slideDown(500,function(){if(t){t()}})},animateOut:function(){var e=this;e.$el.slideUp({duration:250,complete:function(){e.$el.trigger({type:"afterCustomizeViewAnimateOut"});e.$el.find(".sm-customize-actions [save-btn]").addClass("disabled")}})},__init:function(){var e=this;if(!e.isTop2Customizer){e.tabs.$el.children("nav").find(".tab").on("click",e._onTabClick);e.tabs.$el.on("tabs.beforeOpen",e._onBeforeTabOpen)}e.$el.find(".apply-to-all .q").popout();e.$el.on("click","[apply-to-all-checkbox]",e._onApplyToAllCheckBoxClick);e.$el.on("click",".sm-customize-actions [save-btn]",e._onSaveBtnClick);e.$el.on("click",".sm-customize-actions [cancel-btn]",e._onCancelBtnClick);e.bindModel(e.display,"allDisplaysChange",{self:e},function(){e.currentView.render()});e.bindModel(e.display,"displayChange",{self:e},e._onDisplayChange);e.bindModel(e.display,"tempDisplayChange",{self:e},e._onDisplayChange);e.bindModel(e.display,"allDisplaysChange",{self:e},e._onDisplayChange)},_onDisplayChange:function(){var e=this;if(e._canSave()){e._enableTabs();e._enableSaveBtn()}else{e._disableTabs();e._disableSaveBtn()}},_onTabClick:function(e){var t=this,i,s=$(e.target),n=s.attr("tab-target"),a=t.survey.owner.isBasic();e.preventDefault();if(a&&n==="colors"){i=SM.Views.create(SM.DialogView,{width:800,isModal:true,templateID:"customize-upgrade-dialog-template"});i.open()}},_onBeforeTabOpen:function(e){var t=this,i=e.tab.key,s=e.tab.$panel;t._renderTab(i,s)},_onApplyToAllCheckBoxClick:function(e){var t=this,i=$(e.target);t.applyToAll=i.prop("checked");if(t.applyToAll&&t._canSave()){t._enableSaveBtn()}else{if(!t._isDirty()){t._disableSaveBtn()}}},_onSaveBtnClick:function(e){var t=this,i=$(e.target);e.preventDefault();if(i.hasClass("disabled")){return}t.display._trigger({type:"saving"});t._save({applyToAll:t.applyToAll});t.animateOut()},_onCancelBtnClick:function(e){var t=this;e.preventDefault();t._clearUpdates();t.animateOut()},_save:function(e){var t=this,i,s,n,a;e=e||{};a=e.applyToAll;i=t.display.getDisplayUpdates();SM.Bi.customizeQuestion(i,e.applyToAll,t.display.question);if(a&&t.question.isTop2()){s=this.question.ID;n=_.filter(t.survey.questions,function(e){return e.isTop2()});t.survey.anviews.defaultView.updateQuestionDisplayData(i,n,{isCompared:t.question.isCompared(),untypedKeys:SM.QuestionDisplayModel.UNTYPED_DISPLAY_OPTIONS});t._clearUpdates();t.survey.questionRollups.onSharedDisplayDataChange();return}if(!_.isEmpty(i)){t.display.updateDisplayData(i,{done:function(){if(a){t._applyToAll()}}})}else{if(a){t._applyToAll()}}t._clearUpdates()},_applyToAll:function(){var e=this,t,i,s;t=e.display.getSharedDisplayUpdates();e.survey.anviews.defaultView.updateSharedDisplayData({updates:t,deletedKeys:e.display.SHARED_DISPLAY_OPTIONS,untypedKeys:e.display.UNTYPED_DISPLAY_OPTIONS,isCompared:e.question.isCompared()});i=t.show_basic_stats&&t.show_basic_stats===SM.QuestionDisplayModel.DISPLAY_VALUES.show;s=t.show_sig_diffs&&t.show_sig_diffs===SM.QuestionDisplayModel.DISPLAY_VALUES.show;if(i||s){e.survey.questionRollups.fetchStatsRollups()}else{e.survey.questionRollups.onSharedDisplayDataChange()}},_clearUpdates:function(){var e=this;e.display.clearDisplayUpdates();e.display.clearTempDisplay()},_canSave:function(){var e=this;if(e.display.labelUpdatesHaveEmptyLabel()){return false}return true},_isDirty:function(){var e=this;return!_.isEmpty(e.display.getDisplayUpdates())},_disableTabs:function(){if(!this.isTop2Customizer){this.tabs.$el.children("nav").find(".tab").addClass("disabled")}},_enableTabs:function(){if(!this.isTop2Customizer){this.tabs.$el.children("nav").find(".tab").removeClass("disabled")}},_enableSaveBtn:function(){var e=this;e.$el.find("[sm-customize-actions] [save-btn]").removeClass("disabled")},_disableSaveBtn:function(){var e=this;e.$el.find("[sm-customize-actions] [save-btn]").addClass("disabled")}});SM.CustomizeChartTypeView=SM.Views.register({__NAME:"CustomizeChartTypeView",__templateID:"customize-chart-type-template",__defaults:{hasAreaCharts:false,hasPieDonutCharts:false,hasStackedCharts:false},__create:function(e){var t=this;t.question=e.question;t.rollup=e.rollup;t.display=e.display;t.set("hasAreaCharts",e.hasAreaCharts);t.set("hasPieDonutCharts",e.hasPieDonutCharts);t.set("hasStackedCharts",e.hasStackedCharts);_.bindAll(this,"_onChartTypeClick")},__beforeRender:function(e){var t=this,i=t.display.DISPLAY_VALUES,s=t.display.getDisplayData(),n=t.display.getChartType();e={hbar:{isEnabled:true,isSelected:n===i.hbar},vbar:{isEnabled:true,isSelected:n===i.vbar},pie:{isEnabled:t.get("hasPieDonutCharts"),isSelected:n===i.pie},donut:{isEnabled:t.get("hasPieDonutCharts"),isSelected:n===i.donut},stacked_hbar:{isEnabled:t.get("hasStackedCharts"),isSelected:n===i.stacked_hbar},stacked_vbar:{isEnabled:t.get("hasStackedCharts"),isSelected:n===i.stacked_vbar},line:{isEnabled:true,isSelected:n===i.line},area:{isEnabled:true,isSelected:n===i.area},boxplot:{isEnabled:false,isSelected:false}};if(s.tableHasOneRow){e.stacked_hbar.isEnabled=true;e.stacked_vbar.isEnabled=true;e.line.isEnabled=false;e.area.isEnabled=false;if(!t.display._tableRowsAddToMoreThan100Percent(s)){e.pie.isEnabled=true;e.donut.isEnabled=true}}if(s.isWeightedAvg){e.stacked_hbar.isEnabled=false;e.stacked_vbar.isEnabled=false;e.pie.isEnabled=false;e.donut.isEnabled=false}if(!e[n].isEnabled&&e[n].isSelected){e[n].isSelected=false;n=t.display.DEFAULT_CHART_TYPE;e[n].isSelected=true}return e},__init:function(){var e=this;e.$el.on(SM.Event.CLICK,".chart-types li",{self:e},e._onChartTypeClick)},_onChartTypeClick:function(e){e.preventDefault();var t=this,i=$(e.target),s;if(i.hasClass("disabled")){return}s=i.attr("data-chart-type");t._changeChartType(s)},_changeChartType:function(e){var t=this,i;i=t.display.getChartTypeUpdates(e);t.display.updateTempDisplay(i);t.display.setDisplayUpdates(i);t.render()}});SM.CustomizeTop2ChartTypeView=SM.Views.register({__NAME:"CustomizeChartTypeView",__templateID:"top2-customize-chart-type-template",__defaults:{hasAreaCharts:false,hasPieDonutCharts:false,hasStackedCharts:false},__create:function(e){var t=this;t.question=e.question;t.rollup=e.rollup;t.display=e.display;t.set("hasAreaCharts",e.hasAreaCharts);t.set("hasPieDonutCharts",e.hasPieDonutCharts);t.set("hasStackedCharts",e.hasStackedCharts);_.bindAll(this,"_onChartTypeClick")},__beforeRender:function(e){var t=this,i=t.display.DISPLAY_VALUES,s=t.display.getDisplayData(),n=t.display.getChartType(),a=t.rollup.type==="compare",o=true;if(a){o=t.question.compareStructure.answers.crossedOptions.length===1}e={hbar:{isEnabled:true,isSelected:n===i.hbar},vbar:{isEnabled:true,isSelected:n===i.vbar},boxplot:{isEnabled:true,isSelected:n===i.boxplot},top2_vbar:{isEnabled:true,isSelected:n===i.top2_vbar},top2_hbar:{isEnabled:true,isSelected:n===i.top2_hbar},top2_donut:{isEnabled:o,isSelected:n===i.top2_donut}};if(!e[n].isEnabled&&e[n].isSelected){e[n].isSelected=false;n=t.display.DEFAULT_CHART_TYPE;e[n].isSelected=true}return e},__afterRender:function(){this.$el.find(".q").popout()},__init:function(){var e=this;e.$el.on(SM.Event.CLICK,".chart-types li",{self:e},e._onChartTypeClick)},_onChartTypeClick:function(e){e.preventDefault();var t=this,i=$(e.target),s;if(i.hasClass("disabled")){return}s=i.attr("data-chart-type");t._changeChartType(s)},_changeChartType:function(e){var t=this,i;i=t.display.getChartTypeUpdates(e,true);t.display.updateTempDisplay(i);t.display.setDisplayUpdates(i);t.render()}});SM.CustomizeDisplayOptionsView=SM.Views.register({__NAME:"CustomizeDisplayOptionsView",__templateID:"customize-display-options-template",__defaults:{hasDepthOptions:false,hasScaleOptions:false,hasMirrorOptions:false,hasShowEmptyOptions:false},_yAxisScaleOptions:null,__create:function(e){var t=this;t.question=e.question;t.rollup=e.rollup;t.display=e.display;t.customizeView=e.customizeView;t.set("hasMirrorOptions",e.hasMirrorOptions);t.set("hasDepthOptions",e.hasDepthOptions);t.set("hasScaleOptions",e.hasScaleOptions);t.set("hasShowEmptyOptions",e.hasShowEmptyOptions);_.bindAll(t,"_onDisplayOptionSelected","_onShowUpgradeDialog","_onScaleEditSpin");
},__beforeRender:function(){var e=this,t,i=e.display.DISPLAY_OPTIONS,s=e.display.DISPLAY_VALUES,n=e.display.getDisplayData({isCustomization:true}),a=n.hasDepthOptions&&e.get("hasDepthOptions"),o=n.hasScaleOptions&&e.get("hasScaleOptions"),r=n.isPercent,l=n.isMirrorable&&e.get("hasMirrorOptions"),h=!e.question.page.survey.owner.canSigDiffs(),u=!h&&(!e.question.canSidi()||e.rollup.comparedByRA),c=!h&&!u,d=e.question.hasRandomAssignment(),p=n.show_sig_diffs&&n.mirror,m=n.hasShowEmptyOptions&&e.get("hasShowEmptyOptions"),f=parseInt(r?n.dp_percentage:n.dp_absolute),g=e._getRangeScaleOptions(n),_;if(e.question.isNPS()&&n.nps_depth===s.nps_score){o=false}if(g!=="none"){_=e._buildAxisMaxValuesContext(n);if(_&&!_.hasOptions){g="none"}}return{questionID:e.question.ID,isTableShown:n.show_table,isChartShown:n.show_chart,isDataShown:n.show_data,disableDataShown:n.disable_show_data===s.disabled,disableBS:d,isBasicStatsShown:n.show_basic_stats,disableSidi:u,enableSidi:c,upgradeSidi:h,isSidiStatsShown:p,hasEmptyOptions:m,canShowEmpty:m&&!n.show_empty_data,canHideEmpty:m&&n.show_empty_data,hasMirrorOptions:l,canMirror:l&&!n.mirror,canUnMirror:l&&n.mirror,hasDepthOptions:a,isDistributionChart:n.isDistribution,isWeightedAvg:n.isWeightedAvg,canDistributionChart:a&&!n.isDistribution,canWeightedAvgChart:e._canChooseWeightedAvgChart(n,a),hasScaleOptions:o,scaleIsPercent:r,rangeScaleMinEditable:g.indexOf("min")>-1,rangeScaleMaxEditable:g.indexOf("max")>-1,scaleMinOptionKey:e.display.getScaleMinOptionKey(),scaleMaxOptionKey:e.display.getScaleMaxOptionKey(),axisMaxValue:_?_.max:null,axisMinValue:_?_.min:null,enableDecimalPlaces:r||n.isWeightedAvg,decimalPlacesKey:i[r?"dp_percentage":"dp_absolute"],dpIsZero:f===0,dpIsOne:f===1,dpIsTwo:f===2,isLabelable:n.isLableable,labelIsLegend:n.isLableable&&n.isLegend,labelIsLabel:n.isLableable&&!n.isLegend,isNps:e.question.isNPS(),isDepthScore:n.isDepthScore,isDepthDistribution:n.isDepthDistribution,isDepthDetailed:n.isDepthDetailed,displayOptions:i,displayValues:s}},__afterRender:function(){var e=this,t=e._yAxisScaleOptions,i=e.$el.find("#scaleMin"),s=e.$el.find("#scaleMax");e.$el.find(".q").each(function(){$(this).popout()});i.spinner({max:t?Math.floor(t.min):null,spin:e._onScaleEditSpin});if(i.prop("disabled")){i.spinner("disable");if(!i.closest(".form-group").hasClass("disabled")){i.closest(".scale-wrapper").addClass("disabled")}}s.spinner({min:t?Math.ceil(t.max):null,spin:e._onScaleEditSpin});if(s.prop("disabled")){s.spinner("disable")}},__init:function(){var e=this;e.$el.on("change","input, select",e._onDisplayOptionSelected);e.$el.on("click",".upgrade-trigger",e._onShowUpgradeDialog);e.$el.on("click",".upgrade-trigger .upgrade-btn",e._onUpgradeBtnClicked);e.$el.on("click",'.upgrade-trigger input[type="checkbox"]',e._onUpgradeTriggerFieldToggle)},_onShowUpgradeDialog:function(e){this._showUpgradeDialog("sig-diff-upgrade-dialog-template")},_showUpgradeDialog:function(e){var t=SM.Views.create(SM.DialogView,{width:800,isModal:true,templateID:e});t.open()},_onUpgradeTriggerFieldToggle:function(e){e.stopImmediatePropagation();$(e.currentTarget).prop("checked",false)},_onUpgradeBtnClicked:function(e){e.stopImmediatePropagation()},_onScaleEditSpin:function(e,t){var i=this,s=$(e.target),n=s.attr("data-action").split(".");if(n[0]==="chart"){s.removeClass("error").closest(".scale-container").removeAttr("title");clearTimeout(i._spinnerTimeout);i._spinnerTimeout=setTimeout(function(){var e=i.display.getDisplayData({isCustomization:true});i._updateChartDisplayOptions(n[1],t.value+"")},250)}},_onDisplayOptionSelected:function(e){var t=this,i=$(e.target),s=i.parents(".display-option"),n,a,o,r,l,h;if(!!s.attr("disabled")||s.hasClass("upgrade-trigger")){return}if(i.is("select")){n=i.children("option:selected");a=n.attr("data-action");o=n.attr("data-value")}else{a=i.attr("data-action");if(a.indexOf("chart.scale")>-1){var u=t.$el.find("#scaleMin"),c=t.$el.find("#scaleMax"),d=t._yAxisScaleOptions.min,p=t._yAxisScaleOptions.max,m=parseFloat(u.val()),f=parseFloat(c.val()),g,y;u.val(isNaN(m)?Math.floor(d):m);c.val(isNaN(f)?Math.ceil(p):f);g=!isNaN(m)&&m>d;y=!isNaN(f)&&f<p;u.toggleClass("error",g);if(g){u.closest(".scale-container").attr("title",Globalize.localize("Enter a number less than the lowest number in your chart"))}else{u.closest(".scale-container").removeAttr("title")}if(!isNaN(f)){c.val(f)}c.toggleClass("error",y);if(y){c.closest(".scale-container").attr("title",Globalize.localize("Enter a number greater than the highest number in your chart"))}else{c.closest(".scale-container").removeAttr("title")}t.$el.trigger("displayOptionsValidation",[g||y]);if(g||y){return}}o=i.attr("data-value");if(_.isUndefined(o)){o=i.val()}}r=a.split(".");h=r[0];l=r[1];e.preventDefault();if(o&&l&&h){if(h==="table"){t._updateTableDisplayOptions(l,o)}else if(h==="chart"){t._updateChartDisplayOptions(l,o)}else if(h==="both"){t._updateChartDisplayOptions(l,o);t._updateTableDisplayOptions(l,o)}}else{SM.Error.log({name:"DisplayOptionSelectedException",details:"_onDisplayOptionSelected: no field or value selected"})}t.render()},_updateChartDisplayOptions:function(e,t){var i=this,s={};s[e]=t;i.display.updateTempDisplay(s);i.display.setDisplayUpdates(s)},_updateTableDisplayOptions:function(e,t){var i=this,s={};s[e]=t;i.display.updateTempDisplay(s);i.display.setDisplayUpdates(s)},_canChooseWeightedAvgChart:function(e,t){var i=this;return t&&e.isDistribution&&(i.question.isCompared()?e.mirror:!e.mirror)},_getRangeScaleOptions:function(e){var t=this;if(t.question.hasRandomAssignment()||!t.customizeView.questionView.getCurrentChartView()||e.isPieChart||e.isDonutChart||t.question.isNPS()&&e.chart_type===t.display.DISPLAY_VALUES.score_gauge){return"none"}if(e.isStacked||e.isAreaChart&&!t.question.isSimple()){return e.isPercent?"none":"max"}return"max_min"},_buildAxisMaxValuesContext:function(e){var t=this,i=t.question.isNPS(),s=SM.Highcharts,n=e.isStacked||e.isAreaChart&&!t.question.isSimple(),a;if(i&&e.chart_type===SM.QuestionDisplayModel.DISPLAY_VALUES.score_gauge){t._yAxisScaleOptions=a={min:-100,max:100,hasOptions:false}}else if(n&&e.isPercent){t._yAxisScaleOptions=a={min:0,max:100,hasOptions:false}}else{var o=t.customizeView.questionView.getCurrentChartView().getSeriesList(),r,l;_.each(o,function(i){var n;if(e.isStacked||e.isAreaChart&&!t.question.isSimple()&&!e.isWeightedAvg){n=s.calculateStackedSeriesRange(i)}else{n=s.calculateSeriesRange(i)}if(_.isUndefined(r)){r=n.min;l=n.max}else{r=Math.min(r,n.min);l=Math.max(l,n.max)}});if(e.isPercent){a={min:0,max:Math.ceil(l/100)*100||100};a.tickInterval=a.max/10}else if(t.question.isSingleChoice()&&e.isWeightedAvg){a=s.calculateYAxisScaleOptions(t.question.rowList.length,0)}else{if(l<0){l=0}a=s.calculateYAxisScaleOptions(l);if(r<0){a.min=-a.max;a.tickInterval*=2}}a=t.display.getCustomScale({min:r,max:l},a);if(i){if(e.nps_depth===t.display.DISPLAY_VALUES.nps_distribution||e.nps_depth===t.display.DISPLAY_VALUES.nps_detailed){a.min=0;r=0}else if(a.min<0){a.min=Math.min(a.min,-a.max)}}else if(n){a.min=0;r=0}a.hasOptions=true;t._yAxisScaleOptions={min:r,max:l,tickInterval:a.tickInterval}}return a}});SM.CustomizeColorsView=SM.Views.register({__NAME:"CustomizeColorsView",__templateID:"customize-colors-template",MIN_COLORS_FOR_DELETING:11,__create:function(e){var t=this;t.rollup=e.rollup;t.display=e.display;_.bindAll(this,"_newColor","_createColor","_editColor","_updateColor","_deleteColor","_sortColors","_onActionMenuAfterClose","_onColorPickerSwatchClick")},__beforeRender:function(e){var t=this;t.displayUpdates=t.display.getDisplayUpdates();t.displayData=t.display.getDisplayData();t.tempDisplay=t.display.getTempDisplay();t.colors=t.displayData.colors||SM.Highcharts.DEFAULT_COLORS;return{colors:t._colorsForTemplate()}},__afterRender:function(){var e=this;e._bindActionMenusToColorListItems();e._makeColorListSortable()},_colorsForTemplate:function(){var e=this,t;t=_.map(e.colors,function(e,t){return{position:t,hex:e}});return t},_makeColorListSortable:function(){var e=this,t=e.$el.find(".color-list");t.sortable({scroll:false,distance:5,tolerance:"pointer",containment:"parent",placeholder:"color-list-item-placeholder",forcePlaceholderSize:true,update:e._sortColors})},_bindActionMenusToColorListItems:function(){var e=this,t,i,s,n,a;i=e.$el.find(".color-list-item");a=[{text:Globalize.localize("Edit Color"),action:"_editColor"},{text:Globalize.localize("Copy Color"),action:"_copyColor"},{text:Globalize.localize("Delete Color"),action:"_deleteColor",isDisabled:e.colors.length<e.MIN_COLORS_FOR_DELETING}];_.each(i,function(i){s=$(i);t={hex:s.attr("data-hex"),position:parseInt(s.attr("data-position"))};n=s.actionMenu({templateID:"color-list-item-action-menu-template",actions:a});(function(t,i){n.on("actionMenu.beforeOpen",function(s){e._onActionMenuBeforeOpen(s,t,i)});n.on("actionMenu.afterClose",function(s){e._onActionMenuAfterClose(s,t,i)})})(t,s)})},_renderColorPickerView:function(e,t){var i=this,s,n;n={position:t.position,originalHexValue:t.hexValue};if(t.add){n.onSwatchClick=i._onColorPickerSwatchClick;n.onColorSelected=i._createColor;n.primaryBtnText=Globalize.localize("Add")}else{n.onSwatchClick=i._onColorPickerSwatchClick;n.onColorSelected=i._updateColor}s=SM.Views.create(SM.CustomizeColorPickerView,n);$("body").append(s.el);s.$el.position({my:"left center",at:"right center",of:e,within:i.$el})},__init:function(){var e=this;e.$el.on("click","[new-color]",e._newColor)},_onActionMenuBeforeOpen:function(e,t,i){var s=this,n=e.actionMenu,a=n.get("menuView");var o=a.get("actions")[2];o.isDisabled=s.colors.length<s.MIN_COLORS_FOR_DELETING},_onActionMenuAfterClose:function(e,t,i){var s=this,n=e.actionMenu,a=n.get("menuView"),o=a.get("selectedAction");if(o){s[o].call(s,t,i)}},_onColorPickerSwatchClick:function(e){var t=this,i=e.position,s=e.hex,n;t.colors[i]=s;n=t._shouldUpdateTempDisplay({position:i});if(n){t.display.updateTempDisplay({colors:t.colors})}},_newColor:function(e){e.preventDefault();var t=this,i=$(e.currentTarget);t._renderColorPickerView(i,{add:true})},_createColor:function(e){var t=this,i=e.hex;t.colors.push(i);t.display.updateTempDisplay({colors:t.colors});t._setChartDisplayUpdates(t.colors);t.render()},_editColor:function(e,t){var i=this,s,n;n=e.hex;s=e.position;i._renderColorPickerView(t,{position:s,hexValue:n})},_updateColor:function(e){var t=this,i=e.position,s=e.hex;t.colors[i]=s;t.display.updateTempDisplay({colors:t.colors});t._setChartDisplayUpdates(t.colors);t.render()},_copyColor:function(e,t){var i=this,s=e.position+1,n=e.hex;i.colors.splice(s,0,n);i.display.updateTempDisplay({colors:i.colors});i._setChartDisplayUpdates(i.colors);i.render()},_deleteColor:function(e,t){var i=this;i.colors.splice(e.position,1);i.display.updateTempDisplay({colors:i.colors});i._setChartDisplayUpdates(i.colors);t.fadeOut(250,function(){i.render()})},_sortColors:function(e,t){var i=this,s,n;s=i.$el.find(".color-list-item");n=_.map(s,function(e){return $(e).attr("data-hex")});i.colors=n;if(i._shouldUpdateTempDisplay()){i.display.updateTempDisplay({colors:i.colors})}i._setChartDisplayUpdates(i.colors);i.render()},_shouldUpdateTempDisplay:function(e){return true},_setChartDisplayUpdates:function(e){var t=this,i={colors:e};t.display.setDisplayUpdates(i)}});SM.CustomizeColorPickerView=SM.Views.register({__NAME:"CustomizeColorPickerView",__templateID:"customize-color-picker-template",DEFAULT_HEX_VALUES:["#FFFFFF","#E9E9E9","#CCCCCC","#999999","#676767","#343434","#010101","#D0CFBD","#B6B8AA","#93938B","#807E71","#717167","#5A5947","#4D4B3E","#FFFCB9","#F8F580","#E8EC74","#D0D04C","#A7C23D","#86A23C","#4F7A28","#FECB3E","#F1B12B","#F29E2C","#DC7E36","#C75227","#C6332B","#FF3301","#D9EDEC","#8CC8C9","#33BDBF","#01A3A6","#01858A","#36606E","#003849","#A7C6FC","#74A6FF","#398AFF","#0063FF","#0142AA","#01317D","#002055","#E493FC","#D257FF","#9A2ABD","#7B209F","#61197D","#450F5A","#2E073E"],__create:function(e){var t=this;t.position=e.position;t.originalHexValue=e.originalHexValue;t.onColorSelected=e.onColorSelected;t.onSwatchClick=e.onSwatchClick;t.primaryBtnText=e.primaryBtnText||Globalize.localize("Save");_.bindAll(this,"_onSwatchClick","_onCustomHexValueChange","_onSaveBtnClick","_onCancelBtnClick")},__beforeRender:function(e){var t=this,i;t.newHexValue=null;t.$selectedSwatch=null;i=t._colorsForTemplate();return{defaultColors:i,primaryBtnText:t.primaryBtnText}},__afterRender:function(){var e=this;e.$customHexSwatch=e.$el.find("[custom-hex-swatch]")},__init:function(){var e=this;e.$el.on("click","[color-swatch]",e._onSwatchClick);e.$el.on("click","[primary-btn]",e._onSaveBtnClick);e.$el.on("click","[cancel-btn]",e._onCancelBtnClick);e.$el.on("keyup","[custom-hex-value]",e._onCustomHexValueChange)},_colorsForTemplate:function(){var e=this;return _.map(e.DEFAULT_HEX_VALUES,function(e,t){return{position:t,hex:e}})},_animateOut:function(){var e=this;e.$el.fadeOut(250,function(){e.$el.remove()})},_onSwatchClick:function(e){e.preventDefault();var t=this,i=$(e.currentTarget);t.newHexValue=i.attr("data-hex");if(t.$selectedSwatch){t.$selectedSwatch.removeClass("selected")}t.$selectedSwatch=i;t.$selectedSwatch.addClass("selected");t.onSwatchClick({position:t.position,hex:t.newHexValue})},_onCustomHexValueChange:function(e){var t=this,i=$(e.target),s=i.val();if(t._validateHexValue(s)){t.$customHexSwatch.css({backgroundColor:s})}else{}},_validateHexValue:function(e){return true},_onSaveBtnClick:function(e){e.preventDefault();var t=this;t.onColorSelected({position:t.position,hex:t.newHexValue});t._animateOut()},_onCancelBtnClick:function(e){e.preventDefault();var t=this;if(t.newHexValue&&t.originalHexValue){t.onColorSelected({position:t.position,hex:t.originalHexValue})}t._animateOut()}});SM.CustomizeLabelsView=SM.Views.register({__NAME:"CustomizeLabelsView",__templateID:"customize-labels-template",__create:function(e){var t=this;t.question=e.question;t.rollup=e.rollup;t.display=e.display;_.bindAll(this,"_onLabelInputClick","_onLabelInputKeyUp","_onLabelInputFocus","_onLabelInputBlur","_onRevertLinkClick")},__beforeRender:function(){var e=this,t=e.question.isCompared(),i=e.question.labelByWeights(e.question.getContextStructure().answers),s=i.rows,n=i.cols,a,o=i.crossedOptions,r=i.other,l=[],h,u,c,d,p,m;if(!e.question.isNPS()){h=e._buildQuestionHeadingLabelContext();l=l.concat(h);u=e._buildLabelsContext("rows",s);l=l.concat(u);if(!t||t&&o!==n){c=e._buildLabelsContext("columns",n);l=l.concat(c)}m=e._buildLabelsContext("others",r);l=l.concat(m)}if(t){if(!e.rollup.comparedByMyself){p=e._buildLabelsContext("crossedOptions",o);l=l.concat(p)}}else{if(n&&n[0].items){_.each(n,function(t){a=t.items;d=e._buildLabelsContext("columnChoices",a);l=l.concat(d)})}}_.each(l,function(e,t){e.tabIndex=t+1});return{answerLabels:l}},_buildQuestionHeadingLabelContext:function(){var e=this,t=e.display.getQuestionHeadingLabel(),i=t&&t.text&&t.text.length?t.text:null;return e._buildLabelContext("questionHeading",e.question.heading,i,{})},_buildLabelsContext:function(e,t){var i=this,s=[],n,a,o;_.each(t,function(t){if(i._isCustomizableAnswerOption(t)){n=i.display.getLabel(e,t.id);if(n&&n.text){o=n.text.length?n.text:null}else{o=null}a=i._buildLabelContext(e,t.text,o,{answerID:t.id});if(t.type==="row"&&i.question.isEmoji()&&!o){a.useEmoji=true}s.push(a)}});return s},_isCustomizableAnswerOption:function(e){var t=true;if(e.type==="other"&&!e.options["is_answer_choice"]){t=false}return t},_buildLabelContext:function(e,t,i,s){var n={};n.labelType=e;n.originalText=t;n.customText=i;n.showRevertLink=t!=i&&!_.isEmpty(i);if(s.answerID){n.answerID=s.answerID}return n},__init:function(){var e=this;e.$el.on("click","[custom-label-input]",e._onLabelInputClick);e.$el.on("focus","[custom-label-input]",e._onLabelInputFocus);e.$el.on("blur","[custom-label-input]",e._onLabelInputBlur);e.$el.on("keyup","[custom-label-input]",e._onLabelInputKeyUp);e.$el.on("click","[revert-custom-label-link]",e._onRevertLinkClick)},_onLabelInputClick:function(e){var t=this,i=$(e.currentTarget);i.select();t._hideErrorMessaging(i)},_onLabelInputFocus:function(e){var t=this,i=$(e.currentTarget),s=i.attr("answer-id");t._highlightTableLabelCell(s);t._hideErrorMessaging(i)},_onLabelInputKeyUp:function(e){var t=this,i=$(e.currentTarget),s=i.parent().parent().find("[revert-custom-label-link]"),n=i.attr("answer-id"),a=i.attr("label-type"),o=i.val(),r;r=t._getOriginalText(a,n);if(o!==r){if(a==="rows"&&t.question.isEmoji()){i.removeAttr("style")}s.removeClass("hidden");t._changeLabel({labelType:a,answerID:n,labelText:o})}else{s.addClass("hidden")}},_onLabelInputBlur:function(e){var t=this,i=$(e.currentTarget),s=i.attr("answer-id"),n=i.next("[custom-label-error-message]"),a=i.val();if(a==""){i.addClass("has-errors");n.show()}else{t._unHighlightTableLabelCell(s)}},_onRevertLinkClick:function(e){var t=this,i=$(e.currentTarget),s=i.parent().find("[custom-label-input]"),n=s.attr("answer-id"),a=s.attr("label-type"),o;e.preventDefault();o=t._getOriginalText(a,n);s.val(o);if(a==="rows"&&t.question.isEmoji()){s.css("font-family","SMFont")}i.addClass("hidden");t._hideErrorMessaging(s);t._changeLabel({labelType:a,answerID:n,labelText:null})},scrollToLabel:function(e){var t=this,i,s;if(e){i=t.$el.find("[answer-id='"+e+"']")}else{i=t.$el.find("[label-type='questionHeading']")}if(i.length===0){return}s=t.$el.scrollTop()+i.position().top;t.$el.animate({scrollTop:s},250,function(){i.click()})},_highlightTableLabelCell:function(e){var t=this,i=t.$el.parents("[sm-question-view]").find("[summary-table-container] table");i.trigger({type:"highlightLabelCell",answerID:e})},_unHighlightTableLabelCell:function(e){var t=this,i=t.$el.parents("[sm-question-view]").find("[summary-table-container] > table");i.trigger({type:"unHighlightLabelCell",answerID:e})},_setHighlightedTableLabelCell:function(e){var t=this,i=t.$el.parents("[sm-question-view]").find("[summary-table-container]");i.trigger({type:"setHighlightedLabelCell",answerID:e})},_changeLabel:function(e){var t=this,i;t._setHighlightedTableLabelCell(e.answerID);i=t.display.buildLabelUpdates(e);t.display.updateTempDisplay(i);t.display.setDisplayUpdates(i)},_getOriginalText:function(e,t){var i=this,s=i.question.getContextStructure().answers,n,a;if(e==="questionHeading"){a=i.question.heading}else{if(e==="rows"){n=_.find(s.rows,function(e){return e.id==t});a=n.text}else if(e==="columns"){n=_.find(s.cols,function(e){return e.id==t});a=n.text}else if(e==="columnChoices"){_.each(s.cols,function(e){_.each(e.items,function(e){if(e.id==t){n=e;a=n.text;return}})})}else if(e==="crossedOptions"){n=_.find(s.crossedOptions,function(e){return e.id==t});a=n.text}else if(e==="others"){n=_.find(s.other,function(e){return e.id==t});a=n.text}}return a},_hideErrorMessaging:function(e){var t=e.next("[custom-label-error-message]");if(e.hasClass("has-errors")){e.removeClass("has-errors");t.hide()}}});SM.SummaryPageView=SM.Views.register({__NAME:"summaryPageView",__model:"page",__templateID:"summary-page-template",__beforeRender:function(e){return{id:this.page.ID}},__afterRender:function(e){var t=this,i,s=SM.Views.create(SM.SummaryPageHeaderView,{model:this.page}),n=this.page.survey.state.get("allPagesSelected"),a;this.$el.prepend(s.el);if(this.page.shownQuestionList.length){a=SM.Views.create(SM.SummaryQuestionListView,{model:this.page});this.$el.find(".page-header").after(a.el)}else{i=document.createElement("div");i.innerHTML=SM.Template.render("no-page-questions");this.el.appendChild(i)}}});SM.SummaryPageHeaderView=SM.Views.register({__NAME:"SummaryPageHeaderView",__model:"page",__templateID:"summary-page-title-template",__init:function(){this.bindModel(this.page.survey,"rollupsAppended",{self:this},this._onRollupsAppended)},__beforeRender:function(){var e=this.page,t=e.survey.questionRollups,i=t.isAfterLastLoadedPage(e);return{isVisible:!i&&this.page.isShown(),title:this.page.heading,number:this.page.position}},_onRollupsAppended:function(e){var t=e.data.self;t.render()}});SM.SummaryPageListView=SM.Views.register({__NAME:"pageListView",__model:"survey",__templateID:"summary-page-list-template",__create:function(){this.set("lazyLoaderID",this.__NAME+"loader"+this.__uid)},__init:function(){var e=this.survey,t=e.state.get("allPagesSelected"),i=e.questionRollups;this.$el.on(SM.Event.CLICK,"[try-again-btn]",{self:this},this._onTryAgainClicked).on("infiniteScroll.reachedEnd",{self:this},this._onReachedEnd);this.bindModel(e,"rollupsAppended",{self:this},this._onRollupsAppended);this.bindModel(e.state,"page.changed",{self:this},this._onPageChange);this.bindModel(e,"shownListsChanged",{self:this},this._onPageChange);this.infiniteScroll=this.$el.infiniteScroll({windowScroll:true,threshold:1e3,markerID:this.get("lazyLoaderID"),isActive:!i.hasAll()&&i.isBuffered()}).data("infiniteScroll");if(this.infiniteScroll){this.survey.on("suspendResumeScroll",{self:this},this._onSuspendResumeScroll)}},__destroy:function(){if(this.infiniteScroll){this.survey.off("suspendResumeScroll",this._onSuspendResumeScroll)}},__beforeRender:function(){return{hasAllRollups:this.survey.questionRollups.hasAll()}},__afterRender:function(e){var t,i,s,n,a,o=this.survey,r=o.questionRollups,l=o.shownQuestionList.length>0,h=o.state.get("page"),u=o.state.get("allPagesSelected");if(!l){t=SM.Template.renderHTML("no-shown-page-questions")}else if(!u){i=o.pageList[h];t=this._renderPage(i)}else{t=this._renderAllPages(o.shownPageList)}if(this._shouldRenderTMBCViews()){this._renderTMBCViews()}if(!r.hasAll()&&!SM.App.isSharingApp()){a=SM.Views.create(SM.SummaryLazyLoadView,{model:this.survey,ID:this.get("lazyLoaderID")});this.el.appendChild(a.el);if(this.infiniteScroll&&r.isBuffered()){this.infiniteScroll.set("isActive",true)}}},_shouldRenderTMBCViews:function(){if(!this.survey.state.isSummaryMode()||this.survey.isExport){return false}if(!SM.App.isSharingApp()&&!this.survey.hasValidEntity()&&!this.survey.owner.hasBenchmarkingRestricted()){return false}if(!this.survey.isTMBCTemplate()){return false}var e=this.survey.state.get("page"),t=this.survey.state.get("allPagesSelected");if(t||e===0){return true}return false},_renderTMBCViews:function(){var e=SM.Views.create(SM.SummaryTMBCViewContainer,{model:this.survey,tmbcType:this.survey.tmbc.TMBC_TYPE_ENGAGEMENT});this.$el.prepend(e.el);e=SM.Views.create(SM.SummaryTMBCViewContainer,{model:this.survey,tmbcType:this.survey.tmbc.TMBC_TYPE_GEI});this.$el.prepend(e.el)},_onSuspendResumeScroll:function(e){var t=e.data.self,i=e.suspend;if(i){t.suspendScroll()}else{t.resumeScroll()}},suspendScroll:function(){var e=this;if(e.infiniteScroll){e._scrollWasActive=e.infiniteScroll.get("isActive");e.infiniteScroll.set("isActive",false)}},resumeScroll:function(){var e=this;if(e.infiniteScroll&&!_.isUndefined(e._scrollWasActive)){e.infiniteScroll.set("isActive",e._scrollWasActive);delete e._scrollWasActive}},_renderPage:function(e){var t=SM.Views.create(SM.SummaryPageView,{model:e});this.$el.prepend(t.el)},_renderAllPages:function(e){var t,i=document.createDocumentFragment();$.each(e,function(e,s){if(!s.shownQuestionList.length){return true}t=SM.Views.create(SM.SummaryPageView,{model:s});i.appendChild(t.el)});this.$el.prepend(i)},_onPageChange:function(e){var t=e.data.self;if(t.survey.questionRollups.isBuffered()){t.infiniteScroll.set("isActive",true)}else{t.infiniteScroll.set("isActive",false);t.survey.questionRollups.fetchMoreRollups()}t.render()},_onTryAgainClicked:function(e){var t=e.data.self;t.infiniteScroll.set("isActive",false);t.survey.questionRollups.fetchMoreRollups()},_onReachedEnd:function(e){if(!SM.App.isSharingApp()){var t=e.data.self;t.survey.questionRollups.fetchMoreRollups()}},_onRollupsAppended:function(e){var t=e.data.self;if(!t.survey.questionRollups.hasAll()){t.infiniteScroll.set("isActive",true)}else{t.infiniteScroll.removeMarker();t.infiniteScroll.set("isActive",false)}}});SM.SummaryLazyLoadView=SM.Views.register({__NAME:"lazyLoadView",__model:"survey",__templateID:"lazy-load-template",__defaults:{lastFetchFailed:false},__init:function(){this.$el.on(SM.Event.CLICK,"[try-again-btn]",{self:this},this._onTryAgainClicked);this.bindModel(this.survey,"fetchRollupsFailed",{self:this},this._onFetchFail)},__beforeRender:function(){return{id:this.get("ID"),lastFetchFailed:this.__settings.lastFetchFailed}},_onFetchFail:function(e){var t=e.data.self;t.__settings.lastFetchFailed=true;t.render()},_onTryAgainClicked:function(e){var t=e.data.self;e.preventDefault();t.__settings.lastFetchFailed=false;t.$el.trigger("tryFetchMore");t.render()}});SM.SummaryPresentationContainerView=SM.Views.register({__NAME:"summaryPresentationContainerView",__templateID:"summary-presentation-question-template",randomAssignmentOption:null,__create:function(e){var t=this;t.question=e.question},__beforeRender:function(e){var t=this,i=t.__settings.randomAssignmentOption,s=this.question.subtype===this.question.QTYPE.image,n=this.question.subtype===this.question.QTYPE.descriptive_text,a,o,r,l;if(s){if(!!i){a=i.image;r=a.source}else{a=this.image;r=a.source}if(a.type==="upload"){l=this.question.page.survey.resourcePath+"/"+r}else if(a.type==="s3"){l=a.url}else{l=r}}else{if(!!i){o=i.heading}else{o=this.heading}}return{imagePresentation:s,textPresentation:n,imageObject:a,text:o,surveyID:this.question.page.survey.ID,imageSourceLink:l}}});