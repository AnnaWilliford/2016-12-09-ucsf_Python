(function(){var e=this;var t=e._;var i={};var s=Array.prototype,n=Object.prototype,r=Function.prototype;var a=s.push,o=s.slice,l=s.concat,u=n.toString,h=n.hasOwnProperty;var c=s.forEach,d=s.map,f=s.reduce,p=s.reduceRight,_=s.filter,g=s.every,m=s.some,v=s.indexOf,S=s.lastIndexOf,y=Array.isArray,w=Object.keys,M=r.bind;var b=function(e){if(e instanceof b)return e;if(!(this instanceof b))return new b(e);this._wrapped=e};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=b}exports._=b}else{e._=b}b.VERSION="1.4.4";var D=b.each=b.forEach=function(e,t,s){if(e==null)return;if(c&&e.forEach===c){e.forEach(t,s)}else if(e.length===+e.length){for(var n=0,r=e.length;n<r;n++){if(t.call(s,e[n],n,e)===i)return}}else{for(var a in e){if(b.has(e,a)){if(t.call(s,e[a],a,e)===i)return}}}};b.map=b.collect=function(e,t,i){var s=[];if(e==null)return s;if(d&&e.map===d)return e.map(t,i);D(e,function(e,n,r){s[s.length]=t.call(i,e,n,r)});return s};var x="Reduce of empty array with no initial value";b.reduce=b.foldl=b.inject=function(e,t,i,s){var n=arguments.length>2;if(e==null)e=[];if(f&&e.reduce===f){if(s)t=b.bind(t,s);return n?e.reduce(t,i):e.reduce(t)}D(e,function(e,r,a){if(!n){i=e;n=true}else{i=t.call(s,i,e,r,a)}});if(!n)throw new TypeError(x);return i};b.reduceRight=b.foldr=function(e,t,i,s){var n=arguments.length>2;if(e==null)e=[];if(p&&e.reduceRight===p){if(s)t=b.bind(t,s);return n?e.reduceRight(t,i):e.reduceRight(t)}var r=e.length;if(r!==+r){var a=b.keys(e);r=a.length}D(e,function(o,l,u){l=a?a[--r]:--r;if(!n){i=e[l];n=true}else{i=t.call(s,i,e[l],l,u)}});if(!n)throw new TypeError(x);return i};b.find=b.detect=function(e,t,i){var s;C(e,function(e,n,r){if(t.call(i,e,n,r)){s=e;return true}});return s};b.filter=b.select=function(e,t,i){var s=[];if(e==null)return s;if(_&&e.filter===_)return e.filter(t,i);D(e,function(e,n,r){if(t.call(i,e,n,r))s[s.length]=e});return s};b.reject=function(e,t,i){return b.filter(e,function(e,s,n){return!t.call(i,e,s,n)},i)};b.every=b.all=function(e,t,s){t||(t=b.identity);var n=true;if(e==null)return n;if(g&&e.every===g)return e.every(t,s);D(e,function(e,r,a){if(!(n=n&&t.call(s,e,r,a)))return i});return!!n};var C=b.some=b.any=function(e,t,s){t||(t=b.identity);var n=false;if(e==null)return n;if(m&&e.some===m)return e.some(t,s);D(e,function(e,r,a){if(n||(n=t.call(s,e,r,a)))return i});return!!n};b.contains=b.include=function(e,t){if(e==null)return false;if(v&&e.indexOf===v)return e.indexOf(t)!=-1;return C(e,function(e){return e===t})};b.invoke=function(e,t){var i=o.call(arguments,2);var s=b.isFunction(t);return b.map(e,function(e){return(s?t:e[t]).apply(e,i)})};b.pluck=function(e,t){return b.map(e,function(e){return e[t]})};b.where=function(e,t,i){if(b.isEmpty(t))return i?null:[];return b[i?"find":"filter"](e,function(e){for(var i in t){if(t[i]!==e[i])return false}return true})};b.findWhere=function(e,t){return b.where(e,t,true)};b.max=function(e,t,i){if(!t&&b.isArray(e)&&e[0]===+e[0]&&e.length<65535){return Math.max.apply(Math,e)}if(!t&&b.isEmpty(e))return-Infinity;var s={computed:-Infinity,value:-Infinity};D(e,function(e,n,r){var a=t?t.call(i,e,n,r):e;a>=s.computed&&(s={value:e,computed:a})});return s.value};b.min=function(e,t,i){if(!t&&b.isArray(e)&&e[0]===+e[0]&&e.length<65535){return Math.min.apply(Math,e)}if(!t&&b.isEmpty(e))return Infinity;var s={computed:Infinity,value:Infinity};D(e,function(e,n,r){var a=t?t.call(i,e,n,r):e;a<s.computed&&(s={value:e,computed:a})});return s.value};b.shuffle=function(e){var t;var i=0;var s=[];D(e,function(e){t=b.random(i++);s[i-1]=s[t];s[t]=e});return s};var E=function(e){return b.isFunction(e)?e:function(t){return t[e]}};b.sortBy=function(e,t,i){var s=E(t);return b.pluck(b.map(e,function(e,t,n){return{value:e,index:t,criteria:s.call(i,e,t,n)}}).sort(function(e,t){var i=e.criteria;var s=t.criteria;if(i!==s){if(i>s||i===void 0)return 1;if(i<s||s===void 0)return-1}return e.index<t.index?-1:1}),"value")};var T=function(e,t,i,s){var n={};var r=E(t||b.identity);D(e,function(t,a){var o=r.call(i,t,a,e);s(n,o,t)});return n};b.groupBy=function(e,t,i){return T(e,t,i,function(e,t,i){(b.has(e,t)?e[t]:e[t]=[]).push(i)})};b.countBy=function(e,t,i){return T(e,t,i,function(e,t){if(!b.has(e,t))e[t]=0;e[t]++})};b.sortedIndex=function(e,t,i,s){i=i==null?b.identity:E(i);var n=i.call(s,t);var r=0,a=e.length;while(r<a){var o=r+a>>>1;i.call(s,e[o])<n?r=o+1:a=o}return r};b.toArray=function(e){if(!e)return[];if(b.isArray(e))return o.call(e);if(e.length===+e.length)return b.map(e,b.identity);return b.values(e)};b.size=function(e){if(e==null)return 0;return e.length===+e.length?e.length:b.keys(e).length};b.first=b.head=b.take=function(e,t,i){if(e==null)return void 0;return t!=null&&!i?o.call(e,0,t):e[0]};b.initial=function(e,t,i){return o.call(e,0,e.length-(t==null||i?1:t))};b.last=function(e,t,i){if(e==null)return void 0;if(t!=null&&!i){return o.call(e,Math.max(e.length-t,0))}else{return e[e.length-1]}};b.rest=b.tail=b.drop=function(e,t,i){return o.call(e,t==null||i?1:t)};b.compact=function(e){return b.filter(e,b.identity)};var A=function(e,t,i){D(e,function(e){if(b.isArray(e)){t?a.apply(i,e):A(e,t,i)}else{i.push(e)}});return i};b.flatten=function(e,t){return A(e,t,[])};b.without=function(e){return b.difference(e,o.call(arguments,1))};b.uniq=b.unique=function(e,t,i,s){if(b.isFunction(t)){s=i;i=t;t=false}var n=i?b.map(e,i,s):e;var r=[];var a=[];D(n,function(i,s){if(t?!s||a[a.length-1]!==i:!b.contains(a,i)){a.push(i);r.push(e[s])}});return r};b.union=function(){return b.uniq(l.apply(s,arguments))};b.intersection=function(e){var t=o.call(arguments,1);return b.filter(b.uniq(e),function(e){return b.every(t,function(t){return b.indexOf(t,e)>=0})})};b.difference=function(e){var t=l.apply(s,o.call(arguments,1));return b.filter(e,function(e){return!b.contains(t,e)})};b.zip=function(){var e=o.call(arguments);var t=b.max(b.pluck(e,"length"));var i=new Array(t);for(var s=0;s<t;s++){i[s]=b.pluck(e,""+s)}return i};b.object=function(e,t){if(e==null)return{};var i={};for(var s=0,n=e.length;s<n;s++){if(t){i[e[s]]=t[s]}else{i[e[s][0]]=e[s][1]}}return i};b.indexOf=function(e,t,i){if(e==null)return-1;var s=0,n=e.length;if(i){if(typeof i=="number"){s=i<0?Math.max(0,n+i):i}else{s=b.sortedIndex(e,t);return e[s]===t?s:-1}}if(v&&e.indexOf===v)return e.indexOf(t,i);for(;s<n;s++)if(e[s]===t)return s;return-1};b.lastIndexOf=function(e,t,i){if(e==null)return-1;var s=i!=null;if(S&&e.lastIndexOf===S){return s?e.lastIndexOf(t,i):e.lastIndexOf(t)}var n=s?i:e.length;while(n--)if(e[n]===t)return n;return-1};b.range=function(e,t,i){if(arguments.length<=1){t=e||0;e=0}i=arguments[2]||1;var s=Math.max(Math.ceil((t-e)/i),0);var n=0;var r=new Array(s);while(n<s){r[n++]=e;e+=i}return r};b.bind=function(e,t){if(e.bind===M&&M)return M.apply(e,o.call(arguments,1));var i=o.call(arguments,2);return function(){return e.apply(t,i.concat(o.call(arguments)))}};b.partial=function(e){var t=o.call(arguments,1);return function(){return e.apply(this,t.concat(o.call(arguments)))}};b.bindAll=function(e){var t=o.call(arguments,1);if(t.length===0)t=b.functions(e);D(t,function(t){e[t]=b.bind(e[t],e)});return e};b.memoize=function(e,t){var i={};t||(t=b.identity);return function(){var s=t.apply(this,arguments);return b.has(i,s)?i[s]:i[s]=e.apply(this,arguments)}};b.delay=function(e,t){var i=o.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)};b.defer=function(e){return b.delay.apply(b,[e,1].concat(o.call(arguments,1)))};b.throttle=function(e,t){var i,s,n,r;var a=0;var o=function(){a=new Date;n=null;r=e.apply(i,s)};return function(){var l=new Date;var u=t-(l-a);i=this;s=arguments;if(u<=0){clearTimeout(n);n=null;a=l;r=e.apply(i,s)}else if(!n){n=setTimeout(o,u)}return r}};b.debounce=function(e,t,i){var s,n;return function(){var r=this,a=arguments;var o=function(){s=null;if(!i)n=e.apply(r,a)};var l=i&&!s;clearTimeout(s);s=setTimeout(o,t);if(l)n=e.apply(r,a);return n}};b.once=function(e){var t=false,i;return function(){if(t)return i;t=true;i=e.apply(this,arguments);e=null;return i}};b.wrap=function(e,t){return function(){var i=[e];a.apply(i,arguments);return t.apply(this,i)}};b.compose=function(){var e=arguments;return function(){var t=arguments;for(var i=e.length-1;i>=0;i--){t=[e[i].apply(this,t)]}return t[0]}};b.after=function(e,t){if(e<=0)return t();return function(){if(--e<1){return t.apply(this,arguments)}}};b.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var i in e)if(b.has(e,i))t[t.length]=i;return t};b.values=function(e){var t=[];for(var i in e)if(b.has(e,i))t.push(e[i]);return t};b.pairs=function(e){var t=[];for(var i in e)if(b.has(e,i))t.push([i,e[i]]);return t};b.invert=function(e){var t={};for(var i in e)if(b.has(e,i))t[e[i]]=i;return t};b.functions=b.methods=function(e){var t=[];for(var i in e){if(b.isFunction(e[i]))t.push(i)}return t.sort()};b.extend=function(e){D(o.call(arguments,1),function(t){if(t){for(var i in t){e[i]=t[i]}}});return e};b.pick=function(e){var t={};var i=l.apply(s,o.call(arguments,1));D(i,function(i){if(i in e)t[i]=e[i]});return t};b.omit=function(e){var t={};var i=l.apply(s,o.call(arguments,1));for(var n in e){if(!b.contains(i,n))t[n]=e[n]}return t};b.defaults=function(e){D(o.call(arguments,1),function(t){if(t){for(var i in t){if(e[i]==null)e[i]=t[i]}}});return e};b.clone=function(e){if(!b.isObject(e))return e;return b.isArray(e)?e.slice():b.extend({},e)};b.tap=function(e,t){t(e);return e};var I=function(e,t,i,s){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;if(e instanceof b)e=e._wrapped;if(t instanceof b)t=t._wrapped;var n=u.call(e);if(n!=u.call(t))return false;switch(n){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return false;var r=i.length;while(r--){if(i[r]==e)return s[r]==t}i.push(e);s.push(t);var a=0,o=true;if(n=="[object Array]"){a=e.length;o=a==t.length;if(o){while(a--){if(!(o=I(e[a],t[a],i,s)))break}}}else{var l=e.constructor,h=t.constructor;if(l!==h&&!(b.isFunction(l)&&l instanceof l&&b.isFunction(h)&&h instanceof h)){return false}for(var c in e){if(b.has(e,c)){a++;if(!(o=b.has(t,c)&&I(e[c],t[c],i,s)))break}}if(o){for(c in t){if(b.has(t,c)&&!a--)break}o=!a}}i.pop();s.pop();return o};b.isEqual=function(e,t){return I(e,t,[],[])};b.isEmpty=function(e){if(e==null)return true;if(b.isArray(e)||b.isString(e))return e.length===0;for(var t in e)if(b.has(e,t))return false;return true};b.isElement=function(e){return!!(e&&e.nodeType===1)};b.isArray=y||function(e){return u.call(e)=="[object Array]"};b.isObject=function(e){return e===Object(e)};D(["Arguments","Function","String","Number","Date","RegExp"],function(e){b["is"+e]=function(t){return u.call(t)=="[object "+e+"]"}});if(!b.isArguments(arguments)){b.isArguments=function(e){return!!(e&&b.has(e,"callee"))}}if(typeof/./!=="function"){b.isFunction=function(e){return typeof e==="function"}}b.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))};b.isNaN=function(e){return b.isNumber(e)&&e!=+e};b.isBoolean=function(e){return e===true||e===false||u.call(e)=="[object Boolean]"};b.isNull=function(e){return e===null};b.isUndefined=function(e){return e===void 0};b.has=function(e,t){return h.call(e,t)};b.noConflict=function(){e._=t;return this};b.identity=function(e){return e};b.times=function(e,t,i){var s=Array(e);for(var n=0;n<e;n++)s[n]=t.call(i,n);return s};b.random=function(e,t){if(t==null){t=e;e=0}return e+Math.floor(Math.random()*(t-e+1))};var R={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};R.unescape=b.invert(R.escape);var P={escape:new RegExp("["+b.keys(R.escape).join("")+"]","g"),unescape:new RegExp("("+b.keys(R.unescape).join("|")+")","g")};b.each(["escape","unescape"],function(e){b[e]=function(t){if(t==null)return"";return(""+t).replace(P[e],function(t){return R[e][t]})}});b.result=function(e,t){if(e==null)return null;var i=e[t];return b.isFunction(i)?i.call(e):i};b.mixin=function(e){D(b.functions(e),function(t){var i=b[t]=e[t];b.prototype[t]=function(){var e=[this._wrapped];a.apply(e,arguments);return N.call(this,i.apply(b,e))}})};var V=0;b.uniqueId=function(e){var t=++V+"";return e?e+t:t};b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var O=/(.)^/;var k={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"};var L=/\\|'|\r|\n|\t|\u2028|\u2029/g;b.template=function(e,t,i){var s;i=b.defaults({},i,b.templateSettings);var n=new RegExp([(i.escape||O).source,(i.interpolate||O).source,(i.evaluate||O).source].join("|")+"|$","g");var r=0;var a="__p+='";e.replace(n,function(t,i,s,n,o){a+=e.slice(r,o).replace(L,function(e){return"\\"+k[e]});if(i){a+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"}if(s){a+="'+\n((__t=("+s+"))==null?'':__t)+\n'"}if(n){a+="';\n"+n+"\n__p+='"}r=o+t.length;return t});a+="';\n";if(!i.variable)a="with(obj||{}){\n"+a+"}\n";a="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{s=new Function(i.variable||"obj","_",a)}catch(o){o.source=a;throw o}if(t)return s(t,b);var l=function(e){return s.call(this,e,b)};l.source="function("+(i.variable||"obj")+"){\n"+a+"}";return l};b.chain=function(e){return b(e).chain()};var N=function(e){return this._chain?b(e).chain():e};b.mixin(b);D(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=s[e];b.prototype[e]=function(){var i=this._wrapped;t.apply(i,arguments);if((e=="shift"||e=="splice")&&i.length===0)delete i[0];return N.call(this,i)}});D(["concat","join","slice"],function(e){var t=s[e];b.prototype[e]=function(){return N.call(this,t.apply(this._wrapped,arguments))}});b.extend(b.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);(function(e,t){var i=[],s=[],n=[];var r={gsub:function(e,t,i){var s=new RegExp(t.source||t,"gi");return s.test(e)?e.replace(s,i):null},plural:function(e,t){i.unshift([e,t])},pluralize:function(s,r,a){var o;if(r!==t){r=Math.round(r);o=r===1?this.singularize(s):this.pluralize(s);o=a?[r,o].join(" "):o}else{if(e(n).include(s)){return s}o=s;e(i).detect(function(e){var t=this.gsub(s,e[0],e[1]);return t?o=t:false},this)}return o},singular:function(e,t){s.unshift([e,t])},singularize:function(t){if(e(n).include(t)){return t}var i=t;e(s).detect(function(e){var s=this.gsub(t,e[0],e[1]);return s?i=s:false},this);return i},irregular:function(e,t){this.plural("\\b"+e+"\\b",t);this.singular("\\b"+t+"\\b",e)},uncountable:function(e){n.unshift(e)},resetInflections:function(){i=[];s=[];n=[];this.plural(/$/,"s");this.plural(/s$/,"s");this.plural(/(ax|test)is$/,"$1es");this.plural(/(octop|vir)us$/,"$1i");this.plural(/(octop|vir)i$/,"$1i");this.plural(/(alias|status)$/,"$1es");this.plural(/(bu)s$/,"$1ses");this.plural(/(buffal|tomat)o$/,"$1oes");this.plural(/([ti])um$/,"$1a");this.plural(/([ti])a$/,"$1a");this.plural(/sis$/,"ses");this.plural(/(?:([^f])fe|([lr])f)$/,"$1$2ves");this.plural(/(hive)$/,"$1s");this.plural(/([^aeiouy]|qu)y$/,"$1ies");this.plural(/(x|ch|ss|sh)$/,"$1es");this.plural(/(matr|vert|ind)(?:ix|ex)$/,"$1ices");this.plural(/([m|l])ouse$/,"$1ice");this.plural(/([m|l])ice$/,"$1ice");this.plural(/^(ox)$/,"$1en");this.plural(/^(oxen)$/,"$1");this.plural(/(quiz)$/,"$1zes");this.singular(/s$/,"");this.singular(/(n)ews$/,"$1ews");this.singular(/([ti])a$/,"$1um");this.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/,"$1$2sis");this.singular(/(^analy)ses$/,"$1sis");this.singular(/([^f])ves$/,"$1fe");this.singular(/(hive)s$/,"$1");this.singular(/(tive)s$/,"$1");this.singular(/([lr])ves$/,"$1f");this.singular(/([^aeiouy]|qu)ies$/,"$1y");this.singular(/(s)eries$/,"$1eries");this.singular(/(m)ovies$/,"$1ovie");this.singular(/(x|ch|ss|sh)es$/,"$1");this.singular(/([m|l])ice$/,"$1ouse");this.singular(/(bus)es$/,"$1");this.singular(/(o)es$/,"$1");this.singular(/(shoe)s$/,"$1");this.singular(/(cris|ax|test)es$/,"$1is");this.singular(/(octop|vir)i$/,"$1us");this.singular(/(alias|status)es$/,"$1");this.singular(/^(ox)en/,"$1");this.singular(/(vert|ind)ices$/,"$1ex");this.singular(/(matr)ices$/,"$1ix");this.singular(/(quiz)zes$/,"$1");this.singular(/(database)s$/,"$1");this.irregular("person","people");this.irregular("man","men");this.irregular("child","children");this.irregular("sex","sexes");this.irregular("move","moves");this.irregular("cow","kine");e("equipment information rice money species series fish sheep jeans".split(/\s+/)).each(function(e){this.uncountable(e)},this);return this}};e.mixin(r.resetInflections())})(_);(function(){_.sum=function(e){return _.reduce(e,function(e,t){return e+t},0)}})();!function(e,t){"use strict";var i=t.prototype.trim;var s=t.prototype.trimRight;var n=t.prototype.trimLeft;var r=function(e){return e*1||0};var a=function(e,t){if(t<1)return"";var i="";while(t>0){if(t&1)i+=e;t>>=1,e+=e}return i};var o=[].slice;var l=function(e){if(e==null)return"\\s";else if(e.source)return e.source;else return"["+p.escapeRegExp(e)+"]"};function u(e,t){var i,s,n=e.toLowerCase();t=[].concat(t);for(i=0;i<t.length;i+=1){s=t[i];if(!s)continue;if(s.test&&s.test(e))return true;if(s.toLowerCase()===n)return true}}var h={lt:"<",gt:">",quot:'"',amp:"&",apos:"'"};var c={};for(var d in h)c[h[d]]=d;c["'"]="#39";var f=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var i=a;var s=function(){if(!s.cache.hasOwnProperty(arguments[0])){s.cache[arguments[0]]=s.parse(arguments[0])}return s.format.call(null,s.cache[arguments[0]],arguments)};s.format=function(s,n){var r=1,a=s.length,o="",l,u=[],h,c,d,p,_,g;for(h=0;h<a;h++){o=e(s[h]);if(o==="string"){u.push(s[h])}else if(o==="array"){d=s[h];if(d[2]){l=n[r];for(c=0;c<d[2].length;c++){if(!l.hasOwnProperty(d[2][c])){throw new Error(f('[_.sprintf] property "%s" does not exist',d[2][c]))}l=l[d[2][c]]}}else if(d[1]){l=n[d[1]]}else{l=n[r++]}if(/[^s]/.test(d[8])&&e(l)!="number"){throw new Error(f("[_.sprintf] expecting number but found %s",e(l)))}switch(d[8]){case"b":l=l.toString(2);break;case"c":l=t.fromCharCode(l);break;case"d":l=parseInt(l,10);break;case"e":l=d[7]?l.toExponential(d[7]):l.toExponential();break;case"f":l=d[7]?parseFloat(l).toFixed(d[7]):parseFloat(l);break;case"o":l=l.toString(8);break;case"s":l=(l=t(l))&&d[7]?l.substring(0,d[7]):l;break;case"u":l=Math.abs(l);break;case"x":l=l.toString(16);break;case"X":l=l.toString(16).toUpperCase();break}l=/[def]/.test(d[8])&&d[3]&&l>=0?"+"+l:l;_=d[4]?d[4]=="0"?"0":d[4].charAt(1):" ";g=d[6]-t(l).length;p=d[6]?i(_,g):"";u.push(d[5]?l+p:p+l)}}return u.join("")};s.cache={};s.parse=function(e){var t=e,i=[],s=[],n=0;while(t){if((i=/^[^\x25]+/.exec(t))!==null){s.push(i[0])}else if((i=/^\x25{2}/.exec(t))!==null){s.push("%")}else if((i=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t))!==null){if(i[2]){n|=1;var r=[],a=i[2],o=[];if((o=/^([a-z_][a-z_\d]*)/i.exec(a))!==null){r.push(o[1]);while((a=a.substring(o[0].length))!==""){if((o=/^\.([a-z_][a-z_\d]*)/i.exec(a))!==null){r.push(o[1])}else if((o=/^\[(\d+)\]/.exec(a))!==null){r.push(o[1])}else{throw new Error("[_.sprintf] huh?")}}}else{throw new Error("[_.sprintf] huh?")}i[2]=r}else{n|=2}if(n===3){throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported")}s.push(i)}else{throw new Error("[_.sprintf] huh?")}t=t.substring(i[0].length)}return s};return s}();var p={VERSION:"2.3.0",isBlank:function(e){if(e==null)e="";return/^\s*$/.test(e)},stripTags:function(e){if(e==null)return"";return t(e).replace(/<\/?[^>]+>/g,"")},capitalize:function(e){e=e==null?"":t(e);return e.charAt(0).toUpperCase()+e.slice(1)},chop:function(e,i){if(e==null)return[];e=t(e);i=~~i;return i>0?e.match(new RegExp(".{1,"+i+"}","g")):[e]},clean:function(e){return p.strip(e).replace(/\s+/g," ")},count:function(e,i){if(e==null||i==null)return 0;e=t(e);i=t(i);var s=0,n=0,r=i.length;while(true){n=e.indexOf(i,n);if(n===-1)break;s++;n+=r}return s},chars:function(e){if(e==null)return[];return t(e).split("")},swapCase:function(e){if(e==null)return"";return t(e).replace(/\S/g,function(e){return e===e.toUpperCase()?e.toLowerCase():e.toUpperCase()})},escapeHTML:function(e){if(e==null)return"";return t(e).replace(/[&<>"']/g,function(e){return"&"+c[e]+";"})},unescapeHTML:function(e){if(e==null)return"";return t(e).replace(/\&([^;]+);/g,function(e,i){var s;if(i in h){return h[i]}else if(s=i.match(/^#x([\da-fA-F]+)$/)){return t.fromCharCode(parseInt(s[1],16))}else if(s=i.match(/^#(\d+)$/)){return t.fromCharCode(~~s[1])}else{return e}})},escapeRegExp:function(e){if(e==null)return"";return t(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(e,t,i,s){var n=p.chars(e);n.splice(~~t,~~i,s);return n.join("")},insert:function(e,t,i){return p.splice(e,t,0,i)},include:function(e,i){if(i==="")return true;if(e==null)return false;return t(e).indexOf(i)!==-1},join:function(){var e=o.call(arguments),t=e.shift();if(t==null)t="";return e.join(t)},lines:function(e){if(e==null)return[];return t(e).split("\n")},reverse:function(e){return p.chars(e).reverse().join("")},startsWith:function(e,i){if(i==="")return true;if(e==null||i==null)return false;e=t(e);i=t(i);return e.length>=i.length&&e.slice(0,i.length)===i},endsWith:function(e,i){if(i==="")return true;if(e==null||i==null)return false;e=t(e);i=t(i);return e.length>=i.length&&e.slice(e.length-i.length)===i},succ:function(e){if(e==null)return"";e=t(e);return e.slice(0,-1)+t.fromCharCode(e.charCodeAt(e.length-1)+1)},titleize:function(e){if(e==null)return"";e=t(e).toLowerCase();return e.replace(/(?:^|\s|-)\S/g,function(e){return e.toUpperCase()})},camelize:function(e){return p.trim(e).replace(/[-_\s]+(.)?/g,function(e,t){return t?t.toUpperCase():""})},underscored:function(e){return p.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(e){return p.trim(e).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(e){return p.titleize(t(e).replace(/[\W_]/g," ")).replace(/\s/g,"")},humanize:function(e){return p.capitalize(p.underscored(e).replace(/_id$/,"").replace(/_/g," "))},trim:function(e,s){if(e==null)return"";if(!s&&i)return i.call(e);s=l(s);return t(e).replace(new RegExp("^"+s+"+|"+s+"+$","g"),"")},ltrim:function(e,i){if(e==null)return"";if(!i&&n)return n.call(e);i=l(i);return t(e).replace(new RegExp("^"+i+"+"),"")},rtrim:function(e,i){if(e==null)return"";if(!i&&s)return s.call(e);i=l(i);return t(e).replace(new RegExp(i+"+$"),"")},truncate:function(e,i,s){if(e==null)return"";e=t(e);s=s||"...";i=~~i;return e.length>i?e.slice(0,i)+s:e},prune:function(e,i,s){if(e==null)return"";e=t(e);i=~~i;s=s!=null?t(s):"...";if(e.length<=i)return e;var n=function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "},r=e.slice(0,i+1).replace(/.(?=\W*\w*$)/g,n);if(r.slice(r.length-2).match(/\w\w/))r=r.replace(/\s*\S+$/,"");else r=p.rtrim(r.slice(0,r.length-1));return(r+s).length>e.length?e:e.slice(0,r.length)+s},words:function(e,t){if(p.isBlank(e))return[];return p.trim(e,t).split(t||/\s+/)},pad:function(e,i,s,n){e=e==null?"":t(e);i=~~i;var r=0;if(!s)s=" ";else if(s.length>1)s=s.charAt(0);switch(n){case"right":r=i-e.length;return e+a(s,r);case"both":r=i-e.length;return a(s,Math.ceil(r/2))+e+a(s,Math.floor(r/2));default:r=i-e.length;return a(s,r)+e}},lpad:function(e,t,i){return p.pad(e,t,i)},rpad:function(e,t,i){return p.pad(e,t,i,"right")},lrpad:function(e,t,i){return p.pad(e,t,i,"both")},sprintf:f,vsprintf:function(e,t){t.unshift(e);return f.apply(null,t)},toNumber:function(e,t){if(!e)return 0;e=p.trim(e);if(!e.match(/^-?\d+(?:\.\d+)?$/))return NaN;return r(r(e).toFixed(~~t))},numberFormat:function(e,t,i,s){if(isNaN(e)||e==null)return"";e=e.toFixed(~~t);s=typeof s=="string"?s:",";var n=e.split("."),r=n[0],a=n[1]?(i||".")+n[1]:"";return r.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+s)+a},strRight:function(e,i){if(e==null)return"";e=t(e);i=i!=null?t(i):i;var s=!i?-1:e.indexOf(i);return~s?e.slice(s+i.length,e.length):e},strRightBack:function(e,i){if(e==null)return"";e=t(e);i=i!=null?t(i):i;var s=!i?-1:e.lastIndexOf(i);return~s?e.slice(s+i.length,e.length):e},strLeft:function(e,i){if(e==null)return"";e=t(e);i=i!=null?t(i):i;var s=!i?-1:e.indexOf(i);return~s?e.slice(0,s):e},strLeftBack:function(e,t){if(e==null)return"";e+="";t=t!=null?""+t:t;var i=e.lastIndexOf(t);return~i?e.slice(0,i):e},toSentence:function(e,t,i,s){t=t||", ";i=i||" and ";var n=e.slice(),r=n.pop();if(e.length>2&&s)i=p.rtrim(t)+i;return n.length?n.join(t)+i+r:r},toSentenceSerial:function(){var e=o.call(arguments);e[3]=true;return p.toSentence.apply(p,e)},slugify:function(e){if(e==null)return"";var i="\u0105\xe0\xe1\xe4\xe2\xe3\xe5\xe6\u0103\u0107\u0119\xe8\xe9\xeb\xea\xec\xed\xef\xee\u0142\u0144\xf2\xf3\xf6\xf4\xf5\xf8\u015b\u0219\u021b\xf9\xfa\xfc\xfb\xf1\xe7\u017c\u017a",s="aaaaaaaaaceeeeeiiiilnoooooosstuuuunczz",n=new RegExp(l(i),"g");e=t(e).toLowerCase().replace(n,function(e){var t=i.indexOf(e);return s.charAt(t)||"-"});return p.dasherize(e.replace(/[^\w\s-]/g,""))},surround:function(e,t){return[t,e,t].join("")},quote:function(e,t){return p.surround(e,t||'"')},unquote:function(e,t){t=t||'"';if(e[0]===t&&e[e.length-1]===t)return e.slice(1,e.length-1);else return e},exports:function(){var e={};for(var t in this){if(!this.hasOwnProperty(t)||t.match(/^(?:include|contains|reverse)$/))continue;e[t]=this[t]}return e},repeat:function(e,i,s){if(e==null)return"";i=~~i;if(s==null)return a(t(e),i);for(var n=[];i>0;n[--i]=e){}return n.join(s)},naturalCmp:function(e,i){if(e==i)return 0;if(!e)return-1;if(!i)return 1;var s=/(\.\d+)|(\d+)|(\D+)/g,n=t(e).toLowerCase().match(s),r=t(i).toLowerCase().match(s),a=Math.min(n.length,r.length);for(var o=0;o<a;o++){var l=n[o],u=r[o];if(l!==u){var h=parseInt(l,10);if(!isNaN(h)){var c=parseInt(u,10);if(!isNaN(c)&&h-c)return h-c}return l<u?-1:1}}if(n.length===r.length)return n.length-r.length;return e<i?-1:1},levenshtein:function(e,i){if(e==null&&i==null)return 0;if(e==null)return t(i).length;if(i==null)return t(e).length;e=t(e);i=t(i);var s=[],n,r;for(var a=0;a<=i.length;a++)for(var o=0;o<=e.length;o++){if(a&&o)if(e.charAt(o-1)===i.charAt(a-1))r=n;else r=Math.min(s[o],s[o-1],n)+1;else r=a+o;n=s[o];s[o]=r}return s.pop()},toBoolean:function(e,t,i){if(typeof e==="number")e=""+e;if(typeof e!=="string")return!!e;e=p.trim(e);if(u(e,t||["true","1"]))return true;if(u(e,i||["false","0"]))return false}};p.strip=p.trim;p.lstrip=p.ltrim;p.rstrip=p.rtrim;p.center=p.lrpad;p.rjust=p.lpad;p.ljust=p.rpad;p.contains=p.include;p.q=p.quote;p.toBool=p.toBoolean;if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports)module.exports=p;exports._s=p}if(typeof define==="function"&&define.amd)define("underscore.string",[],function(){return p});e._=e._||{};e._.string=e._.str=p}(this,String);(function(e){var t,i="2.4.0",s=Math.round,n,r=0,a=1,o=2,l=3,u=4,h=5,c=6,d={},f=typeof module!=="undefined"&&module.exports,p=/^\/?Date\((\-?\d+)/i,_=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,g=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,m=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,v=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,S=/\d\d?/,y=/\d{1,3}/,w=/\d{3}/,M=/\d{1,4}/,b=/[+\-]?\d{1,6}/,D=/\d+/,x=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,C=/Z|[\+\-]\d\d:?\d\d/i,E=/T/i,T=/[\+\-]?\d+(\.\d{1,3})?/,A=/^\s*\d{4}-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d:?\d\d|Z)?)?$/,I="YYYY-MM-DDTHH:mm:ssZ",R=["YYYY-MM-DD","GGGG-[W]WW","GGGG-[W]WW-E","YYYY-DDD"],P=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],V=/([\+\-]|\d\d)/gi,O="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),k={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},L={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},N={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},$={},B="DDD w W M D d".split(" "),z="M D H h m s w W".split(" "),q={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return J(this.year()%100,2)},YYYY:function(){return J(this.year(),4)},YYYYY:function(){return J(this.year(),5)},gg:function(){return J(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return J(this.weekYear(),5)},GG:function(){return J(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return J(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),true)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),false)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return ne(this.milliseconds()/100)},SS:function(){return J(ne(this.milliseconds()/10),2)},SSS:function(){return J(this.milliseconds(),3)},SSSS:function(){return J(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";if(e<0){e=-e;t="-"}return t+J(ne(e/60),2)+":"+J(ne(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";if(e<0){e=-e;t="-"}return t+J(ne(10*e/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}},F=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];function H(e,t){return function(i){return J(e.call(this,i),t)}}function U(e,t){return function(i){return this.lang().ordinal(e.call(this,i),t)}}while(B.length){n=B.pop();q[n+"o"]=U(q[n],n)}while(z.length){n=z.pop();q[n+n]=H(q[n],2)}q.DDDD=H(q.DDD,3);function Q(){}function G(e){le(e);Y(this,e)}function j(e){var t=ie(e),i=t.year||0,s=t.month||0,n=t.week||0,r=t.day||0,a=t.hour||0,o=t.minute||0,l=t.second||0,u=t.millisecond||0;this._input=e;this._milliseconds=+u+l*1e3+o*6e4+a*36e5;this._days=+r+n*7;this._months=+s+i*12;this._data={};this._bubble()}function Y(e,t){for(var i in t){if(t.hasOwnProperty(i)){e[i]=t[i]}}if(t.hasOwnProperty("toString")){e.toString=t.toString}if(t.hasOwnProperty("valueOf")){e.valueOf=t.valueOf}return e}function W(e){if(e<0){return Math.ceil(e)}else{return Math.floor(e)}}function J(e,t){var i=e+"";while(i.length<t){i="0"+i}return i}function K(e,i,s,n){var r=i._milliseconds,a=i._days,o=i._months,l,u;if(r){e._d.setTime(+e._d+r*s)}if(a||o){l=e.minute();u=e.hour()}if(a){e.date(e.date()+a*s)}if(o){e.month(e.month()+o*s)}if(r&&!n){t.updateOffset(e)}if(a||o){e.minute(l);e.hour(u)}}function X(e){return Object.prototype.toString.call(e)==="[object Array]"}function Z(e){return Object.prototype.toString.call(e)==="[object Date]"||e instanceof Date}function ee(e,t,i){var s=Math.min(e.length,t.length),n=Math.abs(e.length-t.length),r=0,a;for(a=0;a<s;a++){if(i&&e[a]!==t[a]||!i&&ne(e[a])!==ne(t[a])){r++}}return r+n}function te(e){
if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=L[e]||N[t]||t}return e}function ie(e){var t={},i,s,n;for(s in e){if(e.hasOwnProperty(s)){i=te(s);if(i){t[i]=e[s]}}}return t}function se(i){var s,n;if(i.indexOf("week")===0){s=7;n="day"}else if(i.indexOf("month")===0){s=12;n="month"}else{return}t[i]=function(r,a){var o,l,u=t.fn._lang[i],h=[];if(typeof r==="number"){a=r;r=e}l=function(e){var i=t().utc().set(n,e);return u.call(t.fn._lang,i,r||"")};if(a!=null){return l(a)}else{for(o=0;o<s;o++){h.push(l(o))}return h}}}function ne(e){var t=+e,i=0;if(t!==0&&isFinite(t)){if(t>=0){i=Math.floor(t)}else{i=Math.ceil(t)}}return i}function re(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function ae(e){return oe(e)?366:365}function oe(e){return e%4===0&&e%100!==0||e%400===0}function le(e){var t;if(e._a&&e._pf.overflow===-2){t=e._a[a]<0||e._a[a]>11?a:e._a[o]<1||e._a[o]>re(e._a[r],e._a[a])?o:e._a[l]<0||e._a[l]>23?l:e._a[u]<0||e._a[u]>59?u:e._a[h]<0||e._a[h]>59?h:e._a[c]<0||e._a[c]>999?c:-1;if(e._pf._overflowDayOfYear&&(t<r||t>o)){t=o}e._pf.overflow=t}}function ue(e){e._pf={empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false}}function he(e){if(e._isValid==null){e._isValid=!isNaN(e._d.getTime())&&e._pf.overflow<0&&!e._pf.empty&&!e._pf.invalidMonth&&!e._pf.nullInput&&!e._pf.invalidFormat&&!e._pf.userInvalidated;if(e._strict){e._isValid=e._isValid&&e._pf.charsLeftOver===0&&e._pf.unusedTokens.length===0}}return e._isValid}function ce(e){return e?e.toLowerCase().replace("_","-"):e}Y(Q.prototype,{set:function(e){var t,i;for(i in e){t=e[i];if(typeof t==="function"){this[i]=t}else{this["_"+i]=t}}},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var i,s,n;if(!this._monthsParse){this._monthsParse=[]}for(i=0;i<12;i++){if(!this._monthsParse[i]){s=t.utc([2e3,i]);n="^"+this.months(s,"")+"|^"+this.monthsShort(s,"");this._monthsParse[i]=new RegExp(n.replace(".",""),"i")}if(this._monthsParse[i].test(e)){return i}}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var i,s,n;if(!this._weekdaysParse){this._weekdaysParse=[]}for(i=0;i<7;i++){if(!this._weekdaysParse[i]){s=t([2e3,1]).day(i);n="^"+this.weekdays(s,"")+"|^"+this.weekdaysShort(s,"")+"|^"+this.weekdaysMin(s,"");this._weekdaysParse[i]=new RegExp(n.replace(".",""),"i")}if(this._weekdaysParse[i].test(e)){return i}}},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];if(!t&&this._longDateFormat[e.toUpperCase()]){t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)});this._longDateFormat[e]=t}return t},isPM:function(e){return(e+"").toLowerCase().charAt(0)==="p"},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,i){if(e>11){return i?"pm":"PM"}else{return i?"am":"AM"}},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var i=this._calendar[e];return typeof i==="function"?i.apply(t):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,i,s){var n=this._relativeTime[i];return typeof n==="function"?n(e,t,i,s):n.replace(/%d/i,e)},pastFuture:function(e,t){var i=this._relativeTime[e>0?"future":"past"];return typeof i==="function"?i(t):i.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return Le(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}});function de(e,t){t.abbr=e;if(!d[e]){d[e]=new Q}d[e].set(t);return d[e]}function fe(e){delete d[e]}function pe(e){var i=0,s,n,r,a,o=function(e){if(!d[e]&&f){try{require("./lang/"+e)}catch(t){}}return d[e]};if(!e){return t.fn._lang}if(!X(e)){n=o(e);if(n){return n}e=[e]}while(i<e.length){a=ce(e[i]).split("-");s=a.length;r=ce(e[i+1]);r=r?r.split("-"):null;while(s>0){n=o(a.slice(0,s).join("-"));if(n){return n}if(r&&r.length>=s&&ee(a,r,true)>=s-1){break}s--}i++}return t.fn._lang}function _e(e){if(e.match(/\[[\s\S]/)){return e.replace(/^\[|\]$/g,"")}return e.replace(/\\/g,"")}function ge(e){var t=e.match(m),i,s;for(i=0,s=t.length;i<s;i++){if(q[t[i]]){t[i]=q[t[i]]}else{t[i]=_e(t[i])}}return function(n){var r="";for(i=0;i<s;i++){r+=t[i]instanceof Function?t[i].call(n,e):t[i]}return r}}function me(e,t){if(!e.isValid()){return e.lang().invalidDate()}t=ve(t,e.lang());if(!$[t]){$[t]=ge(t)}return $[t](e)}function ve(e,t){var i=5;function s(e){return t.longDateFormat(e)||e}v.lastIndex=0;while(i>=0&&v.test(e)){e=e.replace(v,s);v.lastIndex=0;i-=1}return e}function Se(e,t){var i;switch(e){case"DDDD":return w;case"YYYY":case"GGGG":case"gggg":return M;case"YYYYY":case"GGGGG":case"ggggg":return b;case"S":case"SS":case"SSS":case"DDD":return y;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return x;case"a":case"A":return pe(t._l)._meridiemParse;case"X":return T;case"Z":case"ZZ":return C;case"T":return E;case"SSSS":return D;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"ww":case"W":case"WW":case"e":case"E":return S;default:i=new RegExp(Ee(Ce(e.replace("\\","")),"i"));return i}}function ye(e){var t=(C.exec(e)||[])[0],i=(t+"").match(V)||["-",0,0],s=+(i[1]*60)+ne(i[2]);return i[0]==="+"?-s:s}function we(e,t,i){var s,n=i._a;switch(e){case"M":case"MM":if(t!=null){n[a]=ne(t)-1}break;case"MMM":case"MMMM":s=pe(i._l).monthsParse(t);if(s!=null){n[a]=s}else{i._pf.invalidMonth=t}break;case"D":case"DD":if(t!=null){n[o]=ne(t)}break;case"DDD":case"DDDD":if(t!=null){i._dayOfYear=ne(t)}break;case"YY":n[r]=ne(t)+(ne(t)>68?1900:2e3);break;case"YYYY":case"YYYYY":n[r]=ne(t);break;case"a":case"A":i._isPm=pe(i._l).isPM(t);break;case"H":case"HH":case"h":case"hh":n[l]=ne(t);break;case"m":case"mm":n[u]=ne(t);break;case"s":case"ss":n[h]=ne(t);break;case"S":case"SS":case"SSS":case"SSSS":n[c]=ne(("0."+t)*1e3);break;case"X":i._d=new Date(parseFloat(t)*1e3);break;case"Z":case"ZZ":i._useUTC=true;i._tzm=ye(t);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":e=e.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":e=e.substr(0,2);if(t){i._w=i._w||{};i._w[e]=t}break}}function Me(e){var i,s,n=[],h,c,d,f,p,_,g,m;if(e._d){return}h=De(e);if(e._w&&e._a[o]==null&&e._a[a]==null){d=function(i){return i?i.length<3?parseInt(i,10)>68?"19"+i:"20"+i:i:e._a[r]==null?t().weekYear():e._a[r]};f=e._w;if(f.GG!=null||f.W!=null||f.E!=null){p=Ne(d(f.GG),f.W||1,f.E,4,1)}else{_=pe(e._l);g=f.d!=null?Ve(f.d,_):f.e!=null?parseInt(f.e,10)+_._week.dow:0;m=parseInt(f.w,10)||1;if(f.d!=null&&g<_._week.dow){m++}p=Ne(d(f.gg),m,g,_._week.doy,_._week.dow)}e._a[r]=p.year;e._dayOfYear=p.dayOfYear}if(e._dayOfYear){c=e._a[r]==null?h[r]:e._a[r];if(e._dayOfYear>ae(c)){e._pf._overflowDayOfYear=true}s=Pe(c,0,e._dayOfYear);e._a[a]=s.getUTCMonth();e._a[o]=s.getUTCDate()}for(i=0;i<3&&e._a[i]==null;++i){e._a[i]=n[i]=h[i]}for(;i<7;i++){e._a[i]=n[i]=e._a[i]==null?i===2?1:0:e._a[i]}n[l]+=ne((e._tzm||0)/60);n[u]+=ne((e._tzm||0)%60);e._d=(e._useUTC?Pe:Re).apply(null,n)}function be(e){var t;if(e._d){return}t=ie(e._i);e._a=[t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond];Me(e)}function De(e){var t=new Date;if(e._useUTC){return[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]}else{return[t.getFullYear(),t.getMonth(),t.getDate()]}}function xe(e){e._a=[];e._pf.empty=true;var t=pe(e._l),i=""+e._i,s,n,r,a,o,u=i.length,h=0;r=ve(e._f,t).match(m)||[];for(s=0;s<r.length;s++){a=r[s];n=(Se(a,e).exec(i)||[])[0];if(n){o=i.substr(0,i.indexOf(n));if(o.length>0){e._pf.unusedInput.push(o)}i=i.slice(i.indexOf(n)+n.length);h+=n.length}if(q[a]){if(n){e._pf.empty=false}else{e._pf.unusedTokens.push(a)}we(a,n,e)}else if(e._strict&&!n){e._pf.unusedTokens.push(a)}}e._pf.charsLeftOver=u-h;if(i.length>0){e._pf.unusedInput.push(i)}if(e._isPm&&e._a[l]<12){e._a[l]+=12}if(e._isPm===false&&e._a[l]===12){e._a[l]=0}Me(e);le(e)}function Ce(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,i,s,n){return t||i||s||n})}function Ee(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Te(e){var t,i,s,n,r;if(e._f.length===0){e._pf.invalidFormat=true;e._d=new Date(NaN);return}for(n=0;n<e._f.length;n++){r=0;t=Y({},e);ue(t);t._f=e._f[n];xe(t);if(!he(t)){continue}r+=t._pf.charsLeftOver;r+=t._pf.unusedTokens.length*10;t._pf.score=r;if(s==null||r<s){s=r;i=t}}Y(e,i||t)}function Ae(e){var t,i=e._i,s=A.exec(i);if(s){e._pf.iso=true;for(t=4;t>0;t--){if(s[t]){e._f=R[t-1]+(s[6]||" ");break}}for(t=0;t<4;t++){if(P[t][1].exec(i)){e._f+=P[t][0];break}}if(C.exec(i)){e._f+="Z"}xe(e)}else{e._d=new Date(i)}}function Ie(t){var i=t._i,s=p.exec(i);if(i===e){t._d=new Date}else if(s){t._d=new Date(+s[1])}else if(typeof i==="string"){Ae(t)}else if(X(i)){t._a=i.slice(0);Me(t)}else if(Z(i)){t._d=new Date(+i)}else if(typeof i==="object"){be(t)}else{t._d=new Date(i)}}function Re(e,t,i,s,n,r,a){var o=new Date(e,t,i,s,n,r,a);if(e<1970){o.setFullYear(e)}return o}function Pe(e){var t=new Date(Date.UTC.apply(null,arguments));if(e<1970){t.setUTCFullYear(e)}return t}function Ve(e,t){if(typeof e==="string"){if(!isNaN(e)){e=parseInt(e,10)}else{e=t.weekdaysParse(e);if(typeof e!=="number"){return null}}}return e}function Oe(e,t,i,s,n){return n.relativeTime(t||1,!!i,e,s)}function ke(e,t,i){var n=s(Math.abs(e)/1e3),r=s(n/60),a=s(r/60),o=s(a/24),l=s(o/365),u=n<45&&["s",n]||r===1&&["m"]||r<45&&["mm",r]||a===1&&["h"]||a<22&&["hh",a]||o===1&&["d"]||o<=25&&["dd",o]||o<=45&&["M"]||o<345&&["MM",s(o/30)]||l===1&&["y"]||["yy",l];u[2]=t;u[3]=e>0;u[4]=i;return Oe.apply({},u)}function Le(e,i,s){var n=s-i,r=s-e.day(),a;if(r>n){r-=7}if(r<n-7){r+=7}a=t(e).add("d",r);return{week:Math.ceil(a.dayOfYear()/7),year:a.year()}}function Ne(e,t,i,s,n){var r=new Date(Date.UTC(e,0)).getUTCDay(),a,o;i=i!=null?i:n;a=n-r+(r>s?7:0);o=7*(t-1)+(i-n)+a+1;return{year:o>0?e:e-1,dayOfYear:o>0?o:ae(e-1)+o}}function $e(e){var i=e._i,s=e._f;if(typeof e._pf==="undefined"){ue(e)}if(i===null){return t.invalid({nullInput:true})}if(typeof i==="string"){e._i=i=pe().preparse(i)}if(t.isMoment(i)){e=Y({},i);e._d=new Date(+i._d)}else if(s){if(X(s)){Te(e)}else{xe(e)}}else{Ie(e)}return new G(e)}t=function(t,i,s,n){if(typeof s==="boolean"){n=s;s=e}return $e({_i:t,_f:i,_l:s,_strict:n,_isUTC:false})};t.utc=function(t,i,s,n){var r;if(typeof s==="boolean"){n=s;s=e}r=$e({_useUTC:true,_isUTC:true,_l:s,_i:t,_f:i,_strict:n}).utc();return r};t.unix=function(e){return t(e*1e3)};t.duration=function(e,i){var s=t.isDuration(e),n=typeof e==="number",r=s?e._input:n?{}:e,a=null,d,f,p,m,v;if(n){if(i){r[i]=e}else{r.milliseconds=e}}else if(!!(a=_.exec(e))){d=a[1]==="-"?-1:1;r={y:0,d:ne(a[o])*d,h:ne(a[l])*d,m:ne(a[u])*d,s:ne(a[h])*d,ms:ne(a[c])*d}}else if(!!(a=g.exec(e))){d=a[1]==="-"?-1:1;p=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*d};r={y:p(a[2]),M:p(a[3]),d:p(a[4]),h:p(a[5]),m:p(a[6]),s:p(a[7]),w:p(a[8])}}f=new j(r);if(s&&e.hasOwnProperty("_lang")){f._lang=e._lang}return f};t.version=i;t.defaultFormat=I;t.updateOffset=function(){};t.lang=function(e,i){var s;if(!e){return t.fn._lang._abbr}if(i){de(ce(e),i)}else if(i===null){fe(e);e="en"}else if(!d[e]){pe(e)}s=t.duration.fn._lang=t.fn._lang=pe(e);return s._abbr};t.langData=function(e){if(e&&e._lang&&e._lang._abbr){e=e._lang._abbr}return pe(e)};t.isMoment=function(e){return e instanceof G};t.isDuration=function(e){return e instanceof j};for(n=F.length-1;n>=0;--n){se(F[n])}t.normalizeUnits=function(e){return te(e)};t.invalid=function(e){var i=t.utc(NaN);if(e!=null){Y(i._pf,e)}else{i._pf.userInvalidated=true}return i};t.parseZone=function(e){return t(e).parseZone()};Y(t.fn=G.prototype,{clone:function(){return t(this)},valueOf:function(){return+this._d+(this._offset||0)*6e4},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return me(t(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return he(this)},isDSTShifted:function(){if(this._a){return this.isValid()&&ee(this._a,(this._isUTC?t.utc(this._a):t(this._a)).toArray())>0}return false},parsingFlags:function(){return Y({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){this.zone(0);this._isUTC=false;return this},format:function(e){var i=me(this,e||t.defaultFormat);return this.lang().postformat(i)},add:function(e,i){var s;if(typeof e==="string"){s=t.duration(+i,e)}else{s=t.duration(e,i)}K(this,s,1);return this},subtract:function(e,i){var s;if(typeof e==="string"){s=t.duration(+i,e)}else{s=t.duration(e,i)}K(this,s,-1);return this},diff:function(e,i,s){var n=this._isUTC?t(e).zone(this._offset||0):t(e).local(),r=(this.zone()-n.zone())*6e4,a,o;i=te(i);if(i==="year"||i==="month"){a=(this.daysInMonth()+n.daysInMonth())*432e5;o=(this.year()-n.year())*12+(this.month()-n.month());o+=(this-t(this).startOf("month")-(n-t(n).startOf("month")))/a;o-=(this.zone()-t(this).startOf("month").zone()-(n.zone()-t(n).startOf("month").zone()))*6e4/a;if(i==="year"){o=o/12}}else{a=this-n;o=i==="second"?a/1e3:i==="minute"?a/6e4:i==="hour"?a/36e5:i==="day"?(a-r)/864e5:i==="week"?(a-r)/6048e5:a}return s?o:W(o)},from:function(e,i){return t.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!i)},fromNow:function(e){return this.from(t(),e)},calendar:function(){var e=this.diff(t().zone(this.zone()).startOf("day"),"days",true),i=e<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(i,this))},isLeapYear:function(){return oe(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();if(e!=null){e=Ve(e,this.lang());return this.add({d:e-t})}else{return t}},month:function(e){var i=this._isUTC?"UTC":"",s;if(e!=null){if(typeof e==="string"){e=this.lang().monthsParse(e);if(typeof e!=="number"){return this}}s=this.date();this.date(1);this._d["set"+i+"Month"](e);this.date(Math.min(s,this.daysInMonth()));t.updateOffset(this);return this}else{return this._d["get"+i+"Month"]()}},startOf:function(e){e=te(e);switch(e){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}if(e==="week"){this.weekday(0)}else if(e==="isoWeek"){this.isoWeekday(1)}return this},endOf:function(e){e=te(e);return this.startOf(e).add(e==="isoWeek"?"week":e,1).subtract("ms",1)},isAfter:function(e,i){i=typeof i!=="undefined"?i:"millisecond";return+this.clone().startOf(i)>+t(e).startOf(i)},isBefore:function(e,i){i=typeof i!=="undefined"?i:"millisecond";return+this.clone().startOf(i)<+t(e).startOf(i)},isSame:function(e,i){i=typeof i!=="undefined"?i:"millisecond";return+this.clone().startOf(i)===+t(e).startOf(i)},min:function(e){e=t.apply(null,arguments);return e<this?this:e},max:function(e){e=t.apply(null,arguments);return e>this?this:e},zone:function(e){var i=this._offset||0;if(e!=null){if(typeof e==="string"){e=ye(e)}if(Math.abs(e)<16){e=e*60}this._offset=e;this._isUTC=true;if(i!==e){K(this,t.duration(i-e,"m"),1,true)}}else{return this._isUTC?i:this._d.getTimezoneOffset()}return this},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){if(typeof this._i==="string"){this.zone(this._i)}return this},hasAlignedHourOffset:function(e){if(!e){e=0}else{e=t(e).zone()}return(this.zone()-e)%60===0},daysInMonth:function(){return re(this.year(),this.month())},dayOfYear:function(e){var i=s((t(this).startOf("day")-t(this).startOf("year"))/864e5)+1;return e==null?i:this.add("d",e-i)},weekYear:function(e){var t=Le(this,this.lang()._week.dow,this.lang()._week.doy).year;return e==null?t:this.add("y",e-t)},isoWeekYear:function(e){var t=Le(this,1,4).year;return e==null?t:this.add("y",e-t)},week:function(e){var t=this.lang().week(this);return e==null?t:this.add("d",(e-t)*7)},isoWeek:function(e){var t=Le(this,1,4).week;return e==null?t:this.add("d",(e-t)*7)},weekday:function(e){var t=(this.day()+7-this.lang()._week.dow)%7;return e==null?t:this.add("d",e-t)},isoWeekday:function(e){return e==null?this.day()||7:this.day(this.day()%7?e:e-7)},get:function(e){e=te(e);return this[e]()},set:function(e,t){e=te(e);if(typeof this[e]==="function"){this[e](t)}return this},lang:function(t){if(t===e){return this._lang}else{this._lang=pe(t);return this}}});function Be(e,i){t.fn[e]=t.fn[e+"s"]=function(e){var s=this._isUTC?"UTC":"";if(e!=null){this._d["set"+s+i](e);t.updateOffset(this);return this}else{return this._d["get"+s+i]()}}}for(n=0;n<O.length;n++){Be(O[n].toLowerCase().replace(/s$/,""),O[n])}Be("year","FullYear");t.fn.days=t.fn.day;t.fn.months=t.fn.month;t.fn.weeks=t.fn.week;t.fn.isoWeeks=t.fn.isoWeek;t.fn.toJSON=t.fn.toISOString;Y(t.duration.fn=j.prototype,{_bubble:function(){var e=this._milliseconds,t=this._days,i=this._months,s=this._data,n,r,a,o;s.milliseconds=e%1e3;n=W(e/1e3);s.seconds=n%60;r=W(n/60);s.minutes=r%60;a=W(r/60);s.hours=a%24;t+=W(a/24);s.days=t%30;i+=W(t/30);s.months=i%12;o=W(i/12);s.years=o},weeks:function(){return W(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months%12*2592e6+ne(this._months/12)*31536e6},humanize:function(e){var t=+this,i=ke(t,!e,this.lang());if(e){i=this.lang().pastFuture(t,i)}return this.lang().postformat(i)},add:function(e,i){var s=t.duration(e,i);this._milliseconds+=s._milliseconds;this._days+=s._days;this._months+=s._months;this._bubble();return this},subtract:function(e,i){var s=t.duration(e,i);this._milliseconds-=s._milliseconds;this._days-=s._days;this._months-=s._months;this._bubble();return this},get:function(e){e=te(e);return this[e.toLowerCase()+"s"]()},as:function(e){e=te(e);return this["as"+e.charAt(0).toUpperCase()+e.slice(1)+"s"]()},lang:t.fn.lang,toIsoString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),i=Math.abs(this.days()),s=Math.abs(this.hours()),n=Math.abs(this.minutes()),r=Math.abs(this.seconds()+this.milliseconds()/1e3);if(!this.asSeconds()){return"P0D"}return(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(i?i+"D":"")+(s||n||r?"T":"")+(s?s+"H":"")+(n?n+"M":"")+(r?r+"S":"")}});function ze(e){t.duration.fn[e]=function(){return this._data[e]}}function qe(e,i){t.duration.fn["as"+e]=function(){return+this/i}}for(n in k){if(k.hasOwnProperty(n)){qe(n,k[n]);ze(n.toLowerCase())}}qe("Weeks",6048e5);t.duration.fn.asMonths=function(){return(+this-this.years()*31536e6)/2592e6+this.years()*12};t.lang("en",{ordinal:function(e){var t=e%10,i=ne(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return e+i}});function Fe(e){var i=false,s=t;if(typeof ender!=="undefined"){return}if(e){this.moment=function(){if(!i&&console&&console.warn){i=true;console.warn("Accessing Moment through the global scope is "+"deprecated, and will be removed in an upcoming "+"release.")}return s.apply(null,arguments)}}else{this["moment"]=t}}if(f){module.exports=t;Fe(true)}else if(typeof define==="function"&&define.amd){define("moment",function(i,s,n){if(n.config().noGlobal!==true){Fe(n.config().noGlobal===e)}return t})}else{Fe()}}).call(this);(function(e){var t={starts_with_slashes:/^\/+/,ends_with_slashes:/\/+$/,pluses:/\+/g,query_separator:/[&;]/,uri_parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?(\[[0-9a-fA-F:.]+\]|[^:\/?#]*)(?::(\d+|(?=:)))?(:)?)((((?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/};if(!Array.prototype.forEach){Array.prototype.forEach=function(e,t){var i,s;if(this==null){throw new TypeError(" this is null or not defined")}var n=Object(this);var r=n.length>>>0;if(typeof e!=="function"){throw new TypeError(e+" is not a function")}if(arguments.length>1){i=t}s=0;while(s<r){var a;if(s in n){a=n[s];e.call(i,a,s,n)}s++}}}function i(e){if(e){e=e.toString().replace(t.pluses,"%20");e=decodeURIComponent(e)}return e}function s(e){var i=t.uri_parser;var s=["source","protocol","authority","userInfo","user","password","host","port","isColonUri","relative","path","directory","file","query","anchor"];var n=i.exec(e||"");var r={};s.forEach(function(e,t){r[e]=n[t]||""});return r}function n(e){var s,n,r,a,o,l,u;var h=[];if(typeof e==="undefined"||e===null||e===""){return h}if(e.indexOf("?")===0){e=e.substring(1)}n=e.toString().split(t.query_separator);for(s=0,u=n.length;s<u;s++){r=n[s];a=r.indexOf("=");if(a!==0){o=i(r.substring(0,a));l=i(r.substring(a+1));h.push(a===-1?[r,null]:[o,l])}}return h}function r(e){this.uriParts=s(e);this.queryPairs=n(this.uriParts.query);this.hasAuthorityPrefixUserPref=null}["protocol","userInfo","host","port","path","anchor"].forEach(function(e){r.prototype[e]=function(t){if(typeof t!=="undefined"){this.uriParts[e]=t}return this.uriParts[e]}});r.prototype.hasAuthorityPrefix=function(e){if(typeof e!=="undefined"){this.hasAuthorityPrefixUserPref=e}if(this.hasAuthorityPrefixUserPref===null){return this.uriParts.source.indexOf("//")!==-1}else{return this.hasAuthorityPrefixUserPref}};r.prototype.isColonUri=function(e){if(typeof e!=="undefined"){this.uriParts.isColonUri=!!e}else{return!!this.uriParts.isColonUri}};r.prototype.query=function(e){var t="",i,s,r;if(typeof e!=="undefined"){this.queryPairs=n(e)}for(i=0,r=this.queryPairs.length;i<r;i++){s=this.queryPairs[i];if(t.length>0){t+="&"}if(s[1]===null){t+=s[0]}else{t+=s[0];t+="=";if(typeof s[1]!=="undefined"){t+=encodeURIComponent(s[1])}}}return t.length>0?"?"+t:t};r.prototype.getQueryParamValue=function(e){var t,i,s;for(i=0,s=this.queryPairs.length;i<s;i++){t=this.queryPairs[i];if(e===t[0]){return t[1]}}};r.prototype.getQueryParamValues=function(e){var t=[],i,s,n;for(i=0,n=this.queryPairs.length;i<n;i++){s=this.queryPairs[i];if(e===s[0]){t.push(s[1])}}return t};r.prototype.deleteQueryParam=function(e,t){var s=[],n,r,a,o,l;for(n=0,l=this.queryPairs.length;n<l;n++){r=this.queryPairs[n];a=i(r[0])===i(e);o=r[1]===t;if(arguments.length===1&&!a||arguments.length===2&&(!a||!o)){s.push(r)}}this.queryPairs=s;return this};r.prototype.addQueryParam=function(e,t,i){if(arguments.length===3&&i!==-1){i=Math.min(i,this.queryPairs.length);this.queryPairs.splice(i,0,[e,t])}else if(arguments.length>0){this.queryPairs.push([e,t])}return this};r.prototype.hasQueryParam=function(e){var t,i=this.queryPairs.length;for(t=0;t<i;t++){if(this.queryPairs[t][0]==e)return true}return false};r.prototype.replaceQueryParam=function(e,t,s){var n=-1,r=this.queryPairs.length,a,o;if(arguments.length===3){for(a=0;a<r;a++){o=this.queryPairs[a];if(i(o[0])===i(e)&&decodeURIComponent(o[1])===i(s)){n=a;break}}if(n>=0){this.deleteQueryParam(e,i(s)).addQueryParam(e,t,n)}}else{for(a=0;a<r;a++){o=this.queryPairs[a];if(i(o[0])===i(e)){n=a;break}}this.deleteQueryParam(e);this.addQueryParam(e,t,n)}return this};["protocol","hasAuthorityPrefix","isColonUri","userInfo","host","port","path","query","anchor"].forEach(function(e){var t="set"+e.charAt(0).toUpperCase()+e.slice(1);r.prototype[t]=function(t){this[e](t);return this}});r.prototype.scheme=function(){var e="";if(this.protocol()){e+=this.protocol();if(this.protocol().indexOf(":")!==this.protocol().length-1){e+=":"}e+="//"}else{if(this.hasAuthorityPrefix()&&this.host()){e+="//"}}return e};r.prototype.origin=function(){var e=this.scheme();if(this.userInfo()&&this.host()){e+=this.userInfo();if(this.userInfo().indexOf("@")!==this.userInfo().length-1){e+="@"}}if(this.host()){e+=this.host();if(this.port()||this.path()&&this.path().substr(0,1).match(/[0-9]/)){e+=":"+this.port()}}return e};r.prototype.addTrailingSlash=function(){var e=this.path()||"";if(e.substr(-1)!=="/"){this.path(e+"/")}return this};r.prototype.toString=function(){var e,i=this.origin();if(this.isColonUri()){if(this.path()){i+=":"+this.path()}}else if(this.path()){e=this.path();if(!(t.ends_with_slashes.test(i)||t.starts_with_slashes.test(e))){i+="/"}else{if(i){i.replace(t.ends_with_slashes,"/")}e=e.replace(t.starts_with_slashes,"/")}i+=e}else{if(this.host()&&(this.query().toString()||this.anchor())){i+="/"}}if(this.query().toString()){i+=this.query().toString()}if(this.anchor()){if(this.anchor().indexOf("#")!==0){i+="#"}i+=this.anchor()}return i};r.prototype.clone=function(){return new r(this.toString())};if(typeof define==="function"&&define.amd){define(function(){return r})}else if(typeof module!=="undefined"&&typeof module.exports!=="undefined"){module.exports=r}else{e.Uri=r}})(this);(function(e,t){var i=0,s=/^ui-id-\d+$/;e.ui=e.ui||{};e.extend(e.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});e.fn.extend({focus:function(t){return function(i,s){return typeof i==="number"?this.each(function(){var t=this;setTimeout(function(){e(t).focus();if(s){s.call(t)}},i)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;if(e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))){t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0)}else{t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0)}return/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t){return this.css("zIndex",i)}if(this.length){var s=e(this[0]),n,r;while(s.length&&s[0]!==document){n=s.css("position");if(n==="absolute"||n==="relative"||n==="fixed"){r=parseInt(s.css("zIndex"),10);if(!isNaN(r)&&r!==0){return r}}s=s.parent()}}return 0},uniqueId:function(){return this.each(function(){if(!this.id){this.id="ui-id-"+ ++i}})},removeUniqueId:function(){return this.each(function(){if(s.test(this.id)){e(this).removeAttr("id")}})}});function n(t,i){var s,n,a,o=t.nodeName.toLowerCase();if("area"===o){s=t.parentNode;n=s.name;if(!t.href||!n||s.nodeName.toLowerCase()!=="map"){return false}a=e("img[usemap=#"+n+"]")[0];return!!a&&r(a)}return(/input|select|textarea|button|object/.test(o)?!t.disabled:"a"===o?t.href||i:i)&&r(t)}function r(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return e.css(this,"visibility")==="hidden"}).length}e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var i=e.attr(t,"tabindex"),s=isNaN(i);return(s||i>=0)&&n(t,!s)}});if(!e("<a>").outerWidth(1).jquery){e.each(["Width","Height"],function(i,s){var n=s==="Width"?["Left","Right"]:["Top","Bottom"],r=s.toLowerCase(),a={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};function o(t,i,s,r){e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0;if(s){i-=parseFloat(e.css(t,"border"+this+"Width"))||0}if(r){i-=parseFloat(e.css(t,"margin"+this))||0}});return i}e.fn["inner"+s]=function(i){if(i===t){return a["inner"+s].call(this)}return this.each(function(){e(this).css(r,o(this,i)+"px")})};e.fn["outer"+s]=function(t,i){if(typeof t!=="number"){return a["outer"+s].call(this,t)}return this.each(function(){e(this).css(r,o(this,t,true,i)+"px")})}})}if(!e.fn.addBack){e.fn.addBack=function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}if(e("<a>").data("a-b","a").removeData("a-b").data("a-b")){e.fn.removeData=function(t){return function(i){if(arguments.length){return t.call(this,e.camelCase(i))}else{return t.call(this)}}}(e.fn.removeData)}e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());e.support.selectstart="onselectstart"in document.createElement("div");e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});e.extend(e.ui,{plugin:{add:function(t,i,s){var n,r=e.ui[t].prototype;for(n in s){r.plugins[n]=r.plugins[n]||[];r.plugins[n].push([i,s[n]])}},call:function(e,t,i){var s,n=e.plugins[t];if(!n||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11){return}for(s=0;s<n.length;s++){if(e.options[n[s][0]]){n[s][1].apply(e.element,i)}}}},hasScroll:function(t,i){if(e(t).css("overflow")==="hidden"){return false}var s=i&&i==="left"?"scrollLeft":"scrollTop",n=false;if(t[s]>0){return true}t[s]=1;n=t[s]>0;t[s]=0;return n}})})(jQuery);(function(e,t){var i=0,s=Array.prototype.slice,n=e.cleanData;e.cleanData=function(t){for(var i=0,s;(s=t[i])!=null;i++){try{e(s).triggerHandler("remove")}catch(r){}}n(t)};e.widget=function(t,i,s){var n,r,a,o,l={},u=t.split(".")[0];t=t.split(".")[1];n=u+"-"+t;if(!s){s=i;i=e.Widget}e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)};e[u]=e[u]||{};r=e[u][t];a=e[u][t]=function(e,t){if(!this._createWidget){return new a(e,t)}if(arguments.length){this._createWidget(e,t)}};e.extend(a,r,{version:s.version,_proto:e.extend({},s),_childConstructors:[]});o=new i;o.options=e.widget.extend({},o.options);e.each(s,function(t,s){if(!e.isFunction(s)){l[t]=s;return}l[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t=this._super,i=this._superApply,r;this._super=e;this._superApply=n;r=s.apply(this,arguments);this._super=t;this._superApply=i;return r}}()});a.prototype=e.widget.extend(o,{widgetEventPrefix:r?o.widgetEventPrefix:t},l,{constructor:a,namespace:u,widgetName:t,widgetFullName:n});if(r){e.each(r._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,a,i._proto)});delete r._childConstructors}else{i._childConstructors.push(a)}e.widget.bridge(t,a)};e.widget.extend=function(i){var n=s.call(arguments,1),r=0,a=n.length,o,l;for(;r<a;r++){for(o in n[r]){l=n[r][o];if(n[r].hasOwnProperty(o)&&l!==t){if(e.isPlainObject(l)){i[o]=e.isPlainObject(i[o])?e.widget.extend({},i[o],l):e.widget.extend({},l)}else{i[o]=l}}}}return i};e.widget.bridge=function(i,n){var r=n.prototype.widgetFullName||i;e.fn[i]=function(a){var o=typeof a==="string",l=s.call(arguments,1),u=this;a=!o&&l.length?e.widget.extend.apply(null,[a].concat(l)):a;if(o){this.each(function(){var s,n=e.data(this,r);if(!n){return e.error("cannot call methods on "+i+" prior to initialization; "+"attempted to call method '"+a+"'")}if(!e.isFunction(n[a])||a.charAt(0)==="_"){
return e.error("no such method '"+a+"' for "+i+" widget instance")}s=n[a].apply(n,l);if(s!==n&&s!==t){u=s&&s.jquery?u.pushStack(s.get()):s;return false}})}else{this.each(function(){var t=e.data(this,r);if(t){t.option(a||{})._init()}else{e.data(this,r,new n(a,this))}})}return u}};e.Widget=function(){};e.Widget._childConstructors=[];e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(t,s){s=e(s||this.defaultElement||this)[0];this.element=e(s);this.uuid=i++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=e.widget.extend({},this.options,this._getCreateOptions(),t);this.bindings=e();this.hoverable=e();this.focusable=e();if(s!==this){e.data(s,this.widgetFullName,this);this._on(true,this.element,{remove:function(e){if(e.target===s){this.destroy()}}});this.document=e(s.style?s.ownerDocument:s.document||s);this.window=e(this.document[0].defaultView||this.document[0].parentWindow)}this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(i,s){var n=i,r,a,o;if(arguments.length===0){return e.widget.extend({},this.options)}if(typeof i==="string"){n={};r=i.split(".");i=r.shift();if(r.length){a=n[i]=e.widget.extend({},this.options[i]);for(o=0;o<r.length-1;o++){a[r[o]]=a[r[o]]||{};a=a[r[o]]}i=r.pop();if(s===t){return a[i]===t?null:a[i]}a[i]=s}else{if(s===t){return this.options[i]===t?null:this.options[i]}n[i]=s}}this._setOptions(n);return this},_setOptions:function(e){var t;for(t in e){this._setOption(t,e[t])}return this},_setOption:function(e,t){this.options[e]=t;if(e==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_on:function(t,i,s){var n,r=this;if(typeof t!=="boolean"){s=i;i=t;t=false}if(!s){s=i;i=this.element;n=this.widget()}else{i=n=e(i);this.bindings=this.bindings.add(i)}e.each(s,function(s,a){function o(){if(!t&&(r.options.disabled===true||e(this).hasClass("ui-state-disabled"))){return}return(typeof a==="string"?r[a]:a).apply(r,arguments)}if(typeof a!=="string"){o.guid=a.guid=a.guid||o.guid||e.guid++}var l=s.match(/^(\w+)\s*(.*)$/),u=l[1]+r.eventNamespace,h=l[2];if(h){n.delegate(h,u,o)}else{i.bind(u,o)}})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return(typeof e==="string"?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t);this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t);this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,r,a=this.options[t];s=s||{};i=e.Event(i);i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase();i.target=this.element[0];r=i.originalEvent;if(r){for(n in r){if(!(n in i)){i[n]=r[n]}}}this.element.trigger(i,s);return!(e.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===false||i.isDefaultPrevented())}};e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,r){if(typeof n==="string"){n={effect:n}}var a,o=!n?t:n===true||typeof n==="number"?i:n.effect||i;n=n||{};if(typeof n==="number"){n={duration:n}}a=!e.isEmptyObject(n);n.complete=r;if(n.delay){s.delay(n.delay)}if(a&&e.effects&&e.effects.effect[o]){s[t](n)}else if(o!==t&&s[o]){s[o](n.duration,n.easing,r)}else{s.queue(function(i){e(this)[t]();if(r){r.call(s[0])}i()})}}})})(jQuery);(function(e,t){var i=false;e(document).mouseup(function(){i=false});e.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){if(true===e.data(i.target,t.widgetName+".preventClickEvent")){e.removeData(i.target,t.widgetName+".preventClickEvent");i.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate){e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)}},_mouseDown:function(t){if(i){return}this._mouseStarted&&this._mouseUp(t);this._mouseDownEvent=t;var s=this,n=t.which===1,r=typeof this.options.cancel==="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:false;if(!n||r||!this._mouseCapture(t)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){s.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==false;if(!this._mouseStarted){t.preventDefault();return true}}if(true===e.data(t.target,this.widgetName+".preventClickEvent")){e.removeData(t.target,this.widgetName+".preventClickEvent")}this._mouseMoveDelegate=function(e){return s._mouseMove(e)};this._mouseUpDelegate=function(e){return s._mouseUp(e)};e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);t.preventDefault();i=true;return true},_mouseMove:function(t){if(e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button){return this._mouseUp(t)}if(this._mouseStarted){this._mouseDrag(t);return t.preventDefault()}if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==false;this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)}return!this._mouseStarted},_mouseUp:function(t){e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(t.target===this._mouseDownEvent.target){e.data(t.target,this.widgetName+".preventClickEvent",true)}this._mouseStop(t)}return false},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}})})(jQuery);(function(e,t){function i(e,t,i){return e>t&&e<t+i}function s(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?e.axis==="x"||s(this.items[0].item):false;this.offset=this.element.offset();this._mouseInit();this.ready=true},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled");this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--){this.items[e].item.removeData(this.widgetName+"-item")}return this},_setOption:function(t,i){if(t==="disabled"){this.options[t]=i;this.widget().toggleClass("ui-sortable-disabled",!!i)}else{e.Widget.prototype._setOption.apply(this,arguments)}},_mouseCapture:function(t,i){var s=null,n=false,r=this;if(this.reverting){return false}if(this.options.disabled||this.options.type==="static"){return false}this._refreshItems(t);e(t.target).parents().each(function(){if(e.data(this,r.widgetName+"-item")===r){s=e(this);return false}});if(e.data(t.target,r.widgetName+"-item")===r){s=e(t.target)}if(!s){return false}if(this.options.handle&&!i){e(this.options.handle,s).find("*").addBack().each(function(){if(this===t.target){n=true}});if(!n){return false}}this.currentItem=s;this._removeCurrentsFromItems();return true},_mouseStart:function(t,i,s){var n,r,a=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(t);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(t);this.originalPageX=t.pageX;this.originalPageY=t.pageY;a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt);this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!==this.currentItem[0]){this.currentItem.hide()}this._createPlaceholder();if(a.containment){this._setContainment()}if(a.cursor&&a.cursor!=="auto"){r=this.document.find("body");this.storedCursor=r.css("cursor");r.css("cursor",a.cursor);this.storedStylesheet=e("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(r)}if(a.opacity){if(this.helper.css("opacity")){this._storedOpacity=this.helper.css("opacity")}this.helper.css("opacity",a.opacity)}if(a.zIndex){if(this.helper.css("zIndex")){this._storedZIndex=this.helper.css("zIndex")}this.helper.css("zIndex",a.zIndex)}if(this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"){this.overflowOffset=this.scrollParent.offset()}this._trigger("start",t,this._uiHash());if(!this._preserveHelperProportions){this._cacheHelperProportions()}if(!s){for(n=this.containers.length-1;n>=0;n--){this.containers[n]._trigger("activate",t,this._uiHash(this))}}if(e.ui.ddmanager){e.ui.ddmanager.current=this}if(e.ui.ddmanager&&!a.dropBehaviour){e.ui.ddmanager.prepareOffsets(this,t)}this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(t);return true},_mouseDrag:function(t){var i,s,n,r,a=this.options,o=false;this.position=this._generatePosition(t);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs}if(this.options.scroll){if(this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"){if(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<a.scrollSensitivity){this.scrollParent[0].scrollTop=o=this.scrollParent[0].scrollTop+a.scrollSpeed}else if(t.pageY-this.overflowOffset.top<a.scrollSensitivity){this.scrollParent[0].scrollTop=o=this.scrollParent[0].scrollTop-a.scrollSpeed}if(this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<a.scrollSensitivity){this.scrollParent[0].scrollLeft=o=this.scrollParent[0].scrollLeft+a.scrollSpeed}else if(t.pageX-this.overflowOffset.left<a.scrollSensitivity){this.scrollParent[0].scrollLeft=o=this.scrollParent[0].scrollLeft-a.scrollSpeed}}else{if(t.pageY-e(document).scrollTop()<a.scrollSensitivity){o=e(document).scrollTop(e(document).scrollTop()-a.scrollSpeed)}else if(e(window).height()-(t.pageY-e(document).scrollTop())<a.scrollSensitivity){o=e(document).scrollTop(e(document).scrollTop()+a.scrollSpeed)}if(t.pageX-e(document).scrollLeft()<a.scrollSensitivity){o=e(document).scrollLeft(e(document).scrollLeft()-a.scrollSpeed)}else if(e(window).width()-(t.pageX-e(document).scrollLeft())<a.scrollSensitivity){o=e(document).scrollLeft(e(document).scrollLeft()+a.scrollSpeed)}}if(o!==false&&e.ui.ddmanager&&!a.dropBehaviour){e.ui.ddmanager.prepareOffsets(this,t)}}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!=="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!=="x"){this.helper[0].style.top=this.position.top+"px"}for(i=this.items.length-1;i>=0;i--){s=this.items[i];n=s.item[0];r=this._intersectsWithPointer(s);if(!r){continue}if(s.instance!==this.currentContainer){continue}if(n!==this.currentItem[0]&&this.placeholder[r===1?"next":"prev"]()[0]!==n&&!e.contains(this.placeholder[0],n)&&(this.options.type==="semi-dynamic"?!e.contains(this.element[0],n):true)){this.direction=r===1?"down":"up";if(this.options.tolerance==="pointer"||this._intersectsWithSides(s)){this._rearrange(t,s)}else{break}this._trigger("change",t,this._uiHash());break}}this._contactContainers(t);if(e.ui.ddmanager){e.ui.ddmanager.drag(this,t)}this._trigger("sort",t,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function(t,i){if(!t){return}if(e.ui.ddmanager&&!this.options.dropBehaviour){e.ui.ddmanager.drop(this,t)}if(this.options.revert){var s=this,n=this.placeholder.offset(),r=this.options.axis,a={};if(!r||r==="x"){a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)}if(!r||r==="y"){a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)}this.reverting=true;e(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else{this._clear(t,i)}return false},cancel:function(){if(this.dragging){this._mouseUp({target:null});if(this.options.helper==="original"){this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else{this.currentItem.show()}for(var t=this.containers.length-1;t>=0;t--){this.containers[t]._trigger("deactivate",null,this._uiHash(this));if(this.containers[t].containerCache.over){this.containers[t]._trigger("out",null,this._uiHash(this));this.containers[t].containerCache.over=0}}}if(this.placeholder){if(this.placeholder[0].parentNode){this.placeholder[0].parentNode.removeChild(this.placeholder[0])}if(this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode){this.helper.remove()}e.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){e(this.domPosition.prev).after(this.currentItem)}else{e(this.domPosition.parent).prepend(this.currentItem)}}return this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];t=t||{};e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);if(i){s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}});if(!s.length&&t.key){s.push(t.key+"=")}return s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];t=t||{};i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")});return s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,r=e.left,a=r+e.width,o=e.top,l=o+e.height,u=this.offset.click.top,h=this.offset.click.left,c=this.options.axis==="x"||s+u>o&&s+u<l,d=this.options.axis==="y"||t+h>r&&t+h<a,f=c&&d;if(this.options.tolerance==="pointer"||this.options.forcePointerForContainers||this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]){return f}else{return r<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<a&&o<s+this.helperProportions.height/2&&n-this.helperProportions.height/2<l}},_intersectsWithPointer:function(e){var t=this.options.axis==="x"||i(this.positionAbs.top+this.offset.click.top,e.top,e.height),s=this.options.axis==="y"||i(this.positionAbs.left+this.offset.click.left,e.left,e.width),n=t&&s,r=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();if(!n){return false}return this.floating?a&&a==="right"||r==="down"?2:1:r&&(r==="down"?2:1)},_intersectsWithSides:function(e){var t=i(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),s=i(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),n=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();if(this.floating&&r){return r==="right"&&s||r==="left"&&!s}else{return n&&(n==="down"&&t||n==="up"&&!t)}},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return e!==0&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return e!==0&&(e>0?"right":"left")},refresh:function(e){this._refreshItems(e);this.refreshPositions();return this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i,s,n,r,a=[],o=[],l=this._connectWith();if(l&&t){for(i=l.length-1;i>=0;i--){n=e(l[i]);for(s=n.length-1;s>=0;s--){r=e.data(n[s],this.widgetFullName);if(r&&r!==this&&!r.options.disabled){o.push([e.isFunction(r.options.items)?r.options.items.call(r.element):e(r.options.items,r.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),r])}}}}o.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(i=o.length-1;i>=0;i--){o[i][0].each(function(){a.push(this)})}return e(a)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;i<t.length;i++){if(t[i]===e.item[0]){return false}}return true})},_refreshItems:function(t){this.items=[];this.containers=[this];var i,s,n,r,a,o,l,u,h=this.items,c=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready){for(i=d.length-1;i>=0;i--){n=e(d[i]);for(s=n.length-1;s>=0;s--){r=e.data(n[s],this.widgetFullName);if(r&&r!==this&&!r.options.disabled){c.push([e.isFunction(r.options.items)?r.options.items.call(r.element[0],t,{item:this.currentItem}):e(r.options.items,r.element),r]);this.containers.push(r)}}}}for(i=c.length-1;i>=0;i--){a=c[i][1];o=c[i][0];for(s=0,u=o.length;s<u;s++){l=e(o[s]);l.data(this.widgetName+"-item",a);h.push({item:l,instance:a,width:0,height:0,left:0,top:0})}}},refreshPositions:function(t){if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset()}var i,s,n,r;for(i=this.items.length-1;i>=0;i--){s=this.items[i];if(s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]){continue}n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item;if(!t){s.width=n.outerWidth();s.height=n.outerHeight()}r=n.offset();s.left=r.left;s.top=r.top}if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this)}else{for(i=this.containers.length-1;i>=0;i--){r=this.containers[i].element.offset();this.containers[i].containerCache.left=r.left;this.containers[i].containerCache.top=r.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}}return this},_createPlaceholder:function(t){t=t||this;var i,s=t.options;if(!s.placeholder||s.placeholder.constructor===String){i=s.placeholder;s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");if(s==="tr"){t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(n)})}else if(s==="img"){n.attr("src",t.currentItem.attr("src"))}if(!i){n.css("visibility","hidden")}return n},update:function(e,n){if(i&&!s.forcePlaceholderSize){return}if(!n.height()){n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10))}if(!n.width()){n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10))}}}}t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem));t.currentItem.after(t.placeholder);s.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var n,r,a,o,l,u,h,c,d,f,p=null,_=null;for(n=this.containers.length-1;n>=0;n--){if(e.contains(this.currentItem[0],this.containers[n].element[0])){continue}if(this._intersectsWith(this.containers[n].containerCache)){if(p&&e.contains(this.containers[n].element[0],p.element[0])){continue}p=this.containers[n];_=n}else{if(this.containers[n].containerCache.over){this.containers[n]._trigger("out",t,this._uiHash(this));this.containers[n].containerCache.over=0}}}if(!p){return}if(this.containers.length===1){if(!this.containers[_].containerCache.over){this.containers[_]._trigger("over",t,this._uiHash(this));this.containers[_].containerCache.over=1}}else{a=1e4;o=null;f=p.floating||s(this.currentItem);l=f?"left":"top";u=f?"width":"height";h=this.positionAbs[l]+this.offset.click[l];for(r=this.items.length-1;r>=0;r--){if(!e.contains(this.containers[_].element[0],this.items[r].item[0])){continue}if(this.items[r].item[0]===this.currentItem[0]){continue}if(f&&!i(this.positionAbs.top+this.offset.click.top,this.items[r].top,this.items[r].height)){continue}c=this.items[r].item.offset()[l];d=false;if(Math.abs(c-h)>Math.abs(c+this.items[r][u]-h)){d=true;c+=this.items[r][u]}if(Math.abs(c-h)<a){a=Math.abs(c-h);o=this.items[r];this.direction=d?"up":"down"}}if(!o&&!this.options.dropOnEmpty){return}if(this.currentContainer===this.containers[_]){return}o?this._rearrange(t,o,null,true):this._rearrange(t,null,this.containers[_].element,true);this._trigger("change",t,this._uiHash());this.containers[_]._trigger("change",t,this._uiHash(this));this.currentContainer=this.containers[_];this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[_]._trigger("over",t,this._uiHash(this));this.containers[_].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):i.helper==="clone"?this.currentItem.clone():this.currentItem;if(!s.parents("body").length){e(i.appendTo!=="parent"?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0])}if(s[0]===this.currentItem[0]){this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}}if(!s[0].style.width||i.forceHelperSize){s.width(this.currentItem.width())}if(!s[0].style.height||i.forceHelperSize){s.height(this.currentItem.height())}return s},_adjustOffsetFromHelper:function(t){if(typeof t==="string"){t=t.split(" ")}if(e.isArray(t)){t={left:+t[0],top:+t[1]||0}}if("left"in t){this.offset.click.left=t.left+this.margins.left}if("right"in t){this.offset.click.left=this.helperProportions.width-t.right+this.margins.left}if("top"in t){this.offset.click.top=t.top+this.margins.top}if("bottom"in t){this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();if(this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])){t.left+=this.scrollParent.scrollLeft();t.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&e.ui.ie){t={top:0,left:0}}return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options;if(n.containment==="parent"){n.containment=this.helper[0].parentNode}if(n.containment==="document"||n.containment==="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e(n.containment==="document"?document:window).width()-this.helperProportions.width-this.margins.left,(e(n.containment==="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!/^(document|window|parent)$/.test(n.containment)){t=e(n.containment)[0];i=e(n.containment).offset();s=e(t).css("overflow")!=="hidden";this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,i){if(!i){i=this.position}var s=t==="absolute"?1:-1,n=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,r=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():r?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():r?0:n.scrollLeft())*s}},_generatePosition:function(t){var i,s,n=this.options,r=t.pageX,a=t.pageY,o=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,l=/(html|body)/i.test(o[0].tagName);if(this.cssPosition==="relative"&&!(this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0])){this.offset.relative=this._getRelativeOffset()}if(this.originalPosition){if(this.containment){if(t.pageX-this.offset.click.left<this.containment[0]){r=this.containment[0]+this.offset.click.left}if(t.pageY-this.offset.click.top<this.containment[1]){a=this.containment[1]+this.offset.click.top}if(t.pageX-this.offset.click.left>this.containment[2]){r=this.containment[2]+this.offset.click.left}if(t.pageY-this.offset.click.top>this.containment[3]){a=this.containment[3]+this.offset.click.top}}if(n.grid){i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1];a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i;s=this.originalPageX+Math.round((r-this.originalPageX)/n.grid[0])*n.grid[0];r=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s}}return{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():l?0:o.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():l?0:o.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction==="down"?t.item[0]:t.item[0].nextSibling);this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){if(n===this.counter){this.refreshPositions(!s)}})},_clear:function(e,t){this.reverting=false;var i,s=[];if(!this._noFinalSort&&this.currentItem.parent().length){this.placeholder.before(this.currentItem)}this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(i in this._storedCSS){if(this._storedCSS[i]==="auto"||this._storedCSS[i]==="static"){this._storedCSS[i]=""}}this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else{this.currentItem.show()}if(this.fromOutside&&!t){s.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))})}if((this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!t){s.push(function(e){this._trigger("update",e,this._uiHash())})}if(this!==this.currentContainer){if(!t){s.push(function(e){this._trigger("remove",e,this._uiHash())});s.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer));s.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer))}}for(i=this.containers.length-1;i>=0;i--){if(!t){s.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[i]))}if(this.containers[i].containerCache.over){s.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[i]));this.containers[i].containerCache.over=0}}if(this.storedCursor){this.document.find("body").css("cursor",this.storedCursor);this.storedStylesheet.remove()}if(this._storedOpacity){this.helper.css("opacity",this._storedOpacity)}if(this._storedZIndex){this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex)}this.dragging=false;if(this.cancelHelperRemoval){if(!t){this._trigger("beforeStop",e,this._uiHash());for(i=0;i<s.length;i++){s[i].call(this,e)}this._trigger("stop",e,this._uiHash())}this.fromOutside=false;return false}if(!t){this._trigger("beforeStop",e,this._uiHash())}this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!==this.currentItem[0]){this.helper.remove()}this.helper=null;if(!t){for(i=0;i<s.length;i++){s[i].call(this,e)}this._trigger("stop",e,this._uiHash())}this.fromOutside=false;return true},_trigger:function(){if(e.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel()}},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,
sender:t?t.element:null}}})})(jQuery);SM.Model={__create:function(e){},__validators:undefined,__setters:undefined,__getters:undefined,__counter:0,__defaults:undefined,__initSettings:function(e){var t,i;this.__settings={};if(e){i={};for(t in this.__defaults){if(this.__defaults.hasOwnProperty(t)&&e.hasOwnProperty(t)){i[t]=e[t]}}this.__settings=SM.Object.extend(this.__defaults,i)}else if(this.__defaults){this.__settings=SM.Object.copy(this.__defaults)}},get:function(e,t){var i=this.__getters;if(e===undefined){return}if(i&&i[e]){return i[e](this,t)}else{return this[e]}},set:function(e,t,i){var s=this.__setters,n=this[e],r={notify:false,validate:false},a;if(i){a=SM.Object.extend(r,i)}else{a=r}if(a.validate&&!this.validate(e,t)){return this}if(s&&s[e]){s[e](this,t,a)}else{this[e]=t}if(a.notify){if(t!==n){this._trigger({type:e+".changed",property:e,old:n,value:t})}this._trigger({type:e+".set",property:e,old:n,value:t})}return this},on:function(e,t,i){if(arguments.length<3){throw new Error("model.bind requires three arguments")}else if(!e||!t||!i){throw new Error("model.bind must be passed an event, data, and callback")}this._$.on(e,t,i);return this},off:function(e,t){this._$.off(e,t)},validateKeyValue:function(e,t){var i=this.__validators[e]?this.__validators[e](this,t):{isValid:true};if(!i.isValid){i.property=e;i.value=t;return i}return{isValid:true}},validateGroup:function(e){var t,i,s={isValid:true,invalids:{}};for(t in e){if(!e.hasOwnProperty(t)){continue}i=this.validateKeyValue(t,e[t]);if(!i.isValid){s.isValid=false;s.invalids[t]=i}}return s},validate:function(){var e=this,t=this.__validators,i,s,n,r;if(t){if(arguments.length===0){i=this.validateGroup(this._getValidatables())}else if(arguments.length===1){if(typeof arguments[0]==="string"){s={};r=arguments[0];n=this.state[r];s[r]=n;i=this.validateGroup(s)}else if(typeof arguments[0]==="object"){i=this.validateGroup(arguments[0])}}else if(arguments.length===2){s={};r=arguments[0];n=arguments[1];s[r]=n;i=this.validateGroup(s)}}else{i=this.validateGroup({})}if(!i.isValid){this._trigger({type:"validated",validations:i})}return i},_trigger:function(e){var t={};try{if(e===null||e===undefined){throw new Error("model._trigger: triggering a null or undefined event")}if(typeof e==="string"){t.type=e}else{if(e.type===null||e.type===undefined){throw new Error("model._trigger: triggering a null or undefined event")}t=e}this._$.trigger(t)}catch(i){SM.Error.log(i,"Error model triggering "+t.type)}return this},_getValidatables:function(){var e,t={},i=this.__validators;for(e in i){t[e]=this.get(e)}return t}};SM.Models={_models:{},_types:{},create:function(e,t){var i,s,n;if(e===undefined){throw new Error("a model name is required to create an instance")}s=e+"Model";n=SM[s];if(n===undefined){throw new Error("attempted to create an unregistered model name: "+s)}return this._create(n,t)},register:function(e,t){var i;if(arguments.length!==2){throw new Error("a string model name and model prototype is required to register a model")}if(e===undefined||typeof e!=="string"){throw new Error("a string model name is required to register a model")}i=e+"Model";if(SM[i]!==undefined){throw new Error("a model of this type has already been registered")}SM[i]=SM.Object.extend(SM.Model,t);SM[i].__counter=0;SM[i].__NAME=e;return SM[i]},extend:function(e,t,i){var s=SM.Object.deepExtend(t,i);return this.register(e,s)},_create:function(e,t){var i=SM.Object.create(e);i._$=$({});i.__initSettings(t);i.__uid=e.__counter++;t=t||{};i.__create(t);return i}};SM.log=function(e){if(SM.DEBUG){if(window.console){if(console&&console.log&&console.log.apply){console.log.apply(console,arguments)}else if(console&&console.log){Function.apply.apply(console.log,[null,arguments])}}}};SM.Date={getDaysInMonth:function(e,t){var i=this;return 32-new Date(t,e,32).getDate()},getSimpleDate:function(e){if(!e){return{}}return{month:e.getMonth(),year:e.getFullYear(),day:e.getDate()}},timestamp:function(){return(new Date).getTime()},toISOString:function(e){var t=function(e){return e<10?"0"+e:e};if(!Date.prototype.toISOString){return[this.getUTCFullYear(),"-",t(this.getUTCMonth()+1),"-",t(this.getUTCDate()),"T",t(this.getUTCHours()),":",t(this.getUTCMinutes()),":",t(this.getUTCSeconds()),"Z"].join("")}else{return e.toISOString()}},stdTimezoneOffset:function(){var e=new Date,t=e.getFullYear(),i=new Date(t,0,1),s=new Date(t,6,1);return Math.max(i.getTimezoneOffset(),s.getTimezoneOffset())},utcOffset:function(){return(new Date).getTimezoneOffset()*-6e4},toAge:function(e){var t,i,s,n,r,a,o,l;r=Math.floor(e/1e3);t=r%60;a=Math.floor(r/60);i=a%60;o=Math.floor(a/60);s=o%24;l=Math.floor(o/24);n=l%365;return{seconds:t,minutes:i,hours:s,days:n}},ageToMilliseconds:function(e){var t=e.split(" "),i,s=0,n,r,a,o=0;for(;s<t.length;s++){n=t[s];r=parseInt(n,10),a=n.charAt(n.length-1);a=this._millisecondMap[a];if(a){o+=r*a}}return o},formatDigitalTime:function(e,t,i){var s="";s=this._addDigitalTimeString(s,e)+":";s=this._addDigitalTimeString(s,t)+":";return this._addDigitalTimeString(s,i)},_millisecondMap:{s:1e3,m:1e3*60,h:1e3*60*60,d:1e3*60*60*24,o:1e3*60*60*24*30,y:1e3*60*60*24*365},_addDigitalTimeString:function(e,t){if(t>9){e=e+t}else if(t>0){e=e+"0"+t}else{e=e+"00"}return e}};(function(){var e;jQuery.event.special.leave={add:function(t){var i=t.handler,s=this,n=this;if(!e){e=$(document)}t.handler=function(e){if(e.type===SM.Event.FOCUSIN){if(!SM.DOM.contains(n,e.target)&&e.target.tagName.toLowerCase()!=="body"){i.apply(this,arguments)}}if(e.type===SM.Event.CLICK){if(!SM.DOM.contains(n,e.target)){i.apply(this,arguments)}}};setTimeout(function(){e.on(SM.Event.FOCUSIN+"."+t.guid,t.data,t.handler).on(SM.Event.CLICK+"."+t.guid,t.data,t.handler)},0)},remove:function(t){e.off(SM.Event.FOCUSIN+"."+t.guid).off(SM.Event.CLICK+"."+t.guid)}}})();SM.Cookies={get:function(e){var t=this.getAll();return t[e]},set:function(e,t,i,s){var n,r;s=SM.Object.extend({path:"/"},s);if(typeof i==="string"){r=SM.Date.ageToMilliseconds(i)}else{r=i}n=new Date;n.setTime(n.getTime()+r);i=n.toGMTString();document.cookie=[e+"="+t,"expires="+i,"path="+s.path].join("; ");return this},remove:function(e,t){t=SM.Object.extend({path:"/"},t);return this.set(e,"","-1s",t)},getAll:function(){var e={},t,i=document.cookie.split(";");$.each(i,function(i,s){s=$.trim(s);t=s.split("=");if(t.length===2){e[t[0]]=t[1]}});return e}};(function(e){function t(e){var t=e.split("."),i=t.length,s=0,n=t[i-2],r=[],a;if(i>2){for(;s<i-2;s++){a=t[s];r.push(a)}}return[].concat(n).concat(r)}Uri.prototype.getDomains=function(){this.uriParts.domains=this.uriParts.domains||t(this.uriParts.host);return this.uriParts.domains};Uri.prototype.getRootDomain=function(){var e=this.getDomains();return e[0]};Uri.prototype.getSubDomains=function(){var e=this.getDomains();return e.slice(1,e.length)}})(this);SM.BaseMenuView=SM.Views.register({__NAME:"baseMenuView",__templateID:"base-menu-template"});SM.OptionMenuView=SM.Object.deepExtend({__init:function(){this.bind("focusin",".option",this._onFocusIn).bind("mouseenter",".option",this._onOptionMouseEnter).bind("mouseleave",this._onMouseLeave)},__setters:{currentIndex:function(e,t){e._$options.removeClass("current");if(t===-1){e._$currentOption=null}else{e._$currentOption=e._$options.eq(t).addClass("current")}e._currentIndex=t;e.focusOption(e._currentIndex)},selectedIndex:function(e,t){e._setSelectedIndex(t)}},__getters:{currentIndex:function(e,t){return e._currentIndex}},nextCurrent:function(){var e=this._currentIndex;if(e<this._optionCount-1){this.set("currentIndex",e+1);this.scrollToItem(this._currentIndex)}},prevCurrent:function(){var e=this._currentIndex;if(e>0){this.set("currentIndex",e-1);this.scrollToItem(this._currentIndex)}},selectCurrent:function(){if(this._$currentOption){this._$currentOption.click()}},_$selectedOption:undefined,_$currentOption:undefined,_$options:undefined,_currentIndex:-1,_selectedIndex:-1,_optionCount:0,_refreshOptionData:function(){this._$options=this.$el.find(".option").not(".disabled");this._optionCount=this._$options.length;return this},_setSelectedIndex:function(e){this._$options.removeClass("selected");if(e>=0&&e<this._optionCount){this._$selectedOption=this._$options.eq(e).addClass("selected")}else{this._$selectedOption=undefined}this._selectedIndex=e;return this},scrollToItem:function(e){var t=this.el,i=this._$options.eq(e).parent()[0];if(t.scrollHeight<=t.offsetHeight){return}if(i.offsetTop<t.scrollTop){t.scrollTop=i.offsetTop}else if(i.offsetTop+i.offsetHeight>t.scrollTop+t.clientHeight){t.scrollTop=i.offsetTop+i.offsetHeight-t.clientHeight}return this},focusOption:function(e){var t=this._$options.eq(e);t.focus()},_onOptionMouseEnter:function(e){var t=e.data.self,i=$(this);if(i.hasClass("disabled")){return}t.set("currentIndex",t._$options.index(i))},_onFocusIn:function(e){e.stopPropagation()},_onMouseLeave:function(e){var t=e.data.self;t.set("currentIndex",-1)}});SM.ActionMenuView=SM.Views.deepExtend(SM.OptionMenuView,{__NAME:"actionMenuView",__templateID:"action-menu-template",__init:function(){SM.OptionMenuView.__init.call(this);this.bind("click",".option",this._onOptionClick)},__afterRender:function(){this._refreshOptionData();if(this.__settings.saveState){if(this.__settings.selectedAction){this._setSelectedAction(this.__settings.selectedAction,true)}else{this._setSelectedIndex(-1,true)}}},__setters:{selectedAction:function(e,t){e._setSelectedAction(t,false)},selectedIndex:function(e,t){e._setSelectedIndex(t,false)},actions:function(e,t){e.__settings.actions=t;e.render()}},hasAction:function(e){return this.$el.find('[data-action="'+e+'"]').length>0},actionHasSubMenu:function(e){var t=this._getActionSubmenu(e);return t&&t.actions&&t.actions.length},openSelectedSubmenu:function(){var e=this,t,i=this.__settings.selectedAction,s=this._getActionSubmenu(i),n;if(s&&s.actions&&s.actions.length){t=this.$el.find('[data-action="'+i+'"]');n=t.data("actionMenu");if(!n){s=$.extend({parentMenu:e},s);t.actionMenu(s).on("actionMenu.beforeOpen",function(t){e.trigger({type:"beforeSubmenuOpen",actionSubmenu:n})}).on("actionMenu.afterOpen",function(t){e.trigger({type:"submenuOpened",actionSubmenu:n})}).on("actionMenu.actionSelected",function(t){e.trigger({type:"actionSelected",action:t.action,$action:t.$action})}).on("actionMenu.afterClose",function(){e.trigger("submenuClosed")});n=t.data("actionMenu")}n.open()}},_getActionSubmenu:function(e){var t=this.__settings.actions||[],i;for(i=0;i<t.length;i++){if(t[i].action===e){return t[i].submenu}}return null},_setSelectedAction:function(e,t){var i=-1,s=this.$el.find('[data-action="'+e+'"]');if(s.length){i=this._$options.index(s)}if(this.__settings.saveState){this._setSelectedIndex(i,t)}this.__settings.selectedAction=e;if(!t&&!(i>=0&&this.__settings.saveState)&&!this.actionHasSubMenu(e)){this.trigger({type:"actionSelected",action:e,$action:s})}},_setSelectedIndex:function(e,t){var i;if(this.__settings.saveState){SM.OptionMenuView._setSelectedIndex.call(this,e)}if(e>=0&&e<this._optionCount){i=this._$options.eq(e);this.__settings.selectedAction=i.attr("data-action");if(!t){this.trigger({type:"actionSelected",action:i.attr("data-action"),$action:i})}}},_onOptionClick:function(e){var t=e.data.self,i=$(this),s,n=i.attr("href"),r=i.attr("data-action");if(n){s=n.split("#");if(s.length<2){if(i.hasClass("disabled")){e.preventDefault();e.stopPropagation()}else{t.trigger("optionClicked")}return}}e.preventDefault();e.stopPropagation();if(i.hasClass("disabled")){return}t.set("selectedAction",r);if(t.actionHasSubMenu(r)){t.openSelectedSubmenu()}else{t.trigger("optionClicked")}}});SM.SelectMenuView=SM.Views.deepExtend(SM.OptionMenuView,{__NAME:"SelectMenuView",__templateID:"select-menu-template",__create:function(){if(this.__settings.loadPage){this._loadedOptions=[]}if(this.__settings.loadSearchPage){this._loadedSearchOptions=[]}},__init:function(){SM.OptionMenuView.__init.call(this);this.bind("click keydown",".option",this._onOptionClick);this.bind("focus",".option",this._onOptionFocus);this.bind("click keydown","[data-pageaction]",this._onPagingClick);this.bind("keydown",".search-bar",this._onSearchSubmit);this.bind("click keydown",".search-button",this._onSearchSubmit);this.bind("click keydown",".clear-search",this._onClearSearch)},__afterRender:function(){this._renderMenu()},__setters:{selectedValue:function(e,t){var i=e._getIndexByValue(t),s;if(i!==-1){e._setSelectedIndex(i);e.__settings.selectedValue=t;s=e._getText(t);e.trigger({type:"change",value:t,displayText:s})}},selectedIndex:function(e,t){var i,s;if(t>=0&&t<e._optionCount){e._setSelectedIndex(t);e.__settings.selectedValue=e._getValueByIndex(t);s=e._getText(e.__settings.selectedValue);e.trigger({type:"change",value:e.__settings.selectedValue,displayText:s})}},options:function(e,t){e.__settings.options=t;e.render()}},__getters:{selectedValue:function(e){return e.__settings.selectedValue},valueText:function(e){var t=e.__settings.selectedValue;return e._getText(t)}},VALUE_ATTR:"data-opt-value",inlineSearchOptionsWithSelect:function(e,t){var i=this._optionsText,s=i.length,n=e.length,r=t?this._selectedIndex:this._currentIndex,a;if(!(this.__settings.options||this._isLoaded)){return-1}if(n>1){a=r}else{if(r===-1){a=0}else{a=r+1}}for(a;a<s;a++){if(i[a].substr(0,n)===e){return a}}for(a=0;a<=r;a++){if(i[a].substr(0,n)===e){return a}}return-1},prepareMenuLoad:function(){var e=this.__settings.loadPage!==undefined;if(e){this._loadDynamicPageWithSearch(1,false)}this.scrollToItem(this._selectedIndex);this._focusMenu()},nextSelect:function(){var e=this._selectedIndex;if(e<this._optionCount-1){this.set("selectedIndex",e+1);this.scrollToItem(this._selectedIndex)}},prevSelect:function(){var e=this._selectedIndex;if(e>0){this.set("selectedIndex",e-1);this.scrollToItem(this._selectedIndex)}},_currentIndex:0,_optionsText:undefined,_firstNumOnPage:1,_firstNumOnSearchPage:1,_searchString:null,_showSearchResults:false,_prepopulatedSearchResults:null,_isLoaded:false,_loadedOptions:null,_totalLoadedOptions:0,_loadedSearchOptions:null,_totalLoadedSearchOptions:0,_renderMenu:function(){var e=this.__settings.options,t=this.__settings.numOptionsPerPage,i=e!==undefined,s=this.__settings.paginationEnabled,n=this.__settings.searchEnabled,r=this._showSearchResults,a=r?this._firstNumOnSearchPage:this._firstNumOnPage,o=this.get("selectedValue"),l,u,h,c,d,f,p,_,g,m,v,S="";if(!i){l=this._calculateCurrentPageNum(a);if(this._isDynamicPageLoadedWithSearch(l,r)){u=l-1;h=r?this._loadedSearchOptions[u]:this._loadedOptions[u];c=r?this._totalLoadedSearchOptions:this._totalLoadedOptions}}else{if(r){h=this._prepopulatedSearchResults}else{h=e}c=h.length}d=s&&c>t;if(s){f=r||n&&d}else{f=n}if(f){S+=SM.Template.render("select-search-template",{searchPlaceholderText:this.__settings.searchPlaceholderText,searchString:this._searchString})}if(h&&h.length>0){if(d){g=Math.min(a+t-1,c);if(i){h=h.slice(a-1,g)}S+=SM.Template.render("select-options-template",h);p=a===1;m=this._calculateLastPageFirstNum(c,t);_=a===m;S+=SM.Template.render("select-pagination-template",{firstNumOnPage:a,lastNumOnPage:g,totalOptions:c,isFirstPage:p,isLastPage:_})}else{S+=SM.Template.render("select-options-template",h)}this.trigger("onOptionsLoaded")}else if(!i&&!this._isLoaded){S+=$("#select-options-loading").html()}else if(r){S+=$("#select-search-none").html();this.trigger("onOptionsLoaded")}this.$el.html(S);v=this.$el.find(".selected").last();this._refreshOptionData();this._collectOptionsText();if(o){this._getOptionByValue(o).addClass("selected")}else if(v.length>0){this.set("selectedValue",v.attr("data-opt-value"))}this._focusMenu()},_focusMenu:function(){var e=this.$el.find('[name="searchTerm"]'),t=this.get("selectedValue"),i;if(e.length>0){e.focus()}else{i=this._getOptionByValue(t);if(t&&i.length>0){i.focus()}else{this.$el.find(".option").first().focus()}}},_refreshOptionData:function(){this._$options=this.$el.find(".option");this._optionCount=this._$options.length},_collectOptionsText:function(){this._optionsText=this._$options.map(function(){return $.trim($(this).text().toLowerCase())}).get()},_getText:function(e){return $.trim(this._getOptionByValue(e).text())},_getOptionByValue:function(e){return this.$el.find("["+this.VALUE_ATTR+'="'+e+'"]')},_getIndexByValue:function(e){var t=this._getOptionByValue(e);return this._$options.index(t)},_getValueByIndex:function(e){var t;if(e===-1){return}t=this._$options.eq(e);return t.attr(this.VALUE_ATTR)},_loadDynamicPageWithSearch:function(e,t,i){var s=this,n=e-1,r=this.__settings.numOptionsPerPage,a=r*n+1;if(this._isDynamicPageLoadedWithSearch(e,t)){return}if(t){this.__settings.loadSearchPage(a,r,i).done(function(e){s._isLoaded=true;s._totalLoadedSearchOptions=e.totalOptions;s._loadedSearchOptions[n]=e.options;s._renderMenu()})}else{this.__settings.loadPage(a,r).done(function(e){s._isLoaded=true;s._totalLoadedOptions=e.totalOptions;s._loadedOptions[n]=e.options;s._renderMenu()})}},_onMouseLeave:function(e){return},_onSearchSubmit:function(e){var t=e.data.self,i=$(this),s=t.__settings.loadSearchPage!==undefined,n=$.trim(t.$el.find('[name="searchTerm"]').val()),r;if(i.hasClass("search-button")){if(!SM.A11y.checkClick(e)){return}e.stopPropagation()}else if(i.hasClass("search-bar")){if(!SM.A11y.checkSubmit(e)){return}}if(n.length===0||n===t._searchString){return}else{t._firstNumOnSearchPage=1}t._showSearchResults=true;t._searchString=n;t.$el.find(".clear-search").removeClass("hide");if(s){t._loadedSearchOptions=[];t._totalLoadedSearchOptions=0;r=t._calculateCurrentPageNum(t._firstNumOnSearchPage);t._loadDynamicPageWithSearch(r,true,t._searchString)}else{t._prepopulatedSearchResults=t._searchOptions(t.__settings.options,t._searchString);if(t._prepopulatedSearchResults.length===0){t._firstNumOnSearchPage=0}}t._renderMenu()},_onClearSearch:function(e){var t=e.data.self,i=t.$el.find(".clear-search");if(!SM.A11y.checkClick(e)){return}e.preventDefault();e.stopPropagation();i.addClass("hide");t._prepopulatedSearchResults=null;t._loadedSearchOptions=[];t._totalLoadedSearchOptions=0;t._searchString=null;t._showSearchResults=false;t._firstNumOnSearchPage=1;t._renderMenu()},_onOptionClick:function(e){var t=e.data.self,i=$(this);if(!SM.A11y.checkClick(e)){return}e.preventDefault();e.stopPropagation();if(i.hasClass("disabled")){return}t.set("selectedIndex",t._$options.index(i))},_onPagingClick:function(e){var t=e.data.self,i=t.__settings.loadPage!==undefined,s=$(this),n=s.data("pageaction"),r=t.__settings.numOptionsPerPage,a,o=t._showSearchResults?t._firstNumOnSearchPage:t._firstNumOnPage,l;if(!SM.A11y.checkClick(e)){return}e.stopPropagation();if(t._showSearchResults){a=i?t._totalLoadedSearchOptions:t._prepopulatedSearchResults.length}else{a=i?t._totalLoadedOptions:t.__settings.options.length}switch(n){case"first":o=1;break;case"previous":o-=r;break;case"next":o+=r;break;case"last":o=t._calculateLastPageFirstNum(a,r);break;default:return}if(t._showSearchResults){t._firstNumOnSearchPage=o}else{t._firstNumOnPage=o}t._renderMenu();if(i){l=t._calculateCurrentPageNum(o);t._loadDynamicPageWithSearch(l,t._showSearchResults,t._searchString)}},_onOptionFocus:function(e){var t=$(this),i=e.data.self,s=t.closest("li").index();e.stopPropagation();if(!t.hasClass("current")){i.set("currentIndex",s)}},_calculateLastPageFirstNum:function(e,t){var i=Math.ceil(e/t);if(e===0){return 0}return(i-1)*t+1},_searchOptions:function(e,t){return $.map(e,function(e,i){var s=e.text.toLowerCase(),n=t.toLowerCase();if(s.indexOf(n)!==-1){return e}})},_isDynamicPageLoadedWithSearch:function(e,t){var i,s,n,r=e-1;if(t){i=this._loadedSearchOptions}else{i=this._loadedOptions}s=i.length;if(s>0&&s>=e){loadedPage=i[r];if(loadedPage!==undefined){this._isLoaded=true;return true}}this._isLoaded=false;return false},_calculateCurrentPageNum:function(e){var t=this.__settings.numOptionsPerPage;return Math.ceil(e/t)}});SM.CalendarMenuView=SM.Views.register({__NAME:"calendarMenuView",__templateID:"calendar-menu-template",__init:function(){this.bind("click",".nextBtn",this._onNextMonthClick).bind("click",".prevBtn",this._onPrevMonthClick).bind("click","td.day:not(.out-of-range)",this._onDayClick);if(this.__settings.selectMenus){this.bind("selectMenu.change",".yearSelect",this._onSelectYearChange).bind("selectMenu.change",".monthSelect",this._onSelectMonthChange)}},__beforeRender:function(){var e=this._buildDayHeaders(),t=this.__settings,i,s,n,r,a,o,l,u=Globalize.culture(),h,c;i=SM.Date.getSimpleDate(this._displayDate);s=SM.Date.getSimpleDate(t.minDate);n=SM.Date.getSimpleDate(t.maxDate);r=SM.Date.getSimpleDate(t.selectedDate);a=SM.Date.getSimpleDate(this._currentDate);o=i.year<=s.year&&i.month<=s.month;l=i.year>=n.year&&i.month>=n.month;h=u.calendars.standard.months.names[i.month],c=this._buildDays(i,s,n,r,a);return{weekdays:e,monthName:h,displayDate:i,minDate:s,maxDate:n,currentDate:a,selectedDate:r,isPrevBtnDisabled:o,isNextBtnDisabled:l,selectMenus:t.selectMenus,weeks:c,yearFirst:u.calendar.yearFirst}},__afterRender:function(e){var t,i;if(this.__settings.selectMenus){this.$el.find(".yearSelect").selectMenu({menuView:"YearSelectMenuView",selectWidth:"auto",selectedValue:e.displayDate.year,minYear:e.minDate.year,maxYear:e.maxDate.year});t=0;i=11;if(e.minDate.year&&e.displayDate.year===e.minDate.year){t=e.minDate.month}if(e.maxDate.year&&e.displayDate.year===e.maxDate.year){i=e.maxDate.month}this.$el.find(".monthSelect").selectMenu({menuView:"MonthSelectMenuView",selectWidth:"auto",selectedValue:e.displayDate.month,minMonth:t,maxMonth:i})}},resetDisplayDate:function(e){var t,i=this.__settings=e;this._currentDate=new Date;if(i.selectedDate){t=SM.Date.getSimpleDate(i.selectedDate)}else if(i.minDate&&this._currentDate<i.minDate){t=SM.Date.getSimpleDate(i.minDate)}else if(i.maxDate&&this._currentDate>i.maxDate){t=SM.Date.getSimpleDate(i.maxDate)}else{t=SM.Date.getSimpleDate(this._currentDate)}this._displayDate=new Date(t.year,t.month,1)},_setDisplayDate:function(e,t){var i=new Date(e,t,1);this._currentDate=new Date;this._displayDate=i},_buildDayHeaders:function(){var e=Globalize.culture(),t=e.calendars.standard,i=t.firstDay,s=t.days.names,n=t.days.namesShort,r,a=[],o=7;while(o){r=i<7?i:i-7;a.push({name:s[r],shortName:n[r]});o--;i++}return a},_buildDays:function(e,t,i,s,n){var r=0,a,o,l,u=s.month,h=s.year,c=s.day,d=n.month,f=n.year,p=n.day,_=t.month,g=t.year,m=t.day,v=i.day,S=i.month,y=i.year,w=[],M,b=e.month,D=e.year,x=Globalize.getWeekdayIndexOfFirstDay(b,D),C=SM.Date.getDaysInMonth(b,D),E=_===b&&g===D,T=S===b&&y===D,A=u===b&&h===D,I=d===b&&f===D,R=7*Math.ceil((C+x)/7);while(r<R){M=[];for(a=0;a<7;a++){l=r-x+1;if(r<x||l>C){o={isBlank:true,isFirstEnd:l===C+1}}else{o={number:l,isLast:l===C,isSelected:A&&c===l,isToday:I&&p===l,isOutOfRange:E&&r>=x&&l<m||T&&l>v&&l<=C}}M.push(o);++r}w.push(M)}return w},_onPrevMonthClick:function(e){var t=e.data.self,i=SM.Date.getSimpleDate(t._displayDate),s=$(this);e.preventDefault();e.stopPropagation();if(!s.hasClass("disabled")){t._setDisplayDate(i.year,i.month-1);t.render()}},_onNextMonthClick:function(e){var t=e.data.self,i=$(this),s=SM.Date.getSimpleDate(t._displayDate);e.preventDefault();e.stopPropagation();if(!i.hasClass("disabled")){t._setDisplayDate(s.year,s.month+1);t.render()}},_onSelectYearChange:function(e){var t=e.data.self,i,s,n=t.__settings,r=SM.Date.getSimpleDate(n.minDate),a=SM.Date.getSimpleDate(n.maxDate),o=SM.Date.getSimpleDate(t._displayDate);s=parseInt(e.value,10);i=o.month;if(r.year&&s===r.year&&r.month>o.month){i=r.month}if(a.year&&s===a.year&&a.month<o.month){i=a.month}t._setDisplayDate(s,i);t.render()},_onSelectMonthChange:function(e){var t=e.data.self,i=SM.Date.getSimpleDate(t._displayDate);t._setDisplayDate(i.year,parseInt(e.value,10));t.render()},_onDayClick:function(e){var t=e.data.self,i=$(e.currentTarget),s=parseInt(i.attr("data-day"),10),n=SM.Date.getSimpleDate(t._displayDate);t.trigger({type:"dateSelected",date:new Date(n.year,n.month,s)})}});SM.YearSelectMenuView=SM.Views.deepExtend(SM.SelectMenuView,{__templateID:"years-select-menu-template",__NAME:"yearSelectMenuView",__defaults:{maxYear:null,minYear:null},__beforeRender:function(){var e=this.__settings.maxYear?this.__settings.maxYear:(new Date).getFullYear(),t=this.__settings.selectedValue,i=this.__settings.minYear,s=[],n=e;for(;n>=i;n--){s.push({text:n,value:n,selected:n===t})}this.__settings.options=s;return this.__settings}});SM.MonthSelectMenuView=SM.Views.deepExtend(SM.SelectMenuView,{__templateID:"month-select-menu-template",__NAME:"monthSelectMenuView",__defaults:{maxMonth:11,minMonth:0},__beforeRender:function(){var e=this.__settings.maxMonth,t=this.__settings.selectedValue,i=[],s=Globalize.culture(),n=s.calendars.standard.months.namesAbbr,r=this.__settings.minMonth;for(;r<=e;r++){i.push({value:r,text:n[r],selected:r===t})}this.__settings.options=i;return this.__settings}});SM.HourSelectMenuView=SM.Views.deepExtend(SM.SelectMenuView,{__templateID:"hour-select-menu-template",__NAME:"hourSelectMenuView",__defaults:{militaryTime:false},__beforeRender:function(){var e=0,t=this.__settings.selectedValue,i=[],s=Globalize.getSmartlingCulture(),n=s==="en"?"HH":Globalize.cultures[s].calendar.timeAbbr.h,r;i.push({value:"-1",text:n});if(this.__settings.militaryTime){r=23}else{r=11;e=1;i.push({value:12,text:"12",selected:0===t})}while(e<=r){i.push({value:e,text:e<10?"0"+e:e,selected:t===e});e++}this.__settings.options=i;return this.__settings}});SM.MinuteSelectMenuView=SM.Views.deepExtend(SM.SelectMenuView,{__templateID:"minute-select-menu-template",__NAME:"minuteSelectMenuView",__defaults:{increment:15},__beforeRender:function(){var e=60,t=this.__settings.increment,i=this.__settings.selectedValue,s=[],n=Globalize.getSmartlingCulture(),r=n==="en"?"MM":Globalize.cultures[n].calendar.timeAbbr.m,a=0;s.push({value:"-1",text:r});for(;a<e;a+=t){s.push({value:a,text:a<10?"0"+a:a,selected:i===a})}this.__settings.options=s;return this.__settings}});SM.BaseMenu={__NAME:"menu",__defaults:{position:{my:"left top",at:"left bottom",offset:"0 -1"},parentEl:document.body},__init:function(){var e=this;if(this.__settings.menuView){this._menuView=this.__settings.menuView}this.bind("click",this._onClick).bind("keydown",this._onKeydown)},__onClick:function(e){e.preventDefault();if(this._isOpen){this.close()}else{this.open()}},__onClosedKeydown:function(e){var t=e.which;if(t===SM.KeyCodes.ENTER){e.preventDefault();e.stopPropagation();this.$el.click()}},__onWindowResize:function(e){this.position()},__onMenuInit:function(){},__onBeforeMenuOpen:function(){$(window).on(SM.Event.RESIZE+"."+this.__NAME+this.__uid,{self:this},this._onResize);this.subscribe(SM.Event.FOCUSIN,this._onDocumentFocusin).subscribe(SM.Event.CLICK,this._onDocumentClick).subscribe(SM.Event.KEYDOWN,this._onDocumentKeydown)},__onMenuAddedToPage:function(){},__onAfterMenuOpen:function(){},__onClickOutside:function(e){this.close()},__onFocusOutside:function(e){this.close()},__onOpenKeydown:function(e){var t=e.which;if(t===SM.KeyCodes.ESCAPE){e.preventDefault();this.close()}},__onBeforeMenuClose:function(){},__onAfterMenuClose:function(){$(window).off(SM.Event.RESIZE+"."+this.__NAME+this.__uid,this._onResize);this.unsubscribe(SM.Event.FOCUSIN,this._onDocumentFocusin).unsubscribe(SM.Event.KEYDOWN,this._onDocumentKeydown).unsubscribe(SM.Event.CLICK,this._onDocumentClick)},__setters:{position:function(e,t){SM.Object.update(e.__settings.position,t);if(e.isOpen()){e.position()}},parentEl:function(e,t){e.__settings.parentEl=t;if(e.isOpen()){e.position()}}},__getters:{menuView:function(e,t){if(!e._menu){e._initMenu()}return e._menu}},bindMenu:function(e,t){this._menu.$el.on(this._menu.__NAME+"."+e,{self:this},t);return this},open:function(){var e;if(this.$el.hasClass("disabled")){return}e=this.get("menuView");if(this._isOpen){return}this.trigger("beforeOpen");this.__onBeforeMenuOpen();e.$el.on("click",".close-menu-btn",{self:this},this._onCloseMenuClick);e.$el.appendTo(this.__settings.parentEl);this.$el.addClass("open");this.__onMenuAddedToPage();this.position();this._isOpen=true;this.trigger("afterOpen");this.__onAfterMenuOpen()},close:function(){var e;if(!this._isOpen){return}e=this.get("menuView");this.trigger("beforeClose");this.__onBeforeMenuClose();e.$el.off("click",".close-menu-btn",this._onCloseMenuClick);e.$el.detach();this._isOpen=false;this.$el.removeClass("open");this.trigger("afterClose");this.__onAfterMenuClose()},isOpen:function(){return this._isOpen},position:function(){var e;if(!this.__settings.position.of){this.__settings.position.of=this.$el}if(this.__settings.parentEl){this.__settings.position.within=this.__settings.parentEl}e=$.migrationFixPosition({my:this.__settings.position.my,at:this.__settings.position.at,of:this.__settings.position.of,offset:this.__settings.position.offset,within:this.__settings.position.within,collision:this.__settings.position.collision});this._menu.$el.position(e);this.trigger("position")},_initMenu:function(){var e;if(!this._menu){e=SM[this._menuView];if(!e){throw new Error("A menu requires a menuView key")}this._menu=SM.Views.create(e,this.__settings);this._menu.$el.css({top:0,left:0});this.trigger("menuInit");this.__onMenuInit()}return this._menu},__destroy:function(){if(this._menu){this.__onAfterMenuClose();this._isOpen=false;if(this._menu.$el){this._menu.$el.remove()}this._menu=null}this.$el.off("click",this._onClick).off("keydown",this._onKeydown).data(this.__NAME,null)},_menu:null,_menuView:"BaseMenuView",_isOpen:false,_onClick:function(e){var t=e.data.self;t.__onClick(e)},_onKeydown:function(e){var t=e.data.self;if(!t._isOpen){t.__onClosedKeydown(e)}},_onDocumentKeydown:function(e){var t=e.data.self;t.__onOpenKeydown(e)},_onDocumentClick:function(e){var t=e.data.self;if(!t._menuContains(e.target)&&!t._isStepChild(e.target)&&!t._contains(e.target)){t.__onClickOutside(e)}},_onDocumentFocusin:function(e){var t=e.data.self;if(e.target===document){return}if(!t._menuContains(e.target)&&!t._isStepChild(e.target)&&!t._contains(e.target)&&e.target.tagName.toLowerCase()!=="body"){t.__onFocusOutside(e)}},_onResize:function(e){var t=e.data.self;t.__onWindowResize(e)},_menuContains:function(e){return SM.DOM.contains(this._menu.el,e)},_isStepChild:function(e){return false},_onCloseMenuClick:function(e){e.data.self.close()},_contains:function(e){return SM.DOM.contains(this.el,e)}};SM.Menu=SM.Widgets.register(SM.BaseMenu);SM.AutocompleteMenuView=SM.Views.deepExtend(SM.OptionMenuView,{__NAME:"AutocompleteMenuView",__templateID:"autocomplete-menu-template",__defaults:{results:[]},__init:function(){SM.OptionMenuView.__init.call(this);this.bind("click",".option",this._onOptionClick)},__afterRender:function(){this._refreshOptionData()},__setters:{results:function(e,t){e.__settings.results=t;e.render();e.set("currentIndex",-1)}},_onOptionClick:function(e){var t=e.data.self,i=$(this);e.preventDefault();e.stopPropagation();if(i.hasClass("disabled")){return}t.trigger({type:"selected",text:i.text(),value:i.attr("data-value")})}});SM.ActionMenu=SM.Widgets.deepExtend(SM.BaseMenu,{__NAME:"actionMenu",__defaults:{saveState:false,selectedAction:null},__onMenuInit:function(){this.bindMenu("actionSelected",this._onActionSelected).bindMenu("optionClicked",this._onOptionClicked).bindMenu("beforeSubmenuOpen",this._onBeforeSubmenuOpen).bindMenu("submenuOpened",this._onSubmenuOpened).bindMenu("submenuClosed",this._onSubmenuClosed);this.activeSubmenu=null;this._isSubmenuOpen=false},__setters:{selectedAction:function(e,t){var i=e.get("menuView");i.set("selectedAction",t)},actions:function(e,t){var i=e.get("menuView");i.set("actions",t)}},_onOptionClicked:function(e){var t=e.data.self;t.$el.focus();t.close()},closeSubmenus:function(){if(this.activeSubmenu){this.activeSubmenu.closeSubmenus();this.activeSubmenu.close()}},hasAction:function(e){var t=this.get("menuView");return t.hasAction(e)},_getCurrentAction:function(){var e=this.__settings.actions,t=this._menu.get("currentIndex");if(e&&e[t]){return e[t]}return null},_getCurrentActionSubmenu:function(){var e=this._getCurrentAction();if(e&&e.submenu&&e.submenu.actions&&e.submenu.actions.length){
return e.submenu}return null},_isSubmenu:function(){return!!this.__settings.parentMenu},_menuView:"ActionMenuView",_onActionSelected:function(e){var t=e.data.self;if(t.__settings.saveState&&t.__settings.selectedAction===e.action){return}if(t.__settings.saveState){t.__settings.selectedAction=e.action}t.trigger({type:"actionSelected",action:e.action,$action:e.$action})},_onBeforeSubmenuOpen:function(e){var t=e.data.self;if(t.activeSubmenu){t.activeSubmenu.close()}},_onSubmenuOpened:function(e){var t=e.data.self;t.activeSubmenu=e.actionSubmenu;t.activeSubmenu.bindMenu("actionSelected",function(e){t.close()});t._isSubmenuOpen=true;t.trigger("submenuOpened")},_onSubmenuClosed:function(e){var t=e.data.self;t.activeSubmenu=null;t._isSubmenuOpen=false},__onOpenKeydown:function(e){var t=e.which,i=this._getCurrentAction();SM.BaseMenu.__onOpenKeydown.call(this,e);if(!this._isSubmenuOpen){if(t===SM.KeyCodes.DOWN){this._menu.nextCurrent();e.preventDefault()}else if(t===SM.KeyCodes.UP){this._menu.prevCurrent();e.preventDefault()}else if(t===SM.KeyCodes.LEFT&&this._isSubmenu()){this.close();e.preventDefault()}else if(t===SM.KeyCodes.ENTER||t===SM.KeyCodes.RIGHT&&this._getCurrentActionSubmenu()){this._menu.selectCurrent();e.preventDefault()}}},__onBeforeMenuClose:function(){SM.BaseMenu.__onBeforeMenuClose.call(this);this.closeSubmenus()},__onAfterMenuClose:function(){SM.BaseMenu.__onAfterMenuClose.call(this);if(this._menu){this._menu.set("currentIndex",-1)}}});SM.SelectMenu=SM.Widgets.deepExtend(SM.BaseMenu,{__NAME:"selectMenu",__defaults:{selectedValue:null,options:undefined,paginationEnabled:false,numOptionsPerPage:10,searchEnabled:false,loadPage:undefined,loadSearchPage:undefined,selectWidth:"200px",menuMaxWidth:"400px"},__init:function(e){var t,i;SM.BaseMenu.__init.call(this);this.bind("keypress",this._onCloseKeypress);this.$el.addClass("btn select-menu").css("width",this.__settings.selectWidth);t=this.get("menuView");i=t.get("selectedValue");if(i){this.__settings.selectedValue=i;this._setDisplay(t.get("valueText"))}},__onMenuInit:function(){this.bindMenu("change",this._onMenuChange);this.bindMenu("onOptionsLoaded",this._onMenuOptionsLoaded)},__onClosedKeydown:function(e){var t=e.which;SM.BaseMenu.__onClosedKeydown.call(this,e);if(t===SM.KeyCodes.DOWN){this._menu.nextSelect();e.preventDefault()}else if(t===SM.KeyCodes.UP){this._menu.prevSelect();e.preventDefault()}},__onOpenKeydown:function(e){var t=e.which,i=$(e.target),s=i.attr("name")==="searchTerm";SM.BaseMenu.__onOpenKeydown.call(this,e);if(t===SM.KeyCodes.DOWN){this._menu.nextCurrent();e.preventDefault()}else if(t===SM.KeyCodes.UP){this._menu.prevCurrent();e.preventDefault()}else if(t===SM.KeyCodes.TAB){e.stopPropagation()}},__onBeforeMenuOpen:function(){SM.BaseMenu.__onBeforeMenuOpen.call(this);this._setMenuUI();this.subscribe(SM.Event.KEYPRESS,this._onOpenKeypress)},__onAfterMenuClose:function(){SM.BaseMenu.__onAfterMenuClose.call(this);this.unsubscribe(SM.Event.KEYPRESS,this._onOpenKeypress);this.$el.focus()},__onAfterMenuOpen:function(){SM.BaseMenu.__onAfterMenuOpen.call(this);this._menu.prepareMenuLoad()},__setters:{value:function(e,t){e._menu.set("selectedValue",t)},options:function(e,t){e._menu.set("options",t)}},__getters:{value:function(e,t){return e.__settings.selectedValue}},_menuView:"SelectMenuView",_inlineSearchTerm:undefined,_setDisplay:function(e){this.$el.text(e)},_setMenuUI:function(){var e=this._menu.$el;e.css("min-width",this.__settings.selectWidth);e.css("max-width",this.__settings.menuMaxWidth);if(!this.__settings.paginationEnabled){e.addClass("no-pagination")}},_getNewInlineSearchTerm:function(e){return this._inlineSearchTerm?this._inlineSearchTerm+e:e},_inlineSearchWithSelect:function(e,t){var i,s,n,r=t?"selectedIndex":"currentIndex";if(!e){return}s=this._getNewInlineSearchTerm(e);i=this._menu.inlineSearchOptionsWithSelect(s,t);if(this._inlineSearchTerm&&i===-1){this._inlineSearchTerm=undefined;i=this._menu.inlineSearchOptionsWithSelect(e,t)}if(i!==-1){this._menu.set(r,i);this._inlineSearchTerm=this._getNewInlineSearchTerm(e)}else{this._inlineSearchTerm=undefined}},_getLetter:function(e){var t=e.charCode!==undefined?e.charCode:e.keyCode;return String.fromCharCode(t).toLowerCase()},_onCloseKeypress:function(e){var t=e.data.self,i;if(!t.isOpen()){i=t._getLetter(e);if(e.which===SM.KeyCodes.SPACE){e.preventDefault()}t._inlineSearchWithSelect(i,true)}},_onOpenKeypress:function(e){var t=e.data.self,i=t._getLetter(e),s=$(e.target),n=s.closest(".select-option-item").length>0;if(!n){return}if(e.which===SM.KeyCodes.SPACE){e.preventDefault()}t._inlineSearchWithSelect(i,false)},_onMenuChange:function(e){var t=e.data.self;if(t.__settings.selectedValue===e.value){t.$el.focus();t.close();return}t._setDisplay(e.displayText);t.__settings.selectedValue=e.value;t.trigger({type:"change",value:e.value,displayText:e.displayText});t.$el.focus();t.close()},_onMenuOptionsLoaded:function(e){var t=e.data.self;t.trigger("onOptionsLoaded")}});SM.Autocomplete=SM.Widgets.deepExtend(SM.BaseMenu,{__NAME:"autocomplete",__defaults:{minLength:2,delay:0,maxResults:50,autocompleteOnPaste:true,source:[],search:function(e){var t=this.__settings.source,i=this.__settings.maxResults,s=0,n;n=$.map(t,function(t,n){var r=t.toLowerCase(),a=e.toLowerCase();if(s>=i){return false}if(r.indexOf(a)!==-1){s++;return{value:t,text:t}}});this.set("results",n)},position:{collision:"none"},enabled:true,setInputOnSelect:true,matchInputWidth:true},_timeout:undefined,__getters:{input:function(e){return e._getInput()},results:function(e){var t=e.get("menuView");return t.get("results")}},__setters:{input:function(e,t){e._setInput(t)},results:function(e,t){var i=e.get("menuView");if(t.length>e.__settings.maxResults){t=t.slice(0,e.__settings.maxResults)}i.set("results",t);if(t.length>0){e.open()}else{e.close()}},enabled:function(e,t){if(t&&!e.__settings.enabled){e._bindEvents()}else if(!t&&e.__settings.enabled){e.close();e.$el.off("keydown",e._onKeydown).off("keyup",e._onKeyup).off("paste",e._onPaste)}e.__settings.enabled=t}},__init:function(e){var t=this.el.tagName.toLowerCase();if(this.__settings.enabled){this._bindEvents()}if(this.__settings.menuView){this._menuView=this.__settings.menuView}this._hasVal=t==="input"||t==="textarea";this._height=this.$el.height();this._width=this.$el.outerWidth()},__onMenuInit:function(){this.bindMenu("selected",this._onOptionSelected)},__onBeforeMenuOpen:function(){SM.BaseMenu.__onBeforeMenuOpen.call(this)},__onMenuAddedToPage:function(){SM.BaseMenu.__onMenuAddedToPage.call(this);if(this.__settings.matchInputWidth){this._matchInputSize()}},__onAfterMenuClose:function(){SM.BaseMenu.__onAfterMenuClose.call(this);this._menu.set("currentIndex",-1)},__onWindowResize:function(){this._matchInputSize();SM.BaseMenu.__onWindowResize.call(this)},_matchInputSize:function(){var e=this.get("menuView"),t=this.$el,i=t.outerWidth(),s=parseInt(e.$el.css("border-left-width"),10),n=parseInt(e.$el.css("border-right-width"),10);e.$el.css("width",i-s-n)},_bindEvents:function(){this.bind("keydown",this._onKeydown).bind("keyup",this._onKeyup);if(this.__settings.autocompleteOnPaste){this.bind("paste",this._onPaste)}},_menuView:"AutocompleteMenuView",_pipeInput:function(){var e=this._getInput();if(e.length>=this.__settings.minLength){this._checkHeight();this._checkSearch()}else{this.close()}},_checkHeight:function(){var e=this.$el.height();if(this._height!==e&&this.isOpen()){this.position();this._height=e}},_debounceSearch:function(){var e=this;clearTimeout(e._timeout);e._timeout=setTimeout(function(){e._pipeInput()},e.__settings.delay)},_checkSearch:function(){var e=this._getInput();this.__settings.search.call(this,e)},_getInput:function(){var e=this.$el;return $.trim(this._hasVal?e.val():e.text())},_setInput:function(e){var t=this.$el;if(this._hasVal){t.val(e)}else{t.text(e)}},_onOptionSelected:function(e){var t=e.data.self;if(t.__settings.setInputOnSelect){t._setInput(e.text)}t.trigger({type:"selected",text:e.text,value:e.value});t.close()},_onKeyup:function(e){var t=e.data.self,i=e.which;if(i===SM.KeyCodes.DOWN||i===SM.KeyCodes.UP||i===SM.KeyCodes.ENTER||i===SM.KeyCodes.ESCAPE){e.preventDefault();return}if(i===SM.KeyCodes.SHIFT||i===SM.KeyCodes.CTRL||i===SM.KeyCodes.CAPS||i===SM.KeyCodes.ALT||i===SM.KeyCodes.HOME||i===SM.KeyCodes.END||i===SM.KeyCodes.LEFT||i===SM.KeyCodes.RIGHT||i===SM.KeyCodes.LEFT_WINDOW||i===SM.KeyCodes.RIGHT_WINDOW||i===SM.KeyCodes.RIGHT_WINDOW||i===SM.KeyCodes.SELECT){return}if((e.ctrlKey||e.metaKey)&&i===SM.KeyCodes.V){return}if(t.__settings.delay>0){t._debounceSearch()}else{t._pipeInput()}},_onPaste:function(e){var t=e.data.self;setTimeout(function(){t._pipeInput()},0)},_onKeydown:function(e){var t=e.data.self,i=e.which;if(t.isOpen()){if(i===SM.KeyCodes.DOWN){t._menu.nextCurrent();e.preventDefault()}else if(i===SM.KeyCodes.UP){t._menu.prevCurrent();e.preventDefault()}else if(i===SM.KeyCodes.ENTER){t._menu.selectCurrent();e.preventDefault()}}}});SM.Datepicker=SM.Widgets.deepExtend(SM.BaseMenu,{__NAME:"datepicker",__defaults:{selectedDate:null,minDate:null,maxDate:null,selectMenus:false,dateFormat:"d"},__init:function(e){this.bind("focusin",this._onFocusIn).bind("click",this._onClick).bind("keyup",this._onKeyup).bind("paste",this._onPaste);if(this.$el.siblings(".datepicker-icon").length){this.$icon=this.$el.siblings(".datepicker-icon").first();this.$icon.on("click",{self:this},this._onIconClick)}this._setInitialValue()},__onMenuInit:function(){this.bindMenu("dateSelected",this._onDateSelected)},__onBeforeMenuOpen:function(){SM.BaseMenu.__onBeforeMenuOpen.call(this);this._menu.resetDisplayDate(this.__settings);this._menu.render()},__setters:{selectedDate:function(e,t){e._setSelectedDate(t);e.trigger("dateSelected")},minDate:function(e,t){e._setMinDate(t)},maxDate:function(e,t){e._setMaxDate(t)},selectMenus:function(e,t){e.__settings.selectMenus=t}},_menuView:"CalendarMenuView",_setSelectedDate:function(e){var t=this.__settings;if(e){if(t.minDate&&e<t.minDate){t.selectedDate=new Date(t.minDate)}else if(t.maxDate&&e>t.maxDate){t.selectedDate=new Date(t.maxDate)}else{t.selectedDate=e}this.$el.val(Globalize.format(t.selectedDate,t.dateFormat))}else{t.selectedDate=null;this.$el.val("")}return this},_setMinDate:function(e){var t=this.__settings;if(e){if(t.selectedDate&&e>t.selectedDate){t.minDate=new Date(t.selectedDate)}else if(t.maxDate&&e>t.maxDate){t.minDate=new Date(t.maxDate)}else{t.minDate=e}}else{t.minDate=null}return this},_setMaxDate:function(e){var t=this.__settings;if(e){if(t.selectedDate&&e<t.selectedDate){t.maxDate=new Date(t.selectedDate)}else if(t.minDate&&e<t.minDate){t.maxDate=new Date(t.minDate)}else{t.maxDate=e}}else{t.maxDate=null}return this},_setInitialValue:function(){var e=this.__settings.selectedDate;if(e){this._setSelectedDate(e)}return this},_parseDate:function(e){var t=Globalize.parseDate(e,this.get("dateFormat"));if(t){this.set("selectedDate",t)}else{this.set("selectedDate",null)}},_isStepChild:function(e){return this.$icon&&this.$icon.get(0)===e},_onFocusIn:function(e){var t=e.data.self;t.open()},_onClick:function(e){var t=e.data.self;t.open()},_onDateSelected:function(e){var t=e.data.self;t.set("selectedDate",e.date);t.$el.focus();t.close()},_onKeyup:function(e){var t=e.data.self,i=t.$el.val();t._parseDate(i)},_onPaste:function(e){var t=e.data.self,i=t.$el.val();t._parseDate(i)},_onIconClick:function(e){var t=e.data.self;t.open()}});SM.DateRange=SM.Widgets.register({__NAME:"dateRangePicker",__getters:{startMinDate:function(e){return e._start.get("minDate")},startMaxDate:function(e){return e._start.get("maxDate")},startSelectedDate:function(e){return e._start.get("selectedDate")},endMinDate:function(e){return e._end.get("minDate")},endMaxDate:function(e){return e._end.get("maxDate")},endSelectedDate:function(e){return e._end.get("selectedDate")}},__setters:{startMinDate:function(e,t){e._start.set("minDate",t)},startMaxDate:function(e,t){e._start.set("maxDate",t)},startSelectedDate:function(e,t){e._start.set("selectedDate",t)},endMinDate:function(e,t){e._end.set("minDate",t)},endMaxDate:function(e,t){e._end.set("maxDate",t)},endSelectedDate:function(e,t){e._end.set("selectedDate",t)}},__init:function(e){var t=this.$el.find(".datepicker.date-start"),i=this.$el.find(".datepicker.date-end");if(t.length===0||i.length===0){throw new Error(".date-start or .date-end not found inside daterange element")}t.datepicker({minDate:e.startMinDate,maxDate:e.startMaxDate,selectedDate:e.startSelectedDate,selectMenus:e.selectMenus});i.datepicker({minDate:e.endMinDate,maxDate:e.endMaxDate,selectedDate:e.endSelectedDate,selectMenus:e.selectMenus});this._initStartMaxDate=e.startMaxDate;this._initEndMinDate=e.endMinDate;this._start=t.data("datepicker");this._end=i.data("datepicker");this._start.$el.on("datepicker.beforeOpen",{daterange:this},this._startDateOpen);this._end.$el.on("datepicker.dateSelected",{daterange:this},this._onEndDateSelected).on("datepicker.beforeOpen",{daterange:this},this._endDateOpen)},_start:undefined,_end:undefined,_initStartMaxDate:undefined,_initEndMinDate:undefined,_startDateOpen:function(e){var t=e.data.daterange,i=t._end.get("selectedDate"),s=t._start.get("maxDate"),n=t._end.get("maxDate");if(i&&t._initStartMaxDate&&i<t._initStartMaxDate){t._start.set("maxDate",i)}else if(i&&!t._initStartMaxDate){t._start.set("maxDate",i)}else if(t._initStartMaxDate){t._start.set("maxDate",t._initStartMaxDate)}else if(n){t._start.set("maxDate",n)}},_endDateOpen:function(e){var t=e.data.daterange,i=t._start.get("selectedDate"),s=t._end.get("minDate"),n=t._start.get("minDate");if(i&&t._initEndMinDate&&i>t._initEndMinDate){t._end.set("minDate",i)}else if(i&&!t._initEndMinDate){t._end.set("minDate",i)}else if(t._initEndMinDate){t._end.set("minDate",t._initEndMinDate)}else if(n){t._end.set("minDate",n)}},_onEndDateSelected:function(e){var t=e.datepicker,i=t.get("selectedDate");if(i){i.setMilliseconds(999);i.setSeconds(59);i.setMinutes(59);i.setHours(23);t._setSelectedDate(i)}}});SM.Accordion=SM.Widgets.register({__NAME:"accordion",__defaults:{multiOpen:false,overflowAuto:true},__init:function(){this._cacheData()._bindEvents();if(SM.Browser.isIE8){this.$el.find("div.key > header > h3").prepend('<span class="accordion-arrow"></span>')}},KEY_ATTR:"data-panel-key",close:function(e){var t;e=this._getNormalizedStringPanelkey(e);t=this._panels[e];if(t&&this._openPanels[e]){this._close(t)}return this},open:function(e){var t;e=this._getNormalizedStringPanelkey(e);t=this._panels[e];if(t&&!this._openPanels[e]){if(!this.__settings.multiOpen){this._closeOpenPanels()}this._open(t)}return this},disable:function(e,t){var i;e=this._getNormalizedStringPanelkey(e);i=this.$el.find("#"+e).siblings("header");if(e){if(t){this._disabledPanels[e]=true;i.addClass("disabled")}else{delete this._disabledPanels[e];i.removeClass("disabled")}}return this},isOpen:function(e){e=this._getNormalizedStringPanelkey(e);return!!this._openPanels[e]},isDisabled:function(e){e=this._getNormalizedStringPanelkey(e);return!!this._disabledPanels[e]},_openPanels:undefined,_panels:undefined,_disabledPanels:undefined,_close:function(e){e.$section.css("overflow-y","hidden");this.__trigger({type:"beforeClose",index:e.index,id:e.key});delete this._openPanels[e.key];e.$section.animate({height:0},200,this._onClose)},_open:function(e){var t;e.$panel.addClass("opening");this.__trigger({type:"beforeOpen",index:e.index,id:e.key});this._openPanels[e.key]=true;if(!this.$el.hasClass("static")){t=e.$section.css("height","auto").height();e.$section.css("height",0);this.$el.one("accordion.afterOpen",function(){e.$section.css("height","auto")})}else{e.$panel.addClass("open");t=e.$section.height();e.$panel.removeClass("open")}e.$section.animate({height:t},200,this._onOpen)},_cacheData:function(){var e=0,t,i,s,n,r,a;this._openPanels={};this._panels={};this._disabledPanels={};t=this.$el.children("div.key");r=t.length;for(;e<r;e++){i=t.eq(e);a=i.find("header");s=a.find("a.keyOpener").attr("target").substr(1);n=this.$el.find("#"+s);this._panels[s]={index:e,key:s,$panel:i,$section:n};if(i.hasClass("open")){this._openPanels[s]=true}if(a.hasClass("disabled")){this.disable(s,true)}}return this},_closeOpenPanels:function(){var e=this._panels,t=this._openPanels,i;for(i in t){if(t[i]){this._close(e[i])}}},_bindEvents:function(){this.$el.on("click",".key > header",{accordion:this},this._onKeyClick);return this},_getNormalizedStringPanelkey:function(e){if(typeof e==="string"){return e}var t,i=this._panels;for(t in i){if(i[t].index===e){return i[t].key}}},_getSingleOpenedPanelkey:function(){for(var e in this._openPanels){return e}},_onClose:function(){var e=$(this),t=e.closest(".accordion").data(SM.Accordion.__NAME),i=e.attr("id"),s=t._panels[i];s.$panel.removeClass("open");e.removeAttr("style");t.__trigger({type:"afterClose",index:s.index,id:s.key})},_onOpen:function(){var e=$(this),t=e.closest(".accordion").data(SM.Accordion.__NAME),i=e.attr("id"),s=t._panels[i];s.$panel.removeClass("opening");s.$panel.addClass("open");if(t.__settings.overflowAuto){e.css("overflow-y","auto")}t.__trigger({type:"afterOpen",index:s.index,id:s.key})},_onKeyClick:function(e){var t=e.data.accordion,i=$(this).find("a.keyOpener").attr("target").substring(1),s=t._getSingleOpenedPanelkey();e.preventDefault();if(t.isDisabled(i)){return}if(!t.__settings.multiOpen&&s&&t.isDisabled(s)){return}if(t._openPanels[i]){t.close(i)}else{t.open(i)}}});SM.Popout=SM.Widgets.register({__NAME:"popout",__defaults:{tipSideX:"left",tipSideY:"top",parentElement:document.body,offsetX:null,offsetY:null,at:"left top",showDelayTime:750,hideDelayTime:500,collision:"flip flip"},__init:function(e){this.$el.on("mouseenter.popout",{popout:this},this._onMouseenter).on("mouseleave.popout",{popout:this},this._onMouseleave).on("click.popout",this._onClick)},__destroy:function(){this.$el.off(".popout")},_isHovered:false,_isMsgSetup:false,_$msg:undefined,_offsetX:undefined,_offsetY:undefined,_tipSideX:undefined,_tipSideY:undefined,_positions:{left:{css:"tip-left",offset:"+32",flip:"right"},right:{css:"tip-right",offset:"-15",flip:"left"},bottom:{css:"tip-bottom",offset:"+34",flip:"top"},top:{css:"tip-top",offset:"-14",flip:"bottom"}},_beforeShow:function(){if(this.__settings.offsetX){this._offsetX=this.__settings.offsetX}else{this._offsetX=this._positions[this.__settings.tipSideX].offset}if(this.__settings.offsetY){this._offsetY=this.__settings.offsetY}else{this._offsetY=this._positions[this.__settings.tipSideY].offset}this._$msg=this.$el.find(".popout");if(this._$msg.length===0){this.$el.append("<div class='popout'></div>");this._$msg=this.$el.find(".popout").html($("#"+this.$el.attr("data-help")).html())}this._$msg=this._$msg.clone();this._$msg.on("mouseenter",{popout:this},this._onMessageMouseenter).on("mouseleave",{popout:this},this._onMessageMouseleave).on("position.horizontal.flip",{popout:this,offsetKey:"_offsetX",tipKey:"tipSideX"},this._onMessageFlip).on("position.vertical.flip",{popout:this,offsetKey:"_offsetY",tipKey:"tipSideY"},this._onMessageFlip).on("click",".close",{popout:this},this._onCloseClick).addClass(this._positions[this.__settings.tipSideX].css).addClass(this._positions[this.__settings.tipSideY].css).append('<span class="tip"></span>').append('<a class="close"><span aria-hidden="true"></span>Close</a>').appendTo(this.__settings.parentElement);this._isMsgSetup=true;return this},_show:function(){var e=this;setTimeout(function(){if(e._isHovered){e._$msg.addClass("open").position($.migrationFixPosition({my:e.__settings.tipSideX+" "+e.__settings.tipSideY,at:e.__settings.at,of:e.$el,offset:e._offsetX+" "+e._offsetY,collision:e.__settings.collision}));e.trigger("opened")}},e.get("showDelayTime"));return e},_hide:function(){var e=this;setTimeout(function(){if(!e._isHovered){if(e._$msg!==undefined){e._$msg.remove()}e._isMsgSetup=false}},e.get("hideDelayTime"));return e},_onMessageFlip:function(e){var t=e.data.popout,i=t.__settings[e.data.tipKey],s=t._positions[i],n=t._positions[s.flip];t[e.data.offsetKey]=n.offset;t._$msg.removeClass(s.css).addClass(n.css)},_onMouseenter:function(e){var t=e.data.popout;t._isHovered=true;if(!t._isMsgSetup){t._beforeShow()._show()}},_onMouseleave:function(e){var t=e.data.popout;t._isHovered=false;t._hide()},_onMessageMouseenter:function(e){var t=e.data.popout;t._isHovered=true},_onMessageMouseleave:function(e){var t=e.data.popout;t._isHovered=false;t._hide()},_onCloseClick:function(e){var t=e.data.popout;t._isHovered=false;t._$msg.remove();t._isMsgSetup=false;e.stopPropagation()},_onClick:function(e){e.preventDefault();e.stopPropagation()}});SM.SidiPopout=SM.Widgets.register({__NAME:"sidipopout",__defaults:{templateID:"sidi-popout-msg-template",tipSide:"left",parentElement:document.body,at:"left top",showDelayTime:250,hideDelayTime:150,collision:"flip flip"},__init:function(e){this.$el.on("mouseenter",{popout:this},this._onMouseenter).on("mouseleave",{popout:this},this._onMouseleave)},_isHovered:false,_isMsgSetup:false,_$msg:undefined,_tipSide:undefined,_beforeShow:function(){var e,t=this;this._$msg=this.$el.find(".popout");this._$msg=this._$msg.clone();e=SM.Template.render(this.__settings.templateID,this.__settings);this._$msg.append(e);if(t.__settings.tipSide==="bottom"){t._$msg.css("width",100)}this._$msg.on("mouseenter",{popout:this},this._onMessageMouseenter).on("mouseleave",{popout:this},this._onMessageMouseleave).on(SM.Event.CLICK,"[data-dimension-id]",{popout:this},t._onClickCombineHide).addClass("sidi-tip-"+this.__settings.tipSide).appendTo(this.__settings.parentElement);this._isMsgSetup=true;return this},_show:function(){var e=this;if($("body").hasClass("noPopout")){return}setTimeout(function(){var t=e.$el.offset(),i=t.left,s=t.top;if(e._isHovered){if(e.__settings.tipSide==="left"||e.__settings.tipSide==="right"){if(e.__settings.tipSide==="left"){i+=e.$el.outerWidth()}else{i-=e._$msg.outerWidth()}s+=(e.$el.outerHeight()-e._$msg.outerHeight())/2}else{i+=(e.$el.outerWidth()-e._$msg.outerWidth())/2;if(e.__settings.tipSide==="bottom"){s-=e._$msg.outerHeight()+12}else{s+=e._$msg.outerHeight()}}e._$msg.addClass("open").css({left:Math.floor(i)+"px",top:Math.floor(s)+"px"});e.trigger("opened")}},e.get("showDelayTime"));return e},_hide:function(){var e=this;setTimeout(function(){if(!e._isHovered){e._$msg.remove();e._isMsgSetup=false}},e.get("hideDelayTime"));return e},_onMouseenter:function(e){var t=e.data.popout;t._isHovered=true;if(!t._isMsgSetup){t._beforeShow()._show()}},_onMouseleave:function(e){var t=e.data.popout;t._isHovered=false;t._hide()},_onMessageMouseenter:function(e){var t=e.data.popout;t._isHovered=true},_onMessageMouseleave:function(e){var t=e.data.popout;t._isHovered=false;t._hide()},_onClickCombineHide:function(e){var t=e.data.popout,i=$(e.currentTarget),s=i.attr("data-dimension-id"),n=t.__settings.question.getRollup().combinehideModel;if(s){n.unCombine(s)}else{n.unHideAll()}t._isHovered=false;t._hide()}});SM.Tabs=SM.Widgets.register({__NAME:"tabs",__defaults:{requireOpenTab:true},__setters:{selectedTab:function(e,t){e.open(t)}},__getters:{selectedTab:function(e){return e._selectedTab}},__init:function(){this._cacheData()._initTab()._bindEvents()},open:function(e){var t,i=this._selectedTab;if(typeof e!=="string"){e=this._getKeyFromIndex(e)}t=this._tabs[e];if(!t){return this}if(t.$tab.hasClass("disabled")||i===e){return this}this._opening=t;this._closeOpenTab();if(!this._selectedTab){this._open(t)}this._opening=undefined;return this},close:function(e){var t,i=this._selectedTab;if(e===undefined&&!this.__settings.requireOpenTab){this._closeOpenTab();return this}if(typeof e!=="string"){e=this._getKeyFromIndex(e)}t=this._tabs[e];if(t&&i===t.key&&!this.__settings.requireOpenTab){this._close(t)}return this},_selectedTab:undefined,_tabs:undefined,_close:function(e){var t=$.Event("beforeClose",{tab:e,opening:this._opening});this.__trigger(t);if(t.isDefaultPrevented()){return this}e.$panel.removeClass("open");e.$tab.removeClass("active");this._selectedTab=undefined;this.__trigger({type:"afterClose",tab:e});return this},_open:function(e){this.__trigger({type:"beforeOpen",tab:e});this._setOpenView(e);return this},_setOpenView:function(e){this._selectedTab=e.key;e.$tab.addClass("active");e.$panel.addClass("open")},_bindEvents:function(){this.$el.children("nav").find(".tab").on("click",{tabs:this},this._onTabClick);return this},_initTab:function(){var e=this.$el.children("nav").find(".tab.active"),t,i;if(e.length){t=e.attr("tab-target");i=this._tabs[t];this._setOpenView(i)}return this},_closeOpenTab:function(){var e=this._selectedTab,t;if(e===undefined){return this}t=this._tabs[e];this._close(t);return this},_cacheData:function(){var e,t,i=0,s,n,r;r=this.$el.children("nav").find(".tab");t=r.length;this._tabs={};for(;i<t;i++){s=r.eq(i);e=s.attr("tab-target");n=this.$el.find(".panel[tab="+e+"]");this._tabs[e]={index:i,$tab:s,key:e,$panel:n}}return this},_getKeyFromIndex:function(e){var t,i=this._tabs;for(t in i){if(i[t].index===e){return i[t].key}}},_onTabClick:function(e){var t=e.data.tabs,i=$(this),s;e.preventDefault();s=i.attr("tab-target");if(t.__settings.noClickTab===s){return}if(t._selectedTab===s){t.close(s)}else{t.open(s)}}});SM.Form=SM.Widgets.register({__NAME:"form",__defaults:{formErrorsClass:"form-errors",formGroupErrorClass:"has-error",formControlErrorsClass:"form-control-errors",formControlErrorMessageClass:"form-control-error-message"},__init:function(e){var t=this;t.formView=e.formView;e.formView=null;t.options=SM.Object.deepUpdate(t.__defaults,e);t.validations=t.formView.validations;t.errors=[]},attrs:function(){var e={},t;t=this.$el.serializeArray();_.each(t,function(t){e[t.name]=t.value});return e},validate:function(){var e=this,t=e.options.formErrorsClass,i=e.options.formGroupErrorClass,s=e.options.formControlErrorsClass,n=e.options.formControlErrorMessageClass;var r=function(t,i){var s=true,n,r;if(t["if"]){s=t["if"]()}else if(t["ifChecked"]){n=e.$el.find(t["ifChecked"]);if(n.length){s=n.prop("checked")}else{SM.log("Could not find "+t["ifChecked"])}}if(s){if(t.type==="presence"){r=e.$el.find(i).val();if(_.isEmpty(r)){e.errors.push([i,t.message])}}else if(t.type==="length"){r=e.$el.find(i).val();if(_.has(t,"exactly")&&r.length!==t.exactly){e.errors.push([i,t.message])}if(_.has(t,"min")&&r.length<t.min){e.errors.push([i,t.message])}if(_.has(t,"max")&&r.length>t.max){e.errors.push([i,t.message])}}}};e.errors=[];e.$el.find("."+t).hide();e.$el.find("."+i).removeClass(i);e.$el.find("."+s).remove();_.each(e.validations,function(e,t){if(!_.isArray(e)){r(e,t)}else{_.each(e,function(e){r(e,t)})}});var a,o,l,u;if(e.errors.length){e.$el.find("."+t).show();_.each(e.errors,function(t){a=t[0];o=t[1];l=e.$el.find(a);l.parents(".form-group").eq(0).addClass(i);u=l.next("."+s);if(!u.length){u=$("<div class='"+s+"'></div>");l.after(u)}u.append("<p class='"+n+"'>"+o+"</p>")})}},isValid:function(){this.validate();return _.isEmpty(this.errors)}});SM.SideTab=SM.Widgets.register({__NAME:"sideTab",__init:function(){var e=this,t;if(SM.Browser.isIE7){return}if(!this._supportsMediaQuery){this._bindWindowResize()}this.$el.appendTo(document.body);t=this._getBottomValue();this.$el.css("bottom",t);setTimeout(function(){var t=e._getRightValues();e.$el.css("right",t.normal);e.$el.hover(function(){e.$el.addClass("fast").css("right",t.hover)},function(){e.$el.css("right",t.normal)});if(!e._supportsMediaQuery){e._hasShown=true;e._$window.trigger("resize")}},1800)},_supportsMediaQuery:SM.Browser.support.mediaQuery(),_$window:$(window),MIN_SCREEN_WIDTH:1040,INITIAL_BOTTOM:30,SPACING:7,_bindWindowResize:function(){var e=this;this._hasShown=false;this._$window.on("resize",function(t){if(e._hasShown){if(e._$window.width()>e.MIN_SCREEN_WIDTH){e.$el.show()}else{e.$el.hide()}}})},_getRightValues:function(){var e=this.$el.outerWidth(),t=this.$el.outerHeight(),i,s;if(SM.Browser.isIE8){s=-1*(t-e)}else{s=-1*((e-t)/2)}i=Math.floor(s);s=i-5;return{hover:i,normal:i-5}},_getBottomValue:function(){var e=this.$el.prev(".sidetab"),t;if(e.length){t=this._getPreviousTopValue(e)+this.SPACING}else{t=this.INITIAL_BOTTOM}return t+this._getRotationAdjustment()},_getRotationAdjustment:function(){var e=this.$el.outerWidth(),t=this.$el.outerHeight();if(SM.Browser.isIE8){return t-e}else{return e-(e+t)/2}},_getPreviousTopValue:function(e){var t=e.outerWidth(),i=e.outerHeight(),s=parseInt(e.css("bottom"),10),n;if(SM.Browser.isIE8){n=t;return n+s}else{n=(t+i)/2;return n+s}}});SM.Timepicker=SM.Widgets.register({__NAME:"timepicker",__defaults:{minuteIncrement:15,militaryTime:false,time:null},__init:function(){var e={hours:-1,minutes:-1,ampm:"AM"};if(this.__settings.time){e=this._parseTime(this.__settings.time)}this._createMenus(e);this.bind("selectMenu.change",".hour-menu-btn",this._hoursPicked).bind("selectMenu.change",".minute-menu-btn",this._minutesPicked);if(!this.__settings.militaryTime){this.bind("selectMenu.change",".ampm-menu-btn",this._ampmPicked)}else{this.$el.find(".ampm-menu-btn").hide()}},__setters:{date:function(e,t){var i=e._parseTime(t);e._setMenus(i)},hours:function(e,t){var i,s;if(!e.__settings.militaryTime){s=e._convertHoursToAMPM(t);t=s.hours;i=s.ampm;e._ampm.set("value",i)}e._hours.set("value",t)},minutes:function(e,t){e._minutes.set("value",t)},ampm:function(e,t){e._ampm.set("value",t)},time:function(e,t){e.set("date",t)}},__getters:{isMilitaryTime:function(e){if(Globalize.usesMilitaryTime()){return true}return e.__settings.militaryTime},time:function(e){var t=parseInt(e._hours.get("value"),10),i=parseInt(e._minutes.get("value"),10),s;if(!e.__settings.militaryTime&&t>=0){s=e._ampm.get("value");if(t===12){if(s==="AM"){t=0}}else{if(s==="PM"){t+=12}}}return{hours:t,minutes:i}}},_createMenus:function(e){var t=Globalize.getSmartlingCulture();this._hours=this.$el.find(".hour-menu-btn").selectMenu({menuView:"HourSelectMenuView",selectWidth:"auto",selectedValue:e.hours,militaryTime:this.__settings.militaryTime}).data("selectMenu");this._minutes=this.$el.find(".minute-menu-btn").selectMenu({menuView:"MinuteSelectMenuView",selectWidth:"auto",selectedValue:e.minutes,increment:this.__settings.minuteIncrement}).data("selectMenu");if(!this.get("isMilitaryTime")){this._ampm=this.$el.find(".ampm-menu-btn").selectMenu({options:[{text:Globalize.cultures[t].calendar.AM[0],value:"AM"},{text:Globalize.cultures[t].calendar.PM[0],value:"PM"}],selectWidth:"auto",selectedValue:e.ampm}).data("selectMenu")}},_setMenus:function(e){this._hours.set("value",e.hours.toString());this._minutes.set("value",e.minutes.toString());if(!this.__settings.militaryTime){this._ampm.set("value",e.ampm)}},_convertHoursToAMPM:function(e){if(e===12){ampm="PM"}else if(e>12){e=e-12;ampm="PM"}else{ampm="AM";if(e===0){e=12}}return{hours:e,ampm:ampm}},_parseTime:function(e){var t=e.getHours(),i=e.getMinutes(),s,n=this.__settings.minuteIncrement,r,a;r=i%n;if(r>0){if(Math.floor(n/2)-r>0){i=i-r}else{i=i-r+n;if(i>=60){t++;i=0;if(t===24){t=0}}}}if(!this.__settings.militaryTime){a=this._convertHoursToAMPM(t);t=a.hours;s=a.ampm}return{hours:t,minutes:i,ampm:s}},_hoursPicked:function(e){var t=e.data.self;t.trigger("change")},_minutesPicked:function(e){var t=e.data.self;t.trigger("change")},_ampmPicked:function(e){var t=e.data.self;t.trigger("change")}});SM.Waterpark=SM.Widgets.register({__NAME:"waterpark",__init:function(){this.calculateAttributes()._bindEvents()._displayLocation(this.__settings.location)},__defaults:{location:{slide:0}},__setters:{location:function(e,t){e._setLocation(t)}},calculateAttributes:function(){var e=this.$el.find(".slide"),t=e.length,i,s;if(t%2!==0){t+=1}i=SM.Math.toPercentString(1/t,6),s=""+t*100+"%";this.$el.find(".mover").css("width",s);e.css("width",i);return this},_bindEvents:function(){this.$el.on("click","a.shifter",{waterpark:this},this._onShifterClick).on("click","a.custom-shifter",{waterpark:this},this._onCustomShiftClick).on("click","a.back-shifter",{waterpark:this},this._onBackClick);return this},_setLocation:function(e){var t=this.__settings.location,i=this,s;if(!e||e.slide===undefined){
return this}if(t&&e.slide===t.slide&&e.lane===t.lane){return this}this._displayLocation(e);this.__settings.location.slide=e.slide;this.__settings.location.lane=e.lane;this.__trigger("shift");this._startAfterTimer(e.slide,e.lane);return this},_startAfterTimer:function(e,t){var i=this.__settings.location,s=this;setTimeout(function(){if(i.slide===e&&i.lane===t){s.trigger("afterShift")}},300)},_displayLocation:function(e){var t,i=""+e.slide*-100+"%";if(!SM.Browser.isIE7){this.$el.find(".mover").css("margin-left",i)}t=this.$el.find(".slide").removeClass("current").eq(e.slide).addClass("current");if(e.lane){t.find(".lane").removeClass("open").filter("."+e.lane).addClass("open")}},_onShifterClick:function(e){var t=$(this),i=e.data.waterpark,s=t.attr("lane-target"),n=parseInt(t.attr("slide-target"),10);i._setLocation({slide:n,lane:s});e.preventDefault()},_onCustomShiftClick:function(e){var t=e.data.waterpark;t.__trigger("customShift");e.preventDefault()},_onBackClick:function(e){var t=$(this);var i=e.data.waterpark;var s=i.get("location").slide-1;i._setLocation({slide:s});e.preventDefault()}});SM.DialogView=SM.Views.deepExtend({__NAME:"dialog",__templateID:"dialog-template",__defaults:{isModal:false,isFixed:true,width:350,position:{my:"center",at:"center",collision:"none"},easyClose:true,closeBtn:true},_hasShownOnce:false,__afterRender:function(){var e;this.$el.css("width",this.__settings.width);if(this.__settings.title){this.$el.attr("title",this.__settings.title)}e=this.$el.attr("title");if(e){this._addTitlebar(e);this.$el.removeAttr("title")}if(this.__settings.closeBtn){this._addCloseBtn()}if(this._hasShownOnce){this.$el.addClass("open");this.$el.removeClass("close")}else{this.$el.addClass("close");this.$el.removeClass("open")}if(this.__settings.isFixed){this.$el.closest("dialog-container").addClass("fixed-dialog")}},__onBeforeOpen:function(){var e=this;$(window).on(SM.Event.RESIZE+"."+this.__NAME+this.__uid,{self:this},this._onResize);this.subscribe(SM.Event.KEYDOWN,this._onOpenKeydown);this.$el.on("click",".dialog-close-btn",{self:this},this._onCloseClick)},__onAfterOpen:function(){},__onBeforeClose:function(){$(window).off(SM.Event.RESIZE+"."+this.__NAME+this.__uid,this._onResize);this.unsubscribe(SM.Event.KEYDOWN,this._onOpenKeydown);this.$el.off("click",this._onCloseClick)},__onAfterClose:function(){},__onWindowResize:function(e){this.position()},open:function(e){if(this._isOpen){return this}if(e){SM.Object.update(this.__settings,e)}this.trigger("beforeOpen");this.__onBeforeOpen();this._open();return this},update:function(e){if(e.title){this._updateTitlebar(e.title)}},close:function(){var e=$.Event("beforeClose",{dialog:this});if(!this._isOpen){return this}this.trigger(e);if(e.isDefaultPrevented()){return this}this.__onBeforeClose();this._close();return this},position:function(){var e;if(!this.__settings.position.of){this.__settings.position.of=window}e=$.migrationFixPosition({my:this.__settings.position.my,at:this.__settings.position.at,of:this.__settings.position.of,offset:this.__settings.position.offset,within:this.__settings.position.within,collision:this.__settings.position.collision});this.$el.position(e);this.trigger("position")},isOpen:function(){return this._isOpen},_$overlay:null,_isOpen:false,_open:function(){var e,t,i=this;e=SM.Template.renderHTML("dialog-container-template");t=SM.Template.renderHTML("dialog-overlay-template",{isModal:this.__settings.isModal});this._$dialogContainer=$(e);this._$dialogContainer.appendTo(document.body);this._$overlay=$(t);if(this.$el.hasClass("dialog-b")){this._$overlay.addClass("dialog-overlay-b")}this._$overlay.appendTo(this._$dialogContainer);if(this.__settings.isModal&&this.__settings.isFixed){$("body").addClass("sm-fixed-dialog-modal")}if(this.__settings.easyClose){this._$overlay.on("click",{self:this},i._onOverlayClick)}this.$el.appendTo(this._$dialogContainer);this.position();setTimeout(function(){i._fadeIn()},0)},_close:function(){var e=this;this._$overlay.removeClass("open");this.$el.removeClass("open");this.$el.addClass("close");this._isOpen=false;this._hasShownOnce=false;if(this.__settings.isModal){$("body").removeClass("sm-fixed-dialog-modal")}setTimeout(function(){e._fadeOutComplete()},100)},_fadeIn:function(){this._$overlay.addClass("open");this.$el.addClass("open");this.$el.removeClass("close");this._isOpen=true;this._hasShownOnce=true;this.trigger("afterOpen");this.__onAfterOpen()},_fadeOutComplete:function(){this._$overlay.off("click");this._$overlay.remove();this._$overlay=null;this.$el.detach();this.trigger("afterClose");this._$dialogContainer.remove();this._$dialogContainer=null;this.__onAfterClose()},_addCloseBtn:function(){var e,t=this.$el.hasClass("dialog-b")?"dialog-close-btn-template-b":"dialog-close-btn-template";e=SM.Template.renderHTML(t);this.$el.prepend(e)},_updateTitlebar:function(e){this.$el.find(".dialog-title-bar").replaceWith(SM.Template.renderHTML("dialog-title-bar-template",{title:e}))},_addTitlebar:function(e){var t=SM.Template.renderHTML("dialog-title-bar-template",{title:e});this.$el.prepend(t)},_onCloseClick:function(e){e.data.self.close();e.preventDefault()},_onOverlayClick:function(e){e.data.self.close()},_onResize:function(e){var t=e.data.self;t.__onWindowResize(e)},_onOpenKeydown:function(e){var t=e.data.self;if(e.which===SM.KeyCodes.ESCAPE){t.close();e.preventDefault()}},_contains:function(e){return SM.DOM.contains(this.el,e)}});SM.BaseNotificationView=SM.Views.register({__NAME:"BaseNotificationView",__templateID:"notification-template",__defaults:{duration:5e3,expires:true,tabMessage:null},close:function(){this.notifications.close(this)},isInQueue:function(){this.notifications.isInQueue(this)}});SM.SuccessNotificationView=SM.Views.deepExtend(SM.BaseNotificationView,{__NAME:"SuccessNotificationView",__templateID:"status-notification-template",__defaults:{icon:"2"}});SM.ErrorNotificationView=SM.Views.deepExtend(SM.BaseNotificationView,{__NAME:"ErrorNotificationView",__templateID:"status-notification-template",__defaults:{icon:"!"}});SM.InfoNotificationView=SM.Views.deepExtend(SM.BaseNotificationView,{__NAME:"InfoNotificationView",__templateID:"status-notification-template",__defaults:{icon:"i"}});SM.Notifications={_queuedList:[],CLOSE_ANIMATION_TIME:700,OPEN_ANIMATION_TIME:700,error:function(e){var t=SM.Views.create(SM.ErrorNotificationView,e);this.init();t.$el.addClass("sm-notification-error");this.queue(t);return t},success:function(e){var t=SM.Views.create(SM.SuccessNotificationView,e);this.init();t.$el.addClass("sm-notification-success");this.queue(t);return t},info:function(e){var t=SM.Views.create(SM.InfoNotificationView,e);this.init();t.$el.addClass("sm-notification-info");this.queue(t);return t},template:function(e){var t=SM.Views.create(SM.BaseNotificationView,e);this.init();this.queue(t);return t},queue:function(e){e.$el.data("smnotification",e);e.notifications=this;this._queuedList.push(e);if(this._isWindowFocused){this._processQueue()}else{this._startTitleMessager()}},init:function(){if(this._hasInit){return}this._originalTitle=document.title;this._titleChangeIntervalID=null;this._isWindowFocused=true;this.el=SM.Template.renderHTML("notifications-container-template");this.$el=$(this.el);$(document.body).append(this.el);$(window).on("focus.smnotification",{self:this},this._onWindowFocus).on("blur.smnotification",{self:this},this._onWindowBlur);this.$el.on("click","[notification-close-btn]",{self:this},this._onCloseClick);this._hasInit=true},close:function(e){var t,i=this._getQueueIndex(e),s=this;if(i!==-1){this._queuedList.splice(i,1);return}if(!e.$el){return}t=e.$el.parents(".sm-notification-wrapper");if(!t.length||t.hasClass("close")){return}t.css({height:t.height()});e.set("isOpen",false);setTimeout(function(){t.addClass("close");setTimeout(function(){t.remove()},s.CLOSE_ANIMATION_TIME)},0)},open:function(e){var t=this,i=SM.Template.renderHTML("notification-wrapper-template"),s=$(i);s.append(e.el);this.$el.prepend(s);s.css({marginTop:-1*s.outerHeight()-10});e.set("isOpen",true);setTimeout(function(){s.addClass("open");if(e.get("expires")){setTimeout(function(){t.close(e)},t.OPEN_ANIMATION_TIME+e.get("duration"))}},0)},isInQueue:function(e){return this._getQueueIndex(e)!==-1},_getQueueIndex:function(e){var t=-1;$.each(this._queuedList,function(i,s){if(e.__uid===s.__uid&&e.__NAME===s.__NAME){t=i;return false}});return t},_processQueue:function(){var e=this,t;while(this._queuedList.length>0){t=this._queuedList.shift();e.open(t)}},_startTitleMessager:function(){var e=this,t=this._indexOfNextTabMessage(0);if(this._titleChangeIntervalID===null&&t!==-1){this._titleChangeIntervalID=setInterval(function(){if(t!==-1){document.title=e._queuedList[t].get("tabMessage");t=e._indexOfNextTabMessage(t+1)}else{document.title=e._originalTitle;t=e._indexOfNextTabMessage(0)}},2500)}},_stopTitleMessager:function(){if(this._titleChangeIntervalID){document.title=this._originalTitle;clearInterval(this._titleChangeIntervalID);this._titleChangeIntervalID=null}},_indexOfNextTabMessage:function(e){var t=this._queuedList.length;for(;e<t;e++){if(this._queuedList[e].get("tabMessage")){return e}}return-1},_onWindowFocus:function(e){var t=e.data.self;t._isWindowFocused=true;t._stopTitleMessager();t._processQueue()},_onWindowBlur:function(e){var t=e.data.self;t._isWindowFocused=false},_onCloseClick:function(e){var t=e.data.self,i,s=$(this).parents(".sm-notification");e.preventDefault();if(s.length){i=s.data("smnotification");if(i){t.close(i)}}}};SM.Tooltips={init:function(e){this.enable(e)},enable:function(e){e=SM.Object.extend({selector:"[title]",delay:1500,fadeIn:false,fadeOut:false,fadeTime:250},e);if(!SM.Browser.isOldIE){$(document).on("mouseenter.smtooltips",e.selector,{self:this,delay:e.delay,fadeIn:e.fadeIn,fadeOut:e.fadeOut,fadeTime:e.fadeTime},this._onMouseenter)}},disable:function(e){var t=e?e:"[title]";if(!SM.Browser.isOldIE){$(document).off("mouseenter.smtooltips",t)}},_onMouseenter:function(e){var t=e.data.self,i=e.data.delay,s=e.data.fadeTime,n=e.data.fadeIn,r=e.data.fadeOut,a=$(e.currentTarget),o;if(!a.data("tooltip")){o=t._getAttrs(a);if(!o.text){return}a.data("tooltip",o);a.removeAttr("title");a.on("click.smtooltips mouseleave.smtooltips remove.smtooltips",{self:t,fadeOut:r,fadeTime:s},t._destroy);setTimeout(function(){var e=a.data("tooltip");if(e&&!e.isShown){t._showTipOn(a,n,s)}},i)}},_destroy:function(e){var t=e.data.self,i=$(this),s=e.data.fadeOut,n=e.data.fadeTime,r;r=i.data("tooltip");if(!r){return}if(r.$el){if(s){r.$el.fadeOut(n,function(){r.$el.remove()})}else{r.$el.remove()}}i.off("mouseleave.smtooltips");i.off("remove.smtooltips");i.off("click.smtooltips");i.attr("title",r.text);i.data("tooltip",null)},_showTipOn:function(e,t,i){var s=e.data("tooltip"),n=SM.Object.copy(this._sides[s.side].position),r=this._build(s);s.$el=r;s.isShown=true;if(t){r.hide().appendTo(document.body).fadeIn(i)}else{document.body.appendChild(r[0])}n.of=e;r.position($.migrationFixPosition(n))},_build:function(e){var t=document.createElement("div"),i="tool-tip ";i+=this._sides[e.side].className;if(e.classes){i+=" "+e.classes}t.className=i;t.textContent=e.text;return $(t)},_sides:{left:{className:"tool-tip-left",position:{my:"right center",at:"left center",offset:"-5 0",collision:"none"}},right:{className:"tool-tip-right",position:{my:"left center",at:"right center",offset:"5 0",collision:"none"}},top:{className:"tool-tip-top",position:{my:"center bottom",at:"center top",offset:"0 -5",collision:"none"}},bottom:{className:"tool-tip-bottom",position:{my:"center top",at:"center bottom",offset:"0 5",collision:"none"}}},_getAttrs:function(e){return{text:e.attr("title"),side:e.attr("sm-tooltip-side")||"top",classes:e.attr("sm-tooltip-classes")}}};$.extend(SM.Object,{getOneKey:function(e){for(var t in e){return t}},getOnlyKey:function(e){var t=-1;for(var i in e){t++;if(t>0){throw"getOnlyKey() called on object with more than one key"}}return i},hasOnlyProperty:function(e,t){var i;for(i in e){if(e.hasOwnProperty(i)&&i!==t){return false}}return true}});SM.String.containsWordBoundary=function(e){return $.trim(e).length!==0};SM.String.truncateMiddle=function(e,t,i){if(e.length<=t){return e}i=i||"...";var s=i.length,n=t-s,r=Math.ceil(n/2),a=Math.floor(n/2);return e.substr(0,r)+i+e.substr(e.length-a)};SM.String.NON_BREAKING_HYPHEN=SM.Html.parse("&#8209;")[0].nodeValue;SM.String.NOT_AVAILABLE="Not Available";SM.String.localizeIfNotAvailable=function(e){return e===SM.String.NOT_AVAILABLE?Globalize.localize(SM.String.NOT_AVAILABLE):e};SM.String.textTitle=function(e){var t=$("<div></div>");t.html(e);return t.text()};SM.String.htmlStrip=function(e){return $("<p>"+_.escape(e)+"</p>").text()};SM.String.text=function(e){if(!e){return e}return $("<p>"+e+"</p>").text()};(function(e){"use strict";var t=typeof window==="undefined"?null:window;if(typeof define==="function"&&define.amd){define(function(){return e(t)})}else if(typeof module!=="undefined"){module.exports=e(t)}else{t.DOMPurify=e(t)}})(function e(t){"use strict";var i=function(t){return e(t)};i.version="0.8.3";i.removed=[];if(!t||!t.document||t.document.nodeType!==9){i.isSupported=false;return i}var s=t.document;var n=s;var r=t.DocumentFragment;var a=t.HTMLTemplateElement;var o=t.NodeFilter;var l=t.NamedNodeMap||t.MozNamedAttrMap;var u=t.Text;var h=t.Comment;var c=t.DOMParser;if(typeof a==="function"){var d=s.createElement("template");if(d.content&&d.content.ownerDocument){s=d.content.ownerDocument}}var f=s.implementation;var p=s.createNodeIterator;var _=s.getElementsByTagName;var g=s.createDocumentFragment;var m=n.importNode;var v={};i.isSupported=typeof f.createHTMLDocument!=="undefined"&&s.documentMode!==9;var S=function(e,t){var i=t.length;while(i--){if(typeof t[i]==="string"){t[i]=t[i].toLowerCase()}e[t[i]]=true}return e};var y=function(e){var t={};var i;for(i in e){if(e.hasOwnProperty(i)){t[i]=e[i]}}return t};var w=null;var M=S({},["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr","svg","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","switch","symbol","text","textpath","title","tref","tspan","view","vkern","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","feSpecularLighting","feTile","feTurbulence","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmuliscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mpspace","msqrt","mystyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","#text"]);var b=null;var D=S({},["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","coords","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","rows","rowspan","spellcheck","scope","selected","shape","size","span","srclang","start","src","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns","accent-height","accumulate","additivive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mode","min","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","surfacescale","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","u1","u2","unicode","values","viewbox","visibility","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","y","y1","y2","z","zoomandpan","accent","accentunder","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","display","displaystyle","fence","frame","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]);var x=null;var C=null;var E=true;var T=false;var A=false;var I=false;var R=/\{\{[\s\S]*|[\s\S]*\}\}/gm;var P=/<%[\s\S]*|[\s\S]*%>/gm;var V=false;var O=false;var k=false;var L=false;var N=true;var $=true;var B=S({},["audio","head","math","script","style","svg","video"]);var z=S({},["audio","video","img","source"]);var q=S({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]);var F=null;var H=s.createElement("form");var U=function(e){if(typeof e!=="object"){e={}}w="ALLOWED_TAGS"in e?S({},e.ALLOWED_TAGS):M;b="ALLOWED_ATTR"in e?S({},e.ALLOWED_ATTR):D;x="FORBID_TAGS"in e?S({},e.FORBID_TAGS):{};C="FORBID_ATTR"in e?S({},e.FORBID_ATTR):{};E=e.ALLOW_DATA_ATTR!==false;T=e.ALLOW_UNKNOWN_PROTOCOLS||false;A=e.SAFE_FOR_JQUERY||false;I=e.SAFE_FOR_TEMPLATES||false;V=e.WHOLE_DOCUMENT||false;O=e.RETURN_DOM||false;k=e.RETURN_DOM_FRAGMENT||false;L=e.RETURN_DOM_IMPORT||false;N=e.SANITIZE_DOM!==false;$=e.KEEP_CONTENT!==false;if(I){E=false}if(k){O=true}if(e.ADD_TAGS){if(w===M){w=y(w)}S(w,e.ADD_TAGS)}if(e.ADD_ATTR){if(b===D){b=y(b)}S(b,e.ADD_ATTR)}if($){w["#text"]=true}if(Object&&"freeze"in Object){Object.freeze(e)}F=e};var Q=function(e){i.removed.push({element:e});try{e.parentNode.removeChild(e)}catch(t){e.outerHTML=""}};var G=function(e,t){i.removed.push({attribute:t.getAttributeNode(e),from:t});t.removeAttribute(e)};var j=function(e){var t,i;try{t=(new c).parseFromString(e,"text/html")}catch(s){}if(!t||!t.documentElement){t=f.createHTMLDocument("");i=t.body;i.parentNode.removeChild(i.parentNode.firstElementChild);i.outerHTML=e}if(typeof t.getElementsByTagName==="function"){return t.getElementsByTagName(V?"html":"body")[0]}return _.call(t,V?"html":"body")[0]};var Y=function(e){return p.call(e.ownerDocument||e,e,o.SHOW_ELEMENT|o.SHOW_COMMENT|o.SHOW_TEXT,function(){return o.FILTER_ACCEPT},false)};var W=function(e){if(e instanceof u||e instanceof h){return false}if(typeof e.nodeName!=="string"||typeof e.textContent!=="string"||typeof e.removeChild!=="function"||!(e.attributes instanceof l)||typeof e.removeAttribute!=="function"||typeof e.setAttribute!=="function"){return true}return false};var J=function(e){var t,s;se("beforeSanitizeElements",e,null);if(W(e)){Q(e);return true}t=e.nodeName.toLowerCase();se("uponSanitizeElement",e,{tagName:t});if(!w[t]||x[t]){if($&&!B[t]&&typeof e.insertAdjacentHTML==="function"){try{e.insertAdjacentHTML("AfterEnd",e.innerHTML)}catch(n){}}Q(e);return true}if(A&&!e.firstElementChild&&(!e.content||!e.content.firstElementChild)&&/</g.test(e.textContent)){i.removed.push({element:e.cloneNode()});e.innerHTML=e.textContent.replace(/</g,"&lt;")}if(I&&e.nodeType===3){s=e.textContent;s=s.replace(R," ");s=s.replace(P," ");if(e.textContent!==s){i.removed.push({element:e.cloneNode()});e.textContent=s}}se("afterSanitizeElements",e,null);return false};var K=/^data-[\-\w.\u00B7-\uFFFF]/;var X=/^(?:(?:(?:f|ht)tps?|mailto|tel):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i;var Z=/^(?:\w+script|data):/i;var ee=/[\x00-\x20\xA0\u1680\u180E\u2000-\u2029\u205f\u3000]/g;var te=function(e){var n,r,a,o,l,u,h,c;se("beforeSanitizeAttributes",e,null);u=e.attributes;if(!u){return}h={attrName:"",attrValue:"",keepAttr:true};c=u.length;while(c--){n=u[c];r=n.name;a=n.value;o=r.toLowerCase();h.attrName=o;h.attrValue=a;h.keepAttr=true;se("uponSanitizeAttribute",e,h);a=h.attrValue;if(o==="name"&&e.nodeName==="IMG"&&u.id){l=u.id;u=Array.prototype.slice.apply(u);G("id",e);G(r,e);if(u.indexOf(l)>c){e.setAttribute("id",l.value)}}else{if(r==="id"){e.setAttribute(r,"")}G(r,e)}if(!h.keepAttr){continue}if(N&&(o==="id"||o==="name")&&(a in t||a in s||a in H)){continue}if(I){a=a.replace(R," ");a=a.replace(P," ")}if(E&&K.test(o)){}else if(!b[o]||C[o]){continue}else if(q[o]){}else if(X.test(a.replace(ee,""))){}else if(o==="src"&&a.indexOf("data:")===0&&z[e.nodeName.toLowerCase()]){}else if(T&&!Z.test(a.replace(ee,""))){}else if(!a){}else{continue}try{e.setAttribute(r,a);i.removed.pop()}catch(d){}}se("afterSanitizeAttributes",e,null)};var ie=function(e){var t;var i=Y(e);se("beforeSanitizeShadowDOM",e,null);while(t=i.nextNode()){se("uponSanitizeShadowNode",t,null);if(J(t)){continue}if(t.content instanceof r){ie(t.content)}te(t)}se("afterSanitizeShadowDOM",e,null)};var se=function(e,t,s){if(!v[e]){return}v[e].forEach(function(e){e.call(i,t,s,F)})};i.sanitize=function(e,s){var a,o,l,u,h;if(!e){e=""}if(typeof e!=="string"){if(typeof e.toString!=="function"){throw new TypeError("toString is not a function")}else{e=e.toString()}}if(!i.isSupported){if(typeof t.toStaticHTML==="object"||typeof t.toStaticHTML==="function"){return t.toStaticHTML(e)}return e}U(s);i.removed=[];if(!O&&!V&&e.indexOf("<")===-1){return e}a=j(e);if(!a){return O?null:""}u=Y(a);while(o=u.nextNode()){if(o.nodeType===3&&o===l){continue}if(J(o)){continue}if(o.content instanceof r){ie(o.content)}te(o);l=o}if(O){if(k){h=g.call(a.ownerDocument);while(a.firstChild){h.appendChild(a.firstChild)}}else{h=a}if(L){h=m.call(n,h,true)}return h}return V?a.outerHTML:a.innerHTML};i.addHook=function(e,t){if(typeof t!=="function"){return}v[e]=v[e]||[];v[e].push(t)};i.removeHook=function(e){if(v[e]){v[e].pop()}};i.removeHooks=function(e){if(v[e]){v[e]=[]}};i.removeAllHooks=function(){v={}};return i});SM.AjaxBase={init:function(){},Statuses:{SUCCESS:0,OK:200,NOT_FOUND:404,CONFLICT:409,SERVER_ERROR:500,BAD_GATEWAY:502},get:function(e,t,i){var s={dataType:"json",type:"GET",contentType:"application/json",processData:false,url:e,cache:false,headers:{}},n,r;if(i){$.extend(true,s,i)}if(t){n=new Uri(e);_.each(t,function(e,t){n.addQueryParam(t,e)});s.url=n.toString()}SM.log("Ajax GET:",JSON.stringify(s));r=$.ajax(s);r=this._normalizeRequest(r);return r},post:function(e,t,i){var s={dataType:"json",type:"POST",data:JSON.stringify(t),contentType:"application/json",processData:false,url:e,cache:false,headers:{}},n;if(i){$.extend(true,s,i)}SM.log("Ajax POST:",JSON.stringify(s));n=$.ajax(s);n=this._normalizeRequest(n);return n},destroy:function(e,t,i){var s={dataType:"json",type:"DELETE",data:JSON.stringify(t),contentType:"application/json",processData:false,url:e,cache:false,headers:{}},n;if(i){$.extend(true,s,i)}SM.log("Ajax DELETE:",JSON.stringify(s));n=$.ajax(s);n=this._normalizeRequest(n);return n},_normalizeRequest:function(e){var t=$.Deferred();$.when({dfd:t},e).done(this._done).fail(function(e,i,s){SM.Ajax._fail(t,e,i)});return t},_done:function(e,t){var i=t[0],s=t[1],n=t[2],r=e.dfd;if(i.status===SM.Ajax.Statuses.SUCCESS||i.status===SM.Ajax.Statuses.OK){if(i.data){r.resolve(i.data,s,n)}else{r.resolve(i,s,n)}}else{SM.log("Ajax done but not successful:",JSON.stringify(i));r.reject(i,s,n)}},_fail:function(e,t,i){var s;SM.log("Ajax fail, response text:",t.responseText);try{s=JSON.parse(t.responseText);if(s.status===SM.Ajax.Statuses.CONFLICT){SM.PubSub.publish("HTTP_CONFLICT");return}}catch(n){s={error_message:t.responseText}}e.reject(s,i,t)}};SM.Ajax=$.extend(true,{},SM.AjaxBase);SM.ApiBase={Paths:{},Urls:{},basePath:null,_addUrls:function(e,t){var i=this;_.each(t,function(t,s){i.Urls[s]=e+t})},init:function(e){var t=this;if(!t.basePath&&e){t.basePath=e.basePath;t._addUrls(t.basePath,t.Paths)}},extend:function(e,t){$.extend(true,this,t.API);if(t.Paths){e=e||"";this._addUrls(e,t.Paths)}},FORCE_FAIL:false,_prepare:function(e,t){var i=this.Urls[e];if(!i){throw"Unknown URL Key '"+e+"'"}if(t&&t.replacements){_.each(t.replacements,function(e,t){i=i.replace(e.key,e.value)})}if(this.FORCE_FAIL){i=i+"x"}return i},get:function(e,t,i){var s=this._prepare(e,i);return SM.Ajax.get(s,t,i)},post:function(e,t,i){var s=this._prepare(e,i);return SM.Ajax.post(s,t,i)},destroy:function(e,t,i){var s=this._prepare(e,i);return SM.Ajax.destroy(s,t,i)}};SM.API=$.extend(true,{},SM.ApiBase);SM.LogAPI={Paths:{LOG_INFO:"/ajax/log_info"},API:{hasLogAPI:true,logData:function(e,t,i){if($.type(t)==="string"){t={message:t}}t.level=e;t.url=window.location.href;return this.post("LOG_INFO",t,i)},logInfo:function(e,t){return this.logData("info",e,t)},logWarning:function(e,t){return this.logData("warning",e,t)},logError:function(e,t){return this.logData("error",e,t)},logDebug:function(e,t){return this.logData("debug",e,t)},logUiTrigger:null,logOptions:null,logInit:function(e){if(!e){throw"cannot init BI Logging"}if(!e.webapp){throw"no webapp set for BI Logging"}this.logOptions=e},addLogOptions:function(e){if(!this.logOptions){throw"can't add options - BI logging not init"}if(e){$.extend(true,this.logOptions,e)}},logSetUiTrigger:function(e){this.logUiTrigger=e},logBi:function(e,t){if(!this.logOptions){throw"BI Logging not initialized"}var i=$.extend(true,{ui_trigger:this.logUiTrigger},this.logOptions,e);this.logUiTrigger=null;return this.logInfo(i,t)}}};SM.Error={MAX_ERRLEN:400,init:function(){window.onerror=this._onWindowError},log:function(e,t){var i=e.stack;if(!e){return}if(!e.message){e.message="no message"}if(!e.name){e.name="UndefinedException"}if(SM.DEBUG){setTimeout(function(){if(t){SM.log(t)}if(i){SM.log(i)}throw e},0)}else{if(!t){t="No details."}if(!i){i="No trace."}SM.API.logError({name:e.name,message:e.message,details:t,trace:i})}},makeErrorMessage:function(e,t,i){var s="Unknown Error";if(e.data&&e.data.error_message){s=e.data.error_message}else if(e.exceptionMessage){s=e.exceptionMessage}else if(e.error){s="Error "+e.status+": "+e.error}else{s="Error "+i.status+": "+i.statusText}s=SM.String.truncate(s,this.MAX_ERRLEN,true);return s},_isThirdPartyScript:function(e){var t,i;e=this._parseUrl(e);if(!e||!e.host){return false}t=e.host.split(".");if(t.length!==3){return true}i=window.location.host.split(".");if(t[1]!==i[1]){return true}return false},_parseUrl:function(e){var t;if(!e){return null}t=document.createElement("a");t.href=e;return{raw:t.href,host:t.hostname,scheme:t.protocol,path:t.pathname,query:t.query,hash:t.hash}},_onWindowError:function(e,t,i){if(SM.DEBUG||SM.TEST){return false}else{try{if(SM.Error._isThirdPartyScript(t)){SM.API.logWarning({name:"ThirdPartyException",message:e,scriptUrl:t})}else{SM.API.logError({name:"UncaughtException",message:e})}}catch(s){}window.onerror=undefined;return true}}};SM.Bi={_makeBaseLog:function(e,t){var i={survey_id:SM.API.surveyID,user_id:SM.API.userID};return i},anViewRename:function(e){return SM.API.logBi({action_type:"analyze_view_rename",view_id:e.ID})},anViewDelete:function(e){return SM.API.logBi({action_type:"analyze_view_delete",view_id:e.ID,is_selected:e.isSelected})},anViewRevert:function(e){return SM.API.logBi({action_type:"analyze_view_revert",view_id:e.ID})},anViewSelect:function(e){return SM.API.logBi({action_type:"analyze_view_select",view_id:e.ID})},anViewCreate:function(e){return SM.API.logBi({action_type:"analyze_view_create",view_id:e.ID})},anViewSave:function(e){return SM.API.logBi({action_type:"analyze_view_save",view_id:e.ID})},_makeExportLog:function(e){var t=this._makeBaseLog();_.extend(t,{action_type:"analyze_export_create",export_format:e.format,export_type:e.export_type,include_openended:e.export_data.include_openended,show_word_cloud:e.export_data.show_word_cloud,one_question_per_page:e.export_data.forced_page_break,page_dimension:e.export_data.dimension,page_orientation:e.export_data.orientation});if(e.export_type==="full"){t.respondent_id=e.export_data.respondent_id;t.timezone_offset=e.export_data.timezone_offset}return t},exportCreate:function(e){var t=this._makeExportLog(e);return SM.API.logBi(t)},_makeRuleLog:function(e){var t=this._makeBaseLog();_.extend(t,{rule_id:e.ID,rule_type:e.ruleType,rule_family:e.ruleFamily,is_selected:e.selected,has_custom_heading:!!e.customHeader});return t},ruleApplied:function(e){var t=this._makeRuleLog(e);t.action_type="analyze_rule_changed";return SM.API.logBi(t)},ruleCopy:function(e){var t=this._makeRuleLog(e);t.action_type="analyze_rule_copy";return SM.API.logBi(t)},ruleToggle:function(e){var t=this._makeRuleLog(e);t.action_type="analyze_rule_toggle";t.is_selected=!t.is_selected;return SM.API.logBi(t)},ruleRename:function(e){var t=this._makeRuleLog(e);t.action_type="analyze_rule_rename";return SM.API.logBi(t)},ruleDelete:function(e){var t=this._makeRuleLog(e);t.action_type="analyze_rule_delete";return SM.API.logBi(t)},_makeSharedViewLog:function(e){var t=e.get("modes"),i=this._makeBaseLog();_.extend(i,{share_view_id:e.id,is_public:e.is_public,allow_team_export:e.allow_team_export,has_password:e.has_password,hide_open_ended:e.hide_open_ended,mode_summary:_.contains(t,"summary"),mode_browse:_.contains(t,"browse"),mode_trends:_.contains(t,"trends"),branding:e.branding,custom_branding:e.custom_branding,share_enabled:e.enabled,shared_view_id:e.sharable_view_id,default_view_id:e.default_view_id,share_id:e.id});return i},sharedViewSave:function(e){var t=this._makeSharedViewLog(e);t.action_type="analyze_shared_view_save";return SM.API.logBi(t)},sharedViewToggle:function(e){var t=this._makeSharedViewLog(e);t.action_type="analyze_shared_view_toggle";t.share_enabled=!t.share_enabled;return SM.API.logBi(t)},sharedViewRename:function(e){var t=this._makeSharedViewLog(e);t.action_type="analyze_shared_view_rename";
return SM.API.logBi(t)},sharedViewVisit:function(e){var t=this._makeSharedViewLog(e);t.action_type="analyze_shared_view_visit";return SM.API.logBi(t)},sharedViewGetWeblink:function(e){var t=this._makeSharedViewLog(e);t.action_type="analyze_shared_view_get_weblink";return SM.API.logBi(t)},sharedViewDelete:function(e){var t=this._makeSharedViewLog(e);t.action_type="analyze_shared_view_delete";return SM.API.logBi(t)},customizeQuestion:function(e,t,i){var s=SM.Object.deepCopy(e);s.action_type="analyze_question_customize";s.question_id=i.ID;s.apply_to_all=t;s.customized_labels="labels"in s;delete s.labels;s.customized_colors="colors"in s;delete s.colors;return SM.API.logBi(s)},answersHide:function(e){var t={action_type:"analyze_answers_hide",question_id:e.ID};return SM.API.logBi(t)},answersUnhide:function(e){var t={action_type:"analyze_answers_unhide",question_id:e.ID};return SM.API.logBi(t)},answersUnhideAll:function(e){var t={action_type:"analyze_answers_unhide_all",question_id:e.ID};return SM.API.logBi(t)},answersEditCombine:function(e){var t={action_type:"analyze_answers_edit_combine",question_id:e.ID};return SM.API.logBi(t)},answersUncombine:function(e){var t={action_type:"analyze_answers_uncombine",question_id:e.ID};return SM.API.logBi(t)},answersCombine:function(e){var t={action_type:"analyze_answers_combine",question_id:e.ID};return SM.API.logBi(t)},_makeRespondentLog:function(e){var t=this._makeBaseLog();_.extend(t,{respondent_id:e.ID,collection_mode:e.details.collection_mode,collector_id:e.details.collector_id,ip_address:e.details.ip_address,status:e.details.status});return t},respondentDelete:function(e){var t=this._makeRespondentLog(e);t.action_type="analyze_respondent_delete";return SM.API.logBi(t)},respondentBrowse:function(){var e={action_type:"analyze_respondent_browse"};return SM.API.logBi(e)},respondentEdit:function(e){var t=this._makeRespondentLog(e);t.action_type="analyze_respondent_edit";return SM.API.logBi(t)},trendsQuestionZoomSelected:function(e,t){var i=this._makeBaseLog();_.extend(i,{action_type:"analyze_trends_question_zoom_change",question_id:e.ID,zoom:t});return SM.API.logBi(i)},trendsSurveyZoomSelected:function(e){var t=this._makeBaseLog();_.extend(t,{action_type:"analyze_trends_survey_zoom_change",zoom:e});return SM.API.logBi(t)},trendsQuestionTrendBySelected:function(e,t){var i=this._makeBaseLog();_.extend(i,{action_type:"analyze_trends_question_trendby_change",question_id:e.ID,trend_by:t});return SM.API.logBi(i)},trendsSurveyTrendBySelected:function(e){var t=this._makeBaseLog();_.extend(t,{action_type:"analyze_trends_survey_trendby_change",trend_by:e});return SM.API.logBi(t)},trendsQuestionChartTypeSelected:function(e,t){var i=this._makeBaseLog();_.extend(i,{action_type:"analyze_trends_question_chart_change",chart_type:t,question_id:e.ID});return SM.API.logBi(i)},trendsSurveyChartTypeSelected:function(e){var t=this._makeBaseLog();_.extend(t,{action_type:"analyze_trends_survey_chart_change",chart_type:e});return SM.API.logBi(t)},trendsQuestionDisplayOptionsSelected:function(e,t){var i=this._makeBaseLog();_.extend(i,{action_type:"analyze_trends_question_display_options_change",question_id:e.ID,display_option:t});return SM.API.logBi(i)},_logBenchmarkingData:function(e){e.log_category="benchmarking";e.has_paid_benchmark=SM.App.survey.dataSegmentList.hasPaidBenchmarks();e.has_restricted=SM.App.survey.owner.benchmarkingRestrictedEnabled;return SM.API.logBi(e)},benchmarkingProfilerDialogOpened:function(e,t){var i=this._makeBaseLog();_.extend(i,{action_type:"profiler_dialog_opened",action_source:t});SM.API.logSetUiTrigger(e);return this._logBenchmarkingData(i)},benchmarkingProfilerDialogClosed:function(e,t,i){var s=this._makeBaseLog(),n=SM.App.survey.dataSegmentList.getSelectedSegment();_.extend(s,{action_type:"profiler_dialog_closed",action_source:t,canceled:i});if(!i){s.segment_name=n.getCanonicalName()}SM.API.logSetUiTrigger(e);return this._logBenchmarkingData(s)},_getQuestionData:function(e){var t=SM.App.survey,i={},s;if(e){s=t.getQuestion(e);if(s){i.logicalId=s.logicalID;i.logicalName=s.logicalName;i.logicalLangId=s.logicalLangId;return i}}},benchmarkingShowHide:function(e,t,i){var s=SM.App.survey.dataSegmentList.getSelectedSegment(),n=this._makeBaseLog(),r=this._getQuestionData(e);_.extend(n,{action_type:"benchmarks_show_hide",show_hide:t,action_source:"question",all:i,segment_name:s.getCanonicalName()});if(r){n.question_id=e;n.logical_question_id=r.logicalId;n.question_name=r.logicalName;n.lang_question_id=r.logicalLangId}SM.API.logSetUiTrigger("benchmarking_show_hide_button");return this._logBenchmarkingData(n)},benchmarkingDownloadCSV:function(e,t,i){var s=this._makeBaseLog(),n=this._getQuestionData(e);_.extend(s,{action_type:"benchmarks_download_csv",segment_id:t,action_source:i});if(n){s.question_id=e;s.logical_question_id=n.logicalId;s.question_name=n.logicalName;s.lang_question_id=n.logicalLangId}SM.API.logSetUiTrigger("benchmarking_download_csv_menu_action");return this._logBenchmarkingData(s)},benchmarkingAbout:function(e,t,i,s){var n=this._makeBaseLog(),r=this._getQuestionData(e);_.extend(n,{action_type:"benchmarks_about",action_source:t,destUrl:i,isNPS:s});if(r){n.question_id=e;n.logical_question_id=r.logicalId;n.question_name=r.logicalName;n.lang_question_id=r.logicalLangId}SM.API.logSetUiTrigger("benchmarking_about_menu_action");return this._logBenchmarkingData(n)},benchmarkingBuyMore:function(e,t,i,s,n,r){var a=this._makeBaseLog(),o=this._getQuestionData(e);_.extend(a,{action_type:"benchmarks_buy",action_source:i,destUrl:s,has_restricted:n,isNPS:r});if(!SM.App.survey.isStoreTemplate()){a.action_type="benchmarks_request"}if(o){a.question_id=e;a.logical_question_id=o.logicalId;a.question_name=o.logicalName;a.lang_question_id=o.logicalLangId}SM.API.logSetUiTrigger(t);return this._logBenchmarkingData(a)},logUserProfileState:function(e,t,i,s,n,r,a,o){var l=this._makeBaseLog();_.extend(l,{log_category:"benchmarking",action_type:"user_scenario_state",has_valid_entity:e,has_collector_profile:t,has_opt_out:i,has_restricted:s,has_paid_benchmark:n,benchmarks_shown:r,question_set:a,gei_fe_shown:o,webapp:SM.API.logOptions.webapp,survey_id:SM.API.logOptions.survey_id});return SM.API.logInfo(l)},logUpsellTooltipOpened:function(e){var t=this._makeBaseLog(),i=this._getQuestionData(e);_.extend(t,{action_type:"upsell_tooltip_opened",action_source:"question"});if(i){t.question_id=e;t.logical_question_id=i.logicalId;t.question_name=i.logicalName;t.lang_question_id=i.logicalLangId}SM.API.logSetUiTrigger("icon");return this._logBenchmarkingData(t)},logProfilerMarketingDialog:function(e,t){var i=this._makeBaseLog();_.extend(i,{action_type:"interstitial_modal_opened",action_source:"accordion",upsell_segment:t});SM.API.logSetUiTrigger(e);return this._logBenchmarkingData(i)},logSegmentSwitch:function(e,t,i){var s=SM.App.survey.isTMBCTemplate(),n=this._makeBaseLog();_.extend(n,{action_type:"benchmarks_segment_switch"});n.action_source=i||"accordion";if(e===""){e=s?"standout_gei_benchmark":"survey_monkey_global_benchmark"}if(t===""){t=s?"standout_gei_benchmark":"survey_monkey_global_benchmark"}n.segment_name=t;n.origin_segment_name=e;return this._logBenchmarkingData(n)},logSegmentRemoved:function(e){var t=this._makeBaseLog();_.extend(t,{action_type:"benchmarks_segment_removed",action_source:"accordion"});t.segment_name=e;return this._logBenchmarkingData(t)}};SM.Ajax=$.extend(true,{},SM.AjaxBase,{init:function(e){SM.AjaxBase.init.call(this);this.appVersion=e},__prepare:function(e){e=e||{headers:{}};if(!e.headers){e.headers={}}e.headers["SM-Analyze-Version"]=this.appVersion;return e},get:function(e,t,i){i=this.__prepare(i);return SM.AjaxBase.get.call(this,e,t,i)},post:function(e,t,i){i=this.__prepare(i);return SM.AjaxBase.post.call(this,e,t,i)},destroy:function(e,t,i){i=this.__prepare(i);return SM.AjaxBase.destroy.call(this,e,t,i)}});SM.AnalyzeAPI={Paths:{FETCH_RESPONSES:"/ajax/respondents/responses",DELETE_RESPONDENT:"/ajax/respondents/delete",FETCH_ROLLUPS:"/ajax/questions/rollups",FETCH_TREND_ROLLUPS:"/ajax/questions/trend_rollups",DELETE_VIEW:"/ajax/view/delete",DUPLICATE_VIEW:"/ajax/view/duplicate",EDIT_VIEW:"/ajax/view/edit",SWITCH_VIEW:"/ajax/view/switch",EXPORT_DELETE:"/ajax/export/delete",EXPORT_CREATE:"/ajax/export/create",EXPORT_LIST:"/ajax/export/list",TA_GET_ROLLUP_QUESTION:"/ajax/ta/rollup/by_question",TA_GET_ROLLUP_SEARCH:"/ajax/ta/rollup/by_search",TA_GET_ROLLUP_PHRASE:"/ajax/ta/rollup/by_phrase",TA_TEXT_TAG_ALL:"/ajax/ta/response_texts/tag_all",TA_TEXT_TAG_EXCEPT:"/ajax/ta/response_texts/tag_except",TA_EDIT_TAG:"/ajax/ta/question_tags/update",TA_DELETE_TAG:"/ajax/ta/question_tags/delete",TA_CREATE_TAG:"/ajax/ta/question_tags/create",FILO_BY_SEARCH:"/ajax/filo/rollup/by_search",FILO_BY_QUESTION:"/ajax/filo/rollup/by_question",FILO_DELETE:"/ajax/filo/delete/by_respondents",BM_GET_BENCHMARK_ROLLUPS:"/ajax/bm/get_benchmark_rollups",MERVEYS_COMPLETE_SURVEY_MERGE:"/ajax/merveys/merge_complete",MERVEYS_SAVE_DISPLAY_OPTIONS:"/ajax/merveys/set_display_options"},API:{fetchRespondentsAnalyze:function(e,t){return this.post("FETCH_RESPONSES",e,t)},createExportAnalyze:function(e,t){return this.post("EXPORT_CREATE",e,t)},getExportListAnalyze:function(e,t){return this.post("EXPORT_LIST",e,t)},taGetRollupQuestionAnalyze:function(e,t){return this.post("TA_GET_ROLLUP_QUESTION",e,t)}}};SM.SharingAPI={Paths:{FETCH_SHARED_RESPONSES:"/ajax/shared-view/{shared_view_key}/respondents/responses",SHARED_VIEWS_EXPORT_CREATE:"/ajax/shared-view/{shared_view_key}/export/create",SHARED_VIEWS_EXPORT_GET:"/ajax/shared-view/{shared_view_key}/export/get",TA_GET_ROLLUP_SHARED_QUESTION:"/ajax/shared-view/{shared_view_key}/ta/rollup/by_question",SHARED_VIEWS_LIST:"/ajax/shared_views{shared_view_path}"},API:{postShared:function(e,t,i){var s=SM.Object.extend({replacements:[{key:"{shared_view_key}",value:SM.App.sharedView.get("key")}]},i);return this.post(e,t,s)},fetchRespondentsShared:function(e,t){return this.postShared("FETCH_SHARED_RESPONSES",e,t)},createExportShared:function(e,t){return this.postShared("SHARED_VIEWS_EXPORT_CREATE",e,t)},getExportListShared:function(e,t){return this.postShared("SHARED_VIEWS_EXPORT_GET",e,t)},taGetRollupQuestionShared:function(e,t){return this.postShared("TA_GET_ROLLUP_SHARED_QUESTION",e,t)},fetchSharedViewList:function(e,t){t=t||{};if(!t.replacements){t.replacements=[{key:"{shared_view_path}",value:""}]}return this.get("SHARED_VIEWS_LIST",e,t)}}};SM.API=$.extend(true,{},SM.ApiBase,{init:function(e){SM.ApiBase.init.call(this);this.surveyID=e;this.userID=0;this.extend("/analyze",SM.LogAPI);this.logInit({webapp:"analyze",survey_id:e});this.extend("/analyze",SM.AnalyzeAPI);this.extend("/results",SM.SharingAPI)},post:function(e,t,i){var s=SM.Object.extend({survey_id:this.surveyID},t);return SM.ApiBase.post.call(this,e,s,i)},fetchRespondents:function(e,t){if(SM.App.isSharingApp()){return this.fetchRespondentsShared(e,t)}else{return this.fetchRespondentsAnalyze(e,t)}},deleteRespondent:function(e,t){return this.post("DELETE_RESPONDENT",e,t)},fetchRollups:function(e,t){return this.post("FETCH_ROLLUPS",e,t)},fetchTrends:function(e,t){return this.post("FETCH_TREND_ROLLUPS",e,t)},editView:function(e,t){return this.post("EDIT_VIEW",e,t)},deleteView:function(e,t){return this.post("DELETE_VIEW",e,t)},duplicateView:function(e,t){return this.post("DUPLICATE_VIEW",e,t)},switchView:function(e,t){return this.post("SWITCH_VIEW",e,t)},createExport:function(e,t){SM.Bi.exportCreate(e.exportjob);if(SM.App.isSharingApp()){return this.createExportShared(e,t)}else{return this.createExportAnalyze(e,t)}},getExportList:function(e,t){if(SM.App.isSharingApp()){return this.getExportListShared(e,t)}else{return this.getExportListAnalyze(e,t)}},deleteExport:function(e,t){return this.post("EXPORT_DELETE",e,t)},setUser:function(e){this.userID=e},taGetRollupQuestion:function(e,t){if(SM.App.isSharingApp()){return this.taGetRollupQuestionShared(e,t)}else{return this.taGetRollupQuestionAnalyze(e,t)}},taGetRollupSearch:function(e,t){return this.post("TA_GET_ROLLUP_SEARCH",e,t)},taGetRollupPhrase:function(e,t){return this.post("TA_GET_ROLLUP_PHRASE",e,t)},taTagAllText:function(e,t){return this.post("TA_TEXT_TAG_ALL",e,t)},taTagExceptText:function(e,t){return this.post("TA_TEXT_TAG_EXCEPT",e,t)},taDeleteTag:function(e,t){return this.post("TA_DELETE_TAG",e,t)},taCreateTag:function(e,t){return this.post("TA_CREATE_TAG",e,t)},taEditTag:function(e,t){return this.post("TA_EDIT_TAG",e,t)},bmFetchBenchmarkRollups:function(e,t){return this.post("BM_GET_BENCHMARK_ROLLUPS",e,t)},merveysCompleteMerge:function(e,t){return this.post("MERVEYS_COMPLETE_SURVEY_MERGE",e,t)},saveMerveysDisplayOptions:function(e,t){return this.post("MERVEYS_SAVE_DISPLAY_OPTIONS",e,t)},filoDelete:function(e,t){return this.post("FILO_DELETE",e,t)},filoBySearch:function(e,t){return this.post("FILO_BY_SEARCH",e,t)},filoByQuestion:function(e,t){return this.post("FILO_BY_QUESTION",e,t)}});SM.FunctionTimer={time:function(e,t){var i=(new Date).getTime();e();var s=(new Date).getTime();if(t){SM.log("Took "+(s-i)+"ms to call "+t)}else{SM.log("Took "+(s-i)+"ms")}}};SM.TrendLib={getDefaultScales:function(e,t,i){var s=e/this.HOUR,n=t?this.zoomMapping:this.zoomMapping_inactive,r={},a,o,l;for(l in n){if(s<=n[l]){r.zoom=l;r.zoomMax=l;r.trend=i;r.label=this.getLabelUnit(r.zoom,r.trend);break}}return r},getLabelUnit:function(e,t){if(e==="max"&&_.contains(["quarter","month","week","day"],t)){return"year"}else if(e==="year"&&t==="week"||e==="three_years"&&_.contains(["week","day"],t)){return"month"}else{return t}},checkLabel:function(e){return _.contains(this.timeUnits,e)},smallerTimeUnit:{week:"day",month:"week",quarter:"month",year:"quarter",three_years:"year",max:"quarter"},HOUR:1e3*3600,timeUnits:["day","week","month","quarter","year","three_years","max"],timeIdx:{day:0,week:1,month:2,quarter:3,year:4,three_years:5,max:6},Trend2ZoomOptions:{day:{list:["week","month"],selected:"week"},week:{list:["month","quarter","year"],selected:"month"},month:{list:["quarter","year","three_years"],selected:"quarter"},quarter:{list:["year","three_years","max"],selected:"year"},year:{list:["three_years","max"],selected:"three_years"}},Trend2ZoomOptions_inactive:{day:{list:["week","month"],selected:"week"},week:{list:["month","quarter","year"],selected:"month"},month:{list:["quarter","year","three_years"],selected:"quarter"},quarter:{list:["year","three_years","max"],selected:"year"},year:{list:["three_years","max"],selected:"year"}},trendMapping:{day:24,"7days":24*7,week:24*7,"30days":24*30,month:24*30,quarter:24*30*3,year:24*30*12,three_years:24*30*12*3,max:24*366*15},zoomMapping:{week:24*7,month:24*30,quarter:24*30*3,year:24*30*12,three_years:24*30*12*3,max:24*366*15},zoomMapping_inactive:{month:24*30,quarter:24*30*3,year:24*30*12,three_years:24*30*12*3,max:24*366*15},getBucket:function(e,t){var i={startsAt:SM.TrendLib._getStartOfBucket(e,t).valueOf(),endsAt:SM.TrendLib._getEndOfBucket(e,t).valueOf(),unit:t};return i},_getStartOfBucket:function(e,t){var i,s=this.localize(e),n;switch(t){case"hour":return moment(e).startOf("hour");case"day":return moment(e).startOf("day");case"week":return moment(e).startOf("week");case"month":return moment(e).startOf("month");case"quarter":i=Math.floor(s.month()/3)*3;n=s.month(i);return n.startOf("month");case"year":return moment(e).startOf("year");default:return null}},_getEndOfBucket:function(e,t){var i,s=this.localize(e),n;switch(t){case"hour":return moment(e).endOf("hour");case"day":return moment(e).endOf("day");case"week":return moment(e).endOf("week");case"month":return moment(e).endOf("month");case"quarter":i=Math.floor(s.month()/3)*3+2;n=s.month(i);return n.endOf("month");case"year":return moment(e).endOf("year");default:return null}},getBucketDiff:function(e,t){var i=e/this.HOUR,s=Math.ceil(i/this.trendMapping[t]);return s},getPreviousBucket:function(e,t){var i=this.localize(e.startsAt),s=e.unit;if(t===undefined){t=1}switch(s){case"hour":i.subtract("hour",1*t);return this.getBucket(i,s);case"day":i.subtract("day",1*t);return this.getBucket(i,s);case"week":i.subtract("week",1*t);return this.getBucket(i,s);case"month":i.subtract("month",1*t);return this.getBucket(i,s);case"quarter":i.subtract("month",3*t);return this.getBucket(i,s);case"year":i.subtract("year",1*t);return this.getBucket(i,s);default:return null}},getNextBucket:function(e,t){var i=this.localize(e.startsAt),s=e.unit;if(t===undefined){t=1}switch(s){case"hour":i.add("hour",1*t);return this.getBucket(i,s);case"day":i.add("day",1*t);return this.getBucket(i,s);case"week":i.add("week",1*t);return this.getBucket(i,s);case"month":i.add("month",1*t);return this.getBucket(i,s);case"quarter":i.add("month",3*t);return this.getBucket(i,s);case"year":i.add("year",1*t);return this.getBucket(i,s);default:return null}},getLabelName:function(e,t){var i=Globalize.culture(),s=i.calendars.standard,n=s.months.namesAbbr,r=this.localize(e),a,o,l,u,h;a=r.year();o=r.month();l=r.date();u=r.hour();h=new Date(a,o,l);switch(t){case"year":return a+"";case"quarter":case"month":return n[o]+" "+a;case"week":case"day":return Globalize.format(h,"d");case"hour":return Globalize.normalizeHour(u)+" "+Globalize.format(h,"d");default:return"<invalid-label>"}},toDate:function(e){var t,i,s,n;t=e.year();i=e.month();s=e.date();n=new Date(t,i,s);return Globalize.format(n,"d")},isActive:function(e){return moment().diff(e,"days")<15},localize:function(e){var t=moment.lang();moment.lang(t,{week:{dow:1,doy:4}});return moment(e).zone(moment().zone())},BucketingException:function(e){var t=e.bucketIndex,i=e.trendDatum,s=e.respondentBucket,n="trendBucket#"+t+": start@"+i.start.valueOf()+" ("+i.start.toString()+")"+"; data bucket start@"+s.start+" ("+SM.TrendLib.localize(s.start).toString()+")"+" end@"+s.end+" ("+SM.TrendLib.localize(s.end).toString()+")";return{name:"TrendBucketingException",message:n,toString:function(){return this.name+": "+this.message}}}};SM.ComparedByNps={structure:function(e){var t;e.answers.realRows=e.answers.rows;e.answers.rows=_.map(e.answers.cols,function(e){t=SM.Object.deepCopy(e);t.type="row";return t});delete e.answers.cols;e.type={family:"single_choice",subtype:"net_promoter_score"};return e},rollup:function(e){if(e.type==="matrix"){e.type="simple"}_.each(e.summary.options,function(t){e.summary.options=t.options;if(t.stats){e.summary.stats=t.stats}});return e},choiceSetRevert:function(e,t){var i,s;e.cols=e.rows;i=t.structure.answers.realRows?t.structure.answers.realRows:t.structure.answers.rows;s=_.pluck(i,"id");e.rows={};e.rows[s[0]]=true;return e},choiceSetConvert:function(e){var t=SM.Object.deepCopy(e);t.rows=SM.Object.deepCopy(t.cols);delete t.cols;return t},aggregate:function(e,t){var i=this,s,n,r,a,o,l={};_.each(e,function(e,r){s=t.answers[r];n=i._getDistributedPosition(s.position);a=i.distributed[n].id;if(_.isUndefined(l[a])){l[a]=[]}l[a].push(e)});r={};_.each(l,function(e,t){o=SM.CompositeSummaryBuilder.combineSummaries(e);r[t]=o});return r},answered_subtotals:function(e,t){var i=this,s,n,r,a,o,l={};_.each(e,function(e,r){s=t.answers[r];n=i._getDistributedPosition(s.position);a=i.distributed[n].id;if(_.isUndefined(l[a])){l[a]=0}l[a]+=e});return l},calcScore:function(e,t){var i=this,s,n,r,a=0,o=0,l=0;_.each(e,function(e,r){s=_.findWhere(t,{position:parseInt(r)+1});n=s.position;n=i._getDistributedPosition(n);if(n===0){o+=e.count}else if(n===1){l+=e.count}else{a+=e.count}});if(o+a+l===0){r=0}else{r=Math.round(100*(a-o)/(o+a+l))}return r},mergeCrossedRows:function(e,t){var i=this,s,n,r,a=[];_.each(e,function(e){s=t.answers[e];n=i._getDistributedPosition(s.position);r=i.distributed[n].id;a.push(r)});a=_.uniq(a);return a},distributed:[{text:"Detractors (0-6)",visible:true,position:0,type:"row",id:"Detractors",question_id:null,mediaHTML:"Detractor",is_openended:false},{text:"Passives (7-8)",visible:true,position:1,type:"row",id:"Passives",question_id:null,mediaHTML:"Passive",is_openended:false},{text:"Promoters (9-10)",visible:true,position:2,type:"row",id:"Promoters",question_id:null,mediaHTML:"Promoter",is_openended:false}],detailed:[[1,2,3,4,5,6,7],[8,9],[10,11]],_getDistributedPosition:function(e){if(e<8){return 0}else if(e<10){return 1}else{return 2}},map2DistributedByQuestion:function(e,t){var i=this,s,n=Globalize.localize("Question").substr(0,1),r,a=[];s=n+t.position+": ";_.each(e,function(e){r=_.findWhere(i.distributed,{id:e});r=SM.Object.copy(r);r.text=s+Globalize.localize(r.text);r.mediaHTML=null;r.question_id=t.ID;a.push(r)});return a},map2DistributedBySurvey:function(e,t){var i=this,s,n,r,a=[],o=[];_.each(e,function(e,r){s=t.getAnswer(r);n=i._getDistributedPosition(s.position);o.push(n)});o=_.uniq(o);_.each(o,function(e){r=SM.Object.copy(i.distributed[e]);a.push(r)});return a},getDetailedRows:function(e,t){var i=this,s=i.detailed[e],n,r,a;n=t.family===SM.QuestionModel.QTYPE.single_choice?"row":"column";r=_.map(s,function(e){a=_.findWhere(t.answers,{position:e,type:n});return a});return r},getDistributedOptions:function(e,t){var i=this,s,n,r,a,o=[],l=[];_.each(e,function(e,r){s=t.answers[r];n=i._getDistributedPosition(s.position);l.push(n)});l=_.uniq(l);r="Q"+t.position+": ";_.each(l,function(e){a=SM.Object.copy(i.distributed[e]);a.text=r+a.text;a.question_id=t.ID;o.push(a)});return o},isDistributed:function(e,t){var i=this,s,n,r=0,a=true,o=[0,0,0],l=[7,2,2];_.each(e,function(e,r){s=t.answers[r];n=i._getDistributedPosition(s.position);o[n]++});_.each(o,function(e,t){if(e===0){r++}else if(e!==l[t]){a=false}});if(r===3){return false}else{return a}}};SM.BasicStatsUtils={cols:[{text:"Minimum",visible:true,position:1,type:"column",id:"min",question_id:null},{text:"Maximum",visible:true,position:2,type:"column",id:"max",question_id:null},{text:"Median",visible:true,position:3,type:"column",id:"median",question_id:null},{text:"Mean",visible:true,position:4,type:"column",id:"mean",question_id:null},{text:"Standard Deviation",visible:true,position:5,type:"column",id:"std",question_id:null}],getStructure:function(e){var t=[];_.each(this.cols,function(i){var s=SM.Object.deepCopy(i);s.type=e||s.type;s.text=Globalize.localize(i.text);t.push(s)});return t},hasBasicStats:function(e){var t,i=[];if(e.summary.stats){return true}t=_.values(e.summary.options);_.each(t,function(e){var t=SM.Object.deepCopy(e);if(t.stats){i.push(t)}});if(_.size(t)>0){if(i.length>0){return true}else{t=_.values(t[0].options);if(_.size(t)>0&&t[0].stats){return true}}}return false}};SM.SidiUtils={labelBySidi:function(e,t){var i=this,s;if(t.hasRandomAssignment()){return}s=e.crossed_cols||e.crossed_rows;if(_.size(s)===0){s=e.crossed_rows}_.each(s,function(e,i){var s=t.getAnswer(e);s.sidiLabel=String.fromCharCode(65+i%26);if(Math.floor(i/26)>0){s.sidiLabel+=Math.floor(i/26)+""}})},buildPhrase:function(e,t){var i=_.size(e),s,n,r,a,o;s=_.sortBy(e,function(e){return t.getAnswer(e).sidiLabel});switch(i){case 0:a=null;break;case 1:a=t.getAnswer(s[0]).sidiLabel;break;default:o=[s[i-1]];n=s.slice(0,-1);r=_.map(n,function(e){return t.getAnswer(e).sidiLabel});a=r.join(", ")+" and "+t.getAnswer(o[0]).sidiLabel;break}return a},join:function(e,t){var i=_.size(e),s,n,r;s=_.sortBy(e,function(e){return t.getAnswer(e).sidiLabel});switch(i){case 0:r=null;break;case 1:r=t.getAnswer(s[0]).sidiLabel;break;default:n=_.map(s,function(e){return t.getAnswer(e).sidiLabel});r=n.join("");break}return r}};SM.FiloUtils={formatSize:function(e){var t;if(e<1024){t=e+"bytes"}else if(e<1048576){t=parseInt(e/102.4,10)/10+"KB"}else if(e<1073741824){t=parseInt(e/104857.6,10)/10+"MB"}else{t=parseInt(e/107374182.4,10)/10+"GB"}return t}};SM.BaseAnView={currentSaveRequest:undefined,currentRevertRequest:undefined,isDefault:false,isCurrent:false,clone:function(e){var t=this.dump(),i;t.is_default=false;t.is_current=false;t.name=e||t.name+" - "+Globalize.localize("COPY");i=SM.Models.create("AnView",{ID:"new_"+SM.Date.timestamp(),anView:t});i.anviews=this.anviews;return i},save:function(){var e=SM.API.editView({view_data:this.dump(),view_id:this.ID});this.set("lastEditRequest",e);return e}};SM.Models.register("AnViewList",{viewMap:null,viewList:null,currentView:null,defaultView:null,nextSelectedViewID:null,selectedViewID:null,__create:function(e){var t=this;t.survey=e.survey;t.viewMap={};t.viewList=[]},createViewModels:function(e){var t=e.viewMap[e.currentViewID],i=e.viewMap[e.defaultViewID];delete e.viewMap[e.currentViewID];delete e.viewMap[e.defaultViewID];this.selectedViewID=e.selectedViewID;this._initStandardViews(e);this.defaultView=this._initDefaultView(i);this.currentView=this._initCurrentView(t);this.currentView.loadView(t);this.currentView.loadMetadata(t.metadata);this.currentView.on("isDirty.set",{self:this},this._onCurrentViewDirtySet)},__setters:{selectedViewID:function(e,t){var i=e.getView(t),s=e.getView(e.selectedViewID);if(t===e.selectedViewID){return}if(e.currentView.get("isDirty")){e.set("nextSelectedViewID",t,{notify:true})}else{e.selectedViewID=t;e.updateSelectedView();i.set("selected",true,{notify:true});s.set("selected",false,{notify:true})}}},addView:function(e,t){this.viewMap[e.ID]=e;this.viewList.push(e);this._trigger({type:"viewAdded",anViewModel:e,isSelected:t});this._trigger("sizeChanged")},removeView:function(e){var t=this;$.each(this.viewList,function(i,s){if(e.ID===s.ID){t.viewList.splice(i,1);return false}});delete this.viewMap[e.ID];this._trigger("sizeChanged")},deleteView:function(e){var t=this.currentView,i=this.defaultView.ID,s=e.ID===this.get("selectedViewID");if(s){this.set("selectedViewID",this.defaultView.ID)}else if(this.get("nextViewID")===e.ID){this.set("nextViewID",null)}this.removeView(e);return SM.API.deleteView({view_id:e.ID})},copyView:function(e){var t=e.clone(),i=SM.API.duplicateView({source_view_id:e.ID,name:t.get("name")});this.addView(t,false);$.when({self:this,tempID:t.ID},i).done(this._onViewCopySuccess)},_onViewCopySuccess:function(e,t){var i=e.self,s=t[0],n=i.getView(e.tempID);n.ID=s.new_view.view_id;i.viewMap[n.ID]=n;delete i.viewMap[e.tempID];n._trigger("copySuccess")},saveCurrentViewAs:function(e){var t=this.get("selectedViewID"),i=this.get("nextSelectedViewID"),s=this.currentView,n=s.clone(e),r={self:this,tempID:n.ID,switchToNewView:i===null,requestData:{source_view_id:s.ID,name:e}};s.set("isDirty",false,{notify:true});this.addView(n,r.switchToNewView);this.currentView._trigger("savedToNewView");$.when(r,this.currentView.get("lastEditRequest")).always(this._makeSaveAsRequest);if(i){this.set("selectedViewID",i)}},_onViewSaveAsSuccess:function(e,t){var i=e.self,s=t[0],n=i.getView(e.tempID);n.ID=s.new_view.view_id;i.viewMap[n.ID]=n;delete i.viewMap[e.tempID];n._trigger("createSuccess");if(e.switchToNewView){i.set("selectedViewID",n.ID)}},getView:function(e){if(this.currentView.ID===e){return this.currentView}return this.viewMap[e]},getSelectedView:function(){return this.getView(this.get("selectedViewID"))},_initCurrentView:function(e){var t=SM.Models.create("CurrentAnView",{ID:e.view_id});t.anviews=this;t.on("committed",{self:this},this._onCurrentViewCommitted);return t},_initDefaultView:function(e){var t=this,i=e.view_id,s=SM.Models.create("DefaultAnView",{ID:i,anView:e,survey:t.survey});s.anviews=this;s.loadDisplayData();this.viewMap[i]=s;this.viewList.push(s);return s},_makeSaveAsRequest:function(e,t){var i=SM.API.duplicateView(e.requestData);$.when(e,i).done(e.self._onViewSaveAsSuccess)},_initStandardViews:function(e){var t=this,i=e.viewMap,s;$.each(i,function(e,i){s=SM.Models.create("AnView",{ID:e,anView:i});t.viewMap[e]=s;t.viewList.push(s);s.anviews=t})},updateSelectedView:function(){var e={pageIndex:this.survey.state.get("page"),self:this,timestamp:SM.Date.timestamp()},t=this.getView(this.get("selectedViewID")),i=this.currentView.get("lastSwitchRequest");this.currentView.set("lastSwitchStamp",e.timestamp);this._trigger({type:"selectedViewChanged",viewID:this.get("selectedViewID")});$.when(e,i).always(function(){e.self._makeSwitchViewRequest(e)})},_makeSwitchViewRequest:function(e){var t=e.self,i=t.currentView,s,n=t.survey.state.get("mode");if(i.get("lastSwitchStamp")===e.timestamp){s=SM.API.switchView({selected_view_id:t.get("selectedViewID"),utc_offset:SM.Date.utcOffset(),mode:n});i.set("lastSwitchRequest",s,{notify:true});$.when(e,s).done(t._onViewSwitched).fail(function(i){t._onViewSwitchedFailed(e,i)})}},_onViewSwitched:function(e,t){var i=e.self,s=t[0],n=i.currentView,r=s.current_view.selected_view_id,a=i.getView(r),o=a.isDefault?a.metadata:s.current_view.metadata;if(n.get("lastSwitchStamp")===e.timestamp){$.extend(true,[],s.current_view.metadata);a.metadata=$.extend(true,[],o);n.loadView(s.current_view);n.loadMetadata(o);i._trigger({type:"selectedViewLoaded",anViewModel:a,pageIndex:e.pageIndex,timestamp:e.timestamp,respondentData:s.respondent_data,benchmarkData:s.benchmark_data});a.set("isLoaded",true,{notify:true})}},_onViewSwitchedFailed:function(e,t){var i=t&&t.request_id,s=this.get("selectedViewID"),n=this.getView(s);this.currentView.set("failedLoadRequestID",i,{notify:true})},_onCurrentViewCommitted:function(e){var t=e.data.self,i=t.get("nextSelectedViewID");if(i){t.set("selectedViewID",i)}},_onCurrentViewDirtySet:function(e){var t=e.data.self;if(e.value===true&&t.nextSelectedViewID!==null){t.set("nextSelectedViewID",null,{notify:true})}}});SM.Models.extend("AnView",SM.BaseAnView,{__create:function(e){var t=e.anView;this.ID=e.ID;this.show=t.show;if(this.show.selected===null){this.show.selected=false}this.metadata=t.metadata;this.name=t.name;this.viewType=t.type;this.isDirty=false;this.loadFailed=false},dump:function(){return{view_id:this.ID,survey_id:this.anviews.survey.ID,is_current:false,is_default:false,selected_view_id:null,name:this.name,page:null,show:this.show,type:this.viewType}}});SM.Models.extend("DefaultAnView",SM.BaseAnView,{__setters:{page:function(e,t){if(e.page!==t){e.page=t;if(!SM.App.isSharingApp()){e.save()}}}},isDefault:true,_displayData:{},METADATA_COMPARE_PREFIX:"compare:",__create:function(e){var t=this,i=e.anView;t.survey=e.survey;t.ID=e.ID;t.name=Globalize.localize(i.name);t.viewType=i.type;t.metadata=i.metadata;t.page=i.page;t.show={pages:null,questions:null,selected:false};t.filter=null;t.compare=null},loadDisplayData:function(){var e=this,t;_.each(e.metadata,function(i){t=i.question_id;if(_.isEmpty(e._displayData[t])){e._displayData[t]={}}e._displayData[t][i.key]=i.value;if(i.option_id==="None"){i.option_id=null}})},appliedSidi:function(){var e=this,t;t=_.some(e._displayData,function(e){return e.show_sig_diffs===SM.QuestionDisplayModel.DISPLAY_VALUES.show});return t},appliedSidiAll:function(){var e=this,t=e._displayData["0"];if(_.isEmpty(t)){return false}return t.show_sig_diffs===SM.QuestionDisplayModel.DISPLAY_VALUES.show},updateSidiAll:function(e){var t=this,i;i={show_sig_diffs:e?SM.QuestionDisplayModel.DISPLAY_VALUES.show:SM.QuestionDisplayModel.DISPLAY_VALUES.hide};t.updateSharedDisplayData({updates:i,deletedKeys:["show_sig_diffs"],untypedKeys:SM.QuestionDisplayModel.UNTYPED_DISPLAY_OPTIONS,isCompared:true})},getDisplayData:function(e,t){t=t||{};var i=this,s=i._displayData[e],n=i._displayData["0"],r=!!t.forTrends;if(_.isEmpty(s)){s={}}if(!r&&!!n){s=SM.Object.extend(n,s)}s=SM.Object.deepCopy(s);return s},_typifyUpdates:function(e,t,i){var s=this,n=s.getDisplayData(e),r={},a,o=i.isCompared,l=i.untypedKeys,u=s.METADATA_COMPARE_PREFIX;_.each(t,function(e,t){a=u+t;if(o){if(!l[t]){r[a]=e}else{if(n[a]!==undefined){r[a]=e}r[t]=e}}else{r[t]=e}});return r},updateDisplayData:function(e,t,i){var s=this,n,r=s._displayData[e],a;i=i||{};if(_.isEmpty(r)){r=s._displayData[e]={}}t=s._typifyUpdates(e,t,i);_.each(t,function(t,i){if(_.isEmpty(r[i])){a=s.buildDisplayMetadatum(e,i,t);s.metadata.push(a)}else{s.updateDisplayMetadatum(e,i,t)}r[i]=t});if(i.save!==false){n=s.save();n.done(i.done).fail(i.fail)}},updateQuestionDisplayData:function(e,t,i){var s=this,n=i.isCompared,r=i.untypedKeys||{},a;_.each(t,function(t,i){s.updateDisplayData(t.ID,e,{save:false,isCompared:n,untypedKeys:r})});
if(i.save!==false){a=s.save();a.done(i.done).fail(i.fail)}},deleteDisplayData:function(e,t,i){var s=this,n,r=i.isCompared,a=i.untypedKeys,o,l,u,h;i=i||{};if(!_.isArray(e)){e=[e]}_.each(e,function(e){l=s._displayData[e];if(!_.isEmpty(l)){_.each(t,function(t){o=s.METADATA_COMPARE_PREFIX+t;t=r&&!a[t]?o:t;delete l[t];u=_.filter(s.metadata,function(i){return i.question_id===e&&i.view_id===s.ID&&i.key===t});if(u){_.each(u,function(e){h=_.indexOf(s.metadata,e);s.metadata.splice(h,1)})}})}});if(i.save!==false){n=s.save();n.done(i.done).fail(i.fail)}},updateSharedDisplayData:function(e){var t=this,i,s=e.updates,n=e.deletedKeys,r=e.untypedKeys,a=e.isCompared,o;var l=[],u=[];_.each(t.survey.questionRollups.questions,function(e){if(e.question.subtype==="net_promoter_score"){u.push(e.questionID)}else{l.push(e.questionID)}});t.updateDisplayData("0",s,{save:false,isCompared:a,untypedKeys:r});t.deleteDisplayData(l,n,{save:false,isCompared:a,untypedKeys:r});if(u.length>0){o=["show_chart","show_table"];t.deleteDisplayData(u,o,{save:false,isCompared:a,untypedKeys:r})}if(e.noSave!==false){i=t.save();i.done(e.done).fail(e.fail)}},findMetadatumByQuestionIDAndKey:function(e,t){var i=this,s;s=_.filter(i.metadata,function(i){return i.question_id===e&&i.key===t});return _.last(s)},updateDisplayMetadatum:function(e,t,i){var s=this,n=s.findMetadatumByQuestionIDAndKey(e,t);if(n){n.value=i}},buildDisplayMetadatum:function(e,t,i){var s=this;return{view_id:s.ID,metadata_id:null,question_id:e,option_id:null,key:t,value:i}},isBenchmarkingShownForAnyQuestion:function(){var e=this,t;t=_.filter(e.metadata,function(e){return e.key==="show_benchmark"&&e.value==="show"});return t.length>0},setBenchmarkSegments:function(e,t){var i={updates:{benchmark_segments:e},deletedKeys:["benchmark_segment"]};$.extend(i,t);this.updateSharedDisplayData(i)},getBenchmarkSegments:function(){var e=this.getDisplayData();return e.benchmark_segments},setDriverState:function(e,t){var i={updates:{driver_state:e},deletedKeys:["show_tmbc_benchmark","tmbc_chart_type"]};$.extend(i,t);this.updateSharedDisplayData(i)},getDriverState:function(){var e=this.getDisplayData();return e.driver_state||{}},enableAllBenchmarks:function(e){var t=this,i=e?"show":"hide",s={show_benchmark:i},n=this.anviews.survey.getAllBenchmarkableQuestionIds();_.each(n,function(e,i){t.updateDisplayData(e,s,{save:false})});if(this.anviews.survey.isTMBCTemplate()){this.survey.tmbc.setTMBCShowHide(SM.TMBCModel.TMBC_TYPE_ALL,e,{save:false})}var r=_.filter(t.metadata,function(e){return e.key==="show_benchmark"&&e.value!==i});if(r.length>0){_.each(r,function(e){e.value=i});SM.API.logWarning({name:"Duplicate Metadata",message:"Survey "+this.survey.ID+" has "+r.length+" duplicate show_benchmark flags"})}r=_.filter(t.metadata,function(e){return e.key!=="show_tmbc_benchmark"&&e.key!=="tmbc_chart_type"});t.metadata=r;return t.save()},enableDisableInlineProfiler:function(e,t,i){var s={updates:{show_inline_profiler:e?"show":"hide"}};if(t){s.done=t}if(i){s.fail=i}this.updateSharedDisplayData(s)},dump:function(){return{view_id:this.ID,survey_id:this.anviews.survey.ID,page:this.page,is_current:false,is_default:true,selected_view_id:null,name:this.name,filter:null,compare:null,type:this.viewType,show:{pages:null,questions:null,selected:false},metadata:this.metadata}},copy:function(){SM.Error.log({name:"DefaultViewCopyException",message:"Cannot copy the default view"})}});SM.Models.extend("CurrentAnView",SM.BaseAnView,{lastSaveTimeStamp:-1,lastSaveRequest:null,__setters:{isDirty:function(e,t,i){e.isDirty=t;e.anviews.getSelectedView().set("isDirty",t,i)},failedLoadRequestID:function(e,t){var i=t!==null;e.anviews.getSelectedView().set("loadFailed",i,{notify:i});e.failedLoadRequestID=t}},__create:function(e){this.ID=e.ID;this.isDirty=false;this.lastSwitchStamp=-1;this.lastSwitchRequest=null;this.rules=null;this.metadataLoaded=false;this.isCurrent=true;this.isSaving=false},loadView:function(e){this.show=e.show;this.viewType=e.type;this.anviews.survey.updateShownLists(this.show,{notify:false});this.metadataLoaded=false},loadMetadata:function(e){var t=this,i=[];this._clearRuleModels();this.metadata=e;_.each(e,function(e,s){if(t._metadataIsRule(e)){i.push(e)}});i.sort(function(e,t){return e.metadata_id-t.metadata_id});this._createRuleModels(i);this.isDirty=false;this.metadataLoaded=true;this.set("failedLoadRequestID",null);this.set("isDirty",this._getDirtyState())},hasShowRule:function(){return this.showRule!==null},hasCompareRule:function(){return this.compareRule!==null},hasFilterRule:function(){var e=this;return _.size(e.getFilterRulesSelected())>0},getFilterRulesSelected:function(){var e=this,t=SM.BaseAnRule.FAMILY_TYPES,i=[];_.each(this.ruleList,function(e){if(e.get("selected")&&e.get("ruleFamily")===t.FILTER){i.push(e)}});return i},getCompareRuleSelected:function(){var e=this,t;_.each(this.ruleList,function(e){if(e.get("selected")&&e.isCompare){t=e}});return t},hasRAFilterSelected:function(){var e=this,t,i={};t=e.getFilterRulesSelected();i=_.find(t,function(e){return e.isRA});return!!i},hasRACompareSelected:function(){var e=this,t,i={};t=e.getCompareRuleSelected();return t?t.isRA:false},deleteRule:function(e){var t=this.ruleList,i=this.rules[e],s=this.anviews.defaultView.ID===this.anviews.get("selectedViewID");this._unbindRuleEvents(this.rules[e]);delete this.rules[e];$.each(t,function(i,s){if(e===s.ID){t.splice(i,1);return false}})},revert:function(){var e=this.anviews.getSelectedView();this.loadView(e.dump());this.set("isDirty",false,{notify:true});this.anviews.updateSelectedView()},commitChanges:function(){var e,t=this.anviews.getSelectedView(),i=this.dump().metadata,s;t.metadata=i;$.each(i,function(e,i){i.metadata_id=null;i.view_id=t.ID});t.show=this.show;s=t.dump();s.metadata=i;this.set("isDirty",false,{notify:true});this._trigger("committed");return SM.API.editView({view_data:s,view_id:t.ID})},addRule:function(e){this._bindRuleEvents(e);this.ruleList.push(e);this.rules[e.ID]=e;if(e.isShow){this._onShowRuleChanged(e);this.save()}else{if(e.isCompare&&e.get("selected")){if(this.compareRule){this.compareRule.set("selected",false,{notify:true})}this.compareRule=e}this.set("isSaving",true,{notify:true})}this._trigger({type:"ruleAdded",ruleModel:e})},dump:function(){var e,t=this.anviews.get("selectedViewID").toString();if(this.metadataLoaded){e=[];_.each(this.ruleList,function(t){if(!t.get("isCorrupt")){e.push(t.dump())}})}return{view_id:this.ID,survey_id:this.anviews.survey.ID,is_current:true,is_default:false,page:null,selected_view_id:t,name:"Current View",show:this.show,type:this.viewType,metadata:e}},hasActiveShowRule:function(){return this.show.selected},save:function(){var e=this,t={self:this,timestamp:SM.Date.timestamp()};this.set("isSaving",true,{notify:true});this.set("isDirty",this._getDirtyState(),{notify:true});this.set("lastSaveTimeStamp",t.timestamp);$.when(t,this.get("lastSaveRequest")).always(function(){e._makeSaveRequest(t)})},invalidateNewRules:function(){$.each(this.ruleList,function(e,t){if(!t.isPersisted()){t.set("isCorrupt",true,{notify:true})}})},_metadataIsRule:function(e){return e.key.indexOf(SM.BaseAnRule.BASE_RULE_METADATA_KEY)>=0},_getDirtyState:function(){var e=this,t=false,i=this.dump().metadata,s=i.length,n=false,r=this.anviews.getSelectedView(),a=$.extend(true,[],r.metadata);if(r.isDefault){return this.ruleList.length>0}if(a.length!==s){return true}$.each(i,function(i,s){if(e._metadataIsRule(s)){t=true;$.each(a,function(i,r){n=e._checkMetadataEquality(s,r);if(n){t=false;a.splice(i,1);return false}});if(t){return false}}});if(!t){t=!SM.Object.equals(this.show,r.show)}return t},_checkMetadataEquality:function(e,t){var i=true;try{if(e.value.selected!==t.value.selected){i=false}else{_.each(e.value,function(e,s){if(s!=="answers"){if(!SM.Object.equals(t.value[s],e)){i=false;return}}});if(e.value.answers&&t.value.answers){if(!SM.Object.equals(e.value.answers[0],t.value.answers[0])){i=false}}}}catch(s){SM.Error.log(s,"error comparing metadata");i=false}return i},_makeSaveRequest:function(e){var t=this,i=SM.API.editView({view_data:this.dump(),view_id:this.ID});this.set("lastSaveRequest",i);$.when(i,e).done(this._onSaveSuccess).always(function(){t._onSavedAlways(e)})},_onShowRuleChanged:function(e){this.show=e.get("show");this.anviews.survey.updateShownLists(this.show,{notify:true});this._trigger({type:"showRuleChanged",ruleModel:e})},_createRuleModels:function(e){var t=this,i,s,n;$.each(e,function(e,r){i=r.value;n={ID:r.metadata_id,attrs:i,isCorrupt:r.is_corrupt};s=SM.BaseAnRule.FactoryCreate(n,t.anviews.survey);s.loadSurvey(t.anviews.survey);if(s.isShow){t.showRule=s}if(s.isCompare&&s.get("selected")){t.compareRule=s}t.ruleList.push(s);t.rules[s.ID]=s;t._bindRuleEvents(s)})},_clearRuleModels:function(){var e=this;if(this.ruleList){$.each(this.ruleList,function(t,i){e._unbindRuleEvents(i)})}this.showRule=null;this.compareRule=null;this.ruleList=[];this.rules={}},_bindRuleEvents:function(e){e.on("customHeading.changed",{self:this},this._onRuleRenamed);e.on("ruleEdited",{self:this},this._onRuleEdited);e.on("ruleDeleted",{self:this},this._onRuleDeleted)},_unbindRuleEvents:function(e){e.off("customHeading.changed",this._onRuleRenamed);e.off("ruleEdited",this._onRuleEdited);e.off("ruleDeleted",this._onRuleDeleted)},_onRuleEdited:function(e){var t=e.ruleModel,i,s=e.data.self,n=t.get("selected");if(t.isShow){s._onShowRuleChanged(t);s.save()}else{if(t.isCompare){i=s.compareRule;if(i&&t!==i&&t.get("selected")){i.set("selected",false,{notify:true})}s.compareRule=n?t:null}s.set("isSaving",true,{notify:true})}s._trigger({type:"ruleEdited",ruleModel:t})},_onRuleRenamed:function(e){var t=e.data.self;t.save()},_onRuleDeleted:function(e){var t=e.data.self,i=e.ruleModel;t.deleteRule(i.ID);if(i.isShow){t.showRule=null;t._onShowRuleChanged(i);t.save()}else{if(!i.get("selected")){t.save()}else{if(i.isCompare){t.compareRule=null}t.set("isSaving",true,{notify:true})}}t._trigger({type:"ruleDeleted",ruleModel:i})},_onSaveSuccess:function(e,t){var i=e[0],s=i.created_metadata_ids,n=t.self;if(n.get("lastSaveTimeStamp")===t.timestamp){n.metadata=i.view_edited.metadata;if(!s){return}$.each(s,function(e,t){var i=n.rules[t];if(i){n.rules[e]=i;delete n.rules[t];i.ID=e}})}},_onSavedAlways:function(e){if(this.get("lastSaveTimeStamp")===e.timestamp){this.set("isSaving",false,{notify:true})}}});SM.Models.register("SharedView",{BASE_URL:"/results/ajax/shared_views",TYPES:{WEB_LINK:"weblink"},MODES:{SUMMARY:"summary",TRENDS:"trends",BROWSE:"browse"},BRANDING:{DEFAULT:"default",CUSTOM:"custom",NONE:"none"},__create:function(e){_.extend(this,{DEFAULT_NAME:Globalize.localize("Shared Data"),survey:e.survey,list:e.list,index:e.index,id:e.attrs.id});this.load(e.attrs)},isNew:function(){return!this.id},attributes:function(){var e=this,t={id:e.id,survey_id:e.get("survey_id"),default_view_id:e.get("default_view_id"),sharable_view_id:e.get("sharable_view_id"),key:e.get("key"),type:e.TYPES.WEB_LINK,domain:e.get("domain"),modes:e.get("modes"),enabled:e.get("enabled"),password:e.get("password"),name:e.get("name"),title:e.get("title"),description:e.get("description"),branding:e.get("branding"),hide_open_ended:e.get("hide_open_ended"),is_public:e.get("is_public"),team_only_share:e.get("team_only_share"),allow_team_export:e.get("allow_team_export")};if(!e.get("has_password")){t.password=null}if(!t.team_only_share){t.allow_team_export=false}return t},load:function(e){var t=this;t._setDefaults();_.each(e,function(e,i){t.set(i,e,{notify:false})});if(t.shareGroup()!==this.GROUP_SETTINGS.passwordShare){t.set("password",null)}},_setDefaults:function(){if(_.isEmpty(this.get("modes"))){this.set("modes",["summary"])}if(_.isEmpty(this.get("name"))){this.set("name",this._getDefaultName())}if(_.isEmpty(this.get("title"))){this.set("title",this.survey.get("title"))}if(_.isEmpty(this.get("domain"))){var e,t;if(this.groupDomainLinkEnabled()){t=this.survey.owner.getEnterpriseGroupDefaultDomain();e=t.split(".")[0]}else{e=this.getCultureSubdomain();t=new Uri(document.location.href).host();if(t.indexOf(e)!==0){var i=t.split(".");i[0]=e;t=i.join(".")}}this.set("domain",t)}if(_.isEmpty(this.get("type"))){this.set("type",this.TYPES.WEB_LINK)}if(_.isNull(this.get("enabled"))||_.isUndefined(this.get("enabled"))){this.set("enabled",true)}if(_.isNull(this.get("branding"))||_.isUndefined(this.get("branding"))){this.set("branding",this.BRANDING.DEFAULT)}if(_.isNull(this.get("hide_open_ended"))||_.isUndefined(this.get("hide_open_ended"))){this.set("hide_open_ended",true)}if(_.isNull(this.get("is_public"))||_.isUndefined(this.get("is_public"))){this.set("is_public",false)}if(_.isUndefined(this.get("allow_team_export"))){this.set("allow_team_export",false)}if(_.isNull(this.get("team_only_share"))||_.isUndefined(this.get("team_only_share"))){this.set("team_only_share",false)}},_getDefaultName:function(){var e=this.isNew()?this.survey.sharedViews.list.length:this.index;return this.DEFAULT_NAME+" "+Globalize.format(e+1,"n0")},loadView:function(e){this.sourceView=e},SHARED_VIEW_KEY:"SHARED_VIEWS_LIST",SHARED_VIEW_PATH_KEY:"{shared_view_path}",_getSharedViewOptions:function(e){var t={replacements:[]};e=e||"";if(this.isNew()){t.replacements.push({key:this.SHARED_VIEW_PATH_KEY,value:""})}else{t.replacements.push({key:this.SHARED_VIEW_PATH_KEY,value:"/"+this.key+e})}return t},save:function(){var e=this,t,i;e._setDefaults();t=e.attributes();SM.log(t);i=SM.API.post(this.SHARED_VIEW_KEY,t,e._getSharedViewOptions());$.when(i,{self:this}).done(function(t,i){var s=t[0]["shared_view"];e.load(s);e.survey.sharedViews.add(e);e._trigger("saved",{notify:true})}).fail(function(){SM.log("failed!")});return i},destroy:function(){var e=this,t;t=SM.API.destroy(this.SHARED_VIEW_KEY,{survey_id:e.get("survey_id")},e._getSharedViewOptions());$.when(t,{self:this}).done(function(){e.survey.sharedViews.remove(e)}).fail(function(){SM.log("destroy failed")});return t},isSocialShareable:function(){var e=this.shareGroup();return e===this.GROUP_SETTINGS.publicShare||e===this.GROUP_SETTINGS.linkShare},GROUP_SETTINGS:{publicShare:"share-group-public",enterpriseShare:"share-group-enterprise",passwordShare:"share-group-password",linkShare:"share-group-link"},shareGroup:function(){var e=this,t=null;if(e.isEnterpriseTeam()){t=this.GROUP_SETTINGS.enterpriseShare}else if(e.isPassword()){t=this.GROUP_SETTINGS.passwordShare}else if(e.isPublic()){t=this.GROUP_SETTINGS.publicShare}else{t=this.GROUP_SETTINGS.linkShare}return t},shareGroupLabel:function(){var e=this,t,i="";if(e.isEnterpriseTeam()){t=Globalize.localize("Enterprise Group")}else if(e.isPassword()){t=Globalize.localize("Password Restricted")}else if(e.isPublic()){t=Globalize.localize("Public")}else{t=Globalize.localize("Anyone with the Link")}return t},allowTeamExport:function(){return this.get("allow_team_export")},getCultureSubdomain:function(){var e=Globalize.findClosestCulture(this.survey.language.code);if(e){switch(e.language){case"en":return"www";case"ja":return"jp";default:return e.language}}else{return new Uri(document.location.href).getSubDomains()[0]}},sharedPageURL:function(){var e=new Uri;e.setProtocol("https");e.setHost(this.get("domain"));e.setPath(this.sharedPagePath());return e.toString()},sharedPagePath:function(){return"/results/"+this.key+"/"},toggleMode:function(e,t){var i=this,s=i.get("modes"),n=_.contains(s,e),r;if(t&&!n){s.push(e)}if(!t&&n){r=_.indexOf(s,e);s.splice(r,1)}i.set("modes",s)},hideOpenEnded:function(){return this.get("hide_open_ended")},hasCustomTitle:function(){var e=this.get("title");return!_.isEmpty(e)&&e!==this.survey.get("title")},hasDescription:function(){return!_.isEmpty(this.get("description"))},hasCustomName:function(){var e=this.get("name");return!_.isEmpty(e)&&e!==this._getDefaultName()},hasPassword:function(){return this.get("has_password")},canHavePassword:function(){return!this.survey.owner.isBasic()},canHaveTrends:function(){return this.survey.owner.hasTrends()},isEnterpriseAccount:function(){return this.survey.owner.isEnterprisePlatinum()},isTrendsTabEnabled:function(){return _.contains(this.get("modes"),this.MODES.TRENDS)&&this.survey.owner.hasTrends()},isBrowseTabEnabled:function(){return _.contains(this.get("modes"),this.MODES.BROWSE)},isEnabled:function(){return this.get("enabled")},isPublic:function(){return this.get("is_public")},isEnterpriseTeam:function(){return this.get("team_only_share")},isPassword:function(){return this.canHavePassword()&&this.hasPassword()},toggleEnabled:function(){this.set("enabled",!this.get("enabled"),{notify:true});this.save()},incrementNumViews:function(){SM.API.post(this.SHARED_VIEW_KEY,{survey_id:this.survey.ID},this._getSharedViewOptions("/increment"))},groupDomainLinkEnabled:function(){if(this.isEnterpriseAccount()){return this.survey.owner.enterprisePreferences.custom_domain_enabled}return false},hasEnterpriseDomainOptions:function(){var e=this.survey.owner;return e.isEnterprisePlatinum()&&e.getEnterpriseGroupDomains().length>1},getSelectedDomain:function(){return this.survey.owner.getEnterpriseGroupDefaultDomain()},canCustomizeBranding:function(){return!(this.survey.owner.isBasic()||this.survey.owner.isSelect()||this.survey.owner.isZoomPro())},canCustomizeDomain:function(){if(this.survey.owner.isPlatinum())return true;return this.survey.owner.isEnterprisePlatinum()&&this.hasEnterpriseDomainOptions()},hasHiddenBranding:function(){return this.get("branding")===this.BRANDING.NONE},setBranding:function(e,t){if(e==="none"){e=t?this.BRANDING.NONE:this.BRANDING.DEFAULT}this.set("branding",e)}});SM.Models.register("Survey",{TEMPLATE_TYPES:{SHRM:"SHRM",CSAT:"CSAT",EVENT:"EVENT",NPS:"NPS",TMBC:"TMBC"},TMBC_QUESTION_COUNT:8,DRIVER_TYPES:{TMBC:"tmbc",STD:"std"},__create:function(e){var t=e.survey_data,i;this.ID=t.id;this.language=t.language;this.dateCreated=new Date(t.date_created);this.encryptedID=t.mangled_id;this.templateInfo=t.template_info||{};this.previewLink=t.preview_link;this.resourcePath=t.resource_path;this.themeSettings=t.theme_settings;this.designSettings=t.design_settings;this.hasLogic=t.has_logic;this.hasRandomization=t.has_randomization;this.hasPanelPage=t.has_panel_page;this.includeOpenEnded=e.includeOpenEnded;this.isExport=e.isExport||false;this.exportFormat=e.exportFormat||null;this.exportData=e.exportData||{};this.title=t.title;this.nickname=t.nickname;this.surveyAlertsOn=t.survey_alerts_on;this.pageIDs=t.page_ids;this.pageCount=this.pageIDs.length;this.fullQuestionCount=t.question_count;this.respondentCounts={};this.loadCollectors(t.collectors);this.hasEmailCollector=t.has_email_collector;this.hasOpenCollectors=t.has_open_collector;this.hasCollectors=t.has_collector;this.hasUnconfiguredCollector=t.has_unconfigured_collector;this.hasAllClosedCollectors=t.has_all_closed_collectors;if(t.source_surveys){this.createSourceSurveys(t.source_surveys);this.isMergedSurvey=true;this.source_surveys_question_id=t.source_surveys_question_id}i=this._createPageModels({pageIDs:this.pageIDs,survey_data:t,npsEnabled:e.npsEnabled,mode:e.mode});this.pages=i.pages;this.pageList=i.pageList;this.questions=i.questions;this.questionList=i.questionList;this.hasQuestions=i.questionList.length>0;this.searchTerms=i.searchTerms;this.answers=i.answers;this.questionCount=this.questionList.length;this.quotas=t.quotas;this.nltkOptionEnabled=t.nltk_option_enabled;this.currentUserBenchmarksEnabled=t.current_user_benchmarks_enabled},__setters:{respondentCounts:function(e,t){if(!t||t.failed){e.respondentCounts={failed:true}}else{SM.Object.update(e.respondentCounts,t);e.respondentCounts.failed=false}}},ID:"",encryptedID:"",title:"",nickname:"",pageIDs:[],pages:{},pageList:[],pageCount:0,fullQuestionCount:0,questions:{},questionList:[],questionCount:0,questionRollups:null,answers:{},searchTerms:null,respondentsList:null,respondentCounts:{},collectors:{},collectorList:[],hasEmailCollector:false,hasOpenCollectors:false,owner:null,anviews:null,SEARCH_NGRAM_SIZE:2,shownPageList:[],shownQuestionList:[],updateShownLists:function(e,t){var i=this.pageList,s=i.length,n=0,r,a,o,l,u,h,c=t.notify&&true;this.shownPageList=[];this.shownQuestionList=[];for(;n<s;n++){a=i[n];a.shownQuestionList=[];if(a.isShown(e)){this.shownPageList.push(a);l=a.questionList;h=l.length;for(r=0;r<h;r++){u=l[r];if(u.isShown(e)){a.shownQuestionList.push(u);this.shownQuestionList.push(u)}}}}o=this._validatePage();this.state.set("page",o);if(c){this._trigger("shownListsChanged")}},_validatePage:function(){var e,t,i=this.state.get("page"),s=this.state.get("allPagesSelected");if(!s){e=this.pageList[i];if(!e.isShown()){e=this.getFirstShownPage();return e.position-1}}return i},getPage:function(e){return this.pages[e]},getQuestion:function(e){if(e==="merveySources"||e===this.getSourceSurveysQuestionId()){return this.getSourceSurveys()}return this.questions[e]},getSourceSurveysQuestionId:function(){return this.source_surveys_question_id},getSourceSurvey:function(e){var t=this;return t.sourceSurveysModel.getAnswer(e)},createSourceSurveys:function(e){var t=this,i;i={answers:{},id:"merveySources",type:{family:"single_choice",subtype:"vertical"},headings:[{heading:""}],is_merged_survey:true};i.answers.rows=e;t.sourceSurveysModel=SM.Models.create("Question",{structure:i});t.sourceSurveysModel.loadAnswers(i);return t.sourceSurveysModel},getSourceSurveys:function(){return this.sourceSurveysModel},getAnswer:function(e){return this.answers[e]},getRespondentByID:function(e){return this.respondentsList.map[e]},getRespondentByOffset:function(e){return this.respondentsList.getOffset(e)},getCollector:function(e){return this.collectors[e]},getRollup:function(e){if(this.questionRollups){return this.questionRollups.questions[e]||null}},getRandomAssignmentRollup:function(e,t){var i;if(this.questionRollups){i=this.questionRollups.questions[e];if(i.nestedQuestionDict[t]){return i.nestedQuestionDict[t]}else{return this.getRollup(e)}}},getBenchmarkRollup:function(e){if(this.benchmarkRollups){return this.benchmarkRollups.getRollup(e)}},getLastShownPage:function(){var e=this.shownPageList.length;if(!e){return null}return this.shownPageList[e-1]},getNextShownPage:function(e){var t=this.pageList,i=e+1,s,n=t.length;for(;i<n;i++){s=t[i];if(s.isShown()){return s}}return null},getPrevShownPage:function(e){var t=this.pageList,i=e-1,s;for(;i>=0;i--){s=t[i];if(s.isShown()){return s}}return null},getFirstShownPage:function(){var e=this.shownPageList.length;if(!e){return null}return this.shownPageList[0]},getShownQuestionIDs:function(e){var t;if(e!=="all"){t=this.survey.pageList[e].shownQuestionList}else{t=this.shownQuestionList}return $.map(t,function(e){return e.ID})},getQuestionTrend:function(e){if(this.trendsModel&&this.trendsModel.questionTrends){return this.trendsModel.questionTrends.questionMap[e]}},getResponsesTrend:function(){if(this.trendsModel&&this.trendsModel.responseTrends){return this.trendsModel.responseTrends}},getSelectedView:function(){return this.anviews.getView(this.anviews.get("selectedViewID"))},loadViews:function(e){this.anviews=SM.Models.create("AnViewList",{survey:this});this.anviews.createViewModels(e)},loadOwner:function(e){this.owner=SM.Models.create("User",{ID:e["id"],user:e["features"],groupPreferences:e["group_preferences"]});this.owner.survey=this},loadCurrentUser:function(e){this.currentUserID=e.id;this.currentUserEmail=e.email},loadRespondents:function(e){var t=e.status===0?e.data.respondent_offset:null;this.respondentsList=SM.Models.create("RespondentList",{selectedOffset:t});this.respondentsList.loadSurvey(this);if(e.status===0&&this.respondentCounts.total_context){this.respondentsList.loadRespondents(e.data.respondents)}else if(e.status!==0){this.respondentsList.set("failedLoad",true);this.respondentsList.set("failedLoadRequestID",e.request_id)}},loadQuestionRollups:function(e){this.questionRollups=SM.Models.create("QuestionRollupList");this.questionRollups.loadSurvey(this);if(e.status===0){this.questionRollups.loadRollups(e.data.question_rollups)}else{this.questionRollups.set("failedLoad",true);this.questionRollups.set("failedLoadRequestID",e.request_id)}},loadSurveyTrends:function(e){this.trendsModel=SM.Models.create("SurveyTrends");this.trendsModel.loadSurvey(this);if(e.status===0){if(e.data.survey_respondent_trends){this.trendsModel.loadResponsesTrends(e.data)}if(e.data.question_responses_trends){this.trendsModel.loadQuestionTrends(e.data.question_responses_trends,e.data.trend_range)}}else{this.trendsModel.set("failedLoad",true);this.trendsModel.set("failedLoadRequestID",e.request_id)}},loadAnalyzeState:function(e){this.state=SM.Models.create("AnalyzeState",e);this.state.survey=this},loadExportJobs:function(e){this.exportJobs=SM.Models.create("ExportJobList",{config:this.config});this.exportJobs.survey=this;this.exportJobs.poller=SM.Models.create("ExportJobPoller",{config:this.config.export_poller});this.exportJobs.poller.loadJobs(this.exportJobs)},loadSharedViews:function(){this.sharedViews=SM.Models.create("SharedViewList",{survey:this});this.sharedViews.fetch()},loadConfig:function(e){this.config=e;this.config.export_formats_enabled_server_side=SM.Object.deepCopy(this.config.export_formats_enabled)},loadBenchmarkRollups:function(e){this.benchmarkRollups=SM.Models.create("QuestionBenchmarkRollups",{survey:this});if(e.status===0){this.benchmarkRollups.loadRollups(e.data)}else{this.benchmarkRollups.set("failedLoad",true);this.benchmarkRollups.set("failedLoadRequestID",e.request_id)}},loadDriverRollups:function(e){if(!this.driverRollups){this.driverRollups=SM.Models.create("DriverBenchmarkRollups",{survey:this})}if(e.status===0){this.driverRollups.loadRollups(e.data)}else{this.driverRollups.set("failedLoad",true);this.driverRollups.set("failedLoadRequestID",e.request_id)}},isExportFormatTypeEnabled:function(e,t){var i=this.config.export_formats_enabled[t];return!!(i[e]&&this.config.exports_enabled)},isExportEnabled:function(){return this.config["exports_enabled"]},isSharingEnabled:function(){return this.config["sharing_enabled"]},searchQuestions:function(e){var t={},i=[],s=this.searchTerms,n=e.toLowerCase().split(/[\s,-,?,!,(,)]+/),r=n.length,a=this.SEARCH_NGRAM_SIZE,o=0,l,u,h,c,d,f,p,_,g,m;for(;o<r;o++){u=n[o];h=u.substring(0,a);c=o+1===r&&h===u;if(h in s){f=s[h];p=f.length;for(l=0;l<p;l++){d=f[l];if(c||d.word.substring(0,u.length)===u){m=d.id;if(m in t){t[m]++}else{t[m]=1;i.push(m)}}}}}return i.sort(function(e,i){return t[i]-t[e]})},hasRespondents:function(){return this.respondentCounts.total>0},hasFilteredRespondents:function(){return this.respondentCounts.total_context>0},decrementRespondentCounts:function(){var e=this,t={};$.each(this.respondentCounts,function(i,s){if(s!==null&&s!==undefined&&i!=="failed"){t[i]=e.respondentCounts[i]-1}});this.set("respondentCounts",t,{notify:true})},getRespondentUrl:function(e){return"/analyze/browse/"+this.encryptedID+"?respondent_id="+e},_createPageModels:function(e){var t,i,s,n=e.survey_data,r=e.pageIDs,a=n.pages,o=n.questions,l={},u=[],h={},c=[],d={},f={},p=r.length,_,g;for(t=0;t<p;t++){i=r[t];g=a[i];_=SM.Models.create("Page",{ID:i,structure:g});_.survey=this;_.loadQuestions({questionMap:o,questionIDs:g.question_ids,npsEnabled:e.npsEnabled,mode:e.mode});if(t===p-1){_.isPanelPage=this.hasPanelPage}l[i]=_;u.push(_);SM.Object.update(h,_.questions);SM.Object.update(d,_.answers);for(s in _.searchTerms){if(f[s]){f[s]=f[s].concat(_.searchTerms[s])}else{f[s]=_.searchTerms[s]}}c=c.concat(_.questionList)}return{pages:l,pageList:u,questions:h,questionList:c,answers:d,searchTerms:f}},isFiltered:function(){return this.respondentCounts.matching!==null&&this.respondentCounts.matching!==undefined},loadCollectors:function(e){var t={},i=[],s={weblink:"Web Link",email:"Email",audience:"Targeted Audience",popup:"Website Survey",facebook:"Facebook Link"},n=30,r,a,o,l,u;this.collectorList=$.map(e,function(e){var i={id:e.collector_id,title:SM.String.truncateMiddle(SM.Html.strip(e.title),n),dateCreated:new Date(e.date_created),isOpen:e.is_open,isClosed:e.is_closed,isClearing:e.is_clearing_responses,isUnconfigured:e.is_new,isArchived:e.is_archived,type:e.collector_type,formattedType:Globalize.localize(s[e.collector_type]),isFacebook:e.is_facebook,isLink:e.is_weblink,isAudience:e.is_audience,isEmail:e.is_email,isPopup:e.is_popup,link:e.link,entity_id:e.entity_id,formattedResponseCount:Globalize.format(e.response_count,"n0")};r=SM.TrendLib.localize(e.date_created);a=r.year();o=r.month();l=r.date();u=new Date(a,o,l);i.formattedDate=Globalize.format(u,"d");t[i.id]=i;return i});this.collectors=t},hasTextAnalysis:function(){return this.owner.hasTextAnalysis()},getCountOfBenchmarkableQuestions:function(){var e=0;_.each(this.pages,function(t,i){e=e+t.getCountOfBenchmarkableQuestions()});return e},getAllBenchmarkableQuestionIds:function(){var e=[];_.each(this.pages,function(t,i){e=e.concat(t.getAllBenchmarkableQuestionIds())});return e},getAllBenchmarkableQuestionLogicalIds:function(){var e=[];_.each(this.pages,function(t,i){e=e.concat(t.getAllBenchmarkableQuestionLogicalIds())});return e},getIndexOfFirstPageWithQuestions:function(){var e;e=_.find(this.pageList,function(e){return e.questionList.length>0});return e?e.index:0},hasSHRMQuestion:function(){var e=_.find(this.pages,function(e,t){if(e.hasSHRMQuestion()){return true}});return!_.isUndefined(e)},hasCSATQuestion:function(){var e=_.find(this.pages,function(e,t){if(e.hasCSATQuestion()){return true}});return!_.isUndefined(e)},hasEventQuestion:function(){var e=_.find(this.pages,function(e,t){if(e.hasEventQuestion()){return true}});return!_.isUndefined(e)},hasNPSQuestion:function(){var e=_.find(this.pages,function(e,t){if(e.hasNPSQuestion()){return true}});return!_.isUndefined(e)},getTemplateID:function(){return this.templateInfo["template_id"]},getTemplateType:function(){return this.templateInfo["template_type"]},getTemplateName:function(){return this.templateInfo["template_name"]},validateTMBCTemplate:function(){var e;e=_.filter(this.questions,function(e,t){if(e.is_tmbc&&!e.structure.is_edited){return true}});e=_.uniq(e);if(e.length!==this.TMBC_QUESTION_COUNT){return false}return true},isSHRMTemplate:function(){return this.getTemplateType()===this.TEMPLATE_TYPES.SHRM.toUpperCase()},isNPSTemplate:function(){return this.getTemplateType()===this.TEMPLATE_TYPES.NPS.toUpperCase()},isCSATTemplate:function(){return this.getTemplateType()===this.TEMPLATE_TYPES.CSAT.toUpperCase()},isEVENTTemplate:function(){return this.getTemplateType()===this.TEMPLATE_TYPES.EVENT.toUpperCase()},isTMBCTemplate:function(){return this.getTemplateType()===this.TEMPLATE_TYPES.TMBC},isStoreTemplate:function(){var e=this.getTemplateType();return e&&e!==this.TEMPLATE_TYPES.TMBC},isGenericTemplate:function(){return!this.getTemplateType()},getDriverType:function(){if(this.isTMBCTemplate()){return this.DRIVER_TYPES.TMBC}return this.DRIVER_TYPES.STD},hasProfiledCollector:function(){var e=_.filter(this.collectorList,function(e){if(e.entity_id!=="verified.0"){return e}});return e.length>0},hasValidEntity:function(){return!!this.profiler&&this.profiler.hasValidEntity()||this.hasProfiledCollector()},isProfilerDriverEnabled:function(){var e=this.hasValidEntity(),t=this.hasProfiledCollector(),i=this.dataSegmentList.hasPaidBenchmarks(),s=this.dataSegmentList.hasRestrictedFeatures(),n=this.owner.hasBenchmarkingOptOut(),r=this.anviews.defaultView.isBenchmarkingShownForAnyQuestion(),a=this.getTemplateName(),o;if(!this.profiler){return false}if(!this.isCurrentUserAlsoOwner()){return false}if(this.getCountOfBenchmarkableQuestions()>0){if(this.isTMBCTemplate()){o=this.validateTMBCTemplate()&&this.hasValidEntity()}if(this.owner.benchmarkingHasOptOut||!this.hasValidEntity()){r=false}SM.Bi.logUserProfileState(e,t,n,s,i,r,a,o)}return!e&&!s},shouldShowProfiler:function(){if(this.owner.hasBenchmarkingRestricted()||!this.isCurrentUserAlsoOwner()&&(this.currentUserBenchmarksEnabled||!this.owner.hasBenchmarkingOptOut())){return false}return!this.owner.benchmarkingOptOutWasSet||!this.hasValidEntity()&&!this.owner.benchmarkingHasOptOut;
},isProfilerDialogEnabled:function(){if(!this.profiler){return false}if(!this.isCurrentUserAlsoOwner()){return false}if(this.owner.hasBenchmarkingRestricted()){return false}return this.shouldShowProfiler()||this.owner.hasBenchmarkingOptOut()},canShowBenchmarking:function(){if(!this.isCurrentUserAlsoOwner()){if(!this.profiler){return false}if(this.owner.canShowBenchmarking()||this.owner.hasBenchmarkingRestricted()){return true}if(this.currentUserBenchmarksEnabled){return true}if(this.profiler.shouldShowProfiler()||this.owner.hasBenchmarkingOptOut()){return false}}return this.owner.canShowBenchmarking()},isOwner:function(e){return e===this.owner.ID},isCurrentUserAlsoOwner:function(){return this.isOwner(this.currentUserID)},triggerProfileSaved:function(){this._trigger({type:"profiler:profile_saved"})},filoDownload:function(e){var t;if($.isArray(e)){t=e.join(",")}else{t=e}window.location=this.filoPreviewUrl(t)},filoPreviewUrl:function(e){return"/analyze/files/download/?survey_id="+this.ID+"&files="+e},filoDelete:function(e){var t=[];if(e.length===0){return}_.each(e,function(e){t.push({respondent_id:e.respondent_id,collector_id:e.collector_id,collection_mode:e.collection_mode})});SM.API.filoDelete({survey_id:this.ID,question_id:e[0].question_id,respondents:t})}});SM.Models.register("User",{UNLIMITED:"unlimited",BASIC:"BASIC",SELECT_YEARLY:"SELECT_YEARLY",SELECT_MONTHLY:"SELECT_MONTHLY",GOLD:"GOLD",PLATINUM:"PLATINUM",ENTERPRISE_PLATINUM:"ENTERPRISE_PLATINUM",ZOOM_PRO:"ZOOM_PRO",__create:function(e){this.ID=e.ID;this.packageType=e.user.package_type;this.responseLimit=e.user.analyze_response_limit;this.responseDeleteLimit=e.user.response_delete_limit;this.ruleLimit=e.user.analyze_rule_limit;this.textAnalysIsEnabled=e.user.analyze_ta_enabled;this.hasDismissedTaUpgrade=false;this.hasDismissedFiloUpgrade=false;this.trendsEnabled=e.user.analyze_trends_enabled;this.sharingEnabled=e.user.sharing_enabled;this.hipaaEnabled=e.user.hipaa_enabled;this.exportEnabled=e.user.analyze_export_enabled;this.logoEnabled=e.user.create_logo_enabled;this.logicEnabled=e.user.create_skip_logic_enabled;this.fileUploadEnabled=e.user.file_upload_question_type;this.email=e.user.email||"";this.benchmarkingEnabled=e.user.benchmarking_enabled;this.benchmarkingRestrictedEnabled=e.user.benchmarking_restricted_enabled;this.benchmarkingHasOptOut=e.user.benchmarking_has_opt_out;this.benchmarkingOptOutWasSet=e.user.benchmarking_opt_out_was_set;this.whiteLabel=e.user.white_label;this.disabledExports={spss:!e.user.analyze_export_spss_enabled,ppt:!this.canExportPPT()};this.enterprisePreferences=e.groupPreferences},isOverResponseLimit:function(e){return this.responseLimit!==this.UNLIMITED&&this.responseLimit<e},hasRuleLimit:function(){return this.ruleLimit!==this.UNLIMITED},isOverRuleLimit:function(){var e=this.survey.anviews.currentView.ruleList;if(!this.hasRuleLimit()){return false}if(!e){return this.ruleLimit===0}return e.length>=this.ruleLimit},isBasic:function(){return this.packageType===this.BASIC},isSelect:function(){return this.packageType===this.SELECT_YEARLY||this.packageType===this.SELECT_MONTHLY},isZoomPro:function(){return this.packageType===this.ZOOM_PRO},isGold:function(){return this.packageType===this.GOLD},isPlatinum:function(){return this.packageType===this.PLATINUM},isEnterprisePlatinum:function(){return this.packageType===this.ENTERPRISE_PLATINUM},isFiloEnabled:function(){return this.fileUploadEnabled},hasTextAnalysis:function(){return this.textAnalysIsEnabled},hasExports:function(){return this.exportEnabled},canExport:function(e){if(this.exportEnabled){if(this.disabledExports[e]){return false}return true}return false},canExportPPT:function(){return this.isSelect()||this.isGold()||this.isPlatinum()||this.isEnterprisePlatinum()},hasTrends:function(){return this.trendsEnabled},hasSharing:function(){return this.sharingEnabled},hasBenchmarking:function(){return this.benchmarkingEnabled&&!SM.App.isSharingApp()&&!this.survey.isExport},hasBenchmarkingRestricted:function(){return this.benchmarkingRestrictedEnabled&&this.hasBenchmarking()},hasBenchmarkingOptOut:function(){return this.benchmarkingOptOutWasSet&&this.benchmarkingHasOptOut},canShowBenchmarking:function(){if(this.hasBenchmarkingRestricted()){return true}return this.hasBenchmarking()&&!this.hasBenchmarkingOptOut()},canHideExportBranding:function(){return this.isGold()||this.isPlatinum()||this.isEnterprisePlatinum()},canSigDiffs:function(){return this.isGold()||this.isPlatinum()||this.isEnterprisePlatinum()},canExportTA:function(){return this.isGold()||this.isPlatinum()||this.isEnterprisePlatinum()},getEnterpriseGroupDefaultDomain:function(){return this.enterprisePreferences.selected_domain||null},getEnterpriseGroupDomains:function(){return $.map(this.enterprisePreferences.custom_domains,function(e,t){return{domain:e}})},isMonthly:function(){return this.packageType===this.SELECT_MONTHLY},isInGroup:function(){return this.enterprisePreferences&&this.enterprisePreferences["group_id"]},canHaveMultiSeat:function(){return!(this.isMonthly()||this.isBasic())&&!this.isInGroup()}});SM.Models.register("Page",{__create:function(e){var t=e.structure,i;this.ID=e.ID;this.heading=SM.Html.strip(t.heading);this.shortHeading=SM.String.truncate(this.heading,17);this.position=t.position;this.hasHeading=this.heading.length>0;this.index=t.position-1;this.subheading=t.subheading;this.editLink=t.edit_link},ID:"",heading:"",position:null,index:null,subheading:"",questions:{},questionList:[],questionCount:null,answers:{},searchTerms:{},survey:null,shownQuestionList:[],loadedQuestionMap:{},isPanelPage:false,loadQuestions:function(e){var t=0,i=e.questionMap,s=e.questionIDs,n,r,a,o,l=[],u={},h={},c={},d=s.length;for(;t<d;t++){a=s[t];n=i[a];if(n.type.family==="presentation"&&!n.has_random_assignment){continue}r=SM.Models.create("Question",{ID:n.id,structure:n,npsEnabled:e.npsEnabled,mode:e.mode});r.page=this;u[n.id]=r;l.push(r);r.loadAnswers(n);r.loadIntoSearch();for(o in r.searchTerms){if(c[o]){c[o]=c[o].concat(r.searchTerms[o])}else{c[o]=r.searchTerms[o]}}SM.Object.update(h,r.answers)}this.questions=u;this.questionList=l;this.questionCount=this.questionList.length;this.answers=h;this.searchTerms=c},isShown:function(e){e=e||this.survey.anviews.currentView.show;var t=e.pages;return!e.selected||t&&t[this.ID]},getCountOfBenchmarkableQuestions:function(){var e=0;_.each(this.questions,function(t,i){if(t.isBenchmarkable()){e=e+1}});return e},getAllBenchmarkableQuestionIds:function(){var e=[];_.each(this.questions,function(t,i){if(t.isBenchmarkable()){e.push(t.ID)}});return e},getAllBenchmarkableQuestionLogicalIds:function(){var e=[];_.each(this.questions,function(t,i){if(t.isBenchmarkable()){e.push(t.logicalID)}});return e},hasSHRMQuestion:function(){var e=_.find(this.questions,function(e,t){if(e.is_shrm){return true}});return!_.isUndefined(e)},hasCSATQuestion:function(){var e=_.find(this.questions,function(e,t){if(e.is_csat){return true}});return!_.isUndefined(e)},hasEventQuestion:function(){var e=_.find(this.questions,function(e,t){if(e.is_event){return true}});return!_.isUndefined(e)},hasNPSQuestion:function(){var e=_.find(this.questions,function(e,t){if(e.isNPS()){return true}});return!_.isUndefined(e)},validateTMBCQuestions:function(){var e=_.find(this.questions,function(e,t){if(!e.is_tmbc||e.structure.is_edited){return true}});return _.isUndefined(e)}});SM.Models.register("Question",{QTYPE:{open_ended:"open_ended",datetime:"datetime",demographic:"demographic",numerical:"numerical",nps:"net_promoter_score",single_choice:"single_choice",multiple_choice:"multiple_choice",horiz:"horiz",matrix:"matrix",menu:"menu",menu_matrix:"menu_matrix",single:"single",simple:"simple",rating_scale:"rating",ranking:"ranking",essay:"essay",other_option:"other_option",presentation:"presentation",multi:"multi",descriptive_text:"descriptive_text",image:"image"},displaySubTypeMap:{star:83,heart:107,smiley:258,thumb:256},compareMap:{single_choice:"matrix",multiple_choice:"matrix",matrix:"menu_matrix",open_ended:"matrix",demographic:"matrix",datetime:"matrix"},ID:null,title:"",number:null,family:null,subtype:null,displayType:null,displaySubType:null,searchTerms:{},options:null,rowList:[],colList:[],colChoices:{},page:null,commentField:null,randomAssignmentMap:null,__create:function(e){var t=e.structure;if(t.type.subtype===this.QTYPE.rating_scale&&t.type.family===this.QTYPE.matrix){this.name=t.type.name}this.is_shrm=t.type.is_shrm;this.is_nps=t.type.is_nps;this.is_event=t.type.is_event;this.is_csat=t.type.is_csat;this.is_tmbc=t.type.is_tmbc;this.is_top_2=t.type.is_top_2;this.analysis_type=t.type.analysis_type;if(e.npsEnabled&&e.mode==="summary"&&this.is_nps){t=SM.ComparedByNps.structure(t)}this.npsEnabled=e.npsEnabled;this.is_merged_survey=t.is_merged_survey;this.ID=t.id;this.logicalID=t.logical_id;this.logicalName=t.logical_name;this.logicalLangId=t.logical_lang_id;this.structure=t;this.headings=t.headings;this.heading=SM.String.text(DOMPurify.sanitize(this.headings[0].heading));this.position=t.position;this.family=t.type.family;this.subtype=t.type.display_type==="file_upload"?"file_upload":t.type.subtype;this.displayType=t.type.display_type;this.displaySubType=t.type.display_subtype;this.randomAssignmentList=[];for(var i=0;i<this.headings.length;i++){var s=this.headings[i],n=s.heading;if(n===""){n=s.description}s.heading=DOMPurify.sanitize(n);if(s.random_assignment){var r={heading:s.heading,percent:s.random_assignment.percent,variable_id:s.random_assignment.variable_id,variable_name:s.random_assignment.variable_name};if(s.image){var a;if(s.image.s3_key){a="s3"}else if(s.image.url.indexOf("http://")===0||s.image.url.indexOf("https://")===0){a="url"}else{a="upload"}r.image={source:s.image.s3_key===""?s.image.url:s.image.s3_key,type:a,url:s.image.url}}this.randomAssignmentList.push(r)}}this.sanitizeRAList(this.randomAssignmentList);var o=typeof SM.AnalyzeApp!=="undefined"&&"defaultRAHeader"in SM.AnalyzeApp?SM.AnalyzeApp.defaultRAHeader:SM.raHeader||"A/B Test";if(this.isPresentation()){this.heading=t.nickname||o}else if(this.headings.length>1){this.heading=o}this.searchTerms={};this._models={}},loadIntoSearch:function(){this._addToSearchTerms("Q"+this.position);this._addToSearchTerms(this.heading)},hasRollupLoaded:function(){var e=this.getRollup();return e&&e.type!=="null_rollup"},hasTrendLoaded:function(){var e=this.getTrend();return e.get("isLoaded")},hasRandomAssignment:function(){return!!this.randomAssignmentList&&this.randomAssignmentList.length>0},isAfterLastLoadedRollup:function(){return this.page.survey.questionRollups.isAfterLastLoadedQuestion(this)},isAfterLastLoadedTrend:function(){return this.page.survey.trendsModel.questionTrends.isAfterLastLoadedQuestion(this)},setCompareStructure:function(e){this.compareStructure=e},isComparable:function(){return!!this.compareMap[this.family]&&!(this.subtype===this.QTYPE.menu&&this.family===this.QTYPE.matrix)},hasComparableOptions:function(){return this.family===this.QTYPE.matrix&&this.subtype!==this.QTYPE.menu||this.family===this.QTYPE.multiple_choice||this.family===this.QTYPE.single_choice},isBenchmarkable:function(){var e=this,t=e.structure;if(!t.is_benchmarkable){return false}if(e.isNPS()&&_.size(t.answers.rows)!==11){return false}return true},hasChartView:function(){return this.family===this.QTYPE.matrix||this.family===this.QTYPE.multiple_choice||this.family===this.QTYPE.single_choice||this.subtype===this.QTYPE.numerical},hasTACloud:function(){return this.getRollup().hasTaModels()&&!this.isFileUpload()},hasCloudView:function(){return this.hasTACloud()&&!this.hasRandomAssignment()&&!this.isDateTime()&&!this.isNumerical()&&!this.shouldDisableWordCloud()},getCompareType:function(){return this.compareMap[this.family]},getContextStructure:function(){if(this.isCompared()){return this.compareStructure}return this.structure},getContextAnswerStructure:function(e){var t=e?this.top2compositeAnswerStructure:this.compositeAnswerStructure;if(t){return t}else{return this.getContextStructure().answers}},isCompared:function(){return this.compareStructure!==undefined},isShown:function(e){e=e||this.page.survey.anviews.currentView.show;var t=e.questions;return!e.selected||t&&t[this.ID]},getRollup:function(){var e=!!(this.randomAssignmentList&&this.randomAssignmentOption);if(e){return this.getRandomAssignmentRollup()}else{return this.page.survey.getRollup(this.ID)}},getBenchmarkRollup:function(){return this.page.survey.benchmarkRollups.getRollup(this.ID)},getRandomAssignmentRollup:function(){return this.page.survey.getRandomAssignmentRollup(this.ID,this.randomAssignmentOption)},getRandomAssignmentOption:function(e){this.randomAssignmentMap=this.randomAssignmentMap||this._createRandomAssignmentMap();return this.randomAssignmentMap[e]},_createRandomAssignmentMap:function(){var e={},t=this.randomAssignmentList,i,s;_.each(t,function(t){i=t.variable_id;e[i]=t});return e},getTrend:function(){return this.page.survey.getQuestionTrend(this.ID)},getResponse:function(e){var t=this.page.survey.respondentsList.map[e];return t.getResponse(this.ID)},getCrossedQuestion:function(){var e=this.page.survey,t=e.anviews.currentView;if(this.isCompared()&&t.compareRule){return e.getQuestion(t.compareRule.get("questionID"))}},loadAnswers:function(e){var t=this;this.answers={};if(e.answers.rows){if(!e.is_merged_survey){this._parseRowAnswers(e.answers.rows)}else{_.each(e.answers.rows,function(e){t.answers[e.id]=e})}this.rowList=e.answers.rows}else{e.answers.rows=[]}if(e.answers.cols){this._parseColAnswers(e.answers.cols);this.colList=e.answers.cols;if(this.subtype==="ranking"){this._initRankingWeights()}}if(e.answers.other){this._parseOtherAnswers(e.answers.other);this.commentFieldList=e.answers.other;this.commentField=this.commentFieldList[0]}},getAnswer:function(e){return this.answers[e]},buildCompositeAnswerStructure:function(e,t){var i=this,s=i.getContextStructure(),n=s.answers,r=i.getCombineHideDim(),a,o,l,u,h,c,d,f,p,g,m;if(!e){if(t){i.top2compositeAnswerStructure=null;i.top2hiddenComposites=[];i.top2combinedComposites=[]}else{i.compositeAnswerStructure=null;i.hiddenComposites=[];i.combinedComposites=[]}return}a={rows:"row",cols:"column"};o=SM.Object.deepCopy(n);u=[];_.each(e.combines,function(e){_.each(o[r],function(t){d=SM.Object.deepCopy(t);d.combineId=e.id;if(_.contains(e.combine,t.id)){u.push(d)}})});if(t){i.top2combinedComposites=u}else{i.combinedComposites=u}_.each(e.combines,function(e,t){_.each(e.combine,function(e){o[r]=_.reject(o[r],function(t){return t.id===e})})});h=_.pluck(e.hides,"id");c=[];if(_.size(h)!==0){_.each(o[r],function(e){if(_.contains(h,e.id)){c.push(SM.Object.deepCopy(e))}})}if(t){i.top2hiddenComposites=c}else{i.hiddenComposites=c}_.each(e.hides,function(e){o[r]=_.reject(o[r],function(t){return t.id===e.id})});_.each(e.combines,function(e){p={text:e.title,visible:true,position:999,type:a[r],isCombined:true,id:e.id,question_id:i.ID,is_openended:false};if(i.isRating()){g=_.min(e.combine,function(e){return e});l=_.findWhere(n[r],{id:g});p.weight=l.weight}o[r].push(p)});o[r]=_.sortBy(o[r],function(e){return e.id});if(i.isRanking()){f=[];m=_.size(o[r]);_.each(o[r],function(e,t){d=SM.Object.deepCopy(e);d.weight=m-t;f.push(d)});o[r]=f}if(t){i.top2compositeAnswerStructure=o}else{i.compositeAnswerStructure=o}},buildCompositeMapping:function(e,t){var i=this,s=i.getContextStructure(),n=s.answers,r=i.getCombineHideDim(),a=t?i.top2compositeAnswerStructure:i.compositeAnswerStructure,o={},l,u,h,c;_.each(a[r],function(t){c=_.findWhere(e.combines,{id:t.id});if(c){u=c.combine;_.each(u,function(e){l=_.findWhere(n[r],{id:e});o[l.id]=t})}else{l=_.findWhere(n[r],{id:t.id});o[l.id]=t}});_.each(e.hides,function(e){l=_.findWhere(n[r],{id:e.id});o[l.id]=null});return o},getCombineHideDim:function(){var e=this;if(e.isCompared()){if(e.isMenuMatrix()){return null}else{return"rows"}}else{if(e.isSimple()){return"rows"}else if(e.isMatrix()){return"cols"}}return null},canCombineHide:function(){var e=this;if(e.isCompared()&&e.isMenuMatrix()){return false}if(e.isOpenEnded()){return false}if(e.hasRandomAssignment()){return false}if(e.isNPS()){return false}return this.isSimple()||this.isMatrix()},otherIsAnAnswerChoice:function(){var e=this,t=e.getContextStructure(),i=t.answers;return i.other!==undefined&&i.other[0].options.is_answer_choice},isOther:function(e){var t=this,i=t.getContextStructure(),s=i.answers;return s.other!==undefined&&s.other[0].id===e},summaryType:function(){var e=this,t=e.getRollup(),i=t.summary;return e.isCompared()?i.summary.type:i.type},depthType:function(){var e=this;if(e.isMatrix()){if(e.isMenuMatrix()){return e.QTYPE.menu_matrix}else{return e.QTYPE.matrix}}else{return e.QTYPE.single}},isNPS:function(){var e=this;if(!e.npsEnabled){return false}return this.is_nps},isSimple:function(){if(this.isCompared()){return false}return this.family===this.QTYPE.multiple_choice||this.family===this.QTYPE.single_choice},isSingleChoice:function(){return this.family===this.QTYPE.single_choice},isMultipleChoice:function(){return this.family===this.QTYPE.multiple_choice||this.family===this.QTYPE.matrix&&this.subtype===this.QTYPE.multi},isNumerical:function(){return this.subtype===this.QTYPE.numerical},isMatrix:function(){if(this.isCompared()){return this.compareStructure.type.family===this.QTYPE.matrix}return this.family===this.QTYPE.matrix},isMenuMatrix:function(){if(this.isCompared()){return this.compareStructure.type.family===this.QTYPE.matrix&&this.compareStructure.type.subtype===this.QTYPE.menu}return this.family===this.QTYPE.matrix&&this.subtype===this.QTYPE.menu},isMultiResponse:function(){return this.family==="multiple_choice"||this.family==="open_ended"&&(this.subtype==="multi"||this.isNumerical())||this.family==="demographic"||this.family==="datetime"||this.family==="matrix"&&this.subtype==="multi"},isOpenEnded:function(){return this.family==="open_ended"||this.family==="demographic"||this.family==="datetime"},isPresentation:function(){return this.family===this.QTYPE.presentation},isEssay:function(){return this.family==="open_ended"&&(this.subtype==="essay"||this.subtype==="single")},isFileUpload:function(){return this.family==="open_ended"&&this.subtype==="file_upload"},isRating:function(){return this.subtype==="rating"},isRanking:function(){return this.subtype==="ranking"},isDateTime:function(){return this.family===this.QTYPE.datetime},isDemographic:function(){return this.family===this.QTYPE.demographic},isSimpleRating:function(){return this.subtype==="rating"&&!this.isCompared()&&_.size(this.structure.answers.rows)===1},isEmoji:function(){return this.displayType==="emoji"},isTop2:function(){return this.is_top_2},isTop2Ascending:function(){return this.analysis_type==="top_2_asc"},canSidi:function(){var e=this;if(e.isOpenEnded()){return false}if(e.hasRandomAssignment()){return false}if(e.isNPS()){return false}return this.isCompared()&&(this.isSimple()||this.isMatrix())},hasCommentsPerRow:function(){return!!(this.structure.answers.other&&this.structure.answers.other[0].options.apply_all_rows)},shouldDisableWordCloud:function(){return!!this.structure.validation&&!!this.structure.validation.type&&(this.structure.validation.type==="integer"||this.structure.validation.type.indexOf("date")!==-1||this.structure.validation.type==="email")},getOpenEndedType:function(){var e=this.family,t=this.subtype;if(e==="open_ended"){return t}if(e==="demographic"||e==="datetime"){return e}},labelByWeights:function(e){var t=this,i,s=0,n=SM.Object.deepCopy(e),r=n.other,a,o;if(t.compositeAnswerStructure||t.isNPS()||t.isRanking()||!t.getRollup().display.getDisplayData().show_basic_stats){return n}if(t.isSimple()){i="rows"}else if(t.isNumerical()){return n}else if(t.isCompared()){if(t.isMenuMatrix()){i="cols"}else{i="rows"}}else if(t.isMenuMatrix()){i="columnChoices"}else if(t.isMatrix()){i="cols"}if(i==="rows"){_.each(n.rows,function(e,t){e.text+=" ("+(t+1)+")";if(e.mediaHTML){e.mediaHTML+=" ("+(t+1)+")"}s=t+1})}else if(i==="cols"){_.each(n.cols,function(e,t){if(!e.options.is_na){e.text+=" ("+(t+1)+")";if(e.mediaHTML){e.mediaHTML+=" ("+(t+1)+")"}s=t+1}})}else{_.each(n.cols,function(e){_.each(e.items,function(e,t){e.text+=" ("+(t+1)+")";if(e.mediaHTML){e.mediaHTML+=" ("+(t+1)+")"}s=t+1})})}o=r!==undefined&&r[0].options.is_answer_choice;if(o){a=n.other[0];a.text+=" ("+(s+1)+")"}return n},_initRankingWeights:function(){var e=this.colList,t=this.colList.length;$.each(e,function(e,i){if(i.options.is_na){t--}});$.each(e,function(e,i){if(i.options.is_na){i.options.weight=0}else{i.options.weight=t-e}})},_parseAnswers:function(e,t){var i=e.length,s=0,n,r=this.answers,a;for(;s<i;s++){n=e[s];this.sanitizeAnswer(n);r[n.id]=n;this._addToSearchTerms(n.text);n.is_openended=t}},_parseOtherAnswers:function(e){this._parseAnswers(e,true)},_parseRowAnswers:function(e){this._parseAnswers(e,this.isOpenEnded())},_parseColAnswers:function(e){var t=e.length,i,s,n=this.answers,r,a,o,l,u;for(i=0;i<t;i++){r=e[i];this.sanitizeAnswer(r);if(r.options.is_na){this.naCol=r}n[r.id]=r;this._addToSearchTerms(r.text);a=r.items?r.items:[];o=a.length;for(s=0;s<o;s++){l=a[s];this.sanitizeAnswer(l);n[l.id]=l;this._addToSearchTerms(l.text)}}if(this.naCol&&this.naCol.position===0){e.shift();e.push(this.naCol);this.naCol.position=t}},_addToSearchTerms:function(e){var t=e.toLowerCase().split(/[\s,-,?,!,(,),\/]+/),i=t.length,s=this.page.survey.SEARCH_NGRAM_SIZE,n=this.searchTerms,r=0,a,o;for(;r<i;r++){a=t[r];o=a.substring(0,s);if(!a.length){continue}else if(o in n){n[o].push({word:a,id:this.ID})}else{n[o]=[{word:a,id:this.ID}]}}},mungeCompareMenuMatrix:function(e,t,i){var s,n,r,a=e.crossed_cols||e.crossed_rows,o,l,u,h=this.structure,c=this.rowList,d=c.length,f=this.colList,p=f.length,g=0,m=0;u=SM.Object.deepCopy(h);u.type={family:"matrix",subtype:"menu"};if(!i){for(g=0;g<p;g++){u.answers.cols[g].items=[];for(m=0;m<a.length;m++){s=t.is_merged_survey?"Survey: ":"Q"+t.position+": ";if(e.crossed_cols){o=e.crossed_rows[0];r=t.answers[o];n=e.crossed_cols[m];l=t.answers[n];l=SM.Object.copy(l);if(!t.isEmoji()){s=s+[r.text,l.text].join(": ")}else{s=s+l.text}u.answers.cols[g].items[m]=l}else{o=e.crossed_rows[m];r=t.answers[o];r=SM.Object.copy(r);if(!t.isEmoji()){s=s+r.text}u.answers.cols[g].items[m]=r}u.answers.cols[g].items[m].text=s}}for(g=0;g<d;g++){u.answers.rows[g].items=[];for(m=0;m<a.length;m++){s=t.is_merged_survey?"Survey: ":"Q"+t.position+": ";if(e.crossed_cols){o=e.crossed_rows[0];r=t.answers[o];n=e.crossed_cols[m];l=t.answers[n];l=SM.Object.copy(l);if(!t.isEmoji()){s=s+[r.text,l.text].join(": ")}else{s=s+l.text}u.answers.rows[g].items.push(l)}else{o=e.crossed_rows[m];r=t.answers[o];r=SM.Object.copy(r);if(!t.isEmoji()){s=s+r.text}u.answers.rows[g].items.push(r)}u.answers.rows[g].items[m].text=s}if(!u.answers.crossedOptions){u.answers.crossedOptions=u.answers.rows[g].items}}}else{var v=SM.ComparedByNps.map2DistributedByQuestion(e.crossed_rows,t);_.each(u.answers.cols,function(e,t){u.answers.cols[t].items=_.map(v,_.clone)});_.each(u.answers.rows,function(e,t){u.answers.rows[t].items=_.map(v,_.clone)});if(!u.answers.crossedOptions){u.answers.crossedOptions=v}}return u},mungeCompareMenuMatrixRA:function(e,t){var i,s,n,r=e.crossed_cols||e.crossed_rows,a,o,l,u=this.structure,h=this.rowList,c=h.length,d=this.colList,f=d.length,p=0,_=0;if(r.length===0){r=e.crossed_rows}l=SM.Object.deepCopy(u);l.type={family:"matrix",subtype:"menu"};for(p=0;p<f;p++){l.answers.cols[p].items=[];for(_=0;_<r.length;_++){i="Q"+t.position+": ";if(e.crossed_cols&&e.crossed_cols.length>0){a=e.crossed_rows[0];n=t.answers[a];s=e.crossed_cols[_];o=t.answers[s];o=SM.Object.copy(o);if(!t.isEmoji()){i=i+[n.text,o.text].join(": ")}else{i=i+o.text}l.answers.cols[p].items[_]=o}else{a=e.crossed_rows[_];for(var g=0;g<t.randomAssignmentList.length;g++){if(a===t.randomAssignmentList[g].variable_id){n=t.randomAssignmentList[g];break}}n=SM.Object.copy(n);n.id=n.variable_id.toString();if(n.heading){i+=n.heading}else{i+=n.variable_name}n.position=_+1;n.question_id=parseInt(t.ID);n.visible=true;n.type="col";l.answers.cols[p].items[_]=n}l.answers.cols[p].items[_].text=i}}for(p=0;p<c;p++){l.answers.rows[p].items=[];for(_=0;_<r.length;_++){i=t.is_merged_survey?"Survey: ":"Q"+t.position+": ";if(e.crossed_cols&&e.crossed_cols.length>0){a=e.crossed_rows[0];n=t.answers[a];s=e.crossed_cols[_];o=t.answers[s];o=SM.Object.copy(o);if(!t.isEmoji()){i=i+[n.text,o.text].join(": ")}else{i=i+o.text}l.answers.rows[p].items.push(o)}else{a=e.crossed_rows[_];for(var g=0;g<t.randomAssignmentList.length;g++){if(a===t.randomAssignmentList[g].variable_id){n=t.randomAssignmentList[g];break}}n=SM.Object.copy(n);n.id=n.variable_id.toString();if(n.heading){i+=n.heading}else{i+=n.variable_name}n.position=_+1;n.question_id=parseInt(t.ID);n.visible=true;n.type="row";l.answers.rows[p].items.push(n)}l.answers.rows[p].items[_].text=i}if(!l.answers.crossedOptions){l.answers.crossedOptions=l.answers.rows[p].items}}return l},mungeCompareMatrix:function(e,t,i){var s=this.structure,n,r=e.crossed_cols||e.crossed_rows,a,o,l,u,h,c;n=SM.Object.deepCopy(s);n.type={family:"matrix",subtype:"single"};if(!i){n.answers.cols=[];for(c=0;c<r.length;c++){h=t.is_merged_survey?"Survey: ":"Q"+t.position+": ";if(e.crossed_cols){o=e.crossed_rows[0];a=t.answers[o];l=e.crossed_cols[c];u=t.answers[l];u=SM.Object.copy(u);if(!t.isEmoji()){h=h+[a.text,u.text].join(": ")}else{h=h+u.text}n.answers.cols[c]=u}else{o=e.crossed_rows[c];a=t.answers[o];a=SM.Object.copy(a);if(!t.isEmoji()){h=h+a.text}n.answers.cols[c]=a}n.answers.cols[c].text=h}}else{n.answers.cols=SM.ComparedByNps.map2DistributedByQuestion(e.crossed_rows,t)}n.answers.crossedOptions=n.answers.cols;if(this.isEssay()||this.isFileUpload()){n.answers.rows=[{id:"0",question_id:this.ID,text:this.heading,type:"row",is_openended:true}]}return n},mungeCompareMatrixRA:function(e,t){var i=this.structure,s,n=e.crossed_cols||e.crossed_rows,r,a,o,l,u,h,c;if(n.length===0){n=e.crossed_rows}s=SM.Object.deepCopy(i);s.type={family:"matrix",subtype:"single"};s.answers.cols=[];for(h=0;h<n.length;h++){u=t.is_merged_survey?"Survey: ":"Q"+t.position+": ";if(e.crossed_cols&&e.crossed_cols.length>0){a=e.crossed_rows[0];r=t.answers[a];o=e.crossed_cols[h];l=t.answers[o];l=SM.Object.copy(l);if(!t.isEmoji()){u=u+[r.text,l.text].join(": ")}else{u=u+l.text}s.answers.cols[h]=l}else{a=e.crossed_rows[h];for(var c=0;c<t.randomAssignmentList.length;c++){if(a===t.randomAssignmentList[c].variable_id){r=t.randomAssignmentList[c];break}}r=SM.Object.copy(r);r.id=r.variable_id.toString();if(r.heading){u+=r.heading}else{u+=r.variable_name}s.answers.cols[h]=r}s.answers.cols[h].text=u}s.answers.crossedOptions=s.answers.cols;if(this.isEssay()||this.isFileUpload()){s.answers.rows=[{id:"0",question_id:this.ID,text:this.heading,type:"row",is_openended:true}]}return s},getSidiOptions:function(e,t,i){var s=this,n=s.getRollup(),r=s.getCrossedQuestion(),a,o,l,u;if(n.combinehideModel.isCombined(e)){u={isCombined:true,answerID:e,hasSidi:false};return u}o=n.combinehideModel.getHides();if(_.size(o)>0){u={hasHidden:true,answerID:e,hasSidi:false};return u}l=n.getSidiData(e,t,i);if(!l||!l.enough_responses){return null}if(!l.has_significant_diffs){u={noSidi:true,hasSidi:false};return u}u={p:l.p,confidence_level:l.confidence_level,hasSidi:true};u.higherGroups=SM.SidiUtils.buildPhrase(l.higher_diffs,r);u.hasHigherGroups=u.higherGroups!==null;u.lowerGroups=SM.SidiUtils.buildPhrase(l.lower_diffs,r);u.hasLowerGroups=u.lowerGroups!==null;a=l.higher_diffs.concat(l.lower_diffs);u.groups=SM.SidiUtils.join(a,r);u.answerID=e;return u},sanitizeRAList:function(e){var t=this,i;if(!!e&&e.length){if(this.isPresentation()){_.each(e,function(e,s){if(e.variable_name.length===0){if(t.subtype===t.QTYPE.image){i=Globalize.localize("Image Random Assignment - Image")+" "+(s+1)}else{i=Globalize.localize("Text Random Assignment - Text")+" "+(s+1)}e.variable_name=i}},t)}return e}return[]},sanitizeAnswer:function(e){var t,i,s,n,r="("+Globalize.localize("no label")+")",a;s=SM.Html.findFirstTag(e.text,"img");if(!s){n=DOMPurify.sanitize(e.text);s=SM.Html.findFirstTag(n,"img")}if(s){s=SM.Html.removeExternalAttributes(s);a=SM.Html.parse(s)[0]}if(a){t=a.getAttribute("data-src");t=SM.String.trim(t);t=DOMPurify.sanitize(t);if(SM.String.isHttpUrl(t)){i=t}}if(i){e.text=SM.String.afterLast(i,"/");e.mediaHTML=SM.Template.render("img",{classes:"img-option",src:i,alt:e.text,title:e.text})}else{if(!e.text){e.text=r;if(e.type==="row"&&this.isEmoji()){e.text=this.displaySubTypeMap[this.displaySubType]?String.fromCharCode(this.displaySubTypeMap[this.displaySubType]):e.label}}else{e.text=SM.String.text(DOMPurify.sanitize(e.text))}}}});SM.BaseAnRule={CHOICE_SET_SCHEMA:{rows:{}},BASE_RULE_METADATA_KEY:"rule_",MAX_CHOICE_HEADING_LENGTH:2,TEMP_ID_PREFIX:"new_",FAMILY_TYPES:{SHOW:"show",FILTER:"filter",COMPARE:"compare"},ruleTypeToModelMap:{filter:{respondent_data:"FilterRespondentDataAnRule",collector:"FilterCollectorAnRule",completeness:"FilterCompletenessAnRule",time_period:"FilterTimePeriodAnRule",random_assignment:"FilterRandomAssignmentRule"},compare:{random_assignment:"CompareRandomAssignmentRule"},show:{show:"ShowAnRule"}},qnaRuleModelMap:{single_choice:"QnaSimpleAnRule",multiple_choice:"QnaSimpleAnRule",matrix:"QnaMatrixAnRule",menu_matrix:"QnaMenuMatrixAnRule",open_ended:"QnaOpenEndedAnRule",demographic:"QnaOpenEndedAnRule",datetime:"QnaDatetimeAnRule",numerical:"QnaNumericalAnRule",rating_comment_per_row:"QnaRatingCommentPerRowAnRule",source_surveys:"SourceSurveysRule"},lastValidation:{isValid:true,invalids:[]},__create:function(e){if(!e.ID){this.isNew=true;this.ID=this.TEMP_ID_PREFIX+this.__uid}else{this.isNew=false;this.ID=e.ID}this.is_nps=e.is_nps;this.loadRuleMetadataValue(e.attrs);this.isCorrupt=e.isCorrupt===true;this.ruleFamily=this.isCompare?"compare":"filter";this.editMode=false;this.isDirty=false;this.isShow=false;this.isQNA=false;this.isRA=false;if(this.metadata_id){delete this.metadata_id}},loadRuleMetadataValue:function(e){this.customHeading=e.custom_heading;this.isCompare=e.is_compare_rule||false;this.selected=e.selected},FactoryCreate:function(e,t){var i=e.attrs.rule_type,s,n,r,a,o;if(i==="show"){o="show"}else if(i==="random_assignment"&&e.attrs.is_compare_rule){o="compare"}else{o="filter"}if(i==="qna"){s=t.getQuestion(e.attrs.question_id);n=s.family;if(s.isNPS()){n="single_choice"}if(s.family==="matrix"&&s.subtype==="menu"){n="menu_matrix"}else if(s.subtype==="numerical"){n="numerical"}if(s.commentField&&s.commentField.options.apply_all_rows){n="rating_comment_per_row"}if(e.attrs.question_id===t.getSourceSurveysQuestionId()){n="source_surveys"}a=this.qnaRuleModelMap[n];e.is_nps=s.isNPS();r=SM.Models.create(a,e);if(e.attrs.is_compare_rule){r.ruleFamily="compare";r.isCompare=true}}else if(i==="random_assignment"){a=this.ruleTypeToModelMap[o][i];r=SM.Models.create(a,e);if(e.attrs.is_compare_rule){r.ruleFamily="compare";r.isCompare=true}}else{a=this.ruleTypeToModelMap[o][i];r=SM.Models.create(a,e)}return r},loadSurvey:function(e){this.survey=e},__setters:{editMode:function(e,t){if(t===true){e._ruleBackup=e.dumpRuleValue()}else if(e._ruleBackup){e.loadRuleMetadataValue(e._ruleBackup);delete e._ruleBackup}e.editMode=t}},__getters:{heading:function(e){return e.customHeading||e.getHeading()},selected:function(e){return e.selected&&!e.isCorrupt}},applyRule:function(){if(this.isNew){this.survey.anviews.currentView.addRule(this);this.isNew=false}else{this._trigger({type:"ruleEdited",ruleModel:this})}},copyRule:function(){var e=this.copy();this.survey.anviews.currentView.addRule(e);this.survey.anviews.currentView.save()},toggleRule:function(){var e=!this.get("selected");this.set("selected",e);this._trigger({type:"ruleEdited",ruleModel:this})},deleteRule:function(){this._trigger({type:"ruleDeleted",ruleModel:this})},copy:function(){var e=SM.Models.create(this.__NAME,{ID:null,is_nps:this.is_nps,attrs:this.dumpRuleValue()}),t=e.customHeading||this.get("heading");t=t+" - "+Globalize.localize("COPY");e.set("customHeading",t);e.loadSurvey(this.survey);
e.set("selected",false);e.set("isNew",false);return e},isPersisted:function(){return this.ID.substr(0,4)!==this.TEMP_ID_PREFIX},dump:function(){var e=this.BASE_RULE_METADATA_KEY,t=this.ID,i,s=null;e=[e,this.ruleFamily,"_",this.get("ruleType")].join("");i=this.dumpRuleValue();if(!this.isPersisted()){t=null;s=this.ID}return{key:e,temp_id:s,is_corrupt:this.isCorrupt,metadata_id:t,option_id:null,question_id:null,value:i,view_id:this.survey.anviews.currentView.ID}},sanitize:function(){},dumpRuleValue:function(){var e=this,t={};t.rule_type=this.ruleType;t.selected=this.selected;t.custom_heading=this.customHeading;return SM.Object.deepCopy(t)},commit:function(){this.sanitize();this.lastValidation=this.validate();if(this.lastValidation.isValid){delete this._ruleBackup;this.editMode=false}return this.lastValidation.isValid},_getNpsChoiceSetHeading:function(e){var t,i,s="",n,r=0,a=this.MAX_CHOICE_HEADING_LENGTH,o=this.survey,l;e=SM.ComparedByNps.map2DistributedBySurvey(e,o);_.each(e,function(e){i=Globalize.localize(e.text);if(r<a){s+=i+", "}n=r+1;r++});s=s.substring(0,s.length-2);l=s.length;if(n>a){s+=" +"+(n-a)}return{heading:s,numChoices:r,indexOfLastChoice:l}},_getChoiceSetHeading:function(e,t){var i,s="",n,r=0,a,o=this.MAX_CHOICE_HEADING_LENGTH,l=this.survey,u;a=_.keys(e);a=_.sortBy(a,function(e){return e});_.each(a,function(e){i=t(e);if(r<o){s+=i+", "}n=r+1;r++});s=s.substring(0,s.length-2);u=s.length;if(n>o){s+=" +"+(n-o)}return{heading:s,numChoices:r,indexOfLastChoice:u}}};SM.Models.extend("FilterRespondentDataAnRule",SM.BaseAnRule,{__create:function(e){this.ruleType="respondent_data";SM.BaseAnRule.__create.call(this,e)},loadRuleMetadataValue:function(e){var t=this;SM.BaseAnRule.loadRuleMetadataValue.call(this,e);this.timeTotal=e.time_total;if(!this.get("timeTotal")){this.set("timeTotal",{op:">",unit:"s",value:""})}if(e.txt_rows){$.each(this.respondentAttributes,function(i,s){if(e.txt_rows[s.key]){t.set(s.id,e.txt_rows[s.key])}})}},__validators:{email:function(e,t){var i=/\S+@\S+\.\S+/,s={message:Globalize.localize(e._errorMessages.email),isValid:true};if(t&&t.length>0){s.isValid=i.test(t)}return s},ip:function(e,t){var i=$.trim(t||""),s={message:Globalize.localize(e._errorMessages.ip),isValid:true},n=null,r=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/;if(i.length>0){n=i.match(r);if(n){$.each(n,function(e,t){t=parseInt(t,10);if(t>255||t<0){s.isValid=false}})}else{s.isValid=false}}return s},timeTotal:function(e,t){var i=t.value||"",s=true,n;i=$.trim(i);if(i.length>0){n=parseInt(i,10);if(isNaN(n)||!isFinite(i)||n===0){s=false}}return{isValid:s}}},_errorMessages:{ip:"Please enter a valid IP address",email:"Please enter a valid email"},respondentAttributes:[{id:"ip",key:"ip",textLabel:"IP Address"},{id:"email",key:"email",textLabel:"Email Address"},{id:"firstName",key:"first_name",textLabel:"First Name"},{id:"lastName",key:"last_name",textLabel:"Last Name"},{id:"custom",key:"custom",textLabel:"Custom Data",popout_id:"custom-data-popout"}],dumpRuleValue:function(){var e=SM.BaseAnRule.dumpRuleValue.call(this),t=this,i=t.get("timeTotal"),s={},n,r;$.each(this.respondentAttributes,function(e,i){n=i.id;if(t.get(n)){r=$.trim(t.get(n)||"");if(r){s[i.key]=r}}});e.txt_rows=s;if(i.value){e.time_total=i}return SM.Object.deepCopy(e)},getHeading:function(){var e=this.get("timeTotal"),t=this,i="",s=2,n=0,r=Globalize.culture();if(e&&$.trim(e.value)){i+=Globalize.localize("Response time");i+=" "+e.op+" "+e.value;i+=r.calendar.timeAbbr[e.unit]+", ";n++}$.each(this.respondentAttributes,function(e,r){if(t.get(r.id)){if(n<s){i+=Globalize.localize(r.textLabel);i+=" = "+t.get(r.id)+", "}n++}});i=i.substring(0,i.length-2);if(n>s){i+=" + "+(n-s)}return i},attributeIsVisible:function(e){if(e==="first_name"||e==="last_name"||e==="email"){return this.survey.hasEmailCollector}return true}});SM.Models.extend("FilterCollectorAnRule",SM.BaseAnRule,{__create:function(e){SM.BaseAnRule.__create.call(this,e);this.ruleType="collector"},loadRuleMetadataValue:function(e){SM.BaseAnRule.loadRuleMetadataValue.call(this,e);this.rows=_.isEmpty(e.rows)?{}:e.rows},dumpRuleValue:function(){var e=SM.BaseAnRule.dumpRuleValue.call(this);e.rows=this.get("rows");return SM.Object.deepCopy(e)},getHeading:function(){var e=this.survey,t;t=this._getChoiceSetHeading(this.get("rows"),function(t){var i=e.getCollector(t);return i.title});return t.heading}});SM.Models.extend("FilterCompletenessAnRule",SM.BaseAnRule,{__create:function(e){SM.BaseAnRule.__create.call(this,e);this.ruleType="completeness"},loadRuleMetadataValue:function(e){SM.BaseAnRule.loadRuleMetadataValue.call(this,e);this.rows=_.isEmpty(e.rows)?{}:e.rows},dumpRuleValue:function(){var e=SM.BaseAnRule.dumpRuleValue.call(this);e.rows=this.get("rows");return SM.Object.deepCopy(e)},getHeading:function(){var e=this.get("rows"),t=Globalize.localize("complete responses"),i=Globalize.localize("partial responses"),s=Globalize.localize("disqualified responses"),n=Globalize.localize("responses over quota"),r=[];if(e.completely){r.push(t)}if(e.partially){r.push(i)}if(e.disqualified){r.push(s)}if(e.overquota){r.push(n)}r=r.join(", ");r=r[0].toUpperCase()+r.substr(1);return r}});SM.Models.extend("FilterTimePeriodAnRule",SM.BaseAnRule,{__create:function(e){var t;SM.BaseAnRule.__create.call(this,e);this.ruleType="time_period"},loadRuleMetadataValue:function(e){SM.BaseAnRule.loadRuleMetadataValue.call(this,e);this.startDate=e.start_date;this.endDate=e.end_date;this.timeType=e.time_type},__validators:{endDate:function(e,t){if(!t){return{isValid:false}}return{isValid:true}},startDate:function(e,t){if(!t){return{isValid:false}}return{isValid:true}}},getHeading:function(){return Globalize.format(new Date(this.get("startDate")),"d")+" - "+Globalize.format(new Date(this.get("endDate")),"d")},dumpRuleValue:function(){var e=SM.BaseAnRule.dumpRuleValue.call(this);e.start_date=this.get("startDate");e.end_date=this.get("endDate");e.time_type=this.get("timeType")||"custom";return SM.Object.deepCopy(e)}});SM.Models.extend("BaseQnaAnRule",SM.BaseAnRule,{__create:function(e){SM.BaseAnRule.__create.call(this,e);this.ruleType="qna";this.isQNA=true},loadRuleMetadataValue:function(e){SM.BaseAnRule.loadRuleMetadataValue.call(this,e);this.questionID=e.question_id},getQuestion:function(){return this.survey.getQuestion(this.get("questionID"))},getHeading:function(){var e=this.getQuestion(),t=Globalize.localize("Question").substr(0,1),i=t+e.position+": ";return i+this._getQnaHeading()},dumpRuleValue:function(){var e=SM.BaseAnRule.dumpRuleValue.call(this);if(this.is_nps_distributed){e.is_nps_distributed=true}if(this.choiceSet){e.answers=[this.choiceSet.dump()]}e.is_compare_rule=this.isCompare;e.question_id=this.questionID;return SM.Object.deepCopy(e)},_addCommentFieldHeading:function(e,t){var i=e.heading,s=this.getQuestion().commentField,n,r=this.MAX_CHOICE_HEADING_LENGTH;if(t.get("commentFieldSelected")){e.numChoices++;if(e.numChoices<=r){n=t.get("searchTerm");if(e.numChoices>1){i+=", "}i+=s.text;if(n){i+=[' = "',n,'"'].join("")}e.indexOfLastChoice=i.length}else{i=i.substring(0,e.indexOfLastChoice)+" +"+(e.numChoices-r)}e.heading=i}return e}});SM.Models.extend("QnaSimpleAnRule",SM.BaseQnaAnRuleModel,{CHOICE_SET_SCHEMA:{rows:{}},loadRuleMetadataValue:function(e){var t=this,i;SM.BaseQnaAnRuleModel.loadRuleMetadataValue.call(this,e);this.is_nps_distributed=e.is_nps_distributed||false;if(_.isEmpty(e.answers)){i=SM.Object.deepCopy(this.CHOICE_SET_SCHEMA)}else{if(t.is_nps){i=SM.ComparedByNps.choiceSetConvert(e.answers[0])}else{i=e.answers[0]}}this.choiceSet=SM.Models.create("SimpleQnaRuleChoiceSet",i);this.choiceSet.loadRule(this)},__validators:{choiceSet:function(e,t){return t.validate()}},sanitize:function(){var e=this.choiceSet.get("searchTerm");if(e){this.choiceSet.set("searchTerm",_.string.trim(e))}},_getQnaHeading:function(){var e=this,t=this.survey,i;if(e.is_nps){e.is_nps_distributed=SM.ComparedByNps.isDistributed(e.choiceSet.rows,e.getQuestion())}else{e.is_nps_distributed=false}i=e.is_nps_distributed?e._getNpsChoiceSetHeading(e.choiceSet.rows):this._getChoiceSetHeading(this.choiceSet.rows,function(e){return t.getAnswer(e).text});i=this._addCommentFieldHeading(i,this.get("choiceSet"));return i.heading}});SM.Models.extend("SourceSurveysRule",SM.QnaSimpleAnRuleModel,{loadRuleMetadataValue:function(e){var t=this,i;SM.BaseQnaAnRuleModel.loadRuleMetadataValue.call(this,e);this.is_nps_distributed=false;if(_.isEmpty(e.answers)){i=SM.Object.deepCopy(this.CHOICE_SET_SCHEMA)}else{i=e.answers[0]}this.choiceSet=SM.Models.create("SimpleQnaRuleChoiceSet",i);this.choiceSet.loadRule(this);this.rows=_.isEmpty(e.rows)?{}:e.rows},getHeading:function(){var e=this,t=this.survey,i;i=_.map(this.choiceSet.rows,function(e,i){return t.getSourceSurvey(i).text});return i.join()}});SM.Models.extend("QnaOpenEndedAnRule",SM.BaseQnaAnRuleModel,{CHOICE_SET_SCHEMA:{comment:{search_type:"all",rows:{},search_term:""}},loadRuleMetadataValue:function(e){var t;SM.BaseQnaAnRuleModel.loadRuleMetadataValue.call(this,e);if(_.isEmpty(e.answers)){t=SM.Object.deepCopy(this.CHOICE_SET_SCHEMA)}else{t=e.answers[0]}this.choiceSet=SM.Models.create("QnaOpenEndedRuleChoiceSet",t);this.choiceSet.loadRule(this)},__validators:{choiceSet:function(e,t){return t.validate()}},loadSurvey:function(e){var t;SM.BaseQnaAnRuleModel.loadSurvey.call(this,e);t=this.getQuestion();if(t.isEssay()||t.isFileUpload()){this.choiceSet.set("selectedRowID","0")}},_getQnaHeading:function(){var e=this.getQuestion(),t=this.choiceSet,i,s;if(e.isEssay()||e.isFileUpload()){s=e.heading}else{s=e.getAnswer(t.get("selectedRowID")).text}i=s.substr(-1);if(i===":"||i==="="){s=s.substring(0,s.length-1)}s+=' = "'+t.get("searchTerm")+'"';return s}});SM.Models.extend("QnaDatetimeAnRule",SM.BaseQnaAnRuleModel,{CHOICE_SET_SCHEMA:{comment:{search_term:undefined,rows:{},op:"="}},__validators:{choiceSet:function(e,t){return t.validate()}},_choiceSetModel:"QnaDateTimeRuleChoiceSet",loadRuleMetadataValue:function(e){var t;SM.BaseQnaAnRuleModel.loadRuleMetadataValue.call(this,e);if(_.isEmpty(e.answers)){t=SM.Object.deepCopy(this.CHOICE_SET_SCHEMA)}else{t=e.answers[0]}this.choiceSet=SM.Models.create(this._choiceSetModel,t);this.choiceSet.loadRule(this)},_getQnaHeading:function(){var e=this.getQuestion(),t=this.choiceSet.get("op"),i=e.getAnswer(this.choiceSet.get("selectedRowID")).text,s=e.structure.validation,n=s&&s.type,r=this.choiceSet.selectedDate,a=new Date(r.year(),r.month(),r.date(),r.hours(),r.minutes());if(e.subtype==="date_only"){if(n==="date_intl"){i+=" "+t+" "+Globalize.format(a,"d/M/yyyy")}else{i+=" "+t+" "+Globalize.format(a,"d")}}else if(e.subtype==="time_only"){i+=" "+t+" "+Globalize.format(a,"t")}else{if(n==="date_intl"){i+=" "+t+" "+Globalize.format(a,"d/M/yyyy h:mm tt")}else{i+=" "+t+" "+Globalize.format(a,"M/d/yyyy h:mm tt")}}return i}});SM.Models.extend("QnaNumericalAnRule",SM.BaseQnaAnRuleModel,{CHOICE_SET_SCHEMA:{comment:{op:"=",rows:{},search_term:""}},loadRuleMetadataValue:function(e){var t;SM.BaseQnaAnRuleModel.loadRuleMetadataValue.call(this,e);if(_.isEmpty(e.answers)){t=SM.Object.deepCopy(this.CHOICE_SET_SCHEMA)}else{t=e.answers[0]}this.choiceSet=SM.Models.create("QnaNumericalRuleChoiceSet",t);this.choiceSet.loadRule(this)},__validators:{choiceSet:function(e,t){return t.validate()}},_getQnaHeading:function(){var e=this.getQuestion(),t=this.choiceSet,i=e.getAnswer(t.get("selectedRowID")).text,s;s=i.substr(-1);if(s===":"||s==="="){i=i.substring(0,i.length-1)}i+=" "+this.choiceSet.get("op")+' "'+t.get("searchTerm")+'"';return i},sanitize:function(){var e=Globalize.parseFloat(this.choiceSet.searchTerm,10);this.choiceSet.searchTerm=e.toString()}});SM.Models.register("BaseQnaRuleChoiceSet",{__create:function(e){var t=e.comment;if(t){this.set("commentFieldSelected",true);this.searchType=t.search_type;this.searchTerm=t.search_term}this.rows=e.rows},loadRule:function(e){this.ruleModel=e},__validators:{searchTerm:function(e,t){var i={isValid:true};if(!e.get("commentFieldSelected")){return i}if(_.isEmpty(t)){return i}if(!SM.String.containsWordBoundary(t)){i.isValid=false}return i}},dump:function(){var e=this.ruleModel.getQuestion(),t=SM.Object.deepCopy({rows:this.rows}),i=e.commentField;if(this.get("commentFieldSelected")&&i){t.comment={search_term:this.get("searchTerm")||null,rows:{}};t.comment.rows[i.id]=true;if(t.comment.search_term){t.comment.search_type=this.get("searchType")||"all"}}return t}});SM.Models.extend("SimpleQnaRuleChoiceSet",SM.BaseQnaRuleChoiceSetModel,{dump:function(){var e=this.ruleModel.getQuestion(),t=SM.BaseQnaRuleChoiceSetModel.dump.call(this),i=t.comment;if(this.ruleModel.is_nps){t=SM.ComparedByNps.choiceSetRevert(t,e)}if(this.get("commentFieldSelected")&&i&&!i["search_term"]){t.comment["search_term"]=""}return t}});SM.Models.extend("MatrixQnaRuleChoiceSet",SM.BaseQnaRuleChoiceSetModel,{__create:function(e){SM.BaseQnaRuleChoiceSetModel.__create.call(this,e);this.cols=e.cols;if(e.colChoices){this.colChoices=e.colChoices}},dump:function(){var e=SM.BaseQnaRuleChoiceSetModel.dump.call(this);e.cols=SM.Object.deepCopy(this.cols);if(this.colChoices){e.col_choices=SM.Object.deepCopy(this.colChoices)}return e}});SM.Models.extend("QnaDateTimeRuleChoiceSet",SM.BaseQnaRuleChoiceSetModel,{__create:function(e){var t=SM.Object.getOneKey(e.comment.rows)||"-1",i;this.op=e.comment.op;this.selectedRowID=t;if(t==="-1"){i=moment(new Date);i.startOf("day")}else{i=moment.utc(e.comment.search_term)}this.set("selectedDate",i);this.set("selectedTime",{hours:i.hours(),minutes:i.minutes()})},__validators:{selectedDate:function(e,t){var i=e.ruleModel.getQuestion();if(i.subtype==="date_only"||i.subtype==="both"){return{isValid:t?true:false}}return{isValid:true}},selectedTime:function(e,t){var i=e.ruleModel.getQuestion();if(i.subtype==="time_only"||i.subtype==="both"){if(!t||t.minutes===-1||t.hours===-1){return{isValid:false}}}return{isValid:true}},selectedRowID:function(e,t){var i={isValid:true};if(t==="-1"){i.isValid=false}return i}},dump:function(){var e={rows:{},search_term:this.dumpDateTime(),op:this.get("op")};e.rows[this.get("selectedRowID")]=true;return{comment:e}},dumpDateTime:function(){var e=this.get("selectedDate")||moment(),t=this.get("selectedTime")||{hours:0,minutes:0};e.hours(t.hours);e.minutes(t.minutes);return moment(e).utc().format("YYYY-MM-DD[T]HH:mm:ss")}});SM.Models.extend("QnaOpenEndedRuleChoiceSet",SM.BaseQnaRuleChoiceSetModel,{__create:function(e){this.searchTerm=e.comment.search_term;this.searchType=e.comment.search_type;this.selectedRowID=SM.Object.getOneKey(e.comment.rows)||"-1"},__validators:{searchTerm:function(e,t){var i={isValid:true};if(!SM.String.containsWordBoundary(t)){i.isValid=false}return i},selectedRowID:function(e,t){var i={isValid:true};if(t==="-1"){i.isValid=false}return i}},dump:function(){var e=this.ruleModel.getQuestion(),t={search_term:this.get("searchTerm"),search_type:this.get("searchType")};if(e.isMultiResponse()){t.rows={};t.rows[this.selectedRowID]=true}return{comment:t}}});SM.Models.extend("QnaNumericalRuleChoiceSet",SM.QnaOpenEndedRuleChoiceSetModel,{__create:function(e){SM.BaseQnaRuleChoiceSetModel.__create.call(this,e);this.op=e.comment.op;this.selectedRowID=SM.Object.getOneKey(e.comment.rows)||"-1"},__validators:{searchTerm:function(e,t){var i={isValid:true},s=parseFloat(t,10);if(isNaN(s)||s<0){i.isValid=false}return i},selectedRowID:function(e,t){var i={isValid:true};if(t==="-1"){i.isValid=false}return i}},dump:function(){var e=SM.QnaOpenEndedRuleChoiceSetModel.dump.call(this);delete e.comment.search_type;e.comment.op=this.get("op");return e}});SM.Models.extend("QnaMatrixAnRule",SM.BaseQnaAnRuleModel,{CHOICE_SET_SCHEMA:{rows:{},cols:{}},__validators:{choiceSetList:function(e,t){var i=[];if(t.length===0&&!e.commentChoiceSet){return false}_.each(t,function(e){var t=e.validate();i.push(t)});return i},commentChoiceSet:function(e,t){if(t.get("commentFieldSelected")){return t.validate()}return false}},__create:function(e){SM.BaseQnaAnRuleModel.__create.call(this,e)},loadRuleMetadataValue:function(e){var t=this,i=e.answers,s=e.comment;SM.BaseQnaAnRuleModel.loadRuleMetadataValue.call(this,e);this.choiceSetList=[];if(_.isEmpty(i)){this.addChoiceSet()}else{_.each(i,function(e){t.loadChoiceSet({rows:e.rows,cols:e.cols,colChoices:e.col_choices})})}this.commentChoiceSet=SM.Models.create("MatrixQnaRuleChoiceSet",{comment:s});this.commentChoiceSet.loadRule(this)},commit:function(){this.sanitize();this.lastValidation=this.validate();if(this.lastValidation.invalids.commentChoiceSet){this.lastValidation.isValid=this.lastValidation.invalids.commentChoiceSet.isValid}else{this.lastValidation.isValid=this.lastValidation.invalids.choiceSetList}if(this.lastValidation.isValid){this.lastValidation.invalids=[];delete this._ruleBackup;this.editMode=false}return this.lastValidation.isValid},addChoiceSet:function(){var e=this.loadChoiceSet(SM.Object.deepCopy(this.CHOICE_SET_SCHEMA));e.loadRule(this);return e},loadChoiceSet:function(e){var t;if(!e.cols){return}t=SM.Models.create("MatrixQnaRuleChoiceSet",e);this.choiceSetList.push(t);t.loadRule(this);return t},isInvalidSet:function(e){return SM.Object.getOnlyKey(e.get("rows"))===undefined||SM.Object.getOneKey(e.get("cols"))===undefined||e.get("colChoices")&&SM.Object.getOneKey(e.get("colChoices"))===undefined},sanitize:function(){var e=this.choiceSetList,t=this.commentChoiceSet,i=t.get("searchTerm"),s,n=this,r=0;for(;r<e.length;r++){s=e[r];if(n.isInvalidSet(s)){e.splice(r,1);r--}}if(i){t.set("searchTerm",_.string.trim(i))}},_dumpAnswers:function(){var e=[],t=this;_.each(this.choiceSetList,function(i){if(!t.isInvalidSet(i)){e.push(i.dump())}});return e},dumpRuleValue:function(){var e=this.getQuestion(),t=SM.BaseQnaAnRuleModel.dumpRuleValue.call(this),i=e.commentField,s=this.get("commentChoiceSet"),n,r,a,o;t.question_id=this.questionID;t.answers=this._dumpAnswers();r=this.get("commentFieldSelected")||s&&s.get("commentFieldSelected");if(i&&r){t.comment=this.commentChoiceSet.dump().comment;n=i.id;a=$.trim(t.comment.search_term||null);o={rows:{}};o.rows[n]={search_type:t.comment.search_type||null,search_term:a};t.answers.push(o)}return SM.Object.deepCopy(t)},_getQnaHeading:function(){var e=this.getQuestion(),t=this.choiceSetList,i=this.survey,s=function(e){return i.getAnswer(e).text},n,r,a,o;if(t.length>0){r=SM.Object.getOnlyKey(t[0].get("rows"));if(r){n=e.getAnswer(r).text+": ";if(e.isEmoji()){n=""}o=this._getChoiceSetHeading(t[0].get("cols"),s);n=n+this._addCommentFieldHeading(o,t[0]).heading;if(t.length>1){r=SM.Object.getOnlyKey(t[1].get("rows"));n+="; "+e.getAnswer(r).text+": ";if(t[1].cols){o=this._getChoiceSetHeading(t[1].get("cols"),s);n=n+this._addCommentFieldHeading(o,t[1]).heading}if(t.length>2){n+="..."}}}}if(this.commentChoiceSet.get("commentFieldSelected")){if(t.length<this.MAX_CHOICE_HEADING_LENGTH){a=this.commentChoiceSet.get("searchTerm");if(n){n+="; "}else{n=""}n+=this.getQuestion().commentField.text;if(a){n+=[' = "',a,'"'].join("")}}else{n+="..."}}return n}});SM.Models.extend("QnaRatingCommentPerRowAnRule",SM.QnaMatrixAnRuleModel,{dumpRuleValue:function(){var e=SM.QnaMatrixAnRuleModel.dumpRuleValue.call(this);e.answers=this._dumpAnswers();return SM.Object.deepCopy(e)}});SM.Models.extend("QnaMenuMatrixAnRule",SM.QnaMatrixAnRuleModel,{CHOICE_SET_SCHEMA:{rows:{},cols:{},colChoices:{}},_getQnaHeading:function(){var e=this.getQuestion(),t=this.choiceSetList,i="",s=this.survey,n;if(t.length>0){i+=this._getRowColHeading(e,t[0].rows,t[0].cols);i+=this._getChoiceSetHeading(t[0].colChoices,function(e){return s.getAnswer(e).text}).heading;if(t.length>1){i+="; "+this._getRowColHeading(e,t[1].rows,t[1].cols);i+=this._getChoiceSetHeading(t[1].colChoices,function(e){return s.getAnswer(e).text}).heading;if(t.length>2){i+="..."}}}if(this.commentChoiceSet.get("commentFieldSelected")){if(t.length<this.MAX_CHOICE_HEADING_LENGTH){n=this.commentChoiceSet.get("searchTerm");i+="; "+this.getQuestion().commentField.text;if(n){i+=[' = "',n,'"'].join("")}}else{i+="..."}}return i},_getRowColHeading:function(e,t,i){var s="",n=SM.Object.getOnlyKey(t);s+=e.getAnswer(n).text+", ";n=SM.Object.getOnlyKey(i);s+=e.getAnswer(n).text+": ";return s}});SM.Models.extend("ShowAnRule",SM.BaseAnRule,{__create:function(e){SM.BaseAnRule.__create.call(this,e);this.ruleFamily="show";this.isShow=true;this.ruleType="show"},__getters:{show:function(e){var t=e.get("showSet").dump();t.selected=e.get("selected");return t}},loadSurvey:function(e){this.survey=e;this.showSet=SM.Models.create("ShowSet");this.showSet.loadView(this.survey.anviews.currentView);this.set("selected",this.get("selected")||false)},getHeading:function(){var e=this,t=e.showSet,i="",s=Globalize.localize("Page"),n=Globalize.localize("Question").substr(0,1),r=2,a=0;$.each(this.survey.pageList,function(e,o){if(t.hasPage(o)){if(a<r){i+=s+" "+o.position;if(t.pageQuestionsCheckedCount!==o.questionList.length){i+=": ";$.each(o.questionList,function(e,s){if(t.hasQuestion(s)){i+=n+s.position+", "}});i=i.replace(/,\s$/,"; ")}else{i+=", "}}a++}});i=i.substring(0,i.length-1);if(a>r){i+=" +"+(a-r)}return i},deleteRule:function(){this.showSet.clear();this.set("selected",false);this._trigger({type:"ruleDeleted",ruleModel:this})}});SM.Models.register("ShowSet",{show:null,survey:null,pageQuestionCounts:null,totalQuestionCount:0,totalPageCount:0,loadView:function(e){var t,i,s,n;this.survey=e.anviews.survey;n=e.show;this.clear();if(n.pages){for(t in n.pages){this.show.pages[t]=true;this.totalPageCount++}}if(n.questions){for(i in n.questions){s=this.survey.getQuestion(i);if(!s){continue}this.show.questions[i]=true;this.pageQuestionCounts[s.page.ID]++;this.totalQuestionCount++}}},__create:function(e){this.show={pages:{},questions:{}}},allSelected:function(){if(this.totalQuestionCount===this.survey.questionCount){return true}else{return false}},togglePage:function(e){if(this.show.pages[e.ID]){if(this.pageQuestionCounts[e.ID]===e.questionList.length){this.removePage(e);return false}this.addPage(e);return true}else{this.addPage(e);return true}},toggleQuestion:function(e){if(this.show.questions[e.ID]){this.removeQuestion(e);return false}else{this.addQuestion(e);return true}},toggleAll:function(){if(this.allSelected()){this.clear();return false}else{this.addAll();return true}},addAll:function(){var e=this.survey.pageList,t=0,i,s,n;this.totalQuestionCount=this.survey.questionCount;this.totalPageCount=this.survey.pageList.length;for(;t<e.length;t++){n=e[t];if(n.questionList.length>0){this.show.pages[n.ID]=true;for(i=0;i<n.questionList.length;i++){s=n.questionList[i];this.show.questions[s.ID]=true;this.pageQuestionCounts[n.ID]++}}}},clear:function(){var e={},t=0,i=this.survey.pageList,s=i.length;for(;t<s;t++){e[i[t].ID]=0}this.pageQuestionCounts=e;this.show.pages={};this.show.questions={};this.totalQuestionCount=0;this.totalPageCount=0},addQuestion:function(e){if(!this.show.questions[e.ID]){this.show.questions[e.ID]=true;if(!this.show.pages[e.page.ID]){this.show.pages[e.page.ID]=true}this.pageQuestionCounts[e.page.ID]++;this.totalQuestionCount++}},addPage:function(e){var t=0,i=e.questionList.length;if(!this.show.pages[e.ID]){this.show.pages[e.ID]=true;this.totalPageCount++}this.pageQuestionCounts[e.ID]=i;for(;t<i;t++){if(!this.show.questions[e.questionList[t].ID]){this.show.questions[e.questionList[t].ID]=true;this.totalQuestionCount++}}},removePage:function(e){var t=0,i;if(this.show.pages[e.ID]){for(;t<e.questionList.length;t++){i=e.questionList[t];if(this.show.questions[i.ID]){delete this.show.questions[i.ID];this.totalQuestionCount--}}delete this.show.pages[e.ID];this.pageQuestionCounts[e.ID]=0;this.totalPageCount--}},removeQuestion:function(e){var t=0,i=e.page;if(this.show.questions[e.ID]){this.totalQuestionCount--;this.pageQuestionCounts[e.page.ID]--;delete this.show.questions[e.ID]}if(this.pageQuestionCounts[e.page.ID]===0){delete this.show.pages[e.page.ID]}},hasPage:function(e,t){var i=t||this;return i.show.pages[e.ID]},hasQuestion:function(e,t){var i=t||this;return i.show.questions[e.ID]},questionCheckedCount:function(e){return this.totalQuestionCount},pageQuestionsCheckedCount:function(e){return this.pageQuestionCounts[e.ID]||0},dump:function(){var e=this.show;if(this.isEmpty()){e.questions=null;e.pages=null}return SM.Object.deepCopy(this.show)},isEmpty:function(){return $.isEmptyObject(this.show.questions)||$.isEmptyObject(this.show.pages)},_toNumberList:function(e,t,i){var s=0,n=this.survey.pageList,r="";if(t===e.length||t===0){return Globalize.localize("All")}for(;s<e.length;s++){if(i(e[s],this)){r+=[e[s].position,", "].join("")}}return r.substring(0,r.length-2)},getPageString:function(){return this._toNumberList(this.survey.pageList,this.totalPageCount,this.hasPage)},getQuestionString:function(){return this._toNumberList(this.survey.questionList,this.totalQuestionCount,this.hasQuestion)}});SM.Models.extend("FilterRandomAssignmentRule",SM.BaseAnRule,{__create:function(e){SM.BaseAnRule.__create.call(this,e);this.ruleType="random_assignment";this.isRA=true},dumpRuleValue:function(){var e=SM.BaseAnRule.dumpRuleValue.call(this);e.rows=this.get("rows");e.question_id=this.get("questionID");e.family=this.getFamily();e.subtype=this.getSubtype();return SM.Object.deepCopy(e)},loadRuleMetadataValue:function(e){SM.BaseAnRule.loadRuleMetadataValue.call(this,e);this.rows=_.isEmpty(e.rows)?{}:e.rows;this.questionID=e.question_id},getFamily:function(){return this.getQuestion().family},_mapTypeToText:function(e,t){var i={datetime:{date_only:"Question Test",time_only:"Question Test",both:"Question Test"},demographic:{us:"Question Test",international:"Question Test"},single_choice:{vertical:"Question Test",menu:"Question Test"},multiple_choice:{vertical:"Question Test"},open_ended:{essay:"Question Test",single:"Question Test",multi:"Question Test",numerical:"Question Test"},matrix:{rating:"Question Test",single:"Question Test",multi:"Question Test",ranking:"Question Test"},presentation:{image:"Image Test",descriptive_text:"Text Test"}};return i[e][t]},getHeading:function(){var e=this,t=this.getQuestion(),i=this.get("rows"),s=[],n,r,a;_.each(i,function(e,i){_.each(t.randomAssignmentList,function(e){if(e.variable_id.toString()===i){s.push(e.variable_name||e.heading)}})});n="Q"+t.position+": "+Globalize.localize("("+this._mapTypeToText(t.family,t.subtype)+")")+" "+s.join(", ");return n},getQuestion:function(){return this.survey.getQuestion(this.get("questionID"))},getRandomAssignmentList:function(){return this.getQuestion().randomAssignmentList},getSubtype:function(){return this.getQuestion().subtype}});SM.Models.extend("CompareRandomAssignmentRule",SM.BaseAnRule,{__create:function(e){e.attrs.is_compare_rule=true;SM.BaseAnRule.__create.call(this,e);this.ruleType="random_assignment";this.isRA=true},dumpRuleValue:function(){var e=SM.BaseAnRule.dumpRuleValue.call(this);e.rows=this.get("rows");e.cols=this.get("cols");e.question_id=this.get("questionID");e.family=this.getFamily();e.subtype=this.getSubtype();e.is_compare_rule=true;return SM.Object.deepCopy(e)},loadRuleMetadataValue:function(e){SM.BaseAnRule.loadRuleMetadataValue.call(this,e);this.rows=_.isEmpty(e.rows)?{}:e.rows;this.questionID=e.question_id},_mapTypeToText:function(e,t){var i={datetime:{date_only:"Question Test",time_only:"Question Test",both:"Question Test"},demographic:{us:"Question Test",international:"Question Test"},single_choice:{vertical:"Question Test",menu:"Question Test"},multiple_choice:{vertical:"Question Test"},open_ended:{essay:"Question Test",single:"Question Test",multi:"Question Test",numerical:"Question Test"},matrix:{rating:"Question Test",single:"Question Test",multi:"Question Test",ranking:"Question Test"},presentation:{image:"Image Test",descriptive_text:"Text Test"}};return i[e][t]},getHeading:function(){var e=this,t=Globalize.localize("Question").substr(0,1),i=this.getQuestion(),s=this.get("rows"),n=[],r,a,o;_.each(s,function(e,t){_.each(i.randomAssignmentList,function(e){if(e.variable_id.toString()===t){n.push(e.variable_name||e.heading)}})});r=t+i.position+": "+Globalize.localize("("+this._mapTypeToText(i.family,i.subtype)+")")+" "+n.join(", ");return r},getFamily:function(){return this.getQuestion().family},getQuestion:function(){return this.survey.getQuestion(this.get("questionID"))},getRandomAssignmentList:function(){return this.getQuestion().randomAssignmentList},getSubtype:function(){return this.getQuestion().subtype}});SM.Models.register("AnalyzeState",{SUMMARY_MODE:"summary",BROWSE_MODE:"browse",TREND_MODE:"trends",__create:function(e){this.page=e.pageIndex;this.mode=e.mode;this.viewID=e.viewID;this.nextViewID=null},__setters:{page:function(e,t){e.page=t;e.survey.anviews.defaultView.set("page",t)},mode:function(e,t){e.mode=t}},__getters:{page:function(e){return e.survey.anviews.defaultView.get("page")},mode:function(e){return e.mode},allPagesSelected:function(e){return e.get("page")==="all"||e.survey&&e.survey.pageList.length<=1}},isBrowseMode:function(){return this.mode===this.BROWSE_MODE},isSummaryMode:function(){return this.mode===this.SUMMARY_MODE},isTrendMode:function(){return this.mode===this.TREND_MODE},survey:null});SM.Models.register("ExportJobPoller",{EXPONENTIAL_COEFFICIENT:1.5,KILL_SWITCH_CAP:30,interval:6e3,iterations:0,isActive:false,__create:function(e){var t=e.config;this.START_INTERVAL=t.start_interval||6e3;this.INTERVAL_CAP=t.interval_cap||6e4;this.ITERATION_CAP=t.iteration_cap||15},loadJobs:function(e){this.exportJobs=e},start:function(){var e=this,t=0;this.iterations=0;this.interval=this.START_INTERVAL;if(this.get("isActive")||!this.hasJobsPending()){return}this.set("isActive",true,{notify:true});this._poll()},_poll:function(){var e=this;if(this.iterations>this.ITERATION_CAP){if(this.iterations<this.KILL_SWITCH_CAP){this.interval=this.INTERVAL_CAP*5}else{this.stop();return}}else{if(this.interval>this.INTERVAL_CAP){this.interval=this.INTERVAL_CAP}}this.intervalID=setTimeout(function(){e._onePoll()},this.interval)},_onePoll:function(){if(!this.get("isActive")||!this.hasJobsPending()){this.stop();return}this.interval*=this.EXPONENTIAL_COEFFICIENT;this.iterations++;this.updateStatuses();this._poll()},hasJobsPending:function(){var e=this.exportJobs.list,t=e.length,i=0,s;for(;i<t;i++){s=e[i];if(s.pending()){return true}}return false},stop:function(){this.set("isActive",false,{notify:true});clearTimeout(this.intervalID);delete this.intervalID},updateStatuses:function(){var e=null;if(SM.App.isSharingApp()){var t=[];$.each(this.exportJobs.list,function(e,i){t.push(i.ID)});e={exportjob_ids:t}}var i=SM.API.getExportList(e);$.when(i,{self:this}).done(this._onFetchedStatuses)},_onFetchedStatuses:function(e,t){var i=e[0],s=0,n=t.self,r,a=SM.Models.create("ExportJobList");a.loadJobs(i["exportjob_list"]);$.each(n.exportJobs.list,function(e,t){r=a.map[t.ID];if(r){if(r.status!==t.status){t.downloadLink=r.downloadLink;t.set("status",r.status,{notify:true})}}});if(!n.hasJobsPending()){n.stop()}}});SM.Models.register("ExportJobList",{EXPORT:"export",isLoaded:false,__create:function(e){this.list=null;this.map=null;this._cancelledJobs={};this.isUnavailable=false;this.isUserInBillingRetry=false;this.isDriveAuthorized=false;this.config=e},isAvailable:function(){return!this.isUnavailable},isNotAllowedToExport:function(){return this.isUserInBillingRetry},requiresDriveAuth:function(){return!this.isDriveAuthorized},onAuthEstablished:function(e){if(e!=null){e.finalizeExportData();this.addJob(e)}this.isDriveAuthorized=true},createJob:function(e){var t=SM.Models.create("ExportJob",{data:e});t.exportJobs=this;return t},addJob:function(e){var t=e.sourceView,i,s;e.createJobInfo(t);if(t.isCurrent){e.jobInfo.view_name=this.survey.anviews.getSelectedView().name;if(t.get("isDirty")){i=Globalize.localize("edited");e.jobInfo.view_name+="("+i+")"}}e.loadDate("createDate",(new Date).getTime());e.on("status.changed",{self:this,job:e},this._onJobStatusChanged);this.map[e.ID]=e;this.list.unshift(e);s=SM.API.createExport({view_id:t.ID,exportjob:e.dump()});$.when(s,{exportID:e.ID,
self:this}).done(this._onExportCreated).fail(function(t){e.set("failedRequestID",t.request_id);if(t.status===601){e.set("status",e.STATUS.TOO_LARGE_ERROR,{notify:true})}else{e.set("status",e.STATUS.SERVER_ERROR,{notify:true})}});this._trigger({type:"jobAdded",job:e})},_onExportCreated:function(e,t){var i=t.self,s=e[0].export_job.exportjob_id,n=i.map[t.exportID],r=i._cancelledJobs[t.exportID];if(n){delete i.map[n.ID];n.set("ID",s);i.map[s]=n;i.poller.start()}else if(r){delete i._cancelledJobs[t.exportID];r.set("ID",s);r.deleteJob()}},loadJobs:function(e){var t=this;if(!this.get("isLoaded")){this.list=[];this.map={}}$.each(e,function(e,i){var s=SM.Models.create("ExportJob",{data:i});t.map[s.ID]=s;t.list.push(s);s.exportJobs=t;s.on("status.changed",{self:t,job:s},t._onJobStatusChanged)});this.set("isLoaded",true,{notify:true})},hasFullExportPending:function(){var e=false,t=this.list||[];$.each(t,function(t,i){if(i.type==="full"&&i.pending()){e=true;return false}});return e},getPendingFullExports:function(){var e=null,t=this.list||[];return $.map(t,function(e){if(e.type==="full"&&e.pending()){return e}})},deleteJob:function(e){var t=this;e.deleteJob();delete t.map[e.ID];e.off("status.changed",t._onJobStatusChanged);t._spliceJob(e.ID);this._trigger({type:"jobDeleted",job:e})},cancelJob:function(e){var t=this;e.set("isCancelled",true,{notify:true});t._cancelledJobs[e.ID]=e;delete t.map[e.ID];e.off("status.changed",t._onJobStatusChanged);t._spliceJob(e.ID);this._trigger({type:"jobCancelled",job:e})},_onJobStatusChanged:function(e){var t=e.data.self;t._trigger({type:"jobStatusChanged",job:e.data.job})},fetchJobs:function(){var e=this;if(this.survey.owner.isBasic()||SM.App.isSharingApp()){this.loadJobs([])}else if(!this.get("isLoaded")){$.when(SM.API.getExportList(),{self:this}).done(this._onFetchedJobs).fail(function(t,i,s){e._onJobFetchFailed(t)})}},_spliceJob:function(e){var t=this;$.each(t.list,function(i,s){if(e===s.ID){t.list.splice(i,1);return false}})},_onFetchedJobs:function(e,t){var i=t.self,s=e[0];i.set("unavailableErrorID","");i.set("isUnavailable",false,{notify:true});i.set("isUserInBillingRetry",s["is_user_in_billing_retry"]);i.set("isDriveAuthorized",s["is_drive_authorized"]);i.loadJobs(s["exportjob_list"]);i.poller.start()},_onJobFetchFailed:function(e){if(e.status===503){this.set("unavailableErrorID",e.request_id);this.set("isUnavailable",true,{notify:true})}}});SM.Models.register("ExportJob",{STATUS:{SUCCESS:"succeeded",ENQUEUED:"enqueued",STARTED:"started",SERVER_ERROR:"server_error",FILTER_ERROR:"filter_error",CROSSTAB_ERROR:"crosstab_error",TOO_LARGE_ERROR:"too_large_error"},FORMAT:{CSV:"csv",EXCEL:"excel",EXCEL_PLUS:"excel_plus",GIF:"gif",HTML:"html",JPG:"jpg",PDF:"pdf",PNG:"png",PPT:"ppt",SPSS:"spss"},TYPE:{SUMMARY_EXPORT:"summary",ALL_EXPORT:"full",CHART_EXPORT:"chart"},NOTIFICATION_MESSAGES:{succeeded:"Your export is complete",server_error:"There was a problem exporting your data",filter_error:"There was a problem exporting your data",crosstab_error:"There was a problem exporting your data",too_large_error:"Your export file is too large to process"},sourceView:null,exportExtensionMap:{csv:".zip",excel:".zip",excel_plus:".zip",gif:".zip",html:".zip",jpg:".zip",pdf:".pdf",png:".png",gss:"",ppt:".pptx",spss:".zip"},__create:function(e){this.load(e.data)},__setters:{includeOpenended:function(e,t){e.exportData.include_openended=t},showWordCloud:function(e,t){e.exportData.show_word_cloud=t},includeChart:function(e,t){e.exportData.include_chart=t},pdfOrientation:function(e,t){e.exportData.orientation=t},pdfPaperSize:function(e,t){e.exportData.dimension=t},format:function(e,t){if(t===undefined){return}e.format=t;e.name=e.generateFileName();e.initExport()},questionDisplay:function(e,t){e.exportData.question_display=t},columnSetting:function(e,t){e.exportData.column_setting=t},cellType:function(e,t){e.exportData.cell_type=t},useNonBrandedTemplate:function(e,t){e.exportData.non_branded_template=t},forcedPageBreak:function(e,t){e.exportData.forced_page_break=t}},__getters:{includeOpenended:function(e){return e.exportData.include_openended},showWordCloud:function(e,t){return e.exportData.show_word_cloud},includeChart:function(e){return e.exportData.include_chart},pdfOrientation:function(e){return e.exportData.orientation},pdfPaperSize:function(e){return e.exportData.dimension},isSingleQuestionMode:function(e){return e.exportData&&e.exportData.question_id!==undefined},isSingleResponseMode:function(e){return e.exportData&&e.exportData.respondent_id!=="all"},forcedPageBreak:function(e){return e.exportData.forced_page_break}},initExport:function(){var e=this._initByTypeFormat[this.type],t;if(this.exportData.show_word_cloud){this.shouldShowWordCloud=true}this.exportData={};if(e){t=e[this.format];if(t){t(this)}}this.exportData["timezone_offset"]=SM.Date.stdTimezoneOffset()*6e4},_initByTypeFormat:{summary:{pdf:function(e){var t=false;e.createPDFSettings(t);if(e.questionID){e.exportData.question_id=e.questionID;e.exportData.questionNumber=e.questionNumber}},excel:function(e){e.exportData={question_display:"multiple_sheets",include_openended:false,include_chart:true};if(e.questionID){e.exportData.question_id=e.questionID;e.exportData.questionNumber=e.questionNumber}},csv:function(e){e.exportData={include_openended:false};if(e.questionID){e.exportData.question_id=e.questionID;e.exportData.questionNumber=e.questionNumber}},ppt:function(e){e.exportData={non_branded_template:false,include_openended:false,show_word_cloud:false,include_charts:true,include_tables:true,zoomFactor:"1",question_ids:[],survey_title:SM.String.textTitle(e.exportJobs.survey.title),todays_date:Globalize.format(new Date,"D"),survey_summary:{summary_translations:{complete_responses:Globalize.localize("Complete Responses"),date_created:Globalize.localize("Date Created"),total_responses:Globalize.localize("Total Responses")},total_responses:0,complete_responses:0,date_created:Globalize.format(e.exportJobs.survey.dateCreated,"D")},css_selectors:".sm-chart,.sm-data-table-container"};if(e.questionID){e.exportData.question_id=e.questionID;e.exportData.questionNumber=e.questionNumber}}},chart:{png:function(e){e.exportData={show_word_cloud:false,question_id:e.questionID,questionNumber:e.questionNumber,css_selectors:[".sm-export-question-view"]};if(e.shouldShowWordCloud){e.exportData.show_word_cloud=true;delete e.shouldShowWordCloud}}},full:{excel:function(e){e.exportData={column_setting:"condensed",cell_type:"actual_choice_text"}},pdf:function(e){var t=true;e.createPDFSettings(t);e.exportData.respondent_id=e.respondentID}}},createPDFSettings:function(e){var t=this,i=t.exportJobs.survey.owner.isSelect(),s={headerHeight:"0.8cm",footerHeight:"0.8cm",marginTop:"0.1cm",marginLeft:"1cm",marginRight:"1cm",marginBottom:"0.1cm",header:SM.Template.render("phantom-pdf-header-template"),footer:SM.Template.render("phantom-pdf-footer-template"),phantomjs_pdf_enabled:true},n={marginTop:"15mm",marginBottom:"15mm",headerSpacing:"3",footerSpacing:"2",phantomjs_pdf_enabled:false},r;t.exportData={orientation:"portrait",include_openended:e,show_word_cloud:false,dimension:"letter",zoomFactor:".95",forced_page_break:true};if(t.exportJobs.survey.config.phantomjs_pdf_enabled){_.extend(t.exportData,s)}else{_.extend(t.exportData,n);r=i?"pdf-branded-header-template":"pdf-header-template";t.exportData.header=SM.Template.render(r);t.exportData.footer=SM.Template.render("pdf-footer-template")}},load:function(e){this.ID=e.exportjob_id||"exp-"+this.__uid;this.email=e.email||"";this.jobInfo=e.job_info||{};this.filterData=e.filter_data||null;this.compareData=e.crosstab||null;this.format=e.format;this.type=e.export_type;this.loadDate("createDate",e.create_date);this.loadDate("startDate",e.start_date);this.loadDate("endDate",e.end_date);this.exportPreferences=this.export_pref;this.downloadLink=e.download_link;this.status=e.job_status||"enqueued";this.size=e.size;this.exportData=e.export_data;if(e.export_data){this.questionID=e.export_data.question_id;this.respondentID=e.export_data.respondent_id}this.questionNumber=e.questionNumber;this.respondentNumber=e.respondentNumber;this.name=e.custom_filename||this.generateFileName()},dump:function(){var e=this.exportData.question_display;if(this.type==="summary"&&this.format==="excel"&&e!=="multiple_sheets"){this.set("includeChart",false)}return{custom_filename:this.name,format:this.format,email:this.email,export_data:this.exportData,export_type:this.type,job_info:this.jobInfo,type:this.type}},generateFileName:function(e){var t=new Date,i=this.type,s=this.format,n=this.exportExtensionMap[s],r,a,o,l,u,h,c,d;if(e){return e+n}if(i==="chart"){o=this.exportData.show_word_cloud?"Cloud":Globalize.localize("Chart");l=Globalize.localize("Question")[0];e=o+"_"+l+this.questionNumber}else if(i==="summary"&&this.questionNumber!==undefined){u=Globalize.localize("Data");l=Globalize.localize("Question")[0];e=u+"_"+l+this.questionNumber}else if(i==="full"&&s==="pdf"){if(this.exportData.respondent_id!=="all"){c=Globalize.localize("Response");d=this.respondentNumber}else{c=Globalize.localize("Responses");d=Globalize.localize("All")}e=c+"_"+d}else{u=Globalize.localize("Data");h=Globalize.localize("All");e=u+"_"+h}r=[e+"_",t.getFullYear().toString().substring(2,4),this.doubleDigify(t.getMonth()+1),this.doubleDigify(t.getDate())].join("")+n;return r},loadDate:function(e,t){if(t){this[e]=new Date(t)}else{this[e]=null}if(e==="createDate"&&t){this.expirationDate=new Date(t);this.expirationDate.setDate(this.expirationDate.getDate()+14)}},doubleDigify:function(e){e=e.toString();if(e.length<2){e="0"+e}return e},failed:function(){return this.status===this.STATUS.CROSSTAB_ERROR||this.status===this.STATUS.FILTER_ERROR||this.status===this.STATUS.TOO_LARGE_ERROR||this.status===this.STATUS.SERVER_ERROR},createJobInfo:function(e){var t=SM.Models.create("ShowSet");t.loadView(e);this.jobInfo={view_name:e.name,pages:t.getPageString(),questions:t.getQuestionString()}},getReadableStatus:function(){if(this.failed()){return"failed"}if(this.done()){return"finished"}if(this.pending()){return"processing"}},done:function(){return this.status===this.STATUS.SUCCESS},pending:function(){return this.status===this.STATUS.ENQUEUED||this.status===this.STATUS.STARTED},deleteJob:function(){SM.API.deleteExport({export_id:this.ID});this._trigger("deleted")},toDateString:function(e){if(!e){return"N/A"}return Globalize.format(e,"d")},isNew:function(){return SM.String.beginsWith(this.ID,"exp-")},isDrive:function(){return this.format==="gss"},finalizeExportData:function(){if(this.format===this.FORMAT.PPT){this.finalizePptExportData()}},finalizePptExportData:function(){var e=this.exportData,t=this.exportData.survey_summary,i=this.exportJobs.survey,s=i.respondentCounts.total,n=i.respondentCounts.total_context,r,a,o;if(e.question_id){r=[i.getQuestion(e.question_id)]}else if(this.sourceView.isCurrent){r=i.shownQuestionList}else{r=i.questionList}_.each(r,function(t){if(this.canExportQuestionInPPT(t)){e.question_ids.push(t.ID)}},this)},canExportQuestionInPPT:function(e){var t=e.isOpenEnded()&&!e.isNumerical();return!(t||e.hasRandomAssignment())}});SM.Models.register("SharedViewList",{__defaults:{isLoaded:false},__create:function(e){this.survey=e.survey;this.list=[];_.bindAll(this,"_onViewsFetched","_onViewsFetchFailed")},add:function(e){var t=this,i;i=_.indexOf(_.pluck(t.list,"key"),e.get("key"));if(i===-1){t.list.push(e);t._trigger({type:"add",sharedView:e})}},remove:function(e){var t=this,i;i=_.indexOf(t.list,e);t.list.splice(i,1);t._trigger({type:"remove",sharedView:e})},load:function(e){var t=this,i,s;_.each(e,function(e,n){s={survey:t.survey,list:t,attrs:e,index:n};i=SM.Models.create("SharedView",s);t.list.push(i)});t.set("isLoaded",true,{notify:true})},fetch:function(){var e={survey_id:this.survey.ID};$.when(SM.API.fetchSharedViewList(e),{self:this}).done(this._onViewsFetched).fail(this._onViewsFetchFailed)},_onViewsFetched:function(e,t){var i=e[0],s=i.shared_views;this.load(s)},_onViewsFetchFailed:function(e,t,i){}});SM.Models.register("DriverBenchmarkRollup",{__create:function(e){this.driver=e.driver;this.rollupList=e.rollupList;this.rollupKey=e.rollupKey;this.rollupId=e.rollupId;this._rollupData={error:"no_data"}},loadRollupData:function(e){this._rollupData=e},getRollupData:function(){return this._rollupData},getRollupId:function(){return this.rollupId},getRollupKey:function(){return this.rollupKey},hasError:function(){if(this._rollupData){return this._rollupData.error!=="none"}return true},getError:function(){if(this.rollupList.hasError()){return this.rollupList.getError()}return this._rollupData.error||"no_error"},getValue:function(){return this._rollupData.value||0},getRawQuartileValues:function(){return this._rollupData.quartile_values},getQuartileValues:function(){var e=this.getRawQuartileValues(),t={};_.each(e,function(e,i){t[i]=SM.Math.roundTo(e,2,0)});return t},getQuartileValuesArray:function(){var e=this.getQuartileValues(),t=[e[0],e[25],e[50],e[75],e[100]];return t},getSampleSize:function(){return this._rollupData.sample_size||0},getDateStart:function(){return this.date_start||1412188765},getDateEnd:function(){return this.date_end||1443638365},getSegmentName:function(){var e=this.rollupList.survey.dataSegmentList.getSelectedSegment();if(e){return e.name()}SM.API.logError("No current segment!");return""}});SM.Models.register("DriverBenchmarkRollups",{__create:function(e){this.survey=e.survey;this.drivers={};this.driversById={};this.createRollupModels()},createRollupModels:function(){var e=this;_.each(e.survey.driverState.drivers,function(t,i){var s=t.getIdMap();_.each(s,function(i,s){var n=SM.Models.create("DriverBenchmarkRollup",{driver:t,rollupKey:i,rollupId:s,rollupList:e});e.drivers[i]=n;e.driversById[s]=n})})},reset:function(){SM.log("Removing all rollup models.");this.drivers={};this.createRollupModels()},loadRollups:function(e){var t=this;t.rollups=e;if(e){if(e.error&&e.error!=="none"){SM.API.logWarning({message:"Driver benchmark rollups error "+e.error})}_.each(e.driver_benchmarks,function(e,i){if(t.driversById[i]){t.driversById[i].loadRollupData(e)}else{SM.API.logError({message:"Loading driver rollup for driver id "+i+", but no driver available"})}});if(t.survey.isTMBCTemplate()){e.segment_name=t.survey.dataSegmentList.getSelectedSegment().name()}}},getRollup:function(e){return this.drivers[e]||null},getSegmentName:function(){if(this.rollups){return this.rollups.segment_name}},setSegmentName:function(e){if(this.rollups){this.rollups.segment_name=e}},hasError:function(){if(this.rollups){return this.rollups.error&&this.rollups.error!=="none"}return true},getError:function(){if(this.rollups){return this.rollups.error}return"no_data"},_onSelectedViewLoaded:function(e){var t=e.data.self,i=t.survey.anviews.currentView,s=t.survey.questionRollups;if(i.get("lastSwitchStamp")===s.get("lastFetchFilteredStamp")){t.reset();t.loadRollups(e.benchmarkData)}},_onNewSegmentAdded:function(e){var t=e.data.self,i=e.benchmarkData;t.reset();t.loadRollups(i)}});SM.Models.register("DriverState",{drivers:{},DRIVER_ID_MAP:{},DRIVER_KEY_MAP:{},__create:function(e){this.survey=e.survey;this._driverState=e.driverState},registerDriverModel:function(e){var t=this,i=e.getIdMap();if(e.DRIVER_KEY in this.drivers){throw"Model "+e.DRIVER_KEY+" is already registered!"}this.drivers[e.DRIVER_KEY]=e;_.each(i,function(e,i){t.DRIVER_ID_MAP[e]=i;t.DRIVER_KEY_MAP[i]=e})},getDriverModel:function(e){return this.drivers[e]},getDriverKey:function(e){return this.DRIVER_ID_MAP[e]},getDriverId:function(e){return this.DRIVER_KEY_MAP[e]},getAllDriverState:function(){return this._driverState||{}},setAllDriverState:function(e,t){this._driverState=e;this.survey.anviews.defaultView.setDriverState(e,t)},getDriverState:function(e){var t=this.getAllDriverState();return t[e]||{}},setDriverState:function(e,t,i){var s=this.getAllDriverState();s[e]=t;this.setAllDriverState(s,i)},hasError:function(){if(this._driverState){return this._driverState.error&&this._driverState.error!=="none"}return true},getError:function(){if(this._driverState){return this._driverState.error}return"no_data"}});SM.DriverModel={__create:function(e){if(!this.DRIVER_KEY){throw"Missing Driver Key"}this.survey=e.survey},getIdMap:function(){return{}},initData:function(e){var t=this.getIdMap(),i={};if(e){_.each(t,function(t,s){var n;i[t]=e[s];if(!_.isUndefined(i[t])&&_.isUndefined(i[t].value)){n=!_.isUndefined(i[t].score);i[t].value=n?i[t].score:0}})}return i}};SM.Models.extend("TMBC",SM.DriverModel,{DRIVER_KEY:"tmbc",TMBC_ID_MAP:{},TMBC_TYPE_GEI:"tmbc_gei",TMBC_TYPE_ENGAGEMENT:"tmbc_engagement",TMBC_TYPE_ALL:"all",TMBC_ID_GEI:1,TMBC_ID_ENGAGEMENT:2,TMBC_MIN_RESPONSES:3,TMBC_DEFAULT_NAME:"StandOut GEI Benchmark",TMBC_GRADES:[{limit:93.42,grade:"A++",key:"App"},{limit:88.04,grade:"A+",key:"Ap"},{limit:84.08,grade:"A",key:"A"},{limit:80.84,grade:"A-",key:"Am"},{limit:77.92,grade:"A--",key:"Amm"},{limit:75.78,grade:"B++",key:"Bpp"},{limit:73.49,grade:"B+",key:"Bp"},{limit:70.96,grade:"B",key:"B"},{limit:68.17,grade:"B-",key:"Bm"},{limit:64.82,grade:"B--",key:"Bmm"},{limit:60.8,grade:"C++",key:"Cpp"},{limit:56.77,grade:"C+",key:"Cp"},{limit:51.76,grade:"C",key:"C"},{limit:42.232,grade:"C-",key:"Cm"},{limit:0,grade:"C--",key:"Cmm"}],__create:function(e){SM.DriverModel.__create.call(this,e);this.TMBC_ID_MAP[this.TMBC_ID_GEI]=this.TMBC_TYPE_GEI;this.TMBC_ID_MAP[this.TMBC_ID_ENGAGEMENT]=this.TMBC_TYPE_ENGAGEMENT;this.survey.driverState.registerDriverModel(this);if(e.tmbcData.status===0){this._tmbcData=this.initData(e.tmbcData.data)}else{this._tmbcData=e.tmbcData;SM.API.logError(e.tmbcData)}this._wasEdited=e.wasEdited},getIdMap:function(){return this.TMBC_ID_MAP},getTMBCDriverState:function(e){var t=this.survey.driverState.getDriverState(this.DRIVER_KEY);if(e===this.TMBC_TYPE_ALL){if(!t[this.TMBC_TYPE_GEI]){t[this.TMBC_TYPE_GEI]={}}if(!t[this.TMBC_TYPE_ENGAGEMENT]){t[this.TMBC_TYPE_ENGAGEMENT]={}}return t}if(!t[e]){t[e]={}}return t[e]},setTMBCDriverState:function(e,t,i){var s=this.survey.driverState.getDriverState(this.DRIVER_KEY);if(e===this.TMBC_TYPE_ALL){s=t}else{s[e]=t}this.survey.driverState.setDriverState(this.DRIVER_KEY,s,i)},setTMBCShowHide:function(e,t,i){var s=t?SM.QuestionDisplayModel.DISPLAY_VALUES.show:SM.QuestionDisplayModel.DISPLAY_VALUES.hide,n=this.getTMBCDriverState(e);if(e===this.TMBC_TYPE_ALL){n[this.TMBC_TYPE_GEI].show_benchmark=s;n[this.TMBC_TYPE_ENGAGEMENT].show_benchmark=s}else{n.show_benchmark=s}this.setTMBCDriverState(e,n)},getTMBCShowHide:function(e){var t=this.getTMBCDriverState(e);return t.show_benchmark!==SM.QuestionDisplayModel.DISPLAY_VALUES.hide},setTMBCChartType:function(e,t,i){var s=this.getTMBCDriverState(e);s.chart_type=t;this.setTMBCDriverState(e,s)},getTMBCChartType:function(e){var t=this.getTMBCDriverState(e);return t.chart_type||SM.QuestionDisplayModel.DISPLAY_VALUES.donut},getDateStart:function(e){var t=this.survey.driverRollups.getRollup(e);if(t){return t.getDateStart()}return""},getDateEnd:function(e){var t=this.survey.driverRollups.getRollup(e);if(t){return t.getDateEnd()}return""},getTMBCValue:function(e){return this._tmbcData[e].value},getTMBCBenchmarkValue:function(e){var t=this.survey.driverRollups.getRollup(e);if(t){return t.getValue()}return 0},getQuartileValues:function(e){var t=this.survey.driverRollups.getRollup(e),i,s={};if(t){i=t.getQuartileValues();_.each(i,function(e,t){s[t]=SM.Math.roundTo(e,2,0)})}return s},getQuartileValuesArray:function(e){var t=this.getQuartileValues(e),i=[t[0],t[25],t[50],t[75],t[100]];return i},calculateQuartile:function(e){var t=this.survey.driverRollups.getRollup(e),i=t.getRawQuartileValues(),s=this.getTMBCValue(e);if(!i){return{}}if(s<=i["25"]){return{bottom:true}}if(s<=i["50"]){return{lower:true}}if(s<=i["75"]){return{upper:true}}return{top:true}},getSampleSize:function(e){var t=this.survey.driverRollups.getRollup(e);if(t){return t.getSampleSize()}return 0},getSegmentName:function(){return this.survey.driverRollups.getSegmentName()},getTMBCName:function(e){if(e===this.TMBC_TYPE_GEI){return"Your GEI"}else if(e===this.TMBC_TYPE_ENGAGEMENT){return"Your % Fully Engaged"}return""},getGrade:function(e){for(var t=0;t<this.TMBC_GRADES.length;t++){if(e>=this.TMBC_GRADES[t].limit){return this.TMBC_GRADES[t]}}return this.TMBC_GRADES[this.TMBC_GRADES.length-1]},hasTooFewResponses:function(){return this.survey.respondentCounts.total<this.TMBC_MIN_RESPONSES},wasEdited:function(){return this._wasEdited},hasError:function(){if(this._tmbcData){return this._tmbcData.error&&this._tmbcData.error!=="none"}return true},getError:function(){if(this._tmbcData){return this._tmbcData.error}return"no_data"}});SM.AnalyzeLoaderView=SM.Views.register({__NAME:"analyzeLoaderView",__templateID:"analyze-content-loader-template",__defaults:{defaultTop:200,isFixed:false},__getters:{isFixed:function(e){if(SM.Browser.isIE7){return false}return e.__settings.isFixed}},show:function(){if(this.get("isFixed")){this.$el.css({position:"fixed",top:"50%",marginTop:-(this.$el.outerHeight()/2)})}else{this.$el.css({position:"absolute",top:this.get("defaultTop"),marginTop:0})}this.$el.removeClass("exit").removeClass("hide");this._isShown=true},hide:function(){var e=this;if(e._isShown){e._isShown=false;setTimeout(function(){if(!e._isShown){e.$el.addClass("exit");e.$el.css("top","-=200");setTimeout(function(){if(!e._isShown){e.$el.addClass("hide")}},400)}},400)}}});SM.AnalyzeMainView=SM.Views.register({__NAME:"analyzeMainView",__model:"survey",__templateID:"analyze-main-column-template",__create:function(e){this.userIsOverResponseLimit=this.survey.owner.isOverResponseLimit(this.survey.respondentCounts.total)},__beforeRender:function(){return{isOverResponseLimit:this.userIsOverResponseLimit}},__afterRender:function(){if(this._shouldRenderResponseLimitUpgradeView()){this._renderResponseLimitUpgradeView()}if(this._shouldRenderProfilerDriverView()){this._renderProfilerDriverView()}this._renderAnalyzeHeaderView();this._renderContentNavView();this._renderAnalyzeContentWrapperView();if(this.survey.state.isSummaryMode()&&!SM.App.isSharingApp()){this.survey.dataSegmentList.on(SM.DataSegmentListModel.DATA_SEGMENT_LOADED,{self:this},this._onDataSegmentLoaded)}},_renderAnalyzeHeaderView:function(){var e=SM.Views.create(SM.AnalyzeHeaderView,{model:this.survey});this.el.appendChild(e.el)},_renderContentNavView:function(){var e=SM.Views.create(SM.ContentNavView,{model:this.survey});this.el.appendChild(e.el)},_renderAnalyzeContentWrapperView:function(){var e=SM.Views.create(SM.AnalyzeContentWrapperView,{model:this.survey});this.el.appendChild(e.el)},_renderResponseLimitUpgradeView:function(){var e=SM.Views.create(SM.ResponseLimitUpgradeView,{model:this.survey,classes:"sm-corner-a spacer-mbl",linkSource:"wall_responselimit&ut_source2=new_analyze"});this.el.appendChild(e.el)},_renderProfilerDriverView:function(){var e=SM.Views.create(SM.ProfilerDriverView,{model:this.survey});this.el.appendChild(e.el)},_onDataSegmentLoaded:function(e){var t=e.data.self;t.$el.find(".profiler-driver-ctnr").hide()},_shouldRenderResponseLimitUpgradeView:function(){if(SM.App.isSharingApp()){return false}else{return this.userIsOverResponseLimit}},_shouldRenderProfilerDriverView:function(){if(!this.survey.state.isSummaryMode()||SM.App.isSharingApp()){return false}return this.survey.isProfilerDriverEnabled()}});SM.AnalyzeHeaderView=SM.Views.register({__NAME:"AnalyzeHeaderView",__model:"survey",__templateID:"analyze-header-container-template",__afterRender:function(){this._renderStatsHeaderView();if(this._shouldRenderQuotasHeaderView()){this._renderQuotasHeaderView()}this._renderModeTabsView()},_renderStatsHeaderView:function(){var e=SM.Views.create(SM.StatsHeaderView,{model:this.survey});this.el.appendChild(e.el)},_renderQuotasHeaderView:function(){var e=SM.Views.create(SM.QuotasHeaderView,{model:this.survey.quotas});this.el.appendChild(e.el)},_renderModeTabsView:function(){var e=SM.Views.create(SM.ModeTabsView,{model:this.survey});this.el.appendChild(e.el)},_shouldRenderQuotasHeaderView:function(){return this.survey.quotas&&!!this.survey.quotas.equations}});SM.NoResponsesView=SM.Views.register({__NAME:"noResponsesView",__templateID:"no-responses-template",__model:"survey",__beforeRender:function(){var e={surveyIDEncryption:this.survey.encryptedID,classes:this.__settings.classes,shouldShowBuyResponsesButton:Globalize.culture().name==="en",surveyID:this.survey.ID,onSharedPage:SM.App.isSharingApp()};return e}});SM.AnalyzeContentView=SM.Views.register({__NAME:"analyzeContentView",__model:"survey",__templateID:"analyze-pages-content-container",__init:function(){var e=this.survey.state;if(e.isSummaryMode()){this.bindModel(this.survey.questionRollups,"isLoading.changed",{self:this},this._onIsLoadingChanged);if(this.survey.owner.hasBenchmarking()){this.bindModel(this.survey.benchmarkRollups,"isLoading.changed",{self:this},this._onIsLoadingChanged);this.bindModel(this.survey.dataSegmentList,"isLoading.changed",{self:this},this._onIsLoadingChanged)}}else if(e.isBrowseMode()){this.bindModel(this.survey,"respondentCounts.changed",{self:this},this._onRespondentCountChanged);this.bindModel(this.survey.respondentsList,"isLoading.changed",{self:this},this._onIsLoadingChanged)}else if(e.isTrendMode()){this.bindModel(this.survey.trendsModel,"isLoading.changed",{self:this},this._onIsLoadingChanged)}},__beforeRender:function(){var e=this.survey.getCountOfBenchmarkableQuestions()>0,t=this.survey.hasFilteredRespondents(),i=this.survey.hasRespondents(),s=this.survey.shownQuestionList.length>0,n=this.survey.questionCount>0,r=this.survey.state;if(r.isSummaryMode()&&!SM.App.isSharingApp()&&!t&&e){t=true;i=true}return{hasQuestions:n,hasShownQuestions:s,hasRespondents:i,hasFilteredResponses:t}},__afterRender:function(e){var t,i=this._getModelState();if(i.failed){t=SM.Template.renderHTML("content-load-error-template",{classes:"mod-no-header",requestID:i.requestID})}else if(!e.hasQuestions){t=SM.Template.renderHTML("no-questions-template",{surveyIDEncryption:this.survey.encryptedID,classes:"mod-no-header"})}else if(!e.hasRespondents){t=SM.Views.create(SM.NoResponsesView,{model:this.survey,classes:"mod-no-header"}).el}else if(!e.hasFilteredResponses){t=SM.Template.renderHTML("filtered-no-responses-template",{classes:"mod-no-header"})}else if(this.survey.state.isSummaryMode()){t=SM.Views.create(SM.SummaryPageListView,{model:this.survey}).el}else if(this.survey.state.isBrowseMode()){t=SM.Views.create(SM.RespondentListView,{model:this.survey}).el}else if(this.survey.state.isTrendMode()){t=SM.Views.create(SM.TrendContainerView,{model:this.survey.trendsModel}).el}this.el.appendChild(t)},_getModelState:function(){var e=this.survey,t=e.state;if(t.isSummaryMode()){return{requestID:e.questionRollups.get("failedLoadRequestID"),failed:e.questionRollups.get("failedLoad")}}else if(t.isBrowseMode()){return{requestID:e.respondentsList.get("failedLoadRequestID"),failed:e.respondentsList.get("failedLoad")}}else if(t.isTrendMode()){return{requestID:e.trendsModel.get("failedLoadRequestID"),failed:e.trendsModel.get("failedLoad")}}},_onIsLoadingChanged:function(e){var t=e.data.self,i=e.value;if(!i){t.render();t.$el.removeClass("disabled")}else{t.$el.addClass("disabled")}},_onRespondentCountChanged:function(e){var t=e.data.self;if(!t.survey.hasFilteredRespondents()){t.render()}}});SM.AnalyzeContentWrapperView=SM.Views.register({__NAME:"analyzeContentWrapperView",__model:"survey",__templateID:"analyze-pages-content-wrapper-container",__init:function(){var e=this.survey.state;if(e.isSummaryMode()){this.bindModel(this.survey.questionRollups,"isLoading.changed",{self:this},this._onIsLoadingChanged);this.bindModel(this.survey.questionRollups,"isUpdating.changed",{self:this},this._onIsUpdatingChanged);if(this.survey.owner.hasBenchmarking()){this.bindModel(this.survey.benchmarkRollups,"isLoading.changed",{self:this},this._onIsLoadingChanged);this.bindModel(this.survey.dataSegmentList,"isLoading.changed",{self:this},this._onIsLoadingChanged)}}else if(e.isBrowseMode()){this.bindModel(this.survey.respondentsList,"isLoading.changed",{self:this},this._onIsLoadingChanged)}else if(e.isTrendMode()){this.bindModel(this.survey.trendsModel,"isLoading.changed",{self:this},this._onIsLoadingChanged)}this._isLoading=false;this._isUpdating=false},__destroy:function(){$(window).off("scroll."+this.__uid+"."+this.__NAME);this._loaderView=null},__afterRender:function(){var e,t;this._loaderView=SM.Views.create(SM.AnalyzeLoaderView);e=SM.Views.create(SM.AnalyzeContentView,{model:this.survey});this.el.appendChild(this._loaderView.el);this.el.appendChild(e.el)},_showSpinner:function(){this.$el.css({height:this.$el.height(),width:this.$el.width()});this.$el.find("[analyze-mode-spinner-backdrop]").removeClass("hide").addClass("disabled");this._loaderView.show();$(window).on("scroll."+this.__uid+"."+this.__NAME,{self:this},this._onScroll);$(window).scroll()},_hideSpinner:function(e){this.$el.find("[analyze-mode-spinner-backdrop]").addClass("hide").removeClass("disabled");this.$el.css({height:"auto",width:"auto"});$(window).off("scroll."+this.__uid+"."+this.__NAME,this._onScroll);this._loaderView.hide()},_onIsLoadingChanged:function(e){var t=e.data.self,i=e.value;if(i){t._isLoading=true;setTimeout(function(){if(!t._isLoading){return}t._showSpinner()},400)}else{t._isLoading=false;setTimeout(function(){t._hideSpinner()},0)}},_onIsUpdatingChanged:function(e){var t=e.data.self,i=e.value;if(i){t._isUpdating=true;t._showSpinner()}else{t._isUpdating=false;setTimeout(function(){t._hideSpinner()},0)}},_onScroll:function(e){var t=e.data.self,i=t.$el.offset(),s=$(window).scrollTop();if(s<i.top){t._loaderView.$el.css("top",100)}else{t._loaderView.$el.css("top",100+s-i.top)}}});SM.PageArrowBtnsView=SM.Views.register({__NAME:"pageArrowBtnsView",__model:"survey",__templateID:"page-arrow-btns-template",__init:function(){this.survey.state.on("page.changed",{self:this},this._onPageChange);this.$el.on(SM.Event.CLICK,"[sm-prev-btn]",{self:this},this._onPrevPageClick).on(SM.Event.CLICK,"[sm-next-btn]",{self:this},this._onNextPageClick)},__destroy:function(){this.survey.state.off("page.changed",this._onPageChange)},__beforeRender:function(){var e=this.survey.state.get("page"),t=this.survey.getLastShownPage(),i=this.survey.getFirstShownPage(),s=e<=i.position-1,n=e>=t.position-1,r=this.survey.state.get("allPagesSelected");return{prevBtnDisabled:r||s,nextBtnDisabled:r||n}},_onPageChange:function(e){var t=e.data.self;t.render()},_onNextPageClick:function(e){var t=e.data.self,i=t.survey.state.get("page"),s=t.survey.state.get("allPagesSelected"),n;e.preventDefault();if(s){return}n=t.survey.getNextShownPage(i);if(!n){return}t.survey.state.set("page",n.position-1,{notify:true})},_onPrevPageClick:function(e){var t=e.data.self,i=t.survey.state.get("page"),s=t.survey.state.get("allPagesSelected"),n;e.preventDefault();if(s){return}n=t.survey.getPrevShownPage(i);if(!n){return}t.survey.state.set("page",n.position-1,{notify:true})}});SM.PageMenuBtnView=SM.Views.register({__NAME:"pageMenuBtnView",__model:"survey",__templateID:"page-menu-btn-template",__init:function(e){this.survey.state.on("page.changed",{self:this},this._onPageChange);this.$el.actionMenu({menuView:"PageMenuView",model:this.survey,selectedAction:this.survey.state.get("page").toString(),saveState:true}).on("actionMenu.actionSelected",{self:this},this._onPageSelected).on("actionMenu.beforeOpen",{self:this},this._onBeforeMenuOpen)},__destroy:function(){this.survey.state.off("page.changed",this._onPageChange)},__beforeRender:function(){var e,t=this.survey.state.get("page"),i=this.survey.anviews.currentView.hasActiveShowRule(),s=this.survey.state.get("allPagesSelected");if(t!=="all"){e=t+1}return{hasShowRule:i,allPagesSelected:s,pageNumber:e}},_onPageSelected:function(e){var t=e.data.self,i=e.action;if(i!=="all"){i=parseInt(i,10)}t.survey.state.set("page",i,{notify:true})},_onBeforeMenuOpen:function(e){e.actionMenu.get("menuView").render();
},_onPageChange:function(e){var t=e.data.self,i=t.$el.data("actionMenu");i.set("selectedAction",t.survey.state.get("page"));t.render()}});SM.PageMenuView=SM.Views.deepExtend(SM.ActionMenuView,{__NAME:"pageMenuView",__model:"survey",__templateID:"page-menu-template",__beforeRender:function(){var e=this.survey.pageCount,t=this.survey.anviews.currentView.hasActiveShowRule(),i=[],s,n,r=0;for(;r<e;r++){n=this.survey.pageList[r];s={};s.title=n.heading;s.number=n.position;s.index=n.position-1;s.isShown=n.isShown();i.push(s)}return{pages:i,hasShowRule:t}}});SM.PageNavView=SM.Views.register({__NAME:"pageNavView",__model:"survey",__templateID:"page-nav-container-template",__init:function(){this.survey.on("shownListsChanged",{self:this},this._onShownListChange)},__destroy:function(){this.survey.off("shownListsChanged",this._onShownListChange)},__beforeRender:function(){return{pageCount:this.survey.pageCount}},__afterRender:function(e){var t,i;if(e.pageCount>1){i=SM.Views.create(SM.PageMenuBtnView,{model:this.survey});t=SM.Views.create(SM.PageArrowBtnsView,{model:this.survey});this.el.appendChild(t.el);this.el.appendChild(i.el)}},_onShownListChange:function(e){var t=e.data.self;t.render()}});SM.ContentNavView=SM.Views.register({__NAME:"contentNavView",__model:"survey",__templateID:"content-nav-view-template",__init:function(){this.bindModel(this.survey,"respondentCounts.changed",{self:this},this._onCountUpdate);this.bindModel(this.survey.anviews,"selectedViewLoaded",{self:this},this._onSelectedViewLoaded);this.bindModel(this.survey,"shownListsChanged",{self:this},this._onShownListChange)},__beforeRender:function(){var e=this.survey.pageCount,t=this.survey.state.isBrowseMode(),i=this.survey.respondentCounts.total_context>1,s=this.survey.respondentCounts.total_context===1,n=t&&i,r=this.survey.shownQuestionList.length>0,a=this.survey.shownPageList.length>0,o=(i||s)&&e>1&&r&&a;return{hasPageNav:o,hasRespondentNav:n,isHidden:!o&&!n}},__afterRender:function(e){var t,i;if(!e.isHidden){if(e.hasPageNav){t=SM.Views.create(SM.PageNavView,{model:this.survey});this.el.appendChild(t.el)}if(e.hasRespondentNav){i=SM.Views.create(SM.RespondentNavView,{model:this.survey});this.el.appendChild(i.el)}}},_onCountUpdate:function(e){var t=e.data.self;t.render()},_onShownListChange:function(e){var t=e.data.self;t.render()},_onSelectedViewLoaded:function(e){var t=e.data.self;t.render()}});SM.ModeTabsView=SM.Views.register({__NAME:"modeTabsView",__templateID:"analyze-mode-tabs-template",__model:"survey",__beforeRender:function(){return{isSummaryMode:this.survey.state.isSummaryMode(),isBrowseMode:this.survey.state.isBrowseMode(),isTrendMode:this.survey.state.isTrendMode(),displayBrowseTab:this._displayBrowseTab(),displayTrendTab:this._displayTrendsTab(),summaryTabURL:this._summaryTabURL(),browseTabURL:this._browseTabURL(),trendsTabURL:this._trendsTabURL(),isDebug:SM.DEBUG}},__afterRender:function(){var e=this.$el.find("[sm-tab-text]");e.each(function(e,t){var i=$(t),s=i.text(),n="",r=s.match(/[^\s]+/g);$.each(r,function(e,t){n+=t;if(e===r.length-1){return false}if(r[e+1].length<=3){n+=" "}else{n+="<br/>"}});i.html(n)})},__init:function(){this.$el.on(SM.Event.CLICK,"#mode_tab_trends",{self:this},this._onTrendsTabClick)},_onTrendsTabClick:function(e){var t=e.data.self,i;if(!t.survey.owner.hasTrends()){e.preventDefault();i=SM.Views.create(SM.DialogView,{width:800,isModal:true,templateID:"trends-upgrade-dialog-template"});i.open()}},_displayBrowseTab:function(){if(SM.App.isSharingApp()){return SM.App.sharedView.isBrowseTabEnabled()}else{return SM.DISPLAY_BROWSE_TAB}},_displayTrendsTab:function(){if(SM.App.isSharingApp()){return SM.App.sharedView.isTrendsTabEnabled()}else{return SM.DISPLAY_TREND_TAB}},_buildTabURL:function(e){var t=new Uri(e);return t.toString()},_summaryTabURL:function(){var e;if(SM.App.isSharingApp()){e=SM.App.sharedView.sharedPagePath()}else{e="/analyze/"+this.survey.encryptedID}return this._buildTabURL(e)},_browseTabURL:function(){var e;if(SM.App.isSharingApp()){e=SM.App.sharedView.sharedPagePath()+"browse/"}else{e="/analyze/browse/"+this.survey.encryptedID}return this._buildTabURL(e)},_trendsTabURL:function(){var e;if(SM.App.isSharingApp()){e=SM.App.sharedView.sharedPagePath()+"data-trends/"}else{e="/analyze/data-trends/"+this.survey.encryptedID}return this._buildTabURL(e)}});SM.SharedPageAuthFormView=SM.Views.register({__NAME:"SharedPageAuthFormView",__templateID:"shared-page-auth-form-template",__create:function(e){this.password=e.password;this.passwordIsValid=e.passwordIsValid;this.validations={"#password":{type:"presence",message:"Please enter a password"}};_.bindAll(this,"_onPasswordInputChange","_onPasswordInputFocus")},__beforeRender:function(){return{password:this.password,passwordIsInvalid:!!this.password&&!this.passwordIsValid}},__afterRender:function(){var e=this;e.$passwordInput=e.$el.find("[type='password']");e.$submitButton=e.$el.find("[type='submit']");e.$passwordInput.on("keyup",this._onPasswordInputChange);e.$passwordInput.on("focus",this._onPasswordInputFocus)},__init:function(){var e=this;e.form=e.$el.find("form").form({formView:e}).data("form");e.$passwordInput.focus()},_onPasswordInputFocus:function(e){},_onPasswordInputChange:function(e){if(this.$passwordInput.val().length){this.$submitButton.prop("disabled",false)}else{this.$submitButton.prop("disabled",true)}}});SM.ExportAllBtnView=SM.Views.register({__NAME:"ExportAllBtnView",__model:"survey",__templateID:"export-all-btn-view-template",__init:function(){this.$el.actionMenu({menuView:"ExportAllMenuView",exportEnabled:this.survey.owner.hasExports(),singleMode:this.__settings.singleMode,disallowResponses:this.__settings.disallowResponses,hasTACloud:this.__settings.hasTACloud,taEnabled:this.survey.owner.canExportTA(),hasCloudView:this.__settings.hasCloudView,hasChartView:this.__settings.hasChartView}).on("actionMenu.actionSelected",{self:this},this._onMenuAction).on("click",{self:this},function(e){var t=e.data.self;SM.Bi.uiTrigger=t.__settings.buttonName});if(this.survey.anviews.currentView.hasCompareRule()&&this.survey.anviews.currentView.compareRule.isRA){this._disableDotNETExports()}else if(this.survey.anviews.currentView.hasFilterRule()&&this.survey.anviews.currentView.hasRAFilterSelected()){this._disableDotNETExports()}else{this._enableDotNETExports()}this.question=this.__settings.question},__beforeRender:function(){return{noBorder:this.__settings.noBorder,singleMode:this.__settings.singleMode,disallowResponses:this.__settings.disallowResponses}},__afterRender:function(e){this.$el.find(".q").popout()},_disableDotNETExports:function(){var e=this;e.survey.config.export_formats_enabled.full.excel=false;e.survey.config.export_formats_enabled.full.excel_plus=false;e.survey.config.export_formats_enabled.full.spss=false;e.survey.config.export_formats_enabled.full.gss=false;e.survey.config.export_formats_enabled.summary.excel=false;e.survey.config.export_formats_enabled.summary.csv=false},_enableDotNETExports:function(){var e=this;e.survey.config.export_formats_enabled.full.excel=e.survey.config.export_formats_enabled_server_side.full.excel;e.survey.config.export_formats_enabled.full.excel_plus=e.survey.config.export_formats_enabled_server_side.full.excel_plus;e.survey.config.export_formats_enabled.full.spss=e.survey.config.export_formats_enabled_server_side.full.spss;e.survey.config.export_formats_enabled.full.gss=e.survey.config.export_formats_enabled_server_side.full.gss;e.survey.config.export_formats_enabled.summary.excel=e.survey.config.export_formats_enabled_server_side.summary.excel;e.survey.config.export_formats_enabled.summary.csv=e.survey.config.export_formats_enabled_server_side.summary.csv},_onMenuAction:function(e){var t,i=e.data.self,s=e.action,n=i.survey,r=e.$action.hasClass("pro"),a=s==="individual";if(s==="individual"){s="full"}if(r){var o="export-upgrade-dialog-template";if(i.__settings.singleMode){switch(s){case"summary":o="export-single-upgrade-dialog-template";break;case"cloud":o="ta-upgrade-dialog-template";break;case"chart":o="export-chart-upgrade-dialog-template";break}}t=SM.Views.create(SM.DialogView,{width:800,isModal:true,templateID:o});t.open()}else{if(n.owner.get("hipaaEnabled")){t=SM.Views.create(SM.HipaaExportWarningView,{model:n,jobType:"export",onContinueClick:function(){i._createExportDialog(n,s,a)}});t.open()}else{i._createExportDialog(n,s,a)}}},_createExportDialog:function(e,t,i){var s,n,r,a=e.anviews.currentView;n={email:e.currentUserEmail,export_type:t==="cloud"?"chart":t,export_data:{respondent_id:"all"}};if(this.question!==undefined){n.export_data.question_id=this.question.ID;n.questionNumber=this.question.position;if(t==="chart"||t==="cloud"){n.format="png"}if(t==="cloud"){n.export_data.show_word_cloud=true;n.export_data.include_openended=true}}r=e.exportJobs.createJob(n);r.sourceView=a;s=SM.Views.create(SM.ExportDialogView,{model:r,viewSelectMode:true,disallowResponses:this.__settings.disallowResponses,individualResponseMode:i,hasChartView:this.__settings.hasChartView,question:this.question});e.exportJobs.fetchJobs();s.open()}});SM.NewExportBtnView=SM.Views.extend(SM.ExportAllBtnView,{__NAME:"NewExportBtnView",__templateID:"new-export-btn-view-template"});SM.ExportAllMenuView=SM.Views.deepExtend(SM.ActionMenuView,{__NAME:"ExportAllMenuView",__templateID:"export-all-menu-template",__afterRender:function(){SM.ActionMenuView.__afterRender.call(this);this.$el.find(".q").popout()}});SM.ExportDialogView=SM.Views.deepExtend(SM.DialogView,{__NAME:"ExportJobDialogView",__model:"exportJob",__templateID:"export-dialog-view",__defaults:{viewSelectMode:false,responseSelectMode:false,confirmDisabled:true,isModal:true,width:750,disallowResponses:false,individualResponseMode:false},__init:function(e){var t=this,i=t.exportJob.exportJobs.survey.owner;this.viewID=e.viewID;this.errors={};this.$el.on(SM.Event.CLICK,"div .confirm-btn",{self:this},this._onConfirm).on(SM.Event.CLICK,"div .cancel-btn",{self:this},this._closeDialog).on(SM.Event.CLICK,"ul li a.export-summary-tab",{self:this},this._onSummaryTabClick).on(SM.Event.CLICK,"a[edit-view-select]",{self:this},this._onEditViewSelection).on(SM.Event.CLICK,"ul li a.all-response-tab",{self:this},this._onAllResponseTabClick).on(SM.Event.CLICK,"input[type='radio'][value='current']",{self:this,view:"currentView"},this._onEditViewSelection).on(SM.Event.CLICK,"input[type='radio'][value='original']",{self:this,view:"defaultView"},this._onEditViewSelection).on({formatClicked:function(e,i){t.buttonsView.render()}});this.bindModel(this.exportJob.exportJobs,"jobDeleted",{self:this},this._onJobDeleted);this.bindModel(this.exportJob.exportJobs,"jobCancelled",{self:this},this._onJobDeleted);this.bindModel(this.exportJob.exportJobs,"isLoaded.changed",{self:this},this._onExportJobsLoadedChanged);this.bindModel(this.exportJob.exportJobs,"jobStatusChanged",{self:this},this._onJobStatusChanged);this.bindModel(this.exportJob.exportJobs,"isUnavailable.set",{self:this},this._onExportJobsUnavailable);this.bindModel(this.exportJob.exportJobs,"clickedExportPreferenceUpgradeTrigger",{self:this},this._closeDialog)},__onAfterClose:function(){this.$el.remove()},_onJobStatusChanged:function(e){var t=e.data.self;if(e.job.type==="full"&&!e.job.pending()){t.render()}},_onJobDeleted:function(e){var t=e.data.self;if(!t.exportJob.exportJobs.hasFullExportPending()){t.render()}},_onExportJobsLoadedChanged:function(e){var t=e.data.self;t.render()},_hasNoMatchingResponses:function(){return!this.exportJob.exportJobs.survey.hasFilteredRespondents()||this.__settings.question&&this.__settings.question.getRollup().summary.answered===0&&!this.__settings.question.hasRandomAssignment()},__beforeRender:function(){var e=this.exportJob,t=e.exportJobs,i=e.type===e.TYPE.SUMMARY_EXPORT,s={viewModel:this.exportJob.sourceView,viewSelectMode:this.__settings.viewSelectMode,responseSelectMode:this.__settings.responseSelectMode,fullExportsInProgress:!i&&t.hasFullExportPending(),exportsLoaded:t.get("isLoaded"),exportsIsUnavailable:t.isUnavailable,isAllowedToExport:!t.isNotAllowedToExport(),singleMode:e.get("isSingleQuestionMode"),showWordCloud:e.exportData.show_word_cloud,disallowResponses:this.__settings.disallowResponses};s[e.type+"Mode"]=true;return s},__afterRender:function(){var e,t=this.exportJob,i=t.exportJobs,s=i.survey,n=t.type===t.TYPE.SUMMARY_EXPORT,r=t.type===t.TYPE.CHART_EXPORT,a=t.exportData.show_word_cloud,o=!n&&i.hasFullExportPending(),l={model:t,hasChartView:this.__settings.hasChartView,question:this.__settings.question};SM.DialogView.__afterRender.call(this);if(i.isAvailable()){if(i.isNotAllowedToExport()){e=SM.Template.render("retry-export-warning");this.$el.children("section").append(e)}else{if(o){this.panel=SM.Views.create(SM.FullExportPendingListView,{model:i});this.$el.children("section").append(this.panel.el)}else if(this._hasNoMatchingResponses()&&!a){this.panel=SM.Views.create(SM.ExportDialogNoMatchingResponsesView,{survey:s});this.$el.find("div.current-panel").append(this.panel.$el)}else{if(n){this.panel=SM.Views.create(SM.ExportDialogSummaryView,l)}else if(r){this.panel=SM.Views.create(SM.ChartExportDialogView,l)}else{this.panel=SM.Views.create(SM.ExportDialogAllResponseView,{model:t,individualResponseMode:this.__settings.individualResponseMode})}this.$el.find("div.current-panel").append(this.panel.$el)}this.buttonsView=SM.Views.create(SM.ExportDialogButtonView,{model:t,dialogDisabled:o||this._hasNoMatchingResponses()&&!a,exportsLoaded:i.get("isLoaded")});this.$el.find(".buttons-wrapper").append(this.buttonsView.$el)}}else{e=SM.Template.render("exports-unavailable-template",{requestID:i.unavailableErrorID});this.$el.children("section").html(e)}this.$el.find(".q").popout()},_onExportJobsUnavailable:function(e){if(e.value){e.data.self.render()}},_onEditViewSelection:function(e){var t=e.data.self,i=e.data.view;t.exportJob.sourceView=t.exportJob.exportJobs.survey.anviews.get(i)},_onSummaryTabClick:function(e){var t=e.data.self;e.preventDefault();t.exportJob.type=t.exportJob.TYPE.SUMMARY_EXPORT;t.exportJob.format=undefined;t.render()},_onAllResponseTabClick:function(e){var t=e.data.self;e.preventDefault();t.exportJob.type=t.exportJob.TYPE.ALL_EXPORT;t.exportJob.format=undefined;t.render()},_closeDialog:function(e){e.preventDefault();e.data.self.close()},_onConfirm:function(e){var t=e.data.self,i;e.preventDefault();if(t.exportJob.format!==undefined){if(t.panel.validate()){t.close();if(t.exportJob.format==="gss"&&t.exportJob.exportJobs.requiresDriveAuth()){window.SM.authPendingDialogViewInstance=t;i=window.open("/analyze/export/drive/auth-req/?state=launch")}else{t.close();t.exportJob.finalizeExportData();t.exportJob.exportJobs.addJob(t.exportJob)}}else{t.panel.render()}}},onAuthEstablished:function(){this.exportJob.exportJobs.onAuthEstablished(this.exportJob)},onAuthFailed:function(){var e="There was a problem exporting your data",t=SM.Notifications.error({title:Globalize.localize(e),classes:"export-job-failed-notification",tabMessage:Globalize.localize("Export failed"),content:SM.Template.render("export-job-notification-error-message-template",{job:this.exportJob,exportTooLarge:false}),duration:1e4})}});SM.FullExportPendingListView=SM.Views.register({__NAME:"FullExportPendingListView",__templateID:"pending-full-exports-list-template",__model:"exportJobs",__afterRender:function(){var e=this,t=e.$el.find("ul"),i=this.exportJobs.getPendingFullExports();$.each(i,function(e,i){var s=SM.Views.create(SM.FullExportPendingView,{model:i});t.append(s.el)})}});SM.FullExportPendingView=SM.Views.register({__NAME:"FullExportPendingView",__templateID:"pending-full-export-template",__model:"exportJob",__init:function(){var e=this;this.$el.on("click","[cancel-btn]",{self:this},this._onCancelClick);this.bindModel(this.exportJob,"isCancelled.changed",{self:this},this._onDeleteJob);this.bindModel(this.exportJob,"deleted",{self:this},this._onDeleteJob)},__beforeRender:function(){return{job:this.exportJob}},_onDeleteJob:function(e){var t=e.data.self;t.$el.remove()},_onCancelClick:function(e){var t=e.data.self,i=t.exportJob,s=i.exportJobs;e.preventDefault();if(i.isNew()){s.cancelJob(i)}else{s.deleteJob(i)}}});SM.ExportDialogButtonView=SM.Views.register({__NAME:"ExportDialogButtonView",__model:"exportJob",__settings:{dialogDisabled:false,exportsLoaded:true},__templateID:"export-dialog-button-view",__beforeRender:function(){var e=this.exportJob.exportJobs.survey.owner,t=this.exportJob,i=t.format;return{dialogDisabled:this.__settings.dialogDisabled,upgradeRequired:!e.canExport(this.exportJob.format),confirmDisabled:t.format===undefined,exportsLoaded:this.__settings.exportsLoaded,exportType:i,isPPT:i===t.FORMAT.PPT,isSPSS:i===t.FORMAT.SPSS}},__defaults:{confirmDisabled:true}});SM.BaseExportDialogPanelView={__model:"exportJob",__templateID:"export-panel-view",__init:function(e){var t=this,i=this.exportJob.exportJobs.survey.config.export_formats_enabled;this.$el.on({emailEnter:function(e,i){t.exportJob.email=i},filenameEnter:function(e,i){t.exportJob.name=i},formatClicked:function(e,s){if(i[t.exportJob.type][s]){if(t.exportJob.format===s){t.exportJob.set("format",undefined)}else{t.exportJob.set("format",s)}t.render();t.$el.find(".error-msg").hide()}},useOneExcelSheetChanged:function(e,i){t.exportJob.set("questionDisplay",i)}})},_addTextInputs:function(){var e=this.errors||{},t=this.exportJob,i;this.exportJob.name=this.exportJob.generateFileName();i=SM.Views.create(SM.ExportDialogTextInputView,{label:Globalize.localize("File Name"),preferenceType:"filename",textValue:this.exportJob.name,error:e.filename,isPPT:!!!e.filename&&t.format===t.FORMAT.PPT});this.el.appendChild(i.el)},__beforeRender:function(e){var t={format:this.exportJob.format,isSingleMode:this.exportJob.get("isSingleQuestionMode"),chartMode:this.exportJob.type==="chart",showWordCloud:this.exportJob.exportData.show_word_cloud,summaryMode:this.exportJob.type===this.exportJob.TYPE.SUMMARY_EXPORT};if(t.format){t[t.format+"Selected"]=true}else{t.selectType=null}return t},__afterRender:function(e){var t=0,i=this._exportFormats.length,s=this.exportJob.type,n=this.exportJob.exportJobs.survey.config.export_formats_enabled[s],r=this.exportJob.format,a=this.$el.find("tr").get(0);for(;t<i;t++){a.appendChild(SM.Views.create(SM.ExportDialogFormatView,{isSelected:this._exportFormats[t]===this.exportJob.format,format:this._exportFormats[t],type:this.exportJob.type,isDisabled:!n[this._exportFormats[t]]}).el)}if(r){this.renderPreferences(this);this._addTextInputs()}this.$el.find(".q").popout()},validate:function(){var e=/\S+@\S+\.\S+/,t=/\S+/,i=$.trim(SM.String.htmlStrip(this.exportJob.name)),s=SM.String.htmlStrip(this.exportJob.email),n;this.errors={};if(!i.length){i=this.exportJob.generateFileName()}n=i.lastIndexOf(".");if(n!==-1){i=i.substr(0,n)}else{i=i}if(i.length>250){this.errors.filename=Globalize.localize("Max filename length is 250 characters")+".";return false}if(!t.test(i)){this.errors.filename=Globalize.localize("Please enter a valid filename")+".";return false}this.exportJob.email=s;this.exportJob.name=this.exportJob.generateFileName(i);return true}};SM.ExportDialogNoMatchingResponsesView=SM.Views.register({__NAME:"ExportDialogNoMatchingResponsesView",__templateID:"export-panel-view-no-matching-responses",__beforeRender:function(e){var t={surveyHasRespondents:e.survey.hasRespondents()};return t}});SM.ExportDialogSummaryView=SM.Views.extend(SM.BaseExportDialogPanelView,{__NAME:"ExportDialogSummaryView",__init:function(e){var t=this,i;SM.BaseExportDialogPanelView.__init.call(this,e);this.$el.on({pdfOrientationChanged:function(e,i){t.exportJob.set("pdfOrientation",i)},pdfPaperSizeChanged:function(e,i){t.exportJob.set("pdfPaperSize",i)},includeOpenendedChanged:function(e,i){t.exportJob.set("includeOpenended",i)},showWordCloudChanged:function(e,i){t.exportJob.set("showWordCloud",i)},useNonBrandedTemplateChanged:function(e,i){t.exportJob.set("useNonBrandedTemplate",i)},forcedPageBreakChanged:function(e,i){t.exportJob.set("forcedPageBreak",i)}})},__afterRender:function(e){var t=this.exportJob.type,i=this.exportJob.exportJobs.survey.config.export_formats_enabled[t];i.ppt=this.isPPTExportEnabled();SM.BaseExportDialogPanelView.__afterRender.call(this,e)},isPPTExportEnabled:function(){var e=this.exportJob.get("isSingleQuestionMode"),t=this.exportJob.exportJobs.survey.anviews.currentView,i,s;if(t.hasRACompareSelected()){return false}else if(e){i=this.__settings.question;return this.exportJob.canExportQuestionInPPT(i)}return true},hasEnabledOpenEndedInExports:function(){return!SM.SharedAnalyzeApp||!SM.SharedAnalyzeApp.data.shared_view.hide_open_ended},_exportFormats:["pdf","ppt","excel","csv"],renderPreferences:function(){var e=[],t,i=this.exportJob,s=this;t=SM.Views.create(SM.ExportDialogDataFilterView,{model:this.exportJob});e.push(t);if(i.format===i.FORMAT.PDF){t=SM.Views.create(SM.ExportDialogPdfInputView,{model:this.exportJob});e.push(t)}if(i.format===i.FORMAT.EXCEL){t=SM.Views.create(SM.ExportDialogXlsSheetChoiceView,{model:this.exportJob});e.push(t)}if(i.format!==i.FORMAT.PPT){if(s.hasEnabledOpenEndedInExports()){e.push(SM.Views.create(SM.ExportDialogCheckboxInputView,{type:"includeOpenended",isChecked:this.__settings.hasChartView===false,label:Globalize.localize("Open-ended responses"),isCheckedWordCloud:this.__settings.hasChartView===false,labelWordCloud:Globalize.localize("Word Clouds"),isUpgradeTrigger:false}))}}else{t=SM.Views.create(SM.ExportDialogChartAndOrTableChoiceView,{model:i});e.push(t);t=SM.Views.create(SM.ExportDialogCheckboxInputView,{type:"useNonBrandedTemplate",isChecked:false,label:Globalize.localize("Hide SurveyMonkey Branding"),isUpgradeTrigger:!i.exportJobs.survey.owner.canHideExportBranding(),upgradeTemplate:"export-hide-branding-upgrade-dialog-template",exportJobs:i.exportJobs});e.push(t)}_.each(e,function(e){s.$el.append(e.$el)});if(s.__settings.hasChartView===false){s.exportJob.set("includeOpenended",true);s.exportJob.set("showWordCloud",true)}}});SM.ChartExportDialogView=SM.Views.extend(SM.BaseExportDialogPanelView,{__NAME:"ChartExportDialogView",__init:function(e){var t=this;SM.BaseExportDialogPanelView.__init.call(this,e);this.exportJob.initExport()},__afterRender:function(e){SM.BaseExportDialogPanelView.__afterRender.call(this,e);this.$el.find(".disabled .folded").hide()},renderPreferences:function(){var e=[],t,i=this;t=SM.Views.create(SM.ExportDialogDataFilterView,{model:this.exportJob});e.push(t);$.each(e,function(e,t){i.$el.append(t.$el)})},_exportFormats:["png","","",""]});SM.ExportDialogAllResponseView=SM.Views.extend(SM.BaseExportDialogPanelView,{__NAME:"ExportDialogAllResponseView",_exportFormats:["excel","excel_plus","gss","spss","pdf"],__defaults:{individualResponseMode:false},__init:function(e){var t=this;SM.BaseExportDialogPanelView.__init.call(this,e);this.$el.on({xlsColumnChoiceChanged:function(e,i){t.exportJob.set("columnSetting",i)},xlsCellChoiceChanged:function(e,i){t.exportJob.set("cellType",i)},pdfPaperSizeChanged:function(e,i){t.exportJob.set("pdfPaperSize",i)},respondentChanged:function(e,i){t.render()},forcedPageBreakChanged:function(e,i){t.exportJob.set("forcedPageBreak",i)}});if(this.__settings.individualResponseMode){t.$el.trigger("formatClicked","pdf")}},renderPreferences:function(){var e=[],t=this.exportJob,i,s=t.respondentID!=="all",n=this;i=SM.Views.create(SM.ExportDialogDataFilterView,{model:this.exportJob});e.push(i);if(t.format==="excel"){i=SM.Views.create(SM.ExportDialogXlsColumnCellChoiceView,{model:t});e.push(i)}if(t.format==="pdf"){i=SM.Views.create(SM.ExportDialogResponseSelectView,{model:this.exportJob,responseSelectMode:s});e.push(i);i=SM.Views.create(SM.ExportDialogPdfInputView,{model:this.exportJob,onlyPaperSize:true});e.push(i)}$.each(e,function(e,t){n.$el.append(t.$el)})}});SM.ExportDialogCheckboxInputView=SM.Views.register({__NAME:"ExportDialogCheckboxInputView",__templateID:"export-dialog-preference-checkbox",__defaults:{type:null,label:null,isChecked:false,isUpgradeTrigger:false,isDisabled:false,upgradeTemplate:null,exportJobs:null},__init:function(){var e=this,t;this.$el.on(SM.Event.CLICK,function(){if(e.__settings.isUpgradeTrigger){t=e.__settings.exportJobs;t._trigger({type:"clickedExportPreferenceUpgradeTrigger",upgradeTemplate:e.__settings.upgradeTemplate})}else if(!e.__settings.isDisabled){e.__settings.isChecked=!e.__settings.isChecked;e.$el.trigger(e.__settings.type+"Changed",e.__settings.isChecked);e.render()}})},__beforeRender:function(){return{type:this.__settings.type,isChecked:this.__settings.isChecked,checkboxLabel:this.__settings.label,isInclude:this.__settings.type==="includeOpenended",isUpgradeTrigger:this.__settings.isUpgradeTrigger,isDisabled:this.__settings.isDisabled}}});SM.ExportDialogCheckboxInputViewV1=SM.Views.register({__NAME:"ExportDialogCheckboxInputView",__templateID:"export-dialog-preference-checkbox",__defaults:{type:null,label:null,isChecked:false,isUpgradeTrigger:false,isDisabled:false,upgradeTemplate:null,exportJobs:null},__init:function(){var e=this,t;this.$el.on(SM.Event.CLICK,function(i){var s=i.target.value,n=$(i.target).prop("checked");if(e.__settings.isUpgradeTrigger){t=e.__settings.exportJobs;t._trigger({type:"clickedExportPreferenceUpgradeTrigger",upgradeTemplate:e.__settings.upgradeTemplate})}else if(!e.__settings.isDisabled){if(s==="cloud"){e.__settings.isCheckedWordCloud=n;e.$el.trigger("showWordCloudChanged",n)}else{e.__settings.isChecked=n;e.$el.trigger(e.__settings.type+"Changed",n)}e.render()}})},__beforeRender:function(){return{type:this.__settings.type,label:this.__settings.label,isChecked:this.__settings.isChecked,isDisabled:this.__settings.isDisabled,isInclude:this.__settings.type==="includeOpenended",labelWordCloud:this.__settings.labelWordCloud,isCheckedWordCloud:this.__settings.isCheckedWordCloud,isUpgradeTrigger:this.__settings.isUpgradeTrigger}}});SM.ExportDialogTextInputView=SM.Views.register({__NAME:"ExportDialogTextInputView",__templateID:"export-dialog-text-input",__init:function(){var e=this;this.$el.on(SM.Event.KEYUP,"input",function(){e.$el.trigger(e.__settings.preferenceType+"Enter",$(this).val())})},__defaults:{textValue:null,label:null,isLastSection:false,preferenceType:null}});SM.ExportDialogDataFilterView=SM.Views.register({__NAME:"ExportDialogDataFilterView",__model:"exportJob",__templateID:"export-data-filter-view",__init:function(){return},__beforeRender:function(){var e=this.exportJob,t={viewModel:this.exportJob.sourceView,viewSelectMode:true,singleMode:e.get("isSingleQuestionMode"),localizedQuestionLabel:Globalize.localize("Question")+" #"+e.questionNumber};return t}});SM.ExportDialogPdfInputView=SM.Views.register({__NAME:"ExportDialogPdfInputView",__model:"exportJob",__templateID:"export-dialog-pdf-input-template",__defaults:{onlyPaperSize:false},__init:function(){var e=this;this.$el.on("selectMenu.change","a[orientation]",function(t){e.$el.trigger("pdfOrientationChanged",t.value)}).on("selectMenu.change","a[paper-size]",function(t){e.$el.trigger("pdfPaperSizeChanged",t.value)})},__beforeRender:function(){var e={onlyPaperSize:this.__settings.onlyPaperSize};return e},__afterRender:function(){this.renderPreferences();this.$el.find("a[orientation]").selectMenu({selectedValue:this.exportJob.get("pdfOrientation"),options:[{text:Globalize.localize("Portrait (Vertical)"),value:"portrait"},{text:Globalize.localize("Landscape (Horizontal)"),value:"landscape"}]});this.$el.find("a[paper-size]").selectMenu({selectedValue:this.exportJob.get("pdfPaperSize"),options:[{text:Globalize.localize('Letter (8.5" x 11")'),value:"letter"},{text:Globalize.localize('Legal (8.5" x 14")'),value:"legal"},{text:Globalize.localize("A4 (210mm \xd7 297mm)"),value:"A4"}]})},renderPreferences:function(){var e=this,t=this.exportJob,i=t.get("isSingleQuestionMode"),s=t.type===t.TYPE.SUMMARY_EXPORT,n="Start each question on a new page",r="Start each response on a new page",a;a=SM.Views.create(SM.ExportDialogCheckboxInputView,{type:"forcedPageBreak",isChecked:true,label:Globalize.localize(s?n:r),isUpgradeTrigger:false,isDisabled:this.isPageBreakPreferenceDisabled()});e.$el.append(a.$el)},isPageBreakPreferenceDisabled:function(){var e=this.exportJob,t=e.type,i=t===e.TYPE.SUMMARY_EXPORT,s=t===e.TYPE.ALL_EXPORT,n=e.get("isSingleQuestionMode"),r=e.get("isSingleResponseMode");if(n&&i){return true}else if(r&&s){return true}return false}});SM.ExportDialogResponseSelectView=SM.Views.register({__NAME:"ExportDialogResponseSelectView",__model:"exportJob",__templateID:"export-dialog-response-select-template",__defaults:{responseSelectMode:false},__init:function(){var e=this;this.$el.on("change","input[type='radio'][name='response']",{self:this},this._onEditResponseSelection)},__beforeRender:function(){var e=this.exportJob,t=e.exportData.respondent_id!=="all",i={responseSelectMode:this.__settings.responseSelectMode,individualResponse:t,respondentID:e.respondentID,respondentNumber:e.respondentNumber,singleRespondentID:this.__NAME+this.__uid+"radio-single-respondent",allRespondentsID:this.__NAME+this.__uid+"radio-all-respondents"};return i},_onEditResponseSelection:function(e){var t=e.data.self;t.exportJob.exportData.respondent_id=e.currentTarget.value;t.exportJob.name=t.exportJob.generateFileName();t.$el.trigger("respondentChanged",e.currentTarget.value)}});SM.ExportDialogXlsSheetChoiceView=SM.Views.register({__NAME:"ExportDialogXlsSheetChoiceView",__templateID:"export-dialog-xls-sheet-choice-view",__model:"exportJob",__init:function(){var e=this;this.$el.on(SM.Event.CLICK,"input",function(){e.$el.trigger("useOneExcelSheetChanged",$(this).val())})},__beforeRender:function(){return{singleMode:this.exportJob.get("isSingleQuestionMode")}}});SM.ExportDialogXlsColumnCellChoiceView=SM.Views.register({__NAME:"ExportDialogXlsColumnCellChoiceView",__model:"exportJob",__templateID:"export-dialog-xls-column-cell-choice-view",__init:function(){var e=this;this.$el.on("selectMenu.change","a[column]",function(t){e.$el.trigger("xlsColumnChoiceChanged",t.value)}).on("selectMenu.change","a[cell]",function(t){e.$el.trigger("xlsCellChoiceChanged",t.value)})},__afterRender:function(){this.$el.find("a[column]").selectMenu({options:[{text:Globalize.localize("Condensed"),value:"condensed"},{text:Globalize.localize("Expanded"),value:"expanded"}],selectedValue:this.exportJob.exportData.column_setting});this.$el.find("a[cell]").selectMenu({options:[{text:Globalize.localize("Actual Answer Text"),value:"actual_choice_text"},{text:Globalize.localize("Numerical Value (1-n)"),value:"numerical_value"}],selectedValue:this.exportJob.exportData.cell_type})}});SM.ExportDialogChartAndOrTableChoiceViewV1=SM.Views.register({__NAME:"ExportDialogChartAndOrTableChoiceView",__model:"exportJob",__templateID:"export-dialog-chart-and-or-table-choice-view",__init:function(){var e=this;this.$el.on("change","input[type='checkbox'][name='chart-and-or-table']",{self:this},this._onEditChartAndOrTableSelection)},_onEditChartAndOrTableSelection:function(e){var t=e.data.self,i=e.currentTarget.value,s=$(e.currentTarget).prop("checked"),n=t.exportJob.exportData;switch(i){case"chart":n.include_charts=s;break;case"table":n.include_tables=s;break;case"cloud":n.show_word_cloud=s;break}}});SM.ExportDialogChartAndOrTableChoiceView=SM.Views.register({__NAME:"ExportDialogChartAndOrTableChoiceView",__model:"exportJob",__templateID:"export-dialog-chart-and-or-table-choice-view",__init:function(){var e=this;this.$el.on("change","input[type='radio'][name='chart-and-or-table']",{self:this},this._onEditChartAndOrTableSelection)},_onEditChartAndOrTableSelection:function(e){var t=e.data.self,i=e.currentTarget.value,s=t.exportJob.exportData;switch(i){case"chart-and-table":s.include_charts=true;s.include_tables=true;break;case"chart-only":s.include_charts=true;s.include_tables=false;break;case"table-only":s.include_charts=false;s.include_tables=true;break}}});SM.ExportDialogFormatView=SM.Views.register({__templateID:"export-dialog-format-view",__NAME:"ExportDialogFormatView",
__init:function(e){var t=this;this.$el.on(SM.Event.CLICK,function(e){if(!t.__settings.isDisabled){t.$el.trigger("formatClicked",t.__settings.format)}})},styleMap:{csv:{ext:".csv",icon:"\xbc",labelColor:"exp-green",iconClass:"smf-icon icon",description:"Opens in most analytics software"},excel:{ext:".xls",icon:"\xbc",labelColor:"exp-green",iconClass:"smf-icon icon",description:"Opens in Microsoft Excel"},excel_plus:{ext:".xls+",icon:"\xbc",labelColor:"exp-green",iconClass:"smf-icon icon",description:"Open in advanced statistical and analytical software"},rdb:{ext:".rdb",icon:"\xbc",labelColor:"exp-purple",iconClass:"smf-icon icon",description:"Provides a separate file for each database table"},spss:{ext:"spss",icon:"\xbc",labelColor:"exp-red",iconClass:"smf-icon icon",description:"Open in your SPSS analytical software"},gss:{ext:"drive",icon:"N",labelColor:"exp-blue",iconClass:"smf-icon-2 gss-icon",description:"Downloads directly to Google Sheets"},html:{ext:".html",icon:"\xdc",labelColor:"exp-purple",iconClass:"smf-icon icon",description:"Ideal for posting directly to a website"},png:{ext:".png",icon:"\xdc",labelColor:"exp-orange",iconClass:"smf-icon icon",description:"Best for adding charts as images to presentations"},pdf:{ext:".pdf",icon:"\xdc",labelColor:"exp-red",iconClass:"smf-icon icon",description:"Ideal for sharing and printing"},ppt:{ext:".ppt",icon:"\xdc",labelColor:"exp-light-purple",iconClass:"smf-icon icon",description:"Ideal for presenting in Microsoft PowerPoint"},pdf_chart:{ext:".pdf",icon:"\xdc",labelColor:"exp-red",iconClass:"smf-icon icon",description:"Ideal for sharing and opening on all computers"}},__defaults:{isSelected:false,isDisabled:false,format:null},__beforeRender:function(){var e=SM.Object.copy(this.styleMap[this.__settings.format]);e.description=Globalize.localize(e.description);e.isSelected=this.__settings.isSelected;e.format=this.__settings.format;e.isDisabled=this.__settings.isDisabled;return e}});SM.AnalyzeWarningDialogView=SM.Views.deepExtend(SM.DialogView,{__NAME:"AnalyzeWarningDialogView",__model:"survey",__defaults:{width:800},__create:function(e){var t=this;t.onContinueClick=e.onContinueClick},__init:function(){var e=this;e.$el.on(SM.Event.CLICK,".continue-btn",{self:e},e._onContinueClick)},_onContinueClick:function(e){var t=e.data.self;t.onContinueClick()}});SM.HipaaExportWarningView=SM.Views.deepExtend(SM.AnalyzeWarningDialogView,{__NAME:"HipaaExportWarningView",__templateID:"hipaa-export-warning",__model:"survey",__defaults:{jobType:"export",width:800},__beforeRender:function(){var e=this.__settings.jobType+"Mode",t={};t[e]=true;return t}});SM.QuotaEditWarningView=SM.Views.deepExtend(SM.AnalyzeWarningDialogView,{__NAME:"QuotaEditWarningView",__templateID:"quota-edit-warning",__defaults:{width:600,isModal:true}});SM.FiloDeleteWarningView=SM.Views.deepExtend(SM.AnalyzeWarningDialogView,{__NAME:"FiloDeleteWarningView",__templateID:"filo-delete-warning",__model:"files",__defaults:{width:600,isModal:true},__beforeRender:function(){var e=this.files.length===1,t={singleMode:e};if(e){t.fileName=this.files[0].name;t.fileSize=SM.FiloUtils.formatSize(this.files[0].file_size)}else{t.fileCount=this.files.length}return t}});SM.SocialSharingButtonsView=SM.Views.register({__NAME:"SocialSharingButtonsView",__templateID:"social-sharing-buttons-template",__create:function(e){this.dataUrl=e.dataUrl;this.sharedViewTitle=e.sharedViewTitle},__beforeRender:function(){return{dataUrl:this.dataUrl,sharedViewTitle:this.sharedViewTitle}},__afterRender:function(){this.loadTwitterShareButton();this.loadFacebookShareButton();this.loadGooglePlusShareButton();this.loadLinkedInShareButton(".linkedin-container");$("#social-sharing-container").append(this.el);try{IN.parse()}catch(e){}},loadTwitterShareButton:function(){try{twttr.widgets.load(this.el)}catch(e){}},loadFacebookShareButton:function(){try{FB.XFBML.parse(this.el)}catch(e){}},loadGooglePlusShareButton:function(){try{gapi.plus.go(this.el)}catch(e){}},loadLinkedInShareButton:function(e){var t='<script type="IN/Share" ';if(!!this.dataUrl){t=t+"data-url="+this.dataUrl}t=t+"></script>";this.$el.find(".linkedin-container").html(t)}});SM.BaseApp={ERROR_CODES:{MODELS:"1",VIEWS:"2",ROUTERS:"3"},initializers:{beforeInit:[],afterInit:[]},__beforeInit:function(e){var t=this;SM.Error.init();SM.Tooltips.init();SM.Ajax.init(e.version);SM.API.init(e.survey_id);t._renderLoaderView();t._runInitializers("before",e)},__afterInit:function(e){var t=this;t._runInitializers("after",e)},init:function(e){var t=this;SM.App=t;SM.Browser.support.needsBrowserUpgrade();t.el=e.el;t.version=e.version;t.dataURL=t._setDataURL(e.data_url);t.surveyTitle=e.survey_title;t.JClipboardMovieUrl=e.jclipboard_movie_url;t.dfd=$.Deferred();SM.raHeader="A/B Test";t.__beforeInit(e);if(t.dataURL){_.bindAll(this,"_onSuccess","_onFail","_onAlways","_loadData");SM.Ajax.get(t.dataURL).done(t._onSuccess,function(){t.__afterInit(e)}).fail(t._onFail).always(t._onAlways)}else{t._onAlways()}return t.dfd},_buildSurveyModel:function(e,t){var i=this,s,n;SM.API.setUser(e.current_user.id);i.setCulture(e.survey_data);s=SM.Models.create("Survey",{survey_data:e.survey_data,npsEnabled:e.config.nps_enabled,mode:e.analyze_mode,includeOpenEnded:e.include_openended||t.includeOpenEnded});s.loadAnalyzeState({mode:e.analyze_mode,pageIndex:e.page_index});s.loadConfig(e.config);s.loadOwner(e.owner);n=s.owner;s.loadCurrentUser(e.current_user);s.loadViews({viewMap:e.views,currentViewID:e.current_view_id,defaultViewID:e.default_view_id,selectedViewID:e.selected_view_id});if(t.loadSharedViews){s.loadSharedViews(e.shared_views)}if(t.loadExportJobs){s.loadExportJobs(e.exportjob_list)}if(e.respondent_data.status===0){s.set("respondentCounts",e.respondent_data.data.respondent_counts)}else{s.set("respondentCounts",{failed:true})}if(s.state.isBrowseMode()){s.loadRespondents(e.respondent_data)}else if(s.state.isSummaryMode()){if(!this.isSharingApp()){if(!e.profiler_data||e.profiler_data.status!==0||(!e.segment_data||e.segment_data.status!==0)){s.owner.benchmarkingEnabled=false;n=null}s.dataSegmentList=SM.Models.create("DataSegmentList",{survey:s,defaultView:s.anviews.defaultView,benchmarkQuestions:e.survey_data.benchmark_questions,segmentData:e.segment_data});s.loadBenchmarkRollups(e.benchmark_data);s.profiler=SM.Models.create("Profiler",{parent:s,user:n,profiler_data:e.profiler_data,basePath:"/analyze",webapp:"anweb",source:"profilerDialog",showHeading:true,disableOrgAC:false,showDefaultCB:false,showOptInCB:true,disableAccordion:true,showQuestionText:false,openIfInvalid:true,hasCollectorProfile:s.hasProfiledCollector()})}s.driverState=SM.Models.create("DriverState",{survey:s,driverState:s.anviews.defaultView.getDriverState()});if(s.isTMBCTemplate()){s.tmbc=SM.Models.create("TMBC",{survey:s,tmbcData:e.driver_data,wasEdited:!s.validateTMBCTemplate()})}s.loadDriverRollups(e.benchmark_data);s.loadQuestionRollups(e.respondent_data)}else if(s.state.isTrendMode()){s.loadSurveyTrends(e.respondent_data)}return s},_renderLoaderView:function(){var e=this;e._loaderView=SM.Views.create(SM.AnalyzeLoaderView,{isFixed:true});e.el.appendChild(e._loaderView.el);e._loaderView.show()},_setDataURL:function(e){var t=new Uri(e);t.setProtocol("https");t.addQueryParam("utc_offset",SM.Date.utcOffset().toString());t=t.toString();SM.log("data.js URL: "+t);return t},_handleLoadingError:function(e){var t=SM.Template.renderHTML("content-load-error-template",{requestID:e.requestID,errorCode:e.errorCode,classes:"analyze-failed-load mod-no-header"});$(this.el).html(t)},_onSuccess:function(e){this.data=e;this._loadData(e);this.dfd.resolve()},_onFail:function(e){this._handleLoadingError({requestID:e.request_id,encryptedSurveyID:e.survey_id_encryption});this.dfd.reject()},_onAlways:function(){this._loaderView.hide()},_runInitializers:function(e,t){var i;if(_.isEmpty(this.initializers)){return}i=this.initializers[e+"Init"];if(i.length){_.each(i,function(e){e.call(this,SM.App,t)})}},isSharingApp:function(){return false},isExportApp:function(){return false},isMerveysApp:function(){return this.survey.isMergedSurvey},isSharingEnabled:function(){return this.survey.isSharingEnabled()&&this.survey.owner.hasSharing()},isDebug:function(){return!!SM.DEBUG},setCulture:function(){var e=Globalize.getSmartlingCulture();Globalize.culture(e);Globalize.addCultureInfo(e,{messages:SM.translations})}};SM.AnalyzeApp=SM.Object.deepExtend(SM.BaseApp,{_loadData:function(e){var t=this;if("is_merge_completed"in e.survey_data&&!e.survey_data.is_merge_completed){window.location.href="/analyze/merve/design-tool/"+e.survey_id_encryption;return}try{t._initConstants(e);t.survey=t.survey=t._buildSurveyModel(e,{includeOpenEnded:true,loadSharedViews:true,loadExportJobs:true})}catch(i){t.dfd.reject();t._handleLoadingError({errorCode:t.ERROR_CODES.MODELS,encryptedSurveyID:e.survey_id_encryption});SM.Error.log(i,"AnalyzeApp failed to initialize models");return}try{t._initRouters()}catch(i){t.dfd.reject();t._handleLoadingError({errorCode:t.ERROR_CODES.ROUTERS,encryptedSurveyID:e.survey_id_encryption});SM.Error.log(i,"AnalyzeApp failed to initialize routers");return}try{t._render(t.survey)}catch(i){t.dfd.reject();t._handleLoadingError({errorCode:t.ERROR_CODES.VIEWS,encryptedSurveyID:e.survey_id_encryption});SM.Error.log(i,"AnalyzeApp failed to render");return}try{$(".sidetab").sideTab()}catch(i){t.dfd.reject();SM.Error.log(i,"AnalyzeApp sidetabs/tours failed")}},_initConstants:function(e){SM.DISPLAY_BROWSE_TAB=e.display_browse_tab;SM.DISPLAY_TREND_TAB=e.display_trend_tab},_initRouters:function(){this.SharedViewsRouter=new SM.SharedViewsRouter({survey:this.survey})},_render:function(e){this._renderMainView(e);this._renderSecondaryView(e)},_renderMainView:function(e){var t=SM.Views.create(SM.AnalyzeMainView,{model:e});this.el.appendChild(t.el)},_renderSecondaryView:function(e){var t=SM.Views.create(SM.AnalyzeSecondaryView,{model:e});this.el.appendChild(t.el)}});SM.SharedAnalyzeApp=SM.Object.deepExtend(SM.AnalyzeApp,{__NAME:"SharedAnalyzeApp",__beforeInit:function(e){var t=this,i=$(".charity-header-container"),s;if(i){s="-"+i.height()+"px";i.css({top:s,display:"block"});i.animate({top:"0"},500);setTimeout(function(){i.animate({top:s},{duaration:500,complete:function(){i.remove()}})},4e3)}SM.AnalyzeApp.__beforeInit.call(t,e);if($("#survey_responses_count").val()>1e4){t.dataURL=null}},_loadData:function(e){var t=this,i="spv",s;try{t._initConstants(e);t.survey=t._buildSurveyModel(e,{includeOpenEnded:false,loadSharedViews:false,loadExportJobs:!!e.shared_view.allow_team_export});t.sharedView=t._buildSharedViewModel(e.shared_view)}catch(n){t.dfd.reject();t._handleLoadingError({errorCode:t.ERROR_CODES.MODELS,encryptedSurveyID:e.survey_id_encryption});SM.Error.log(n,"AnalyzeApp failed to initialize models");return}try{t._render(t.survey,t.sharedView)}catch(n){t.dfd.reject();t._handleLoadingError({errorCode:t.ERROR_CODES.VIEWS,encryptedSurveyID:e.survey_id_encryption});SM.Error.log(n,"AnalyzeApp failed to render");return}if(SM.Cookies.get(i)){}else{s=t.sharedView.sharedPagePath();SM.Cookies.set(i,"1","1d",{path:s});t.sharedView.incrementNumViews()}},_initConstants:function(e){SM.AnalyzeApp._initConstants.call(this,e)},_buildSharedViewModel:function(e){var t=this;return SM.Models.create("SharedView",{survey:t.survey,attrs:e})},_buildSurveyModel:function(e,t){var i=SM.AnalyzeApp._buildSurveyModel.call(this,e,t);SM.API.setUser(e.current_user.id);i.date_created=e.survey_data.date_created;i.date_closed=e.survey_date_closed;this.resetTitleTag();return i},_render:function(e,t){var i;e.sharedView=t;i=SM.Views.create(SM.SharedAnalyzeMainView,{model:e});$(this.el).append(i.el);$("#userAcctMenu").actionMenu({templateID:"account-action-menu-template",position:{my:"right top",at:"right bottom"}})},isSharingApp:function(){return true},resetTitleTag:function(){var e=$("<div></div>");e.html(this.surveyTitle);$(document).attr("title",e.text()+Globalize.localize(" - Responses | SurveyMonkey"))},setCulture:function(e){var t=e.language.code;Globalize.culture(t);Globalize.addCultureInfo(t,{messages:SM.translations})}});SM.SharedAnalyzeMainView=SM.Views.deepExtend(SM.AnalyzeMainView,{__NAME:"SharedAnalyzeMainView",__templateID:"shared-analyze-main-column-template",__afterRender:function(){this._renderSharedAnalyzeHeaderView();this._renderContentNavView();this._renderAnalyzeContentWrapperView()},_renderSharedAnalyzeHeaderView:function(){var e=this,t=SM.Views.create(SM.SharedAnalyzeHeaderView,{model:e.survey}),i=e.survey.sharedView,s=t.shouldShow(),n=$(e.el);if(s){n.append(t.el)}if(i.isSocialShareable()){SM.Views.create(SM.SocialSharingButtonsView,{})}else{$("#social-sharing-container").remove()}$(".survey-date-created").html(Globalize.format(new Date(e.survey.date_created),"d"));if(e.survey.date_closed){$(".survey-date-closed").html(Globalize.format(new Date(e.survey.date_closed),"d"))}if($(".shared-page-content.allow-team-export").length){var r=n.find(".actions-header");r.append(SM.Views.create(SM.ExportAllBtnView,{model:e.survey,disallowResponses:!i.isBrowseTabEnabled(),noBorder:true,buttonName:"ExportSharedPageButton"}).el);if(s){r.removeClass("sm-corner-a").addClass("sm-corner-t");$(t.el).removeClass("sm-corner-a").addClass("sm-corner-b")}e.inProgressNotification=null;if($("#export-progress-notification-template").length){e.bindModel(e.survey.exportJobs,"jobAdded",{},function(){if(!e.inProgressNotification){e.inProgressNotification=SM.Notifications.success({title:Globalize.localize("Exporting your file..."),tabMessage:Globalize.localize("Exporting your file..."),expires:false,templateID:"export-progress-notification-template"})}});e.bindModel(e.survey.exportJobs,"jobStatusChanged",{self:e},e._onStatusChanged)}}},_onStatusChanged:function(e){var t=e.job,i=e.data.self,s=t.get("status"),n=t.NOTIFICATION_MESSAGES[s],r=false,a;if(t.done()){r=true;a=SM.Notifications.success({title:Globalize.localize(n),message:Globalize.localize('Click "Download" to save the file to your computer.'),expires:false,classes:"export-job-success-notification",tabMessage:Globalize.localize("Export complete"),content:SM.Template.render("export-job-notification-download-link-template",{job:t})});a.$el.on("click",".download-btn",function(e){e.preventDefault();window.location=$(e.target).attr("link");a.close()})}else if(t.failed()){r=true;a=SM.Notifications.error({title:Globalize.localize(n),classes:"export-job-failed-notification",tabMessage:Globalize.localize("Export failed"),expires:false,content:SM.Template.render("export-job-notification-error-message-template",{job:t,exportTooLarge:s===t.STATUS.TOO_LARGE_ERROR})})}if(r&&i.inProgressNotification){i.inProgressNotification.close();i.inProgressNotification=null}}});SM.SharedAnalyzeHeaderView=SM.Views.deepExtend(SM.AnalyzeHeaderView,{__NAME:"SharedAnalyzeHeaderView",shouldShow:function(){return this._shouldShowModeTabsView()},__afterRender:function(){if(this._shouldShowModeTabsView()){SM.AnalyzeHeaderView._renderModeTabsView.call(this)}},_shouldShowModeTabsView:function(){return SM.App.sharedView.isBrowseTabEnabled()||SM.App.sharedView.isTrendsTabEnabled()}});